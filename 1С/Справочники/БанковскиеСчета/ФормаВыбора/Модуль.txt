Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	Если РежимВыбора И НЕ ЗначениеЗаполнено(Отбор.Владелец.Значение) И НЕ ЗначениеЗаполнено(ПараметрОтборПоВладельцу) Тогда
		
		Если ТипЗнч(ВладелецФормы) <> Тип("ТабличноеПоле") Тогда
			Если ТипЗнч(ВладелецФормы.ВыборПоВладельцу)=Тип("СправочникСсылка.Контрагенты") Тогда
				ФормаВыбораВладельца = Справочники.Контрагенты.ПолучитьФормуВыбора();
				ФормаВыбораВладельца.Заголовок = "Выберите контрагента, счет которого Вы хотите выбрать.";
			ИначеЕсли ТипЗнч(ВладелецФормы.ВыборПоВладельцу)=Тип("СправочникСсылка.Организации") Тогда
				ФормаВыбораВладельца = Справочники.Организации.ПолучитьФормуВыбора();
				ФормаВыбораВладельца.Заголовок = "Выберите организацию, счет которой Вы хотите выбрать.";
			Иначе
				//необходимо выбрать - чей счет выбираем организации или контрагента
				СписокВариантов = новый СписокЗначений;
				СписокВариантов.Добавить("Счет организации");
				СписокВариантов.Добавить("Счет контрагента");
				РезультатВыбора = СписокВариантов.ВыбратьЭлемент();
				Если РезультатВыбора = неопределено Тогда
					Отказ = истина;
					Возврат;
				Иначе
					Если РезультатВыбора.Значение = "Счет организации" Тогда
						ФормаВыбораВладельца = Справочники.Организации.ПолучитьФормуВыбора();
						ФормаВыбораВладельца.Заголовок = "Выберите организацию, счет которой Вы хотите выбрать.";
					Иначе
						ФормаВыбораВладельца = Справочники.Контрагенты.ПолучитьФормуВыбора();
						ФормаВыбораВладельца.Заголовок = "Выберите контрагента, счет которого Вы хотите выбрать.";
					КонецЕсли;
				КонецЕсли;
			КонецЕсли;
			
			Владелец = ФормаВыбораВладельца.ОткрытьМодально();
				
			Если Владелец=Неопределено Тогда
				Отказ=Истина;
			КонецЕсли;
				
			Если Отбор.Владелец.ТипЗначения.СодержитТип(ТипЗнч(Владелец)) Тогда
				Отбор.Владелец.Значение = Владелец;
			КонецЕсли;
			Если ЗначениеЗаполнено(Отбор.Владелец.Значение) Тогда
				Отбор.Владелец.Использование = Истина;
			КонецЕсли;
				
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

// Процедура - обработчик события "ПриОткрытии" формы
//
Процедура ПриОткрытии()

КонецПроцедуры