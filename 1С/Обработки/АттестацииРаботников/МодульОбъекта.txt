////////////////////////////////////////////////////////////////////////////////
// ЭКСПОРТНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

#Если ТолстыйКлиентОбычноеПриложение Тогда

// Процедура построения справки на кандидата.
//
// Параметры: 
//  ФизЛицо        - Тип Элемент справочника "ФизическиеЛица"	
//  Подразделение  - Тип Элемент справочника "Подразделения"
//  Должность      - Тип Элемент справочника "Должности"
//
//
Процедура ПостроитьСправку(ТабличныйДокумент, ТекущиеДанные) Экспорт
	
	ТабличныйДокумент.Очистить();
	
	Если ТекущиеДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	// Вывод шапки
	Макет = ПолучитьМакет("Макет");
	Область = Макет.ПолучитьОбласть("Шапка");
	
	Область.Параметры.Работник		= ТекущиеДанные.Сотрудник;
	
	ТабличныйДокумент.Вывести(Область);
	
	// Данные для списка не оцененых компетенций.
	Запрос = Новый Запрос;
	
	Запрос.УстановитьПараметр("Сотрудник", ТекущиеДанные.Сотрудник);
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	АттестацияРаботникаСписокКомпетенций.Компетенция КАК Компетенция,
	|	АттестацияРаботникаСписокКомпетенций.Ссылка.Ссылка КАК Документ,
	|	АттестацияРаботникаСписокКомпетенций.Ссылка.Ответственный,
	|	АттестацияРаботникаСписокКомпетенций.Ссылка.Дата
	|ИЗ
	|	Справочник.СотрудникиОрганизаций КАК СотрудникиОрганизаций
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.АттестацияРаботника.СписокКомпетенций КАК АттестацияРаботникаСписокКомпетенций
	|		ПО СотрудникиОрганизаций.Физлицо = АттестацияРаботникаСписокКомпетенций.Ссылка.Физлицо
	|ГДЕ
	|	(НЕ АттестацияРаботникаСписокКомпетенций.Ссылка.Проведен)
	|	И (НЕ АттестацияРаботникаСписокКомпетенций.Ссылка.ПометкаУдаления)
	|	И СотрудникиОрганизаций.Ссылка = &Сотрудник";
	
	НеоцененныеКомпетенции = Запрос.Выполнить().Выбрать();

	// Вывод не оцененых компетенций.
	
	Область = Макет.ПолучитьОбласть("СтрокаСправки");
	
	Если НеоцененныеКомпетенции.Количество() = 0 Тогда
		Область.Параметры.Компетенция   = "Нет компетенций";
		Область.Параметры.Ответственный = "--";
		Область.Параметры.Дата          = "--";
		Область.Параметры.Документ      = "Нет документов";
		ТабличныйДокумент.Вывести(Область);
		
	Иначе
		
		Пока НеоцененныеКомпетенции.Следующий() Цикл
		
			ЗаполнитьЗначенияСвойств(Область.Параметры, НеоцененныеКомпетенции);
			ТабличныйДокумент.Вывести(Область);
			
		КонецЦикла;
		
	КонецЕсли;
	
	// Вывод заголовка для последних оценок компетнций.
	Область = Макет.ПолучитьОбласть("ШапкаДва");
	ТабличныйДокумент.Вывести(Область);
	
	// Данные для списка последних оценок компетенций.
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ОценкиКомпетенцийРаботников.Компетенция,
	|	ОценкиКомпетенцийРаботников.Оценка,
	|	ОценкиКомпетенцийРаботников.Период КАК Дата,
	|	ОценкиКомпетенцийРаботников.Регистратор КАК Документ
	|ИЗ
	|	РегистрСведений.ОценкиКомпетенцийРаботников.СрезПоследних(
	|			,
	|			Физлицо В
	|				(ВЫБРАТЬ
	|					СотрудникиОрганизаций.Физлицо
	|				ИЗ
	|					Справочник.СотрудникиОрганизаций КАК СотрудникиОрганизаций
	|				ГДЕ
	|					СотрудникиОрганизаций.Ссылка = &Сотрудник)) КАК ОценкиКомпетенцийРаботников";
	
	ОцененныеКомпетенции = Запрос.Выполнить().Выбрать();

	// Вывод последних оценок компетенций
	Область = Макет.ПолучитьОбласть("СтрокаСправкиДва");
	
	Если ОцененныеКомпетенции.Количество() = 0 Тогда
		Область.Параметры.Компетенция	= "Нет компетенций";
		Область.Параметры.Оценка		= "--";
		Область.Параметры.Дата			= "--";
		Область.Параметры.Документ		= "Нет документов";
		ТабличныйДокумент.Вывести(Область);
		
	Иначе

		Пока ОцененныеКомпетенции.Следующий() Цикл
			
			ЗаполнитьЗначенияСвойств(Область.Параметры, ОцененныеКомпетенции);
			ТабличныйДокумент.Вывести(Область);
			
		КонецЦикла;
		
	КонецЕсли;
	
КонецПроцедуры // ПостроитьСправку()

// Процедура фрмирует диаграмму "Распределения оценок". 
//
// Параметры
//  Нет  
//  	
Процедура СформироватьДиаграмму(Диаграмма, Компетенция, НачПериода, КонПериода, Должность) Экспорт
	
	Если НЕ ЗначениеЗаполнено(Компетенция) Тогда
		Возврат;
	КонецЕсли;
	
	Диаграмма.СерииВСтроках = Ложь;
	Диаграмма.ОтображатьЗаголовок = Ложь;
	
	Диаграмма.ОбластьЗаголовка.Текст = "Распределение оценок компетенции " + Компетенция.Наименование;
	Диаграмма.ИсточникДанных = АттестацииРаботниковПереопределяемый.СформироватьЗапросДиаграммы(Диаграмма, Компетенция, НачПериода, КонПериода, Должность);
	
КонецПроцедуры  // СформироватьДиаграмму()

#КонецЕсли

////////////////////////////////////////////////////////////////////////////////
// ОПЕРАТОРЫ ОСНОВНОЙ ПРОГРАММЫ