Перем УчетнаяЗапись Экспорт;
Перем Организация Экспорт;
Перем СоответствиеКомандыТекстуПодробнее;
Перем КомандыРегистрацииСертификатов;
Перем мПрограммноеЗакрытие;

Процедура ТаблицаИзмененийПриПолученииДанных(Элемент, ОформленияСтрок)
	
	Для Каждого ОформлениеСтроки Из ОформленияСтрок Цикл
		
		ПредставлениеПодробнее = СоответствиеКомандыТекстуПодробнее[ОформлениеСтроки.ДанныеСтроки.Настройка];
		Если ЗначениеЗаполнено(ПредставлениеПодробнее) Тогда
			ОформлениеСтроки.Ячейки.Подробнее.УстановитьТекст(ПредставлениеПодробнее);
			ОформлениеСтроки.Ячейки.Подробнее.ЦветТекста = Новый Цвет(0, 0, 127);
			ОформлениеСтроки.Ячейки.Подробнее.Гиперссылка = Истина;
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

Процедура ТаблицаИзмененийВыбор(Элемент, ВыбраннаяСтрока, Колонка, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	Если Колонка = ЭлементыФормы.ТаблицаИзменений.Колонки.Подробнее Тогда
		ПоказатьПодробнее();
	КонецЕсли;
	
КонецПроцедуры

Процедура ПоказатьПодробнее()
	
	ТекСтрока = ЭлементыФормы.ТаблицаИзменений.ТекущиеДанные;
	Если ТекСтрока = Неопределено Тогда
		Возврат;
	КонецЕсли;
	ТекКоманда = ТекСтрока.Настройка;
	
	// если выбрана команда изменения пароля, то подробности не показываем
	Если НЕ ЗначениеЗаполнено(ТекКоманда) ИЛИ ТекКоманда = "ИзменитьПарольPOP3" ИЛИ ТекКоманда = "ИзменитьПарольSMTP" Тогда
		Возврат;
		
	// если выбрана команда регистрации сертификата, то показываем сертификат
	ИначеЕсли КомандыРегистрацииСертификатов.Найти(ТекКоманда) <> Неопределено Тогда
		НовоеЗначение = ТекСтрока.НовоеЗначение;
		Если ЗначениеЗаполнено(НовоеЗначение) И НовоеЗначение.Свойство("Сертификат") Тогда
			ФайлСертификата = КонтекстЭДО.ЗаписатьСертификат64ВФайл(НовоеЗначение.Сертификат);
			Если ФайлСертификата <> Неопределено Тогда
				ЗапуститьПриложение(ФайлСертификата);
			КонецЕсли;
		КонецЕсли;
		
	// иначе показываем диалог сравнения настроек
	Иначе
		ПоказатьСравнениеНастроек(ТекСтрока);
	КонецЕсли;
	
КонецПроцедуры

Процедура ПоказатьСравнениеНастроек(Сведения)
	
	ФормаСравнения = КонтекстЭДО.ПолучитьФорму("РОКИСравнениеНастроек");
	ФормаСравнения.Сведения = Сведения;
	ФормаСравнения.ОткрытьМодально();
	
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	ЭлементыФормы.НадписьВнимание.Заголовок = СтрЗаменить(ЭлементыФормы.НадписьВнимание.Заголовок, "<УчетнаяЗапись>", УчетнаяЗапись);
	
КонецПроцедуры

Процедура ОсновныеДействияФормыПроизвестиАвтоматическуюНастройку(Кнопка)
	
	мПрограммноеЗакрытие = Истина;
	Закрыть(Истина);
	
КонецПроцедуры

Процедура ПередЗакрытием(Отказ, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	Если НЕ мПрограммноеЗакрытие Тогда
		Ответ = Вопрос("Настоятельно рекомендуется произвести автоматическую настройку параметров документооборота!
						|Отказ от автоматической настройки может привести к ошибкам в процессе документооборота!
						|
						|Произвести автоматическую настройку?",
						РежимДиалогаВопрос.ДаНетОтмена,
						,
						КодВозвратаДиалога.Да,
						"ВНИМАНИЕ!");
		Отказ = Истина;
		Если Ответ = КодВозвратаДиалога.Да Тогда
			мПрограммноеЗакрытие = Истина;
			Закрыть(Истина);
		ИначеЕсли Ответ = КодВозвратаДиалога.Нет Тогда
			мПрограммноеЗакрытие = Истина;
			Закрыть(Ложь);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
	Если ИмяСобытия = "Автонастройка параметров документооборота активна?" Тогда
		Параметр = Истина;
	КонецЕсли;
	
КонецПроцедуры

СоответствиеКомандыТекстуПодробнее = Новый Соответствие;
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьСерверPOP3", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьПортPOP3", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьИмяПользователяPOP3", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьИдентификаторАбонента", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьИдентификаторСпецоператора", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьАдресЭлектроннойПочты", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьПарольPOP3", "");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьСерверSMTP", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьПортSMTP", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьФлагТребуетсяSMTPАутентификация", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьСертификатРуководителя", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьСертификатГлавногоБухгалтера", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьСертификатДляШифрования", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьОсновнуюИФНС", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьАдресПочтовогоСервера", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьАдресНалоговогоОргана", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьСертификатПочтовогоСервера", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьСертификатИФНС", "Подробнее");
//СоответствиеКомандыТекстуПодробнее.Вставить("ЗарегистрироватьОрганПФР", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьСертификатОрганаПФР", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьПризнакДокументооборотаСФНС", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьПризнакДокументооборотаСПФР", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьПризнакДокументооборотаСФСГС", "Подробнее");

СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьАдресПочтовогоСервераПФР", "Подробнее");
СоответствиеКомандыТекстуПодробнее.Вставить("ИзменитьАдресПочтовогоСервераФСГС", "Подробнее");

СоответствиеКомандыТекстуПодробнее.Вставить("ЗарегистрироватьСертификатСОС", "Показать сертификат");
СоответствиеКомандыТекстуПодробнее.Вставить("ЗарегистрироватьСертификатКорневойГНИВЦ", "Показать сертификат");
СоответствиеКомандыТекстуПодробнее.Вставить("ЗарегистрироватьСертификатКорневойТакском", "Показать сертификат");
СоответствиеКомандыТекстуПодробнее.Вставить("ЗарегистрироватьСертификатКроссГНИВЦ", "Показать сертификат");
СоответствиеКомандыТекстуПодробнее.Вставить("ЗарегистрироватьСертификатНалоговогоОргана", "Показать сертификат");
СоответствиеКомандыТекстуПодробнее.Вставить("ЗарегистрироватьСертификатПочтовогоСервера", "Показать сертификат");
СоответствиеКомандыТекстуПодробнее.Вставить("ЗарегистрироватьСертификатОрганаПФР", "Показать сертификат");
СоответствиеКомандыТекстуПодробнее.Вставить("ЗарегистрироватьСертификатКорневойПФР", "Показать сертификат");
СоответствиеКомандыТекстуПодробнее.Вставить("ЗарегистрироватьСертификатКРОССПФР", "Показать сертификат");
СоответствиеКомандыТекстуПодробнее.Вставить("ЗарегистрироватьСертификатОрганаФСГС", "Показать сертификат");
СоответствиеКомандыТекстуПодробнее.Вставить("ЗарегистрироватьСертификатКорневойФСГС", "Показать сертификат");
СоответствиеКомандыТекстуПодробнее.Вставить("ЗарегистрироватьСертификатКРОССФСГС", "Показать сертификат");

КомандыРегистрацииСертификатов = Новый Массив;
КомандыРегистрацииСертификатов.Добавить("ЗарегистрироватьСертификатСОС");
КомандыРегистрацииСертификатов.Добавить("ЗарегистрироватьСертификатКорневойГНИВЦ");
КомандыРегистрацииСертификатов.Добавить("ЗарегистрироватьСертификатКорневойТакском");
КомандыРегистрацииСертификатов.Добавить("ЗарегистрироватьСертификатКроссГНИВЦ");
КомандыРегистрацииСертификатов.Добавить("ЗарегистрироватьСертификатНалоговогоОргана");
КомандыРегистрацииСертификатов.Добавить("ЗарегистрироватьСертификатПочтовогоСервера");
КомандыРегистрацииСертификатов.Добавить("ЗарегистрироватьСертификатОрганаПФР");
КомандыРегистрацииСертификатов.Добавить("ЗарегистрироватьСертификатКорневойПФР");
КомандыРегистрацииСертификатов.Добавить("ЗарегистрироватьСертификатКРОССПФР");
КомандыРегистрацииСертификатов.Добавить("ЗарегистрироватьСертификатОрганаФСГС");
КомандыРегистрацииСертификатов.Добавить("ЗарегистрироватьСертификатКорневойФСГС");
КомандыРегистрацииСертификатов.Добавить("ЗарегистрироватьСертификатКРОССФСГС");

мПрограммноеЗакрытие = Ложь;