Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	// 141
	Если Тип = Перечисления.ТипыТранспортныхСообщений.ПереподписанныйПротоколВходногоКонтроляОтчетности Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Переподписанный налогоплательщиком протокол входного контроля файла отчетности";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("ПереподписанныйПротоколВходногоКонтроляОтчетности").ПолучитьТекст());
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.КвитанцияОПриемеФайлаОтчетности Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Квитанция о приеме файла отчетности налоговым органом";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("КвитанцияОПриемеФайлаОтчетности").ПолучитьТекст());
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.ПереподписанноеПодтверждениеОтправкиОтчетности Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Переподписанное налогоплательщиком подтверждение отправки файла отчетности";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("ПереподписанноеПодтверждениеОтправкиОтчетности").ПолучитьТекст());
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.ПодтверждениеОтправкиОтчетности Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Подтверждение отправки файла отчетности";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("ПодтверждениеОтправкиОтчетности").ПолучитьТекст());
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.ПротоколВходногоКонтроляОтчетности Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Протокол входного контроля файла отчетности";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("ПротоколВходногоКонтроляОтчетности").ПолучитьТекст());
		
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.ПодтверждениеНаНеформализованныйДокументНО Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Подтверждение приема документа налогового органа";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("ПодтверждениеНаНеформализованныйДокументНО").ПолучитьТекст());
		
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.ПодтверждениеОтправкиНеформализованногоДокументаНалогоплательщика Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Подтверждение отправки документа налогоплательщика";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("ПодтверждениеОтправкиНеформализованногоДокументаНалогоплательщика").ПолучитьТекст());
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.ПереподписанноеПодтверждениеОтправкиНеформализованногоДокументаНалогоплательщика Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Переподписанное налогоплательщиком подтверждение отправки документа налогоплательщика";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("ПереподписанноеПодтверждениеОтправкиНеформализованногоДокументаНалогоплательщика").ПолучитьТекст());
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.ПодтверждениеДоставкиНеформализованногоДокументаНалогоплательщика Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Подтверждение доставки неформализованного документа налогоплательщика в налоговый орган";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("ПодтверждениеДоставкиНеформализованногоДокументаНалогоплательщика").ПолучитьТекст());
		
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.ПереподписанныйПротоколВходногоКонтроляЗапросаИОН Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Подтверждение на протокол входного контроля";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("ПереподписанныйПротоколВходногоКонтроляЗапросаИОН").ПолучитьТекст());
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.КвитанцияОПриемеЗапросаИОН Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Квитанция о приеме запроса на информационное обслуживание налоговым органом";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("КвитанцияОПриемеЗапросаИОН").ПолучитьТекст());
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.ПереподписанноеПодтверждениеОтправкиЗапросаИОН Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Подтверждение налогоплательщика на подтверждение отправки от почтового сервера";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("ПереподписанноеПодтверждениеОтправкиЗапросаИОН").ПолучитьТекст());
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.ПодтверждениеОтправкиЗапросаИОН Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Подтверждение отправки запроса на информационное обслуживание от почтового сервера";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("ПодтверждениеОтправкиЗапросаИОН").ПолучитьТекст());
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.ПротоколВходногоКонтроляЗапросаИОН Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Протокол входного контроля от налогового органа";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("ПротоколВходногоКонтроляЗапросаИОН").ПолучитьТекст());
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.ПереподписанныйОтветНаЗапросИОН Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Подтверждение налогоплательщика на ответ НО на запрос на информационное обслуживание";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("ПереподписанныйОтветНаЗапросИОН").ПолучитьТекст());
		
	// 693/534
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.ПодтверждениеДекларацияНО Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Подтверждение даты отправки отчетности";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("ПодтверждениеДатыОтправкиОтчетности").ПолучитьТекст());
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.ИзвещениеПодтверждениеНП Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Извещение о получении подтверждения даты отправки";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("ИзвещениеОПолученииПодтвержденияДатыОтправкиОтчетности").ПолучитьТекст());
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.ИзвещениеДекларацияНО Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Извещение о получении декларации";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("ИзвещениеОПолученииОтчетности").ПолучитьТекст());
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.РезультатПриемаДекларацияНО Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Результат приема декларации";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("РезультатПриемаОтчетности").ПолучитьТекст());
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.ИзвещениеРезультатПриемаНП Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Извещение о получении результата приема";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("ИзвещениеОПолученииРезультатаПриемаОтчетности").ПолучитьТекст());
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.РезультатОбработкиДекларацияНО Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Результат обработки декларации";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("РезультатОбработкиОтчетности").ПолучитьТекст());
	
	// 534 2-НДФЛ
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.ПодтверждениеФорма2НДФЛНО Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Подтверждение даты отправки формы 2-НДФЛ";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("ПодтверждениеДатыОтправки2НДФЛ").ПолучитьТекст());
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.ИзвещениеФорма2НДФЛНО Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Извещение о получении формы 2-НДФЛ";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("ИзвещениеОПолучении2НДФЛ").ПолучитьТекст());
	ИначеЕсли Тип = Перечисления.ТипыТранспортныхСообщений.РезультатПриемаФорма2НДФЛНО Тогда
		Заголовок = "Цикл обмена " + СокрЛП(ЦиклОбмена) + ". Результат приема формы 2-НДФЛ";
		ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(КонтекстЭДО.ПолучитьМакет("РезультатПриема2НДФЛ").ПолучитьТекст());
	
	Иначе
		Отказ = Истина;
		Возврат;
	КонецЕсли;
	
КонецПроцедуры

Процедура ПолеHTMLДокументаonclick(Элемент, pEvtObj)
	
	htmlElement = pEvtObj.srcElement;

	Пока htmlElement <> Неопределено И ВРег(htmlElement.tagName) <> "A" Цикл
		htmlElement = htmlElement.parentElement;
	КонецЦикла;

	Если htmlElement = Неопределено Тогда
		Возврат;
	КонецЕсли;

	ТекстСсылки = htmlElement.href;
	
	Если Найти(ТекстСсылки, "ДокументНалогоплательщика") <> 0 Тогда
		pEvtObj.returnValue = Ложь;
		НеформализованныйДокумент = КонтекстЭДО.ПолучитьСообщениеЦиклаОбмена(ЦиклОбмена, Перечисления.ТипыТранспортныхСообщений.НеформализованныйДокументНалогоплательщика);
		Если НеформализованныйДокумент <> Неопределено Тогда
			ОткрытьЗначение(НеформализованныйДокумент);
		Иначе
			Предупреждение("Для цикла обмена """ + ЦиклОбмена + """ отсутствует документ налогоплательщика.");
		КонецЕсли;
	ИначеЕсли Найти(ТекстСсылки, "Налогоплательщик") <> 0 Тогда
		pEvtObj.returnValue = Ложь;
		ОткрытьЗначение(ЦиклОбмена.Организация);
	ИначеЕсли Найти(ТекстСсылки, "НалоговыйОрган") <> 0 Тогда
		pEvtObj.returnValue = Ложь;
		ОткрытьЗначение(ЦиклОбмена.ВнешняяОрганизация);
	ИначеЕсли Найти(ТекстСсылки, "ПервичноеСообщение") <> 0 Тогда
		pEvtObj.returnValue = Ложь;
		ПервичноеСообщение = КонтекстЭДО.ПолучитьСообщениеЦиклаОбмена(ЦиклОбмена, Перечисления.ТипыТранспортныхСообщений.ПервичноеСообщениеСодержащееОтчетность);
		Если ПервичноеСообщение <> Неопределено Тогда
			ОткрытьЗначение(ПервичноеСообщение);
		Иначе
			Предупреждение("Для цикла обмена """ + ЦиклОбмена + """ отсутствует первичное сообщение, содержащее файл отчетности.");
		КонецЕсли;
	ИначеЕсли Найти(ТекстСсылки, "Запрос") <> 0 Тогда
		pEvtObj.returnValue = Ложь;
		ПервичноеСообщение = КонтекстЭДО.ПолучитьСообщениеЦиклаОбмена(ЦиклОбмена, Перечисления.ТипыТранспортныхСообщений.ЗапросИОН);
		Если ПервичноеСообщение <> Неопределено Тогда
			ОткрытьЗначение(ПервичноеСообщение);
		Иначе
			Предупреждение("Для цикла обмена """ + ЦиклОбмена + """ отсутствует первичное сообщение, содержащее запрос на информационное обслуживание.");
		КонецЕсли;
	ИначеЕсли Найти(ТекстСсылки, "НастройкиОбмена") <> 0 Тогда
		pEvtObj.returnValue = Ложь;
		ОткрытьЗначение(ЦиклОбмена.УчетнаяЗапись);
	ИначеЕсли Найти(ТекстСсылки, "СерверДокументооборота") <> 0 Тогда
		pEvtObj.returnValue = Ложь;
		УчетнаяЗапись = ЦиклОбмена.Организация.УчетнаяЗаписьОбмена;
		СерверДокументооборота = УчетнаяЗапись.СерверДокументооборота;
		Если ЗначениеЗаполнено(СерверДокументооборота) Тогда
			ОткрытьЗначение(СерверДокументооборота);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры