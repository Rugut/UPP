////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ДЛЯ ОБЕСПЕЧЕНИЯ ПРОВЕДЕНИЯ ДОКУМЕНТА

// Добавляет запись в движения по регистру учета доходов 
//
Процедура ДобавитьСтрокуВДвиженияПоДоходам(ДокументОбъект, ВыборкаПоДоходам, ВыборкаПоШапкеДокумента) Экспорт
	
	Если ВыборкаПоДоходам.ТипСтроки = "Основные начисления" 
		Или ВыборкаПоДоходам.ТипСтроки = "Пособия по социальному страхованию (основные)" 
		Или ВыборкаПоДоходам.ТипСтроки = "Пособия по уходу за ребенком" Тогда
		
		СтрокаДвижения = ДокументОбъект.Движения.ЕСНОсновныеНачисления.Добавить();
		
		ВидУчетаВремени = ПроведениеРасчетов.ПолучитьВидУчетаВремени(ВыборкаПоДоходам.СпособРасчета, ВыборкаПоДоходам.ВидВремени, ВыборкаПоДоходам.СуммированныйУчетРабочегоВремени);
		
		// свойства
		СтрокаДвижения.ПериодДействияНачало		= ВыборкаПоДоходам.ПериодДействияНачало;
		СтрокаДвижения.ПериодДействияКонец		= ВыборкаПоДоходам.ПериодДействияКонец;

		// реквизиты
		СтрокаДвижения.ГрафикРаботы				= ВыборкаПоДоходам.ГрафикРаботы;
		СтрокаДвижения.ВидУчетаВремени			= ВидУчетаВремени;
		
	Иначе
		СтрокаДвижения = ДокументОбъект.Движения.ЕСНДополнительныеНачисления.Добавить();
		
	КонецЕсли;
	
	ЗаполнитьЗначенияСвойств(СтрокаДвижения,ВыборкаПоДоходам);
	ЗаполнитьЗначенияСвойств(СтрокаДвижения,ВыборкаПоШапкеДокумента);
	
	// продублируем сведения о доходах в рег-ре учета доходов
	СтрокаДвижения = ДокументОбъект.Движения.СтраховыеВзносыСведенияОДоходах.Добавить();
	
	ЗаполнитьЗначенияСвойств(СтрокаДвижения,ВыборкаПоДоходам);
	ЗаполнитьЗначенияСвойств(СтрокаДвижения,ВыборкаПоШапкеДокумента);
	
КонецПроцедуры // ДобавитьСтрокуВДвиженияПоДоходам()

// Выполняет проверку правильности заполнения строки табличной части о доходах
Процедура ПроверитьЗаполнениеСтрокиДохода(ВыборкаПоДоходам, Отказ, Заголовок = "") Экспорт
	
	ТипСтроки = Лев(ВыборкаПоДоходам.ТипСтроки,34);
	
	СтрокаНачалаСообщенияОбОшибке = "В строке номер """ + СокрЛП(ВыборкаПоДоходам.НомерСтроки) +
		""" таблицы """ + ТипСтроки + """: ";
		
    Если Найти(ВыборкаПоДоходам.ТипСтроки,"Пособия") <> 0 и Найти(ВыборкаПоДоходам.ТипСтроки,"единовременные") = 0 Тогда
		ТипСтроки = "Основные начисления"
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(ВыборкаПоДоходам.ВидРасчета) Тогда
		ОбщегоНазначения.ВывестиИнформациюОбОшибке(СтрокаНачалаСообщенияОбОшибке + "Не указан вид расчета!", Отказ, Заголовок);
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(ВыборкаПоДоходам.Сотрудник) Тогда
		ОбщегоНазначения.ВывестиИнформациюОбОшибке(СтрокаНачалаСообщенияОбОшибке + "Не указан сотрудник!", Отказ, Заголовок);
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(ВыборкаПоДоходам.КодДоходаЕСН) Тогда
		ОбщегоНазначения.ВывестиИнформациюОбОшибке(СтрокаНачалаСообщенияОбОшибке + "Не указан вид дохода по страховым взносам!", Отказ, Заголовок);
	КонецЕсли;
	
	// Организация сотрудника должна совпадать с организацией документа
	Если ВыборкаПоДоходам.ОшибкаНеСоответствиеСотрудникаИОрганизации Тогда
		ОбщегоНазначения.ВывестиИнформациюОбОшибке(СтрокаНачалаСообщенияОбОшибке + "указанный сотрудник оформлен на другую организацию!", Отказ, Заголовок);
	КонецЕсли;
	
	Если ТипСтроки = "Основные начисления" Тогда
		
		// Дата начала
		Если Не ЗначениеЗаполнено(ВыборкаПоДоходам.ПериодДействияНачало) Тогда
			ОбщегоНазначения.ВывестиИнформациюОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указана дата начала начисления!", Отказ, Заголовок);
		Иначе
			// Дата окончания
			Если Не ЗначениеЗаполнено(ВыборкаПоДоходам.ПериодДействияКонец) Тогда
				ОбщегоНазначения.ВывестиИнформациюОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указана дата окончания начисления!", Отказ, Заголовок);
			Иначе
				Если ВыборкаПоДоходам.ПериодДействияКонец < ВыборкаПоДоходам.ПериодДействияНачало Тогда
					ОбщегоНазначения.ВывестиИнформациюОбОшибке(СтрокаНачалаСообщенияОбОшибке + "дата окончания начисления не должна быть меньше даты начала!", Отказ, Заголовок);
				Иначе
					Если НачалоМесяца(ВыборкаПоДоходам.ПериодДействияКонец) <> НачалоМесяца(ВыборкаПоДоходам.ПериодДействияНачало) Тогда
						ОбщегоНазначения.ВывестиИнформациюОбОшибке(СтрокаНачалаСообщенияОбОшибке + "даты начала и окончания должны принадлежать одному месяцу!", Отказ, Заголовок);
					КонецЕсли;
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;

	КонецЕсли;
	
Конецпроцедуры // ПроверитьЗаполнениеСтрокиДохода()

Процедура ПроверитьЗаполнениеСтрокиПособияСоциальномуСтрахованию(СтрокаТЧ, Отказ, Заголовок) Экспорт
	
	СтрокаНачалаСообщенияОбОшибке = "В строке № """+ СокрЛП(СтрокаТЧ.НомерСтроки) +
									""" табл. части ""Пособия по социальному страхованию"": ";
									
	Если Не ЗначениеЗаполнено(СтрокаТЧ.ВидПособияСоциальногоСтрахования) Тогда
		ОбщегоНазначения.ВывестиИнформациюОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указан вид пособия!", Отказ, Заголовок);
	КонецЕсли;
	
	Если НЕ ЗначениеЗаполнено(СтрокаТЧ.СпособФинансированияПособий) Тогда
		ОбщегоНазначения.ВывестиИнформациюОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указан способ финансирования пособия!", Отказ, Заголовок);
	КонецЕсли;
	
КонецПроцедуры // ПроверитьЗаполнениеСтрокиПособияПоУходу()

Процедура ПроверитьЗаполнениеСтрокиПособияПоУходуЗаРебенкомДоПолутораЛет(СтрокаТЧ, Отказ, Заголовок) Экспорт
	
	СтрокаНачалаСообщенияОбОшибке = "В строке № """+ СокрЛП(СтрокаТЧ.НомерСтроки) +
									""" табл. части ""Пособия по уходу за ребенком до полутора лет"": ";
									
	Если Не ЗначениеЗаполнено(СтрокаТЧ.Сотрудник) Тогда
		ОбщегоНазначения.ВывестиИнформациюОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указан получатель пособия!", Отказ, Заголовок);
	КонецЕсли;
	
КонецПроцедуры // ПроверитьЗаполнениеСтрокиПособияПоУходу()

// Формирует запрос по табличным частям документам
//
// Параметры: 
//  Режим        - режим проведения.
//
// Возвращаемое значение:
//  Результат запроса.
//
Функция СформироватьЗапросПоПособияСоциальномуСтрахованию(Ссылка, ВыборкаПоШапкеДокумента) Экспорт
	
	Запрос = Новый Запрос;
	
	// Установим параметры запроса
	Запрос.УстановитьПараметр("ДокументСсылка" , Ссылка);
	
	Если ВыборкаПоШапкеДокумента.ПериодРегистрации < ПроведениеРасчетов.ДатаНачалаРеформыСоцСтрахования() Тогда
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	НАЧАЛОПЕРИОДА(Пособия.Ссылка.ПериодРегистрации, МЕСЯЦ) КАК Период,
		|	Пособия.Ссылка.Организация КАК Организация,
		|	ВЫБОР
		|		КОГДА Пособия.СпособФинансированияПособий = ЗНАЧЕНИЕ(Перечисление.СпособыФинансированияПособийСоцстрахования.ЗаСчетФСС)
		|			ТОГДА Пособия.ВидПособияСоциальногоСтрахования
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка)
		|	КОНЕЦ КАК ВидПособияСоциальногоСтрахования,
		|	Пособия.ОблагаетсяЕНВД,
		|	ВЫБОР
		|		КОГДА (НЕ Пособия.ВидПособияСоциальногоСтрахования В (ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.Нетрудоспособность), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.БеременностьРоды), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.НетрудоспособностьПрофзаболевание), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.НетрудоспособностьНесчастныйСлучай)))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ПустаяСсылка)
		|		КОГДА Пособия.Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ПустаяСсылка)
		|	КОНЕЦ КАК ВидЗанятости,
		|	СУММА(ВЫБОР
		|			КОГДА Пособия.УчитыватьКакНовыйСтраховойСлучай
		|				ТОГДА ВЫБОР
		|						КОГДА Пособия.Сторно
		|							ТОГДА -1
		|						ИНАЧЕ 1
		|					КОНЕЦ
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК СтраховыеСлучаи,
		|	СУММА(Пособия.ОплаченныеДни) КАК ОплаченныеДни,
		|	СУММА(Пособия.СуммаВсего) КАК СуммаВсего,
		|	Пособия.Сотрудник,
		|	Пособия.ДокументОснование,
		|	Пособия.ДатаСтраховогоСлучая КАК ДатаСтраховогоСлучая,
		|	СУММА(Пособия.СуммаСверхНорм) КАК СуммаСверхНорм,
		|	Пособия.ВыплатаЗаСчетФедеральногоБюджета
		|ИЗ
		|	Документ.РасчетСтраховыхВзносов.ПособияПоСоциальномуСтрахованию КАК Пособия
		|ГДЕ
		|	Пособия.Ссылка = &ДокументСсылка
		|
		|СГРУППИРОВАТЬ ПО
		|	Пособия.ОблагаетсяЕНВД,
		|	Пособия.Сотрудник,
		|	Пособия.ДокументОснование,
		|	Пособия.Ссылка,
		|	ВЫБОР
		|		КОГДА (НЕ Пособия.ВидПособияСоциальногоСтрахования В (ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.Нетрудоспособность), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.БеременностьРоды), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.НетрудоспособностьПрофзаболевание), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.НетрудоспособностьНесчастныйСлучай)))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ПустаяСсылка)
		|		КОГДА Пособия.Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ПустаяСсылка)
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА Пособия.СпособФинансированияПособий = ЗНАЧЕНИЕ(Перечисление.СпособыФинансированияПособийСоцстрахования.ЗаСчетФСС)
		|			ТОГДА Пособия.ВидПособияСоциальногоСтрахования
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка)
		|	КОНЕЦ,
		|	Пособия.ДатаСтраховогоСлучая,
		|	Пособия.Ссылка.Организация,
		|	НАЧАЛОПЕРИОДА(Пособия.Ссылка.ПериодРегистрации, МЕСЯЦ),
		|	Пособия.ВыплатаЗаСчетФедеральногоБюджета";
		
	Иначе
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	Пособия.Период,
		|	Пособия.Организация,
		|	Пособия.ВидПособияСоциальногоСтрахования,
		|	Пособия.ВидЗанятости,
		|	СУММА(ВЫБОР
		|			КОГДА Пособия.ВидПособияСоциальногоСтрахования В (ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПриРожденииРебенка), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ВСвязиСоСмертью))
		|				ТОГДА Пособия.СтраховыеСлучаи
		|			КОГДА Пособия.СтраховыеСлучаи > 1
		|				ТОГДА 1
		|			КОГДА Пособия.СтраховыеСлучаи < -1
		|				ТОГДА -1
		|			ИНАЧЕ Пособия.СтраховыеСлучаи
		|		КОНЕЦ) КАК СтраховыеСлучаи,
		|	СУММА(Пособия.ОплаченныеДни) КАК ОплаченныеДни,
		|	СУММА(Пособия.СуммаВсего) КАК СуммаВсего,
		|	Пособия.Сотрудник,
		|	Пособия.ДокументОснование,
		|	Пособия.ДатаСтраховогоСлучая,
		|	СУММА(Пособия.СуммаСверхНорм) КАК СуммаСверхНорм,
		|	Пособия.ВыплатаЗаСчетФедеральногоБюджета
		|ИЗ
		|	(ВЫБРАТЬ
		|		НАЧАЛОПЕРИОДА(Пособия.Ссылка.ПериодРегистрации, МЕСЯЦ) КАК Период,
		|		Пособия.Ссылка.Организация КАК Организация,
		|		ВЫБОР
		|			КОГДА Пособия.СпособФинансированияПособий = ЗНАЧЕНИЕ(Перечисление.СпособыФинансированияПособийСоцстрахования.ЗаСчетФСС)
		|				ТОГДА Пособия.ВидПособияСоциальногоСтрахования
		|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка)
		|		КОНЕЦ КАК ВидПособияСоциальногоСтрахования,
		|		ВЫБОР
		|			КОГДА НЕ Пособия.ВидПособияСоциальногоСтрахования В (ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.Нетрудоспособность), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.БеременностьРоды), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.НетрудоспособностьПрофзаболевание), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.НетрудоспособностьНесчастныйСлучай))
		|				ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ПустаяСсылка)
		|			КОГДА Пособия.Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|				ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ПустаяСсылка)
		|		КОНЕЦ КАК ВидЗанятости,
		|		СУММА(ВЫБОР
		|				КОГДА Пособия.УчитыватьКакНовыйСтраховойСлучай
		|					ТОГДА ВЫБОР
		|							КОГДА Пособия.Сторно
		|								ТОГДА -1
		|							ИНАЧЕ 1
		|						КОНЕЦ
		|				ИНАЧЕ 0
		|			КОНЕЦ) КАК СтраховыеСлучаи,
		|		МАКСИМУМ(Пособия.ОплаченныеДни) КАК ОплаченныеДни,
		|		СУММА(Пособия.СуммаВсего) КАК СуммаВсего,
		|		Пособия.Сотрудник КАК Сотрудник,
		|		Пособия.ДокументОснование КАК ДокументОснование,
		|		Пособия.ДатаСтраховогоСлучая КАК ДатаСтраховогоСлучая,
		|		СУММА(Пособия.СуммаСверхНорм) КАК СуммаСверхНорм,
		|		Пособия.ВыплатаЗаСчетФедеральногоБюджета КАК ВыплатаЗаСчетФедеральногоБюджета,
		|		Пособия.ПериодДействияНачало КАК ПериодДействияНачало,
		|		Пособия.ПериодДействияКонец КАК ПериодДействияКонец,
		|		Пособия.ВидРасчета КАК ВидРасчета,
		|		Пособия.Сторно КАК Сторно
		|	ИЗ
		|		Документ.РасчетСтраховыхВзносов.ПособияПоСоциальномуСтрахованию КАК Пособия
		|	ГДЕ
		|		Пособия.Ссылка = &ДокументСсылка
		|	
		|	СГРУППИРОВАТЬ ПО
		|		Пособия.Сотрудник,
		|		Пособия.ДокументОснование,
		|		Пособия.Ссылка,
		|		ВЫБОР
		|			КОГДА НЕ Пособия.ВидПособияСоциальногоСтрахования В (ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.Нетрудоспособность), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.БеременностьРоды), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.НетрудоспособностьПрофзаболевание), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.НетрудоспособностьНесчастныйСлучай))
		|				ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ПустаяСсылка)
		|			КОГДА Пособия.Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|				ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ПустаяСсылка)
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА Пособия.СпособФинансированияПособий = ЗНАЧЕНИЕ(Перечисление.СпособыФинансированияПособийСоцстрахования.ЗаСчетФСС)
		|				ТОГДА Пособия.ВидПособияСоциальногоСтрахования
		|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка)
		|		КОНЕЦ,
		|		Пособия.ДатаСтраховогоСлучая,
		|		Пособия.Ссылка.Организация,
		|		НАЧАЛОПЕРИОДА(Пособия.Ссылка.ПериодРегистрации, МЕСЯЦ),
		|		Пособия.ВыплатаЗаСчетФедеральногоБюджета,
		|		Пособия.ПериодДействияНачало,
		|		Пособия.ПериодДействияКонец,
		|		Пособия.ВидРасчета,
		|		Пособия.Сторно) КАК Пособия
		|
		|СГРУППИРОВАТЬ ПО
		|	Пособия.Период,
		|	Пособия.Организация,
		|	Пособия.ВидПособияСоциальногоСтрахования,
		|	Пособия.ВидЗанятости,
		|	Пособия.Сотрудник,
		|	Пособия.ДокументОснование,
		|	Пособия.ДатаСтраховогоСлучая,
		|	Пособия.ВыплатаЗаСчетФедеральногоБюджета";
		
	КонецЕсли;
	
	Возврат Запрос.Выполнить();

КонецФункции

// Формирует запрос по табличным частям документам
//
// Параметры: 
//  Режим        - режим проведения.
//
// Возвращаемое значение:
//  Результат запроса.
//
Функция СформироватьЗапросПоПособияПоУходуЗаРебенкомДоПолутораЛет(Ссылка, ВыборкаПоШапкеДокумента) Экспорт
	
	Запрос = Новый Запрос;

	// Установим параметры запроса
	Запрос.УстановитьПараметр("ДокументСсылка" , Ссылка);
	
	Если ВыборкаПоШапкеДокумента.ПериодРегистрации < ПроведениеРасчетов.ДатаНачалаРеформыСоцСтрахования() Тогда
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	НАЧАЛОПЕРИОДА(ПособияПоУходуЗаРебенком.Ссылка.ПериодРегистрации, МЕСЯЦ) КАК Период,
		|	ПособияПоУходуЗаРебенком.Ссылка.Организация КАК Организация,
		|	ПособияПоУходуЗаРебенком.Сотрудник.Физлицо КАК Физлицо,
		|	ВЫБОР
		|		КОГДА ПособияПоУходуЗаРебенком.Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ПустаяСсылка)
		|	КОНЕЦ КАК ВидЗанятости,
		|	ПособияПоУходуЗаРебенком.ОблагаетсяЕНВД КАК ОблагаетсяЕНВД,
		|	ИСТИНА КАК УходЗаПервымРебенком,
		|	СУММА(ВЫБОР
		|			КОГДА ПособияПоУходуЗаРебенком.Сторно
		|				ТОГДА -1
		|			ИНАЧЕ 1
		|		КОНЕЦ) КАК СтраховыеСлучаи,
		|	СУММА(ПособияПоУходуЗаРебенком.ПособиеПоУходуЗаПервымРебенком) КАК СуммаВсего,
		|	СУММА(ПособияПоУходуЗаРебенком.ПособиеПоУходуЗаПервымРебенкомСверхНорм) КАК СуммаСверхНорм,
		|	ПособияПоУходуЗаРебенком.Сотрудник КАК Сотрудник,
		|	ПособияПоУходуЗаРебенком.ПериодДействияНачало КАК ДатаСтраховогоСлучая,
		|	ПособияПоУходуЗаРебенком.ВыплатаЗаСчетФедеральногоБюджета
		|ИЗ
		|	Документ.РасчетСтраховыхВзносов.ПособияПоУходуЗаРебенкомДоПолутораЛет КАК ПособияПоУходуЗаРебенком
		|ГДЕ
		|	ПособияПоУходуЗаРебенком.Ссылка = &ДокументСсылка
		|	И ПособияПоУходуЗаРебенком.ПособиеПоУходуЗаПервымРебенком <> 0
		|
		|СГРУППИРОВАТЬ ПО
		|	ПособияПоУходуЗаРебенком.Ссылка,
		|	ПособияПоУходуЗаРебенком.ОблагаетсяЕНВД,
		|	ПособияПоУходуЗаРебенком.Сотрудник,
		|	ПособияПоУходуЗаРебенком.ПериодДействияНачало,
		|	ПособияПоУходуЗаРебенком.Ссылка.Организация,
		|	ПособияПоУходуЗаРебенком.Сотрудник.Физлицо,
		|	НАЧАЛОПЕРИОДА(ПособияПоУходуЗаРебенком.Ссылка.ПериодРегистрации, МЕСЯЦ),
		|	ПособияПоУходуЗаРебенком.ВыплатаЗаСчетФедеральногоБюджета,
		|	ВЫБОР
		|		КОГДА ПособияПоУходуЗаРебенком.Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ПустаяСсылка)
		|	КОНЕЦ
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	НАЧАЛОПЕРИОДА(ПособияПоУходуЗаРебенком.Ссылка.ПериодРегистрации, МЕСЯЦ),
		|	ПособияПоУходуЗаРебенком.Ссылка.Организация,
		|	ПособияПоУходуЗаРебенком.Сотрудник.Физлицо,
		|	ВЫБОР
		|		КОГДА ПособияПоУходуЗаРебенком.Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ПустаяСсылка)
		|	КОНЕЦ,
		|	ПособияПоУходуЗаРебенком.ОблагаетсяЕНВД,
		|	ЛОЖЬ,
		|	СУММА(ВЫБОР
		|			КОГДА ПособияПоУходуЗаРебенком.Сторно
		|				ТОГДА -1
		|			ИНАЧЕ 1
		|		КОНЕЦ),
		|	СУММА(ПособияПоУходуЗаРебенком.ПособиеПоУходуЗаВторымРебенком),
		|	СУММА(ПособияПоУходуЗаРебенком.ПособиеПоУходуЗаВторымРебенкомСверхНорм),
		|	ПособияПоУходуЗаРебенком.Сотрудник,
		|	ПособияПоУходуЗаРебенком.ПериодДействияНачало,
		|	ПособияПоУходуЗаРебенком.ВыплатаЗаСчетФедеральногоБюджета
		|ИЗ
		|	Документ.РасчетСтраховыхВзносов.ПособияПоУходуЗаРебенкомДоПолутораЛет КАК ПособияПоУходуЗаРебенком
		|ГДЕ
		|	ПособияПоУходуЗаРебенком.Ссылка = &ДокументСсылка
		|	И ПособияПоУходуЗаРебенком.ПособиеПоУходуЗаВторымРебенком <> 0
		|
		|СГРУППИРОВАТЬ ПО
		|	ПособияПоУходуЗаРебенком.Ссылка,
		|	ПособияПоУходуЗаРебенком.ОблагаетсяЕНВД,
		|	ПособияПоУходуЗаРебенком.Сотрудник,
		|	ПособияПоУходуЗаРебенком.ПериодДействияНачало,
		|	ПособияПоУходуЗаРебенком.Ссылка.Организация,
		|	ПособияПоУходуЗаРебенком.Сотрудник.Физлицо,
		|	НАЧАЛОПЕРИОДА(ПособияПоУходуЗаРебенком.Ссылка.ПериодРегистрации, МЕСЯЦ),
		|	ПособияПоУходуЗаРебенком.ВыплатаЗаСчетФедеральногоБюджета,
		|	ВЫБОР
		|		КОГДА ПособияПоУходуЗаРебенком.Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ПустаяСсылка)
		|	КОНЕЦ";
		
	Иначе
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПособияПоУходуЗаРебенком.Период,
		|	ПособияПоУходуЗаРебенком.Организация,
		|	ПособияПоУходуЗаРебенком.Физлицо,
		|	ПособияПоУходуЗаРебенком.ВидЗанятости,
		|	ПособияПоУходуЗаРебенком.УходЗаПервымРебенком,
		|	ВЫБОР
		|		КОГДА ПособияПоУходуЗаРебенком.СтраховыеСлучаи > 1
		|			ТОГДА 1
		|		КОГДА ПособияПоУходуЗаРебенком.СтраховыеСлучаи < -1
		|			ТОГДА -1
		|		ИНАЧЕ ПособияПоУходуЗаРебенком.СтраховыеСлучаи
		|	КОНЕЦ КАК СтраховыеСлучаи,
		|	СУММА(ПособияПоУходуЗаРебенком.СуммаВсего) КАК СуммаВсего,
		|	СУММА(ПособияПоУходуЗаРебенком.СуммаСверхНорм) КАК СуммаСверхНорм,
		|	ПособияПоУходуЗаРебенком.Сотрудник,
		|	ПособияПоУходуЗаРебенком.ДатаСтраховогоСлучая,
		|	ПособияПоУходуЗаРебенком.ВыплатаЗаСчетФедеральногоБюджета
		|ИЗ
		|	(ВЫБРАТЬ
		|		НАЧАЛОПЕРИОДА(ПособияПоУходуЗаРебенком.Ссылка.ПериодРегистрации, МЕСЯЦ) КАК Период,
		|		ПособияПоУходуЗаРебенком.Ссылка.Организация КАК Организация,
		|		ПособияПоУходуЗаРебенком.Сотрудник.Физлицо КАК Физлицо,
		|		ВЫБОР
		|			КОГДА ПособияПоУходуЗаРебенком.Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|				ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ПустаяСсылка)
		|		КОНЕЦ КАК ВидЗанятости,
		|		ИСТИНА КАК УходЗаПервымРебенком,
		|		СУММА(ВЫБОР
		|				КОГДА ПособияПоУходуЗаРебенком.Сторно
		|					ТОГДА -1
		|				ИНАЧЕ 1
		|			КОНЕЦ) КАК СтраховыеСлучаи,
		|		СУММА(ПособияПоУходуЗаРебенком.ПособиеПоУходуЗаПервымРебенком) КАК СуммаВсего,
		|		СУММА(ПособияПоУходуЗаРебенком.ПособиеПоУходуЗаПервымРебенкомСверхНорм) КАК СуммаСверхНорм,
		|		ПособияПоУходуЗаРебенком.Сотрудник КАК Сотрудник,
		|		ПособияПоУходуЗаРебенком.ПериодДействияНачало КАК ДатаСтраховогоСлучая,
		|		ПособияПоУходуЗаРебенком.ВыплатаЗаСчетФедеральногоБюджета КАК ВыплатаЗаСчетФедеральногоБюджета,
		|		ПособияПоУходуЗаРебенком.ПериодДействияНачало КАК ПериодДействияНачало,
		|		ПособияПоУходуЗаРебенком.ПериодДействияКонец КАК ПериодДействияКонец,
		|		ПособияПоУходуЗаРебенком.Сторно КАК Сторно,
		|		ПособияПоУходуЗаРебенком.ВидРасчета КАК ВидРасчета
		|	ИЗ
		|		Документ.РасчетСтраховыхВзносов.ПособияПоУходуЗаРебенкомДоПолутораЛет КАК ПособияПоУходуЗаРебенком
		|	ГДЕ
		|		ПособияПоУходуЗаРебенком.Ссылка = &ДокументСсылка
		|		И ПособияПоУходуЗаРебенком.ПособиеПоУходуЗаПервымРебенком <> 0
		|	
		|	СГРУППИРОВАТЬ ПО
		|		ПособияПоУходуЗаРебенком.Ссылка,
		|		ПособияПоУходуЗаРебенком.Сотрудник,
		|		ПособияПоУходуЗаРебенком.ПериодДействияНачало,
		|		ПособияПоУходуЗаРебенком.Ссылка.Организация,
		|		ПособияПоУходуЗаРебенком.Сотрудник.Физлицо,
		|		НАЧАЛОПЕРИОДА(ПособияПоУходуЗаРебенком.Ссылка.ПериодРегистрации, МЕСЯЦ),
		|		ПособияПоУходуЗаРебенком.ВыплатаЗаСчетФедеральногоБюджета,
		|		ВЫБОР
		|			КОГДА ПособияПоУходуЗаРебенком.Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|				ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ПустаяСсылка)
		|		КОНЕЦ,
		|		ПособияПоУходуЗаРебенком.ПериодДействияКонец,
		|		ПособияПоУходуЗаРебенком.Сторно,
		|		ПособияПоУходуЗаРебенком.ВидРасчета,
		|		ПособияПоУходуЗаРебенком.ПериодДействияНачало
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		НАЧАЛОПЕРИОДА(ПособияПоУходуЗаРебенком.Ссылка.ПериодРегистрации, МЕСЯЦ),
		|		ПособияПоУходуЗаРебенком.Ссылка.Организация,
		|		ПособияПоУходуЗаРебенком.Сотрудник.Физлицо,
		|		ВЫБОР
		|			КОГДА ПособияПоУходуЗаРебенком.Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|				ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ПустаяСсылка)
		|		КОНЕЦ,
		|		ЛОЖЬ,
		|		СУММА(ВЫБОР
		|				КОГДА ПособияПоУходуЗаРебенком.Сторно
		|					ТОГДА -1
		|				ИНАЧЕ 1
		|			КОНЕЦ),
		|		СУММА(ПособияПоУходуЗаРебенком.ПособиеПоУходуЗаВторымРебенком),
		|		СУММА(ПособияПоУходуЗаРебенком.ПособиеПоУходуЗаВторымРебенкомСверхНорм),
		|		ПособияПоУходуЗаРебенком.Сотрудник,
		|		ПособияПоУходуЗаРебенком.ПериодДействияНачало,
		|		ПособияПоУходуЗаРебенком.ВыплатаЗаСчетФедеральногоБюджета,
		|		ПособияПоУходуЗаРебенком.ПериодДействияНачало,
		|		ПособияПоУходуЗаРебенком.ПериодДействияКонец,
		|		ПособияПоУходуЗаРебенком.Сторно,
		|		ПособияПоУходуЗаРебенком.ВидРасчета
		|	ИЗ
		|		Документ.РасчетСтраховыхВзносов.ПособияПоУходуЗаРебенкомДоПолутораЛет КАК ПособияПоУходуЗаРебенком
		|	ГДЕ
		|		ПособияПоУходуЗаРебенком.Ссылка = &ДокументСсылка
		|		И ПособияПоУходуЗаРебенком.ПособиеПоУходуЗаВторымРебенком <> 0
		|	
		|	СГРУППИРОВАТЬ ПО
		|		ПособияПоУходуЗаРебенком.Ссылка,
		|		ПособияПоУходуЗаРебенком.Сотрудник,
		|		ПособияПоУходуЗаРебенком.ПериодДействияНачало,
		|		ПособияПоУходуЗаРебенком.Ссылка.Организация,
		|		ПособияПоУходуЗаРебенком.Сотрудник.Физлицо,
		|		НАЧАЛОПЕРИОДА(ПособияПоУходуЗаРебенком.Ссылка.ПериодРегистрации, МЕСЯЦ),
		|		ПособияПоУходуЗаРебенком.ВыплатаЗаСчетФедеральногоБюджета,
		|		ВЫБОР
		|			КОГДА ПособияПоУходуЗаРебенком.Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|				ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ПустаяСсылка)
		|		КОНЕЦ,
		|		ПособияПоУходуЗаРебенком.ПериодДействияКонец,
		|		ПособияПоУходуЗаРебенком.Сторно,
		|		ПособияПоУходуЗаРебенком.ВидРасчета,
		|		ПособияПоУходуЗаРебенком.ПериодДействияНачало) КАК ПособияПоУходуЗаРебенком
		|
		|СГРУППИРОВАТЬ ПО
		|	ПособияПоУходуЗаРебенком.Период,
		|	ПособияПоУходуЗаРебенком.Организация,
		|	ПособияПоУходуЗаРебенком.Физлицо,
		|	ПособияПоУходуЗаРебенком.ВидЗанятости,
		|	ПособияПоУходуЗаРебенком.УходЗаПервымРебенком,
		|	ПособияПоУходуЗаРебенком.Сотрудник,
		|	ПособияПоУходуЗаРебенком.ДатаСтраховогоСлучая,
		|	ПособияПоУходуЗаРебенком.ВыплатаЗаСчетФедеральногоБюджета,
		|	ВЫБОР
		|		КОГДА ПособияПоУходуЗаРебенком.СтраховыеСлучаи > 1
		|			ТОГДА 1
		|		КОГДА ПособияПоУходуЗаРебенком.СтраховыеСлучаи < -1
		|			ТОГДА -1
		|		ИНАЧЕ ПособияПоУходуЗаРебенком.СтраховыеСлучаи
		|	КОНЕЦ";

		
	КонецЕсли;

	Возврат Запрос.Выполнить();

КонецФункции

Функция ПолучитьТекстЗапросаОтражениеСторноЗаписей()
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	ОсновныеНачисления.Регистратор КАК Регистратор,
	|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
	|	ОсновныеНачисления.Сотрудник КАК Сотрудник,
	|	ОсновныеНачисления.ОбособленноеПодразделение,
	|	ОсновныеНачисления.ПериодДействияНачало КАК ПериодДействияНачало,
	|	ОсновныеНачисления.ПериодДействияКонец КАК ПериодДействияКонец,
	|	ОсновныеНачисления.ВидРасчета КАК ВидРасчета,
	|	ОсновныеНачисления.СторнируемыйДокумент КАК СторнируемыйДокумент,
	|	ОсновныеНачисления.ВидРасчета.СпособРасчета КАК ВидРасчетаСпособРасчета
	|ПОМЕСТИТЬ ВТ_ОсновныеНачисленияСторно
	|ИЗ
	|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
	|ГДЕ
	|	ОсновныеНачисления.ОбособленноеПодразделение = &парамОрганизация
	|	И ОсновныеНачисления.ПериодРегистрации = &парамПериодРегистрации
	|	И (&парамНеОтбиратьСотрудников
	|			ИЛИ ОсновныеНачисления.Сотрудник В
	|				(ВЫБРАТЬ
	|					ВТСписокСотрудников.Сотрудник
	|				ИЗ
	|					ВТСписокСотрудников КАК ВТСписокСотрудников))
	|	И ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете <> ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.НеОбрабатывать)
	|	И ОсновныеНачисления.Результат <> 0
	|	И ОсновныеНачисления.Сторно
	|	И ОсновныеНачисления.ВидРасчета В(&парамСписокНачислений)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Сотрудник,
	|	ВидРасчета,
	|	СторнируемыйДокумент,
	|	ПериодДействияНачало,
	|	ПериодДействияКонец
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ОсновныеНачисленияСторно.Сотрудник КАК Сотрудник,
	|	ОсновныеНачисленияСторно.ВидРасчета КАК ВидРасчета,
	|	ОсновныеНачисления.ПериодРегистрации КАК ПериодРегистрации
	|ПОМЕСТИТЬ ВТ_СторноСотрудники
	|ИЗ
	|	ВТ_ОсновныеНачисленияСторно КАК ОсновныеНачисленияСторно
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
	|		ПО ОсновныеНачисленияСторно.СторнируемыйДокумент = ОсновныеНачисления.Регистратор
	|ГДЕ
	|	ОсновныеНачисления.ОбособленноеПодразделение = &парамОрганизация
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Сотрудник,
	|	ВидРасчета,
	|	ПериодРегистрации
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ОсновныеНачисления.Регистратор КАК Регистратор,
	|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
	|	ЕСНОсновныеНачисления.КодДоходаЕСН,
	|	ЕСНОсновныеНачисления.ОблагаетсяЕНВД,
	|	ЕСНОсновныеНачисления.ПериодДействияНачало,
	|	ЕСНОсновныеНачисления.ПериодДействияКонец,
	|	ЕСНОсновныеНачисления.Результат
	|ПОМЕСТИТЬ ВТ_ОтражениеВУчетеСторно
	|ИЗ
	|	ВТ_ОсновныеНачисленияСторно КАК ОсновныеНачисления
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|			ЕСНОсновныеНачисления.ВидРасчета КАК ВидРасчета,
	|			ЕСНОсновныеНачисления.ПериодДействияНачало КАК ПериодДействияНачало,
	|			ЕСНОсновныеНачисления.ПериодДействияКонец КАК ПериодДействияКонец,
	|			ЕСНОсновныеНачисления.Сотрудник КАК Сотрудник,
	|			ЕСНОсновныеНачисления.Результат КАК Результат,
	|			СоответствиеКодов.ВидПоСтраховымВзносам КАК КодДоходаЕСН,
	|			ЕСНОсновныеНачисления.ОблагаетсяЕНВД КАК ОблагаетсяЕНВД,
	|			ЕСНОсновныеНачисления.ДокументОснование КАК ДокументОснование
	|		ИЗ
	|			РегистрРасчета.ЕСНОсновныеНачисления КАК ЕСНОсновныеНачисления
	|				ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКодовЕСНиСтраховыхВзносов КАК СоответствиеКодов
	|				ПО ЕСНОсновныеНачисления.КодДоходаЕСН = СоответствиеКодов.КодДоходаЕСН
	|		ГДЕ
	|			(ЕСНОсновныеНачисления.ПериодРегистрации, ЕСНОсновныеНачисления.Сотрудник, ЕСНОсновныеНачисления.ВидРасчета) В
	|					(ВЫБРАТЬ
	|						ОсновныеНачисления.ПериодРегистрации,
	|						ОсновныеНачисления.Сотрудник,
	|						ОсновныеНачисления.ВидРасчета
	|					ИЗ
	|						ВТ_СторноСотрудники КАК ОсновныеНачисления)
	|			И (НЕ ЕСНОсновныеНачисления.Сторно)) КАК ЕСНОсновныеНачисления
	|		ПО ОсновныеНачисления.ВидРасчета = ЕСНОсновныеНачисления.ВидРасчета
	|			И ОсновныеНачисления.Сотрудник = ЕСНОсновныеНачисления.Сотрудник
	|			И (ОсновныеНачисления.СторнируемыйДокумент = ЕСНОсновныеНачисления.ДокументОснование
	|				ИЛИ ОсновныеНачисления.ВидРасчетаСпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.СдельныйЗаработок))
	|			И (ЕСНОсновныеНачисления.ПериодДействияНачало МЕЖДУ ОсновныеНачисления.ПериодДействияНачало И ОсновныеНачисления.ПериодДействияКонец
	|				ИЛИ ОсновныеНачисления.ПериодДействияНачало МЕЖДУ ЕСНОсновныеНачисления.ПериодДействияНачало И ЕСНОсновныеНачисления.ПериодДействияКонец)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Регистратор,
	|	НомерСтроки";
	
	Возврат ТекстЗапроса;
	
КонецФункции	


////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ РАСЧЕТА Страховых взносов

//////////////////////////////////////////////////////////////////////////////////
// алгоритмы за 2010 год

// Процедура формирует набор записей по данным из запроса
//
// Параметры:
//	РезультатДанныеУчета		- выборка по резултату запроса, возвращенная функцией 
//								  ПолучитьДанныеУчета
//	Успешно						- в этот параметр возвращается значение Ложь, если обработка не выполнена
//								  (например, если не окзалось базовых данных)
//	НаборЗаписей
//
Процедура ОбработатьДанныеУчета2010(ДокументОбъект, ВыделятьЕНВД, ВыборкаПоШапкеДокумента,РезультатДанныеУчета, Успешно, НаборЗаписей, ТаблицаОшибок)

	// признак основных начислений
	ЭтоОсновныеНачисления = (ТипЗнч(НаборЗаписей) = Тип("РегистрРасчетаНаборЗаписей.ЕСНОсновныеНачисления"));
	
	мДлинаСуток = 86400;		// в секундах
	
	ПособияСоциальномуСтрахованию 		  = ДокументОбъект.ПособияПоСоциальномуСтрахованию;
	ПособияПоУходуЗаРебенкомДоПолутораЛет = ДокументОбъект.ПособияПоУходуЗаРебенкомДоПолутораЛет;
	
	РаспределятьПоБазовымНачислениям = Справочники.ДоходыПоСтраховымВзносам.РаспределятьПоБазовымНачислениям;
	
	// структура поиска для позиционирования в ДанныеУчетаВспомогательные
	// при необходимости суммирования "базовых" ресурсов
	СтруктураПоиска = Новый Структура("Регистратор,НомерСтроки");
	
	// структура поиска в таблице ошибок мТаблицаОшибок
	СтруктураПоискаОшибок = Новый Структура("Регистратор,НомерСтроки,КодОшибки");
	
	// основная выборка - по ней ведем обход и вводим записи движений
	ДанныеУчета = РезультатДанныеУчета.Выбрать();
		
	// вспомогательная выборка - по ней ведем суммирование базовых результатов
	ДанныеУчетаВспомогательные = РезультатДанныеУчета.Выбрать();
	
	ПродолжатьОбработку = ДанныеУчета.Следующий();
	Пока ПродолжатьОбработку Цикл
		
		СтрокаДанных = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
		
		Если ДанныеУчета.Сторно Тогда
			
			// необходимо обойти все данные относящиеся к одной строке основного регистра и 
			// выполнить распределение, нормируя на долю 
			ЕстьДанныеУчетаСторно = Истина;
			
			// текущий ключ поиска 
			ТекущийРегистратор = ДанныеУчета.Регистратор;
			ТекущийНомерСтроки = ДанныеУчета.НомерСтроки;
			// позиционируемся во вспомогательной выборке по запросу для суммирования "базовых" данных
			СтруктураПоиска.Регистратор = ТекущийРегистратор;
			СтруктураПоиска.НомерСтроки = ТекущийНомерСтроки;
			Если ДанныеУчетаВспомогательные.Регистратор <> ТекущийРегистратор ИЛИ 
				ДанныеУчетаВспомогательные.НомерСтроки <> ТекущийНомерСтроки Тогда
				// ищем следующую строку во спомогательной выборке если она не является искомой	
				ДанныеУчетаВспомогательные.НайтиСледующий(СтруктураПоиска);
			КонецЕсли;
			
			СуммаПоСтроке = 0;
			// суммируем базовые ресурсы по текущей строке набора записей
			Пока ДанныеУчетаВспомогательные.Регистратор = ТекущийРегистратор И ДанныеУчетаВспомогательные.НомерСтроки = ТекущийНомерСтроки Цикл
				Если ДанныеУчетаВспомогательные.РезультатСторно = NULL Тогда
					//нет данных отражения в учете сторно-записи
					Успешно = Ложь;
					ЕстьДанныеУчетаСторно = Ложь;
					ЗарегистрироватьОшибкуОбработкиДанныхУчета(ТаблицаОшибок, ДанныеУчетаВспомогательные, ЭтоОсновныеНачисления, СтруктураПоискаОшибок, 1);
				Иначе
					СуммаПоСтроке = СуммаПоСтроке + ДанныеУчетаВспомогательные.РезультатСторно;
				КонецЕсли;
				Если Не ДанныеУчетаВспомогательные.Следующий() Тогда
					Прервать;
				КонецЕсли;
			КонецЦикла;
			
			// суммарная доля, которую уже "разбросали" на строки с одинаковым регистратором и номером строки
			СуммарнаяДоля = 0;
			СуммарнаяДоляДоп = 0;
			// полный результат
			ПолныйРезультат = ДанныеУчета.Результат;
			ПолныйРезультатДоп = ДанныеУчета.ДополнительныйРезультат;
			// обходим строки и вычисляем долю результата по базовым записям
			ПерваяИзГруппыСтрок = Истина;
			Пока ДанныеУчета.Регистратор = ТекущийРегистратор И ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
				// если это не первая из группы "базовых" строк по одной строке основного регистра
				// то создаем очередную строку движений
				Если Не ПерваяИзГруппыСтрок Тогда
					СтрокаДанных = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
				Иначе
					ПерваяИзГруппыСтрок = Ложь;
				КонецЕсли;
				
				Если СуммаПоСтроке = 0 Тогда
					Доля = 0;
					ДоляДоп = 0;
				Иначе
					Если ДанныеУчета.РезультатСторно = NULL Тогда
						Доля = 0;
						ДоляДоп = 0;
					Иначе
						Доля = Окр(ПолныйРезультат * ДанныеУчета.РезультатСторно / СуммаПоСтроке,2);
						ДоляДоп = Окр(ПолныйРезультатДоп * ДанныеУчета.РезультатСторно / СуммаПоСтроке,2);
					КонецЕсли;
				КонецЕсли;
				
				СтрокаДанных.ОблагаетсяЕНВД = ДанныеУчета.ОблагаетсяЕНВД;
				СтрокаДанных.Результат = ?(ПолныйРезультат > 0,Мин(Доля,ПолныйРезультат - СуммарнаяДоля),Макс(Доля,ПолныйРезультат - СуммарнаяДоля));
				ДополнительныйРезультат = ?(ПолныйРезультатДоп > 0,Мин(ДоляДоп, ПолныйРезультатДоп - СуммарнаяДоляДоп),Макс(ДоляДоп,ПолныйРезультатДоп - СуммарнаяДоляДоп));
				СуммарнаяДоля = СуммарнаяДоля + СтрокаДанных.Результат;
				СуммарнаяДоляДоп = СуммарнаяДоляДоп + ДополнительныйРезультат;
				
				Если ДанныеУчета.ЭтоПособияФСС Тогда
					
					Если ЕстьДанныеУчетаСторно Тогда
						СтрокаДанных.ПериодДействияНачало = ДанныеУчета.ПериодДействияНачалоСторно;	
						СтрокаДанных.ПериодДействияКонец  = ДанныеУчета.ПериодДействияКонецСторно;
					КонецЕсли;
					
					Если ДанныеУчета.ВидПособияСоциальногоСтрахования = Перечисления.ВидыПособийСоциальногоСтрахования.ПоУходуЗаРебенкомДоПолутораЛет Тогда
						
						СтрокаУчетаПособий = ДокументОбъект.ПособияПоУходуЗаРебенкомДоПолутораЛет.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,СтрокаДанных);
						ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета,"ВыплатаЗаСчетФедеральногоБюджета");
						СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком = СтрокаДанных.Результат * ДанныеУчета.ДоляПособияНаПервогоРебенка;
						СтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенком = СтрокаДанных.Результат - СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком;
						СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм = ДополнительныйРезультат * ДанныеУчета.ДоляПособияНаПервогоРебенка;
						СтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенкомСверхНорм = ДополнительныйРезультат - СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм;
						
					ИначеЕсли ЗначениеЗаполнено(ДанныеУчета.ВидПособияСоциальногоСтрахования) Тогда 
						
						СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
						СтрокаУчетаПособий.ПериодДействияНачало = СтрокаДанных.ПериодДействияНачало;	
						СтрокаУчетаПособий.ПериодДействияКонец  = СтрокаДанных.ПериодДействияКонец;
						СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
						СтрокаУчетаПособий.СуммаСверхНорм = ДополнительныйРезультат;
						СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
						
						Если ЕстьДанныеУчетаСторно Тогда
							
							Если ДанныеУчета.КодДоходаЕСН = Справочники.ДоходыПоСтраховымВзносам.НеОблагаетсяЦеликом Тогда
								СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетРаботодателя;
							Иначе
								СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетФСС;
							КонецЕсли;
							
							Если ДанныеУчета.ВариантОбработкиЗаписиПриОтраженииВРеглУчете = Перечисления.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание Тогда
								
								Если ДанныеУчета.КодДоходаЕСН = Справочники.ДоходыПоСтраховымВзносам.НеОблагаетсяЦеликом Тогда
									СтрокаУчетаПособий.ОплаченныеДни = -1 * ?(ДанныеУчета.ОблагаетсяЕНВД, ДанныеУчета.ВсегоДнейНетрудоспособности, ДанныеУчета.ДниЗаСчетРаботодателя);
								Иначе
									СтрокаУчетаПособий.ОплаченныеДни = -1 * ?(ДанныеУчета.ОблагаетсяЕНВД, ДанныеУчета.ВсегоДнейНетрудоспособности, Макс(0,ДанныеУчета.ВсегоДнейНетрудоспособности - ДанныеУчета.ДниЗаСчетРаботодателя));
								КонецЕсли;
								
							Иначе
								СтрокаУчетаПособий.ОплаченныеДни = -1 * ДанныеУчета.ВсегоДнейНетрудоспособности;
							КонецЕсли;
							
						КонецЕсли;
						
					КонецЕсли;
					
				ИначеЕсли ДанныеУчета.ЭтоЕдиновременноеПособиеФСС Тогда
					
					СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
					СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетФСС;
					СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
					СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
					
				КонецЕсли;	
				
				Если Не ДанныеУчета.Следующий() Тогда
					ПродолжатьОбработку = Ложь;
					Прервать;
				КонецЕсли;
			КонецЦикла;
			// ошибки округления складываются на последнюю запись из группы базовых записей
			СтрокаДанных.Результат = СтрокаДанных.Результат + ПолныйРезультат - СуммарнаяДоля;
			
		ИначеЕсли ДанныеУчета.ЭтоЕдиновременноеПособиеФСС Тогда
			
			СтрокаДанных.ОблагаетсяЕНВД = ВыделятьЕНВД и ДанныеУчета.ПроцентЕНВД = 100;
			
			СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
			СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетФСС;
			СтрокаУчетаПособий.ОблагаетсяЕНВД = СтрокаДанных.ОблагаетсяЕНВД;
			СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
			СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
			
			Если Не ЗначениеЗаполнено(ДанныеУчета.КодДоходаЕСН) Тогда
				// у вида расчета не заполнен реквизит КодДоходаЕСН
				Успешно = Ложь;
				ЗарегистрироватьОшибкуОбработкиДанныхУчета(ТаблицаОшибок, ДанныеУчета, ЭтоОсновныеНачисления, СтруктураПоискаОшибок, 6);
			КонецЕсли;
			
			Если Не ДанныеУчета.Следующий() Тогда
				ПродолжатьОбработку = Ложь;
			КонецЕсли;
			
		ИначеЕсли ДанныеУчета.ЭтоПособияФСС Тогда
			
			// текущий ключ поиска 
			ТекущийРегистратор = ДанныеУчета.Регистратор;
			ТекущийНомерСтроки = ДанныеУчета.НомерСтроки;
			// позиционируемся во вспомогательной выборке по запросу для суммирования "базовых" данных
			СтруктураПоиска.Регистратор = ТекущийРегистратор;
			СтруктураПоиска.НомерСтроки = ТекущийНомерСтроки;
			Если ДанныеУчетаВспомогательные.Регистратор <> ТекущийРегистратор ИЛИ 
				ДанныеУчетаВспомогательные.НомерСтроки <> ТекущийНомерСтроки Тогда
				// ищем следующую строку во спомогательной выборке если она не является искомой	
				ДанныеУчетаВспомогательные.НайтиСледующий(СтруктураПоиска);
			КонецЕсли;
			
			ОбщаяБазаРаспределенияСтроки = 0;
			БазаЕНВД = 0;
			Если ДанныеУчета.СтратегияОтраженияВУчете = Перечисления.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления Тогда
				// суммируем базовые ресурсы по текущей строке набора записей
				Пока ДанныеУчетаВспомогательные.Регистратор = ТекущийРегистратор И ДанныеУчетаВспомогательные.НомерСтроки = ТекущийНомерСтроки Цикл
					Если ДанныеУчетаВспомогательные.РезультатБаза = NULL Тогда
						Если ВыделятьЕНВД Тогда
							// Нет данных для определения доли ЕНВД пособия
							Успешно = Ложь;
							ЗарегистрироватьОшибкуОбработкиДанныхУчета(ТаблицаОшибок, ДанныеУчетаВспомогательные, ЭтоОсновныеНачисления, СтруктураПоискаОшибок, 2);
						КонецЕсли;
					Иначе
						ОбщаяБазаРаспределенияСтроки = ОбщаяБазаРаспределенияСтроки + ДанныеУчетаВспомогательные.РезультатБаза;
						Если ДанныеУчетаВспомогательные.ОблагаетсяЕНВДРазрез Тогда
							БазаЕНВД = БазаЕНВД + ДанныеУчетаВспомогательные.РезультатБаза;
						КонецЕсли;						
					КонецЕсли;
					Если Не ДанныеУчетаВспомогательные.Следующий() Тогда
						Прервать;
					КонецЕсли;
				КонецЦикла;
				
			ИначеЕсли ДанныеУчета.ВариантОбработкиЗаписиПриОтраженииВРеглУчете = Перечисления.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание
				Или ДанныеУчета.ВариантОбработкиЗаписиПриОтраженииВРеглУчете = Перечисления.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий Тогда
				// суммируем базовые ресурсы по текущей строке набора записей
				// сюда попали когда для БЛ доля ЕНВД определяется по текущему месяцу, а доля за счет работодателя распределяется по базовым начислениям
				Если ЗначениеЗаполнено(ДанныеУчета.ДоляСпособаОтражения)  Тогда
					Пока ДанныеУчетаВспомогательные.Регистратор = ТекущийРегистратор И ДанныеУчетаВспомогательные.НомерСтроки = ТекущийНомерСтроки Цикл
						Если Не ДанныеУчетаВспомогательные.РезультатБаза = NULL Тогда
							ОбщаяБазаРаспределенияСтроки = ОбщаяБазаРаспределенияСтроки + ДанныеУчетаВспомогательные.РезультатБаза;
							Если ЗначениеЗаполнено(ДанныеУчетаВспомогательные.ПроцентЕНВД) Тогда
								БазаЕНВД = БазаЕНВД + ДанныеУчетаВспомогательные.РезультатБаза;
							КонецЕсли;						
						КонецЕсли;
						Если Не ДанныеУчетаВспомогательные.Следующий() Тогда
							Прервать;
						КонецЕсли;
					КонецЦикла;
				Иначе
					Пока ДанныеУчетаВспомогательные.Регистратор = ТекущийРегистратор И ДанныеУчетаВспомогательные.НомерСтроки = ТекущийНомерСтроки Цикл
						Если Не ДанныеУчетаВспомогательные.РезультатБаза = NULL Тогда
							ОбщаяБазаРаспределенияСтроки = ОбщаяБазаРаспределенияСтроки + ДанныеУчетаВспомогательные.РезультатБаза;
						КонецЕсли;
						Если Не ДанныеУчетаВспомогательные.Следующий() Тогда
							Прервать;
						КонецЕсли;
					КонецЦикла;
					ОбщаяБазаРаспределенияСтроки = ?(ОбщаяБазаРаспределенияСтроки = 0, ДанныеУчета.Результат, ОбщаяБазаРаспределенияСтроки);
					БазаЕНВД = Окр(ОбщаяБазаРаспределенияСтроки * ДанныеУчета.ПроцентЕНВД / 100,2);
				КонецЕсли;
				
			ИначеЕсли ЗначениеЗаполнено(ДанныеУчета.ДоляСпособаОтражения)  Тогда
				// для пособий полностью выплачиваемых за счет ФСС, по которым необходимо определить долю ЕНВД по текущему месяцу
				// суммируем базовые ресурсы по текущей строке набора записей
				Пока ДанныеУчетаВспомогательные.Регистратор = ТекущийРегистратор И ДанныеУчетаВспомогательные.НомерСтроки = ТекущийНомерСтроки Цикл
					Если Не ДанныеУчетаВспомогательные.РезультатБаза = NULL Тогда
						ОбщаяБазаРаспределенияСтроки = ОбщаяБазаРаспределенияСтроки + ДанныеУчетаВспомогательные.РезультатБаза;
						Если ЗначениеЗаполнено(ДанныеУчетаВспомогательные.ПроцентЕНВД) Тогда
							БазаЕНВД = БазаЕНВД + ДанныеУчетаВспомогательные.РезультатБаза;
						КонецЕсли;						
					КонецЕсли;
					Если Не ДанныеУчетаВспомогательные.Следующий() Тогда
						Прервать;
					КонецЕсли;
				КонецЦикла;
				
			ИначеЕсли ДанныеУчета.ПроцентЕНВД = 100 Тогда
				ОбщаяБазаРаспределенияСтроки = ДанныеУчета.Результат;
				БазаЕНВД = ДанныеУчета.Результат;
			ИначеЕсли ДанныеУчета.ПроцентЕНВД = 0 Тогда
				ОбщаяБазаРаспределенияСтроки = ДанныеУчета.Результат;
			Иначе
				ОбщаяБазаРаспределенияСтроки = ДанныеУчета.Результат;
				БазаЕНВД = Окр(ДанныеУчета.Результат * ДанныеУчета.ПроцентЕНВД / 100,2);
			КонецЕсли;
			
			ВторойКалендарныйДень = ДанныеУчета.ДатаНачалаСобытия + мДлинаСуток;
			ТретийКалендарныйДень = ВторойКалендарныйДень + мДлинаСуток;
			
			// доля пособия за счет работодателя за первые два календарных дня может быть
			// при этом ДоляБЛЗаСчетРаботодателя может быть равна нулю по причине отсутствия ФПД
			ЕстьДоляБЛЗаСчетРаботодателя = ТретийКалендарныйДень > ДанныеУчета.ПериодДействияНачало;
			
			Если ДанныеУчета.ВариантОбработкиЗаписиПриОтраженииВРеглУчете = Перечисления.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве Тогда
				СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыПоСтраховымВзносам.НеОблагаетсяЦеликом;
				СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
				СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетФСС;
				СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
				СтрокаУчетаПособий.ОплаченныеДни = ДанныеУчета.ВсегоДнейНетрудоспособности;
				СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
			ИначеЕсли ДанныеУчета.ВариантОбработкиЗаписиПриОтраженииВРеглУчете = Перечисления.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком Тогда
				
				Если ДанныеУчета.ВидПособияСоциальногоСтрахования = Перечисления.ВидыПособийСоциальногоСтрахования.ПоУходуЗаРебенкомДоПолутораЛет Тогда
					СтрокаУчетаПособий = ПособияПоУходуЗаРебенкомДоПолутораЛет.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,СтрокаДанных);
					ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета,"ВыплатаЗаСчетФедеральногоБюджета");
					СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком = СтрокаДанных.Результат * ДанныеУчета.ДоляПособияНаПервогоРебенка;
					СтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенком = СтрокаДанных.Результат - СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком;
					СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм = ДанныеУчета.ДополнительныйРезультат * ДанныеУчета.ДоляПособияНаПервогоРебенка;
					СтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенкомСверхНорм = ДанныеУчета.ДополнительныйРезультат - СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм;
				Иначе 
					СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
					СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетФСС;
					СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
					СтрокаУчетаПособий.СуммаСверхНорм = ДанныеУчета.ДополнительныйРезультат;
					СтрокаУчетаПособий.ОплаченныеДни = ?(ДанныеУчета.ВидПособияСоциальногоСтрахования = Перечисления.ВидыПособийСоциальногоСтрахования.БеременностьРоды,ДанныеУчета.ВсегоДнейНетрудоспособности,ДанныеУчета.НормаДней);
					СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
				КонецЕсли;
				
				Если ВыделятьЕНВД и ОбщаяБазаРаспределенияСтроки <> 0 и БазаЕНВД <> 0 Тогда
					
					// есть доля ЕНВД, вычислим результат для дохода под ЕНВД
					РезультатПодЕНВД = Окр(ДанныеУчета.Результат * БазаЕНВД / ОбщаяБазаРаспределенияСтроки,2);
					
					Если ДанныеУчета.ПроцентЕНВД = 100 Тогда
						
						СтрокаДанных.ОблагаетсяЕНВД = Истина;
						СтрокаУчетаПособий.ОблагаетсяЕНВД = Истина;	
						
					Иначе
						
						// здесь выделяем часть пособия, относящуюся к видам деятельности, облагаемым ЕНВД
						// заводим новую строку данных - для ввода доли дохода под ЕНВД
						НоваяСтрока = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
						// ресурсы
						НоваяСтрока.Результат = РезультатПодЕНВД;
						
						// основной строке данных уменьшаем результат
						СтрокаДанных.Результат = ДанныеУчета.Результат - РезультатПодЕНВД;
						
						// это строка для подпадающего под ЕНВД дохода
						// "обычная строка" уже введена в движения выше
						НоваяСтрока.ОблагаетсяЕНВД = Истина;
						
						Если ДанныеУчета.ВидПособияСоциальногоСтрахования = Перечисления.ВидыПособийСоциальногоСтрахования.ПоУходуЗаРебенкомДоПолутораЛет Тогда
							СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком = СтрокаДанных.Результат * ДанныеУчета.ДоляПособияНаПервогоРебенка;
							СтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенком = СтрокаДанных.Результат - СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком;
							СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм = (ДанныеУчета.ДополнительныйРезультат - Окр(ДанныеУчета.ДополнительныйРезультат * БазаЕНВД / ОбщаяБазаРаспределенияСтроки,2)) * ДанныеУчета.ДоляПособияНаПервогоРебенка;
							СтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенкомСверхНорм = ДанныеУчета.ДополнительныйРезультат - Окр(ДанныеУчета.ДополнительныйРезультат * БазаЕНВД / ОбщаяБазаРаспределенияСтроки,2) - СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм;
							
							СтрокаУчетаПособий = ПособияПоУходуЗаРебенкомДоПолутораЛет.Добавить();
							ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,НоваяСтрока);
							ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета,"ВыплатаЗаСчетФедеральногоБюджета");
							СтрокаУчетаПособий.ОблагаетсяЕНВД = Истина;
							СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком = НоваяСтрока.Результат * ДанныеУчета.ДоляПособияНаПервогоРебенка;
							СтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенком = НоваяСтрока.Результат - СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком;
							СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм = Окр(ДанныеУчета.ДополнительныйРезультат * БазаЕНВД / ОбщаяБазаРаспределенияСтроки,2) * ДанныеУчета.ДоляПособияНаПервогоРебенка;
							СтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенкомСверхНорм = Окр(ДанныеУчета.ДополнительныйРезультат * БазаЕНВД / ОбщаяБазаРаспределенияСтроки,2) - СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм;
						Иначе
							СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
							
							СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
							ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
							СтрокаУчетаПособий.ОблагаетсяЕНВД = Истина;
							СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетФСС;
							СтрокаУчетаПособий.СуммаВсего = НоваяСтрока.Результат;
							СтрокаУчетаПособий.СуммаСверхНорм = Окр(ДанныеУчета.ДополнительныйРезультат * БазаЕНВД / ОбщаяБазаРаспределенияСтроки,2);
							СтрокаУчетаПособий.ОплаченныеДни = ?(ДанныеУчета.ВидПособияСоциальногоСтрахования = Перечисления.ВидыПособийСоциальногоСтрахования.БеременностьРоды,ДанныеУчета.ВсегоДнейНетрудоспособности,ДанныеУчета.НормаДней);
							СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
						КонецЕсли;
						
					КонецЕсли;
					
				КонецЕсли;
				
			ИначеЕсли ДанныеУчета.ВариантОбработкиЗаписиПриОтраженииВРеглУчете = Перечисления.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий Тогда
				
				СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
				СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетФСС;
				СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
				СтрокаУчетаПособий.СуммаСверхНорм = ДанныеУчета.ДополнительныйРезультат;
				СтрокаУчетаПособий.ОплаченныеДни = ДанныеУчета.ВсегоДнейНетрудоспособности;
				СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
				
				Если ВыделятьЕНВД и ОбщаяБазаРаспределенияСтроки <> 0 и БазаЕНВД <> 0 Тогда
					// здесь выделяем часть пособия, относящуюся к видам деятельности, облагаемым ЕНВД
					// заводим новую строку данных - для ввода доли дохода под ЕНВД
					НоваяСтрока = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
					
					// вычислим результат для дохода под ЕНВД
					РезультатПодЕНВД = Окр(ДанныеУчета.Результат * БазаЕНВД / ОбщаяБазаРаспределенияСтроки,2);
					// ресурсы
					НоваяСтрока.Результат = РезультатПодЕНВД;
					
					// основной строке данных уменьшаем результат
					СтрокаДанных.Результат = ДанныеУчета.Результат - РезультатПодЕНВД;
					
					// это строка для подпадающего под ЕНВД дохода
					// "обычная строка" уже введена в движения выше
					НоваяСтрока.ОблагаетсяЕНВД = Истина;
					
					СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
					СтрокаУчетаПособий.СуммаСверхНорм = ДанныеУчета.ДополнительныйРезультат - Окр(ДанныеУчета.ДополнительныйРезультат * БазаЕНВД / ОбщаяБазаРаспределенияСтроки,2);
					
					СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
					СтрокаУчетаПособий.ОблагаетсяЕНВД = Истина;
					СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетФСС;
					СтрокаУчетаПособий.СуммаВсего = НоваяСтрока.Результат;
					СтрокаУчетаПособий.СуммаСверхНорм = Окр(ДанныеУчета.ДополнительныйРезультат * БазаЕНВД / ОбщаяБазаРаспределенияСтроки,2);
					СтрокаУчетаПособий.ОплаченныеДни = ДанныеУчета.ВсегоДнейНетрудоспособности;
					СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
					
				КонецЕсли;
				
			Иначе // заболевание работника
				
				СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
				СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетФСС;
				СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
				СтрокаУчетаПособий.СуммаСверхНорм = ДанныеУчета.ДополнительныйРезультат;
				СтрокаУчетаПособий.ОплаченныеДни = ДанныеУчета.ВсегоДнейНетрудоспособности;
				СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
				
				// вычислим результат для дохода под ЕНВД
				Если ВыделятьЕНВД и ОбщаяБазаРаспределенияСтроки <> 0 и БазаЕНВД <> 0 Тогда
					РезультатПодЕНВД = Окр(ДанныеУчета.Результат * БазаЕНВД / ОбщаяБазаРаспределенияСтроки,2);
				Иначе	
					РезультатПодЕНВД = 0;
				КонецЕсли;
				
				// вычислим пособие, выплачиваемое за счет работодателя для не ЕНВД 
				БЛЗаСчетРаботодателя = Окр((ДанныеУчета.Результат - РезультатПодЕНВД) * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,2);
				
				// вычислим пособие, выплачиваемое за счет ФСС для не ЕНВД
				БЛЗаСчетФСС = ДанныеУчета.Результат - БЛЗаСчетРаботодателя - РезультатПодЕНВД;
				
				Если БЛЗаСчетФСС <> 0 Тогда
					// основной строке данных уменьшаем результат
					СтрокаДанных.Результат	 = ДанныеУчета.Результат - БЛЗаСчетРаботодателя - РезультатПодЕНВД ;
					СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыПоСтраховымВзносам.ПособияЗаСчетФСС;
					СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
					СтрокаУчетаПособий.СуммаСверхНорм = ДанныеУчета.ДополнительныйРезультат - ?(РезультатПодЕНВД = 0, Окр(ДанныеУчета.ДополнительныйРезультат * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,2),Окр(ДанныеУчета.ДополнительныйРезультат * БазаЕНВД / ОбщаяБазаРаспределенияСтроки,2) + Окр((ДанныеУчета.ДополнительныйРезультат - Окр(ДанныеУчета.ДополнительныйРезультат * БазаЕНВД / ОбщаяБазаРаспределенияСтроки,2)) * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,2));
					СтрокаУчетаПособий.ОплаченныеДни = ДанныеУчета.ВсегоДнейНетрудоспособности - ДанныеУчета.ДниЗаСчетРаботодателя;
					Если ЕстьДоляБЛЗаСчетРаботодателя Тогда
						СтрокаДанных.ПериодДействияНачало = Мин(СтрокаДанных.ПериодДействияКонец, ТретийКалендарныйДень);
						СтрокаУчетаПособий.ПериодДействияНачало = Мин(СтрокаУчетаПособий.ПериодДействияКонец, ТретийКалендарныйДень);
					КонецЕсли;
				КонецЕсли;
				
				Если БЛЗаСчетРаботодателя <> 0 Тогда
					Если БЛЗаСчетФСС <> 0 Тогда
						// заводим новую строку данных - для ввода доли за счет работодателя
						СтрокаДанных = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
						СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
						СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
					КонецЕсли;
					// ресурсы
					СтрокаДанных.Результат = БЛЗаСчетРаботодателя;
					СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыПоСтраховымВзносам.НеОблагаетсяЦеликом;
					СтрокаДанных.ПериодДействияКонец = Мин(СтрокаДанных.ПериодДействияКонец, ВторойКалендарныйДень);
					СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетРаботодателя;
					СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
					СтрокаУчетаПособий.СуммаСверхНорм = 0;
					СтрокаУчетаПособий.ВыплатаЗаСчетФедеральногоБюджета = Перечисления.ВыплатыПособийЗаСчетФедеральногоБюджета.ПустаяСсылка();
					СтрокаУчетаПособий.ОплаченныеДни = ДанныеУчета.ДниЗаСчетРаботодателя;
					СтрокаУчетаПособий.ПериодДействияКонец = Мин(СтрокаУчетаПособий.ПериодДействияКонец, ВторойКалендарныйДень);
				КонецЕсли;
				
				// здесь выделяем часть пособия, относящуюся к видам деятельности, облагаемым ЕНВД
				Если ВыделятьЕНВД и ОбщаяБазаРаспределенияСтроки <> 0 и БазаЕНВД <> 0 Тогда
					
					// вычислим пособие, выплачиваемое за счет работодателя для ЕНВД 
					БЛЗаСчетРаботодателяЕНВД = Окр(РезультатПодЕНВД * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,2);
					
					// вычислим пособие, выплачиваемое за счет ФСС ЕНВД
					БЛЗаСчетФССЕНВД = РезультатПодЕНВД - БЛЗаСчетРаботодателяЕНВД;
					
					Если БЛЗаСчетФСС <> 0 или БЛЗаСчетРаботодателя <> 0 Тогда
						// заводим новую строку данных - для ввода доли дохода под ЕНВД
						СтрокаДанных = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
						// заводим новую строку данных - для ввода доли дохода под ЕНВД
						СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
					КонецЕсли;
					
					Если БЛЗаСчетФССЕНВД <> 0 Тогда
						
						// ресурсы
						СтрокаДанных.Результат = БЛЗаСчетФССЕНВД;
						СтрокаДанных.ОблагаетсяЕНВД = Истина;
						СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыПоСтраховымВзносам.ПособияЗаСчетФСС;
						
						СтрокаУчетаПособий.ОблагаетсяЕНВД = Истина;
						СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетФСС;
						СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
						СтрокаУчетаПособий.СуммаСверхНорм = Окр(ДанныеУчета.ДополнительныйРезультат * БазаЕНВД / ОбщаяБазаРаспределенияСтроки,2) - Окр(Окр(ДанныеУчета.ДополнительныйРезультат * БазаЕНВД / ОбщаяБазаРаспределенияСтроки,2) * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,2);
						СтрокаУчетаПособий.ОплаченныеДни = ДанныеУчета.ВсегоДнейНетрудоспособности - ДанныеУчета.ДниЗаСчетРаботодателя;
						СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
						
						Если ЕстьДоляБЛЗаСчетРаботодателя Тогда
							СтрокаДанных.ПериодДействияНачало = Мин(СтрокаДанных.ПериодДействияКонец, ТретийКалендарныйДень);
							СтрокаУчетаПособий.ПериодДействияНачало = Мин(СтрокаУчетаПособий.ПериодДействияКонец, ТретийКалендарныйДень);
						КонецЕсли;
						
					КонецЕсли;
					
					Если БЛЗаСчетРаботодателяЕНВД <> 0 Тогда
						
						Если БЛЗаСчетФССЕНВД <> 0 Тогда
							// заводим новую строку данных - для ввода доли дохода под ЕНВД
							СтрокаДанных = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
							// заводим новую строку данных - для ввода доли дохода под ЕНВД
							СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
							ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);	
						КонецЕсли;	
						
						// ресурсы
						СтрокаДанных.Результат = БЛЗаСчетРаботодателяЕНВД;
						СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыПоСтраховымВзносам.НеОблагаетсяЦеликом;
						СтрокаДанных.ОблагаетсяЕНВД = Истина;
						
						СтрокаУчетаПособий.ОблагаетсяЕНВД = Истина;
						СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетРаботодателя;
						СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
						СтрокаУчетаПособий.СуммаСверхНорм = 0;
						СтрокаУчетаПособий.ВыплатаЗаСчетФедеральногоБюджета = Перечисления.ВыплатыПособийЗаСчетФедеральногоБюджета.ПустаяСсылка();
						СтрокаУчетаПособий.ОплаченныеДни = ДанныеУчета.ДниЗаСчетРаботодателя;
						СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
						СтрокаУчетаПособий.ПериодДействияКонец = Мин(СтрокаУчетаПособий.ПериодДействияКонец, ВторойКалендарныйДень);
						
					КонецЕсли;
				КонецЕсли;
				
			КонецЕсли;
			
			Пока ДанныеУчета.Регистратор = ТекущийРегистратор И ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
				Если Не ДанныеУчета.Следующий() Тогда
					ПродолжатьОбработку = Ложь;
					Прервать;
				КонецЕсли;
			КонецЦикла;
			
		ИначеЕсли ДанныеУчета.ВариантОбработкиЗаписиПриОтраженииВРеглУчете = Перечисления.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйЗаСчетРаботодателя Тогда
			
			ТекущийРегистратор = ДанныеУчета.Регистратор;
			ТекущийНомерСтроки = ДанныеУчета.НомерСтроки;
			
			СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
			СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетРаботодателя;
			СтрокаУчетаПособий.СуммаВсего = ДанныеУчета.Результат;
			СтрокаУчетаПособий.СуммаСверхНорм = 0;
			СтрокаУчетаПособий.ВыплатаЗаСчетФедеральногоБюджета = Перечисления.ВыплатыПособийЗаСчетФедеральногоБюджета.ПустаяСсылка();
			СтрокаУчетаПособий.ВидПособияСоциальногоСтрахования = Перечисления.ВидыПособийСоциальногоСтрахования.Нетрудоспособность;
			СтрокаУчетаПособий.ОплаченныеДни = ДанныеУчета.ВсегоДнейНетрудоспособности;
			СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
			
			Пока ДанныеУчета.Регистратор = ТекущийРегистратор И ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
				Если Не ДанныеУчета.Следующий() Тогда
					ПродолжатьОбработку = Ложь;
					Прервать;
				КонецЕсли;
			КонецЦикла;
			
		ИначеЕсли ЗначениеЗаполнено(ДанныеУчета.ДоляСпособаОтражения)  Тогда
			// необходимо обойти все данные относящиеся к одной строке основного регистра и 
			// выполнить распределение, нормируя на долю 
			
			// текущий ключ поиска 
			ТекущийРегистратор = ДанныеУчета.Регистратор;
			ТекущийНомерСтроки = ДанныеУчета.НомерСтроки;
			// позиционируемся во вспомогательной выборке по запросу для суммирования "базовых" данных
			СтруктураПоиска.Регистратор = ТекущийРегистратор;
			СтруктураПоиска.НомерСтроки = ТекущийНомерСтроки;
			Если ДанныеУчетаВспомогательные.Регистратор <> ТекущийРегистратор ИЛИ 
				ДанныеУчетаВспомогательные.НомерСтроки <> ТекущийНомерСтроки Тогда
				// ищем следующую строку во спомогательной выборке если она не является искомой	
				ДанныеУчетаВспомогательные.НайтиСледующий(СтруктураПоиска);
			КонецЕсли;
			
			СуммаПоСтроке = 0;
			// суммируем базовые ресурсы по текущей строке набора записей
			Пока ДанныеУчетаВспомогательные.Регистратор = ТекущийРегистратор И ДанныеУчетаВспомогательные.НомерСтроки = ТекущийНомерСтроки Цикл
				Если Не ДанныеУчетаВспомогательные.РезультатБаза = NULL Тогда
					СуммаПоСтроке = СуммаПоСтроке + ДанныеУчетаВспомогательные.РезультатБаза;
				КонецЕсли;
				Если Не ДанныеУчетаВспомогательные.Следующий() Тогда
					Прервать;
				КонецЕсли;
			КонецЦикла;
			
			// суммарная доля, которую уже "разбросали" на строки с одинаковым регистратором и номером строки
			СуммарнаяДоля = 0;
			// полный результат
			ПолныйРезультат = ДанныеУчета.Результат;
			// обходим строки и вычисляем долю результата по базовым записям
			ПерваяИзГруппыСтрок = Истина;
			Пока ДанныеУчета.Регистратор = ТекущийРегистратор И ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
				// если это не первая из группы "базовых" строк по одной строке основного регистра
				// то создаем очередную строку движений
				Если Не ПерваяИзГруппыСтрок Тогда
					СтрокаДанных = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
				Иначе
					ПерваяИзГруппыСтрок = Ложь;
				КонецЕсли;
				
				Если ЗначениеЗаполнено(ДанныеУчета.ПроцентЕНВД) Тогда
					СтрокаДанных.ОблагаетсяЕНВД = Истина;	
				КонецЕсли;
				
				Если СуммаПоСтроке = 0 Тогда
					Доля = 0;
				Иначе
					Если ДанныеУчета.РезультатБаза = NULL Тогда
						Доля = 0;
					Иначе
						Доля = Окр(ПолныйРезультат * ДанныеУчета.РезультатБаза / СуммаПоСтроке,2);
					КонецЕсли;
				КонецЕсли;
				
				СтрокаДанных.Результат = ?(ПолныйРезультат > 0,Мин(Доля,ПолныйРезультат - СуммарнаяДоля),Макс(Доля,ПолныйРезультат - СуммарнаяДоля));
				СуммарнаяДоля = СуммарнаяДоля + СтрокаДанных.Результат;
				Если Не ДанныеУчета.Следующий() Тогда
					ПродолжатьОбработку = Ложь;
					Прервать;
				КонецЕсли;
			КонецЦикла;
			// ошибки округления складываются на последнюю запись из группы базовых записей
			СтрокаДанных.Результат = СтрокаДанных.Результат + ПолныйРезультат - СуммарнаяДоля;
			
		ИначеЕсли ДанныеУчета.КодДоходаЕСН <> РаспределятьПоБазовымНачислениям 
			И ДанныеУчета.СтратегияОтраженияВУчете <> Перечисления.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления
			И ЗначениеЗаполнено(ДанныеУчета.ПроцентЕНВД) Тогда
			
			// это условие не должно выполняться при обработке вторичных данных 
			// для них всегда КодДоходаЕСН = РаспределятьПоБазовымНачислениям
			
			Если Не ЗначениеЗаполнено(ДанныеУчета.КодДоходаЕСН) Тогда
				// у вида расчета не заполнен реквизит КодДоходаЕСН
				Успешно = Ложь;
				ЗарегистрироватьОшибкуОбработкиДанныхУчета(ТаблицаОшибок, ДанныеУчета, ЭтоОсновныеНачисления, СтруктураПоискаОшибок, 6);
			КонецЕсли;
			
			Если ДанныеУчета.ПроцентЕНВД = 100 Тогда
				// строке данных проставляем признак дохода подпадающего под ЕНВД
				СтрокаДанных.ОблагаетсяЕНВД = Истина;
			Иначе
				// заводим новую строку данных - для ввода доли дохода под ЕНВД
				НоваяСтрока = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
				
				// вычислим результат для дохода под ЕНВД
				РезультатПодЕНВД = Окр(ДанныеУчета.Результат * ДанныеУчета.ПроцентЕНВД / 100,2);
				СкидкаПодЕНВД = Окр(ДанныеУчета.Скидка * ДанныеУчета.ПроцентЕНВД / 100,2);
				// ресурсы
				НоваяСтрока.Результат = РезультатПодЕНВД;
				
				// основной строке данных уменьшаем результат
				СтрокаДанных.Результат = ДанныеУчета.Результат - РезультатПодЕНВД;
				
				Если Не ЭтоОсновныеНачисления Тогда
					НоваяСтрока.Скидка    = СкидкаПодЕНВД;
					СтрокаДанных.Скидка    = ДанныеУчета.Скидка - СкидкаПодЕНВД;
				КонецЕсли;
				
				// это строка для подпадающего под ЕНВД дохода
				// "обычная строка" уже введена в движения выше
				НоваяСтрока.ОблагаетсяЕНВД = Истина;
				
			КонецЕсли;
			Если Не ДанныеУчета.Следующий() Тогда
				ПродолжатьОбработку = Ложь;
			КонецЕсли;
			
		ИначеЕсли ДанныеУчета.КодДоходаЕСН = РаспределятьПоБазовымНачислениям 
			ИЛИ ДанныеУчета.СтратегияОтраженияВУчете = Перечисления.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления Тогда
			// тут обрабатываем начисления, которые необходимо отразить в учете ЕСН как базовые начсиления, или 
			// доля ЕНВД определяется по базовым начислениям
			// вычисляем результат нормируя его на базу для строк базы относящихся 
			// к одной строке основного регистра
			
			// текущий ключ поиска 
			ТекущийРегистратор = ДанныеУчета.Регистратор;
			ТекущийНомерСтроки = ДанныеУчета.НомерСтроки;
			// позиционируемся во вспомогательной выборке по запросу для суммирования "базовых" данных
			СтруктураПоиска.Регистратор = ТекущийРегистратор;
			СтруктураПоиска.НомерСтроки = ТекущийНомерСтроки;
			Если 	ДанныеУчетаВспомогательные.Регистратор <> ТекущийРегистратор ИЛИ 
				ДанныеУчетаВспомогательные.НомерСтроки <> ТекущийНомерСтроки Тогда
				// ищем следующую строку во спомогательной выборке если она не является искомой	
				ДанныеУчетаВспомогательные.НайтиСледующий(СтруктураПоиска);
			КонецЕсли;
			
			СуммаПоСтроке = 0;
			
			// по этим переменным будем уточнять расшифровку ошибки
			НуженКодЕСН 	= Ложь;
			НужнаДоляЕНВД 	= Ложь;
			НеЗаданКодЕСН 	= Ложь;
			
			// суммируем базовые ресурсы по текущей строке набора записей
			Пока ДанныеУчетаВспомогательные.Регистратор = ТекущийРегистратор И ДанныеУчетаВспомогательные.НомерСтроки = ТекущийНомерСтроки Цикл
				Если ДанныеУчетаВспомогательные.РезультатБаза = NULL Тогда
					// ошибки нет в том случае, когда код ЕСН задан явно и ЕНВД не используется
					// собственно проверку и регистрацию ошибки произведем позже
				Иначе
					СуммаПоСтроке = СуммаПоСтроке + ДанныеУчетаВспомогательные.РезультатБаза;
				КонецЕсли;
				
				Если ДанныеУчетаВспомогательные.КодДоходаЕСН = РаспределятьПоБазовымНачислениям и ДанныеУчетаВспомогательные.КодДоходаЕСНРазрез = NULL Тогда
					НуженКодЕСН = Истина;
				ИначеЕсли Не ЗначениеЗаполнено(ДанныеУчетаВспомогательные.КодДоходаЕСН) Тогда
					// у в.р. не задан код ЕСН
					НеЗаданКодЕСН = Истина;
				КонецЕсли;
				
				Если ДанныеУчетаВспомогательные.ОблагаетсяЕНВДРазрез = NULL  и ВыделятьЕНВД Тогда
					НужнаДоляЕНВД = Истина;
				КонецЕсли;
				
				Если Не ДанныеУчетаВспомогательные.Следующий() Тогда
					Прервать;
				КонецЕсли;
			КонецЦикла;
			
			Если НуженКодЕСН или НужнаДоляЕНВД или НеЗаданКодЕСН Тогда
				//есть ошибка, определим код ошибки и зарегистрируем ее
				КодОшибки = ?(НуженКодЕСН и НужнаДоляЕНВД, 3, ?(НужнаДоляЕНВД и НеЗаданКодЕСН, 7, ?(НуженКодЕСН, 4, ?(НужнаДоляЕНВД,5,?(НеЗаданКодЕСН,6,0)))));
				Успешно = Ложь;
				ЗарегистрироватьОшибкуОбработкиДанныхУчета(ТаблицаОшибок, ДанныеУчета, ЭтоОсновныеНачисления, СтруктураПоискаОшибок, КодОшибки);
			КонецЕсли;
			
			// суммарная доля, которую уже "разбросали" на строки с одинаковым регистратором и номером строки
			СуммарнаяДоля = 0;
			// полный результат
			ПолныйРезультат = ДанныеУчета.Результат;
			// обходим строки и вычисляем долю результата по базовым записям
			ПерваяИзГруппыСтрок = Истина;
			Пока ДанныеУчета.Регистратор = ТекущийРегистратор И ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
				// если это не первая из группы "базовых" строк по одной строке основного регистра
				// то создаем очередную строку движений
				Если Не ПерваяИзГруппыСтрок Тогда
					СтрокаДанных = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
				Иначе
					ПерваяИзГруппыСтрок = Ложь;
				КонецЕсли;
				
				Если СуммаПоСтроке = 0 Тогда
					Доля = 0;
				Иначе
					Если ДанныеУчета.РезультатБаза = NULL Тогда
						Доля = 0;
					Иначе
						Доля = Окр(ПолныйРезультат * ДанныеУчета.РезультатБаза / СуммаПоСтроке,2);
					КонецЕсли;
				КонецЕсли;
				
				// вид дохода заполним данными базы
				Если ДанныеУчета.КодДоходаЕСН = РаспределятьПоБазовымНачислениям и ДанныеУчета.КодДоходаЕСНРазрез = NULL Тогда
					НуженКодЕСН = Истина;
					// делаем пустым код дохода ЕСН 
					СтрокаДанных.КодДоходаЕСН  = Справочники.ДоходыПоСтраховымВзносам.ПустаяСсылка();
				ИначеЕсли Не ЗначениеЗаполнено(ДанныеУчета.КодДоходаЕСН) Тогда
					// у в.р. не задан код ЕСН
					НеЗаданКодЕСН = Истина;
				Иначе
					СтрокаДанных.КодДоходаЕСН  = ?(ДанныеУчета.КодДоходаЕСН = РаспределятьПоБазовымНачислениям, ДанныеУчета.КодДоходаЕСНРазрез, ДанныеУчета.КодДоходаЕСН);
				КонецЕсли;
				
				// признак обложения ЕНВД заполним данными базы
				Если ДанныеУчета.ОблагаетсяЕНВДРазрез = NULL Тогда
					Если ВыделятьЕНВД Тогда
						НужнаДоляЕНВД = Истина;
					КонецЕсли;
					СтрокаДанных.ОблагаетсяЕНВД  = Ложь;
				Иначе
					СтрокаДанных.ОблагаетсяЕНВД  = ДанныеУчета.ОблагаетсяЕНВДРазрез;
				КонецЕсли;
				
				СтрокаДанных.Результат = Доля;
				СуммарнаяДоля = СуммарнаяДоля + Доля;
				Если Не ДанныеУчета.Следующий() Тогда
					ПродолжатьОбработку = Ложь;
					Прервать;
				КонецЕсли;
				
			КонецЦикла;
			
			// ошибки округления скаладываются на последнюю запись из группы базовых записей
			СтрокаДанных.Результат = СтрокаДанных.Результат + (ПолныйРезультат - СуммарнаяДоля);
		Иначе
			Если Не ЗначениеЗаполнено(ДанныеУчета.КодДоходаЕСН) Тогда
				// у вида расчета не заполнен реквизит КодДоходаЕСН
				Успешно = Ложь;
				ЗарегистрироватьОшибкуОбработкиДанныхУчета(ТаблицаОшибок, ДанныеУчета, ЭтоОсновныеНачисления, СтруктураПоискаОшибок, 6);
			КонецЕсли;	
			Если Не ДанныеУчета.Следующий() Тогда
				ПродолжатьОбработку = Ложь;
			КонецЕсли;
		КонецЕсли;
		
	КонецЦикла;

	// при записи не затираем уже введенные движения
	НаборЗаписей.Записать(Ложь);// выполняем дозапись (набор записей чистится автоматически)
	
КонецПроцедуры  //ОбработатьДанныеУчета2010

// получение первичных данных для расчета ЕСН
// первичные в данном случае, это те, для которых учет ЕСН <> РаспределятьПоБазовымНачислениям,
// или те которые определяют свой ЕСН-учет по базовым начисленияи и при этом базируются на прошлом периоде, 
// или те у которых категория начисления = "Первичное"
// 
// Параметры:
//	Основные	- булево, если Истина, то получаем данные по основным начислениям иначе - по доп.
//
// Возвращаемое значение:
//	Результат запроса
//
Функция ПолучитьДанныеУчета2010(ВыборкаПоШапкеДокумента, ВыделятьЕНВД, СписокНачислений, ОрганичениеНаСотрудников, ЭтоОсновныеНачисления, ЭтоПервичныеНачисления)
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Запрос.УстановитьПараметр("парамНеОтбиратьСотрудников", ОрганичениеНаСотрудников = Неопределено);

	Измерения = Новый Массив(1);
	Измерения[0] = "Сотрудник";
	
	Разрезы = Новый Массив(2);
	Разрезы[0] = "КодДоходаЕСН";
	Разрезы[1] = "ОблагаетсяЕНВД";

	Запрос.УстановитьПараметр("парамИзмерения",		Измерения);
	Запрос.УстановитьПараметр("парамРазрезыЕСН",	Разрезы);
	
	Запрос.УстановитьПараметр("парамСписокНачислений", 		СписокНачислений);
	Запрос.УстановитьПараметр("парамПериодРегистрации",		ВыборкаПоШапкеДокумента.ПериодРегистрации);
	Запрос.УстановитьПараметр("парамОрганизация",			ВыборкаПоШапкеДокумента.ОбособленноеПодразделение);
	Запрос.УстановитьПараметр("парамГоловнаяОрганизация",	ВыборкаПоШапкеДокумента.Организация);
    Запрос.УстановитьПараметр("ЕстьЕНВД",					ВыделятьЕНВД);
	
	// для учета особенностей расчета среднего заработка
	ОсновнойЗаработок = Новый Массив(5);
	ОсновнойЗаработок[0] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработку;
	ОсновнойЗаработок[1] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуБЛ;
	ОсновнойЗаработок[2] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуПособий;
	ОсновнойЗаработок[3] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуИндексируемые;
	ОсновнойЗаработок[4] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуПособийС2010;
	
	ПоФиксПремиям = Новый Массив(3);
	ПоФиксПремиям[0] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиям;
	ПоФиксПремиям[1] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиямБЛ;
	ПоФиксПремиям[2] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиямПособий;
	
	ПоПремиям = Новый Массив(6);
	ПоПремиям[0] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиям;
	ПоПремиям[1] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиямБЛ;
	ПоПремиям[2] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиямПособий;
	ПоПремиям[3] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиямИндексируемые;
	ПоПремиям[4] = ПланыВидовРасчета.СреднийЗаработок.ПоГодовойПремииИндексируемые;
	ПоПремиям[5] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиямПособийС2010;
	
	ФиксГодовыеПремии = Новый Массив(5);
	ФиксГодовыеПремии[0] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксГодовойПремии;
	ФиксГодовыеПремии[1] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксГодовойПремииБЛ;
	ФиксГодовыеПремии[2] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксГодовойПремииПособий;
	ФиксГодовыеПремии[3] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиямНеИндексируемые;
	ФиксГодовыеПремии[4] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксГодовойПремииНеИндексируемые;
	
	Запрос.УстановитьПараметр("парамОсновнойЗаработок",	ОсновнойЗаработок);
	Запрос.УстановитьПараметр("парамОсновнойЗаработокНеиндексируемый",	ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуНеИндексируемые);
	Запрос.УстановитьПараметр("парамПоПремиям",			ПоПремиям);
	Запрос.УстановитьПараметр("парамПоФиксПремиям",		ПоФиксПремиям);
	Запрос.УстановитьПараметр("парамПоФиксПремиямНеИндексируемые",	ФиксГодовыеПремии);

	МассивПоСреднемуЗаработку = Новый Массив;
	МассивПоСреднемуЗаработку.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработку);
	МассивПоСреднемуЗаработку.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуДляОтпускаПоКалендарнымДням);
	МассивПоСреднемуЗаработку.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуДляОтпускаПоШестидневке);
	МассивПоСреднемуЗаработку.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС);
	МассивПоСреднемуЗаработку.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ПособиеПоУходуЗаРебенкомДо1_5Лет);
	МассивПоСреднемуЗаработку.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ДоплатаДоСреднегоЗаработка);
	МассивПоСреднемуЗаработку.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ДоплатаДоСреднегоЗаработкаФСС);
	Запрос.УстановитьПараметр("парамПоСреднемуЗаработку", МассивПоСреднемуЗаработку);
	
	
	МассивАвторскихДоходов = Новый Массив;
	МассивАвторскихДоходов.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеАудиовизуальныеПроизведения);
	МассивАвторскихДоходов.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеГрафическиеПроизведения);
	МассивАвторскихДоходов.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеДругиеМузыкальныеПроизведения);
	МассивАвторскихДоходов.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеИсполнениеПроизведений);
	МассивАвторскихДоходов.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеЛитературныеПроизведения);
	МассивАвторскихДоходов.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеМузыкальноСценическиеПроизведение);
	МассивАвторскихДоходов.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеНаучныеТруды);
	МассивАвторскихДоходов.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеОткрытия);
	МассивАвторскихДоходов.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеСкульптуры);
	Запрос.УстановитьПараметр("ДоходыАвторские", МассивАвторскихДоходов);
	
	// ФизлицаДляРасчета
	//
	Если ОрганичениеНаСотрудников = Неопределено Тогда
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	НЕОПРЕДЕЛЕНО КАК Сотрудник
		|ПОМЕСТИТЬ ВТСписокСотрудников";
		Запрос.Выполнить();
		
	Иначе
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ТаблицаСотрудников.Сотрудник КАК Сотрудник
		|ПОМЕСТИТЬ ВТСписокСотрудников
		|ИЗ
		|	&парамТаблицаСотрудников КАК ТаблицаСотрудников";
		Запрос.УстановитьПараметр("парамТаблицаСотрудников", ОрганичениеНаСотрудников);
		Запрос.Выполнить();
		
	КонецЕсли;
	
	ВписатьВЗапросСоответствиеКодовЕСНиСтраховыхВзносов(Запрос);
	
	Если ЭтоОсновныеНачисления Тогда
		
		Если Не ЭтоПервичныеНачисления Тогда
            
			//соберем базу для зависимых начислений
			БазаТекст = 
			"ВЫБРАТЬ
            |   База.Регистратор КАК Регистратор,
            |   База.НомерСтроки КАК НомерСтроки,
            |   База.КодДоходаЕСНРазрез,
            |   База.ОблагаетсяЕНВДРазрез,
            |   СУММА(База.РезультатБаза) КАК РезультатБаза
            |ПОМЕСТИТЬ База
            |ИЗ
            |   (ВЫБРАТЬ
            |       ОсновныеНачисленияБазаЕСНОсновныеНачисления.Регистратор КАК Регистратор,
            |       ОсновныеНачисленияБазаЕСНОсновныеНачисления.НомерСтроки КАК НомерСтроки,
            |       ОсновныеНачисленияБазаЕСНОсновныеНачисления.КодДоходаЕСНРазрез КАК КодДоходаЕСНРазрез,
            |       ОсновныеНачисленияБазаЕСНОсновныеНачисления.ОблагаетсяЕНВДРазрез КАК ОблагаетсяЕНВДРазрез,
            |       ОсновныеНачисленияБазаЕСНОсновныеНачисления.РезультатБаза КАК РезультатБаза
            |   ИЗ
            |       РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций.БазаЕСНОсновныеНачисления(
            |               &парамИзмерения,
            |               &парамИзмерения,
            |               &парамРазрезыЕСН,
            |               Организация = &парамГоловнаяОрганизация
            |                   И ПериодРегистрации = &парамПериодРегистрации
            |                   И (НЕ ВидРасчета.СпособРасчета В (&парамПоСреднемуЗаработку))
            |                   И (&парамНеОтбиратьСотрудников
            |                       ИЛИ Сотрудник В
            |                           (ВЫБРАТЬ
            |                               ВТСписокСотрудников.Сотрудник
            |                           ИЗ
            |                               ВТСписокСотрудников КАК ВТСписокСотрудников))
            |                   И (НЕ Сторно)
            |                   И ВариантОбработкиЗаписиПриОтраженииВРеглУчете = ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ПустаяСсылка)
            |                   И (&ЕстьЕНВД
            |                           И ВидРасчета.СтратегияОтраженияВУчете = ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
            |                       ИЛИ ВидРасчета.КодДоходаСтраховыеВзносы = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.РаспределятьПоБазовымНачислениям))
            |                   И Результат <> 0
            |                   И ВидРасчета В (&парамСписокНачислений)) КАК ОсновныеНачисленияБазаЕСНОсновныеНачисления
            |   
            |   ОБЪЕДИНИТЬ ВСЕ
            |   
            |   ВЫБРАТЬ
            |       ОсновныеНачисленияБазаЕСНДополнительныеНачисления.Регистратор,
            |       ОсновныеНачисленияБазаЕСНДополнительныеНачисления.НомерСтроки,
            |       ОсновныеНачисленияБазаЕСНДополнительныеНачисления.КодДоходаЕСНРазрез,
            |       ОсновныеНачисленияБазаЕСНДополнительныеНачисления.ОблагаетсяЕНВДРазрез,
            |       ОсновныеНачисленияБазаЕСНДополнительныеНачисления.РезультатБаза
            |   ИЗ
            |       РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций.БазаЕСНДополнительныеНачисления(
            |               &парамИзмерения,
            |               &парамИзмерения,
            |               &парамРазрезыЕСН,
            |               Организация = &парамГоловнаяОрганизация
            |                   И ПериодРегистрации = &парамПериодРегистрации
            |                   И (НЕ ВидРасчета.СпособРасчета В (&парамПоСреднемуЗаработку))
            |                   И (&парамНеОтбиратьСотрудников
            |                       ИЛИ Сотрудник В
            |                           (ВЫБРАТЬ
            |                               ВТСписокСотрудников.Сотрудник
            |                           ИЗ
            |                               ВТСписокСотрудников КАК ВТСписокСотрудников))
            |                   И (НЕ Сторно)
            |                   И (&ЕстьЕНВД
            |                           И ВидРасчета.СтратегияОтраженияВУчете = ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
            |                       ИЛИ ВидРасчета.КодДоходаСтраховыеВзносы = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.РаспределятьПоБазовымНачислениям))
            |                   И ВидРасчета.СтратегияОтраженияВУчете = ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
            |                   И Результат <> 0
            |                   И ВидРасчета В (&парамСписокНачислений)) КАК ОсновныеНачисленияБазаЕСНДополнительныеНачисления) КАК База
            |
            |СГРУППИРОВАТЬ ПО
            |   База.Регистратор,
            |   База.ОблагаетсяЕНВДРазрез,
            |   База.КодДоходаЕСНРазрез,
            |   База.НомерСтроки
            |
            |ИНДЕКСИРОВАТЬ ПО
            |   Регистратор,
            |   НомерСтроки";
						
		Иначе	
			
			// для первичных начислений не собираем базу	
			БазаТекст = 
			"ВЫБРАТЬ
			|	НЕОПРЕДЕЛЕНО КАК Регистратор,
			|	НЕОПРЕДЕЛЕНО КАК НомерСтроки,
			|	НЕОПРЕДЕЛЕНО КАК КодДоходаЕСНРазрез,
			|	ЛОЖЬ КАК ОблагаетсяЕНВДРазрез,
			|	0 КАК РезультатБаза
			|ПОМЕСТИТЬ База";
			
		КонецЕсли;	
		
		Запрос.Текст = БазаТекст;
		//временная таблица - База
		Запрос.Выполнить();
		
        ///////////////////////////////////////////////////////////////////////////////////
		// ПОЛУЧЕНИЕ БАЗЫ СРЕДНЕГО ЗАРАБОТКА для прочих начислений
		
		ПолучатьБазу = Ложь;
			
		// ВТ_ПрочиеНачисления
		//
		Запрос.Текст =
		"ВЫБРАТЬ
		|	ОсновныеНачисления.Сотрудник,
		|	ОсновныеНачисления.Регистратор,
		|	ОсновныеНачисления.НомерСтроки,
		|	ОсновныеНачисления.ДатаНачалаСобытия,
		|	ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало,
		|	ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание,
		|	ВЫБОР
		|		КОГДА ОсновныеНачисления.ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ДоплатаДоСреднегоЗаработкаФСС)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС)
		|		ИНАЧЕ ОсновныеНачисления.ВидРасчета.СпособРасчета
		|	КОНЕЦ КАК СпособРасчета
		|ПОМЕСТИТЬ ВТ_ПрочиеНачисления
		|ИЗ
		|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|ГДЕ
		|	ОсновныеНачисления.ВидРасчета.СпособРасчета В(&парамПоСреднемуЗаработку)
		|	И (&парамНеОтбиратьСотрудников
		|			ИЛИ ОсновныеНачисления.Сотрудник В
		|				(ВЫБРАТЬ
		|					ВТСписокСотрудников.Сотрудник
		|				ИЗ
		|					ВТСписокСотрудников КАК ВТСписокСотрудников))
		|	И (НЕ ОсновныеНачисления.Сторно)
		|	И ОсновныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|	И ОсновныеНачисления.ПериодРегистрации = &парамПериодРегистрации
		|	И ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете = ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ПустаяСсылка)
		|	И ОсновныеНачисления.ВидРасчета.СтратегияОтраженияВУчете = ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
		|	И ОсновныеНачисления.Результат <> 0
		|	И ОсновныеНачисления.ВидРасчета В(&парамСписокНачислений)";
		Запрос.Выполнить();
		
		// ВТ_СотрудникиПериодыПрочиеНачисления
		// условия для виртуальной таблицы
		Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ОсновныеНачисления.Сотрудник КАК Сотрудник,
		|	ОсновныеНачисления.ДатаНачалаСобытия КАК ДатаНачалаСобытия
		|ПОМЕСТИТЬ ВТ_СотрудникиПериодыПрочиеНачисления
		|ИЗ
		|	ВТ_ПрочиеНачисления КАК ОсновныеНачисления
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Сотрудник,
		|	ДатаНачалаСобытия";
		Результат = Запрос.Выполнить().Выгрузить();
		ПолучатьБазу = Результат[0].Количество > 0;

		Если ПолучатьБазу Тогда
			
			БазаСреднегоЗаработкаПрочиеНачисленияТекст =
			"ВЫБРАТЬ
			|	БазаСреднегоЗаработка.Регистратор КАК Регистратор,
			|	БазаСреднегоЗаработка.НомерСтроки КАК НомерСтроки,
			|	БазаСреднегоЗаработка.КодДоходаЕСНРазрез,
			|	БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез,
			|	СУММА(БазаСреднегоЗаработка.РезультатБаза) КАК РезультатБаза
			|ПОМЕСТИТЬ ВТ_БазаСреднегоЗаработкаПрочиеНачисления
			|ИЗ
			|	(ВЫБРАТЬ
			|		ОсновныеНачисления.Регистратор КАК Регистратор,
			|		ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
			|		ВЫБОР
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработок)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|						КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|							ТОГДА 1
			|						ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|					КОНЕЦ
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработокНеиндексируемый)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза
			|			КОГДА БазаСреднегоЗаработка.ЧислоМесяцев = 0
			|				ТОГДА 0
			|			ИНАЧЕ ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиямНеИндексируемые)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					ИНАЧЕ БазаСреднегоЗаработка.РезультатБаза
			|				КОНЕЦ * ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ЧислоМесяцев > БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка
			|						ТОГДА БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка / БазаСреднегоЗаработка.ЧислоМесяцев
			|					ИНАЧЕ 1
			|				КОНЕЦ
			|		КОНЕЦ КАК РезультатБаза,
			|		БазаСреднегоЗаработка.КодДоходаЕСНРазрез КАК КодДоходаЕСНРазрез,
			|		БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез КАК ОблагаетсяЕНВДРазрез
			|	ИЗ
			|		ВТ_ПрочиеНачисления КАК ОсновныеНачисления
			|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.РасчетСреднегоЗаработка.БазаЕСНОсновныеНачисления(
			|					&парамИзмерения,
			|					&парамИзмерения,
			|					&парамРазрезыЕСН,
			|					Организация = &парамГоловнаяОрганизация
			|						И Результат <> 0
			|						И ПериодРегистрации = &парамПериодРегистрации
			|						И (Сотрудник, ДатаНачалаСобытия) В
			|							(ВЫБРАТЬ
			|								Список.Сотрудник,
			|								Список.ДатаНачалаСобытия
			|							ИЗ
			|								ВТ_СотрудникиПериодыПрочиеНачисления КАК Список)) КАК БазаСреднегоЗаработка
			|			ПО ОсновныеНачисления.СпособРасчета = БазаСреднегоЗаработка.СпособРасчета
			|				И ОсновныеНачисления.ДатаНачалаСобытия = БазаСреднегоЗаработка.ДатаНачалаСобытия
			|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало = БазаСреднегоЗаработка.ДатаНачалаРасчетногоПериода
			|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание = БазаСреднегоЗаработка.ДатаОкончанияРасчетногоПериода
			|				И ОсновныеНачисления.Сотрудник = БазаСреднегоЗаработка.Сотрудник
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ОсновныеНачисления.Регистратор,
			|		ОсновныеНачисления.НомерСтроки,
			|		ВЫБОР
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработок)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|						КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|							ТОГДА 1
			|						ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|					КОНЕЦ
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработокНеиндексируемый)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза
			|			КОГДА БазаСреднегоЗаработка.ЧислоМесяцев = 0
			|				ТОГДА 0
			|			ИНАЧЕ ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиямНеИндексируемые)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					ИНАЧЕ БазаСреднегоЗаработка.РезультатБаза
			|				КОНЕЦ * ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ЧислоМесяцев > БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка
			|						ТОГДА БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка / БазаСреднегоЗаработка.ЧислоМесяцев
			|					ИНАЧЕ 1
			|				КОНЕЦ
			|		КОНЕЦ,
			|		БазаСреднегоЗаработка.КодДоходаЕСНРазрез,
			|		БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез
			|	ИЗ
			|		ВТ_ПрочиеНачисления КАК ОсновныеНачисления
			|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.РасчетСреднегоЗаработка.БазаЕСНДополнительныеНачисления(
			|					&парамИзмерения,
			|					&парамИзмерения,
			|					&парамРазрезыЕСН,
			|					Организация = &парамГоловнаяОрганизация
			|						И Результат <> 0
			|						И ПериодРегистрации = &парамПериодРегистрации
			|						И (Сотрудник, ДатаНачалаСобытия) В
			|							(ВЫБРАТЬ
			|								Список.Сотрудник,
			|								Список.ДатаНачалаСобытия
			|							ИЗ
			|								ВТ_СотрудникиПериодыПрочиеНачисления КАК Список)) КАК БазаСреднегоЗаработка
			|			ПО ОсновныеНачисления.СпособРасчета = БазаСреднегоЗаработка.СпособРасчета
			|				И ОсновныеНачисления.ДатаНачалаСобытия = БазаСреднегоЗаработка.ДатаНачалаСобытия
			|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало = БазаСреднегоЗаработка.ДатаНачалаРасчетногоПериода
			|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание = БазаСреднегоЗаработка.ДатаОкончанияРасчетногоПериода
			|				И ОсновныеНачисления.Сотрудник = БазаСреднегоЗаработка.Сотрудник) КАК БазаСреднегоЗаработка
			|
			|СГРУППИРОВАТЬ ПО
			|	БазаСреднегоЗаработка.Регистратор,
			|	БазаСреднегоЗаработка.НомерСтроки,
			|	БазаСреднегоЗаработка.КодДоходаЕСНРазрез,
			|	БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	Регистратор,
			|	НомерСтроки";
			
		Иначе	
			
			БазаСреднегоЗаработкаПрочиеНачисленияТекст = 
			"ВЫБРАТЬ
            |   НЕОПРЕДЕЛЕНО КАК Регистратор,
            |   0 КАК НомерСтроки,
            |   НЕОПРЕДЕЛЕНО КАК КодДоходаЕСНРазрез,
            |   ЛОЖЬ КАК ОблагаетсяЕНВДРазрез,
            |   0 КАК РезультатБаза
            |ПОМЕСТИТЬ ВТ_БазаСреднегоЗаработкаПрочиеНачисления";
			
		КонецЕсли;	

		Запрос.Текст = БазаСреднегоЗаработкаПрочиеНачисленияТекст;
		//временная таблица - ВТ_БазаСреднегоЗаработкаПрочиеНачисления
		Запрос.Выполнить();
		
		// Закончили получение базы среднего заработка для прочих начислений
		///////////////////////////////////////////////////////////////////////////////////

        ///////////////////////////////////////////////////////////////////////////////////
		// ПОЛУЧЕНИЕ БАЗЫ СРЕДНЕГО ЗАРАБОТКА для
        // пособия по уходу за ребенком и отпуск по беременности и родам
		// базу надо получать только при наличии ЕНВД
		
		ПолучатьБазу = Ложь;
		Если ВыделятьЕНВД Тогда
			
			// ВТ_ОтпускПоБеременностиИРодамПоУходуЗаРебенком
			//
			Запрос.Текст =
			"ВЫБРАТЬ
			|	ОсновныеНачисления.Регистратор,
			|	ОсновныеНачисления.НомерСтроки,
			|	РасчетСреднегоЗаработка.Сотрудник,
			|	РасчетСреднегоЗаработка.ПериодРегистрации,
			|	ОсновныеНачисления.ДатаНачалаСобытия,
			|	ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало,
			|	ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание,
			|	ОсновныеНачисления.ВидРасчета.СпособРасчета КАК СпособРасчета
			|ПОМЕСТИТЬ ВТ_ОтпускПоБеременностиИРодамПоУходуЗаРебенком
			|ИЗ
			|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.РасчетСреднегоЗаработка КАК РасчетСреднегоЗаработка
			|		ПО ОсновныеНачисления.ВидРасчета.СпособРасчета = РасчетСреднегоЗаработка.СпособРасчета
			|			И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало = РасчетСреднегоЗаработка.ДатаНачалаРасчетногоПериода
			|			И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание = РасчетСреднегоЗаработка.ДатаОкончанияРасчетногоПериода
			|			И ОсновныеНачисления.ДатаНачалаСобытия = РасчетСреднегоЗаработка.ДатаНачалаСобытия
			|			И (ОсновныеНачисления.Сотрудник = ВЫБОР
			|				КОГДА РасчетСреднегоЗаработка.Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ВнутреннееСовместительство)
			|						И РасчетСреднегоЗаработка.СпособРасчета В (ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС), ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПособиеПоУходуЗаРебенкомДо1_5Лет))
			|					ТОГДА ЕСТЬNULL(РасчетСреднегоЗаработка.Регистратор.Сотрудник, РасчетСреднегоЗаработка.Сотрудник)
			|				ИНАЧЕ РасчетСреднегоЗаработка.Сотрудник
			|			КОНЕЦ)
			|			И (РасчетСреднегоЗаработка.Организация = &парамГоловнаяОрганизация)
			|ГДЕ
			|	ОсновныеНачисления.ВидРасчета.СпособРасчета В(&парамПоСреднемуЗаработку)
			|	И (НЕ ОсновныеНачисления.Сторно)
			|	И (&парамНеОтбиратьСотрудников
			|			ИЛИ ОсновныеНачисления.Сотрудник В
			|				(ВЫБРАТЬ
			|					ВТСписокСотрудников.Сотрудник
			|				ИЗ
			|					ВТСписокСотрудников КАК ВТСписокСотрудников))
			|	И ОсновныеНачисления.ОбособленноеПодразделение = &парамОрганизация
			|	И ОсновныеНачисления.ПериодРегистрации = &парамПериодРегистрации
			|	И ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенкомНовыйСтраховойСлучай))
			|	И ОсновныеНачисления.ВидРасчета.СтратегияОтраженияВУчете = ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
			|	И ОсновныеНачисления.Результат <> 0
			|	И ОсновныеНачисления.ВидРасчета В(&парамСписокНачислений)";
			Запрос.Выполнить();
			
			// ВТ_СотрудникиПериодыОтпускПоБеременностиИРодамПоУходуЗаРебенком
			// условия для виртуальной таблицы
			Запрос.Текст =
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ОсновныеНачисления.Сотрудник КАК Сотрудник,
			|	ОсновныеНачисления.ПериодРегистрации КАК ПериодРегистрации,
			|	ОсновныеНачисления.ДатаНачалаСобытия КАК ДатаНачалаСобытия
			|ПОМЕСТИТЬ ВТ_СотрудникиПериодыОтпускПоБеременностиИРодамПоУходуЗаРебенком
			|ИЗ
			|	ВТ_ОтпускПоБеременностиИРодамПоУходуЗаРебенком КАК ОсновныеНачисления
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	Сотрудник,
			|	ПериодРегистрации,
			|	ДатаНачалаСобытия";
			Результат = Запрос.Выполнить().Выгрузить();
			ПолучатьБазу = Результат[0].Количество > 0;
		КонецЕсли;
		
		Если ПолучатьБазу Тогда
			
			БазаСреднегоЗаработкаОтпускПоБеременностиИРодамПоУходуЗаРебенкомТекст =
			"ВЫБРАТЬ
			|	БазаСреднегоЗаработка.Регистратор КАК Регистратор,
			|	БазаСреднегоЗаработка.НомерСтроки КАК НомерСтроки,
			|	БазаСреднегоЗаработка.КодДоходаЕСНРазрез,
			|	БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез,
			|	СУММА(БазаСреднегоЗаработка.РезультатБаза) КАК РезультатБаза
			|ПОМЕСТИТЬ ВТ_БазаСреднегоЗаработкаОтпускПоБеременностиИРодамПоУходуЗаРебенком
			|ИЗ
			|	(ВЫБРАТЬ
			|		ОсновныеНачисления.Регистратор КАК Регистратор,
			|		ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
			|		ВЫБОР
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработок)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|						КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|							ТОГДА 1
			|						ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|					КОНЕЦ
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработокНеиндексируемый)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза
			|			КОГДА БазаСреднегоЗаработка.ЧислоМесяцев = 0
			|				ТОГДА 0
			|			ИНАЧЕ ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиямНеИндексируемые)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					ИНАЧЕ БазаСреднегоЗаработка.РезультатБаза
			|				КОНЕЦ * ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ЧислоМесяцев > БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка
			|						ТОГДА БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка / БазаСреднегоЗаработка.ЧислоМесяцев
			|					ИНАЧЕ 1
			|				КОНЕЦ
			|		КОНЕЦ КАК РезультатБаза,
			|		БазаСреднегоЗаработка.КодДоходаЕСНРазрез КАК КодДоходаЕСНРазрез,
			|		БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез КАК ОблагаетсяЕНВДРазрез
			|	ИЗ
			|		ВТ_ОтпускПоБеременностиИРодамПоУходуЗаРебенком КАК ОсновныеНачисления
			|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.РасчетСреднегоЗаработка.БазаЕСНОсновныеНачисления(
			|					&парамИзмерения,
			|					&парамИзмерения,
			|					&парамРазрезыЕСН,
			|					Организация = &парамГоловнаяОрганизация
			|						И Результат <> 0
			|						И (Сотрудник, ПериодРегистрации, ДатаНачалаСобытия) В
			|							(ВЫБРАТЬ
			|								Список.Сотрудник,
			|								Список.ПериодРегистрации,
			|								Список.ДатаНачалаСобытия
			|							ИЗ
			|								ВТ_СотрудникиПериодыОтпускПоБеременностиИРодамПоУходуЗаРебенком КАК Список)) КАК БазаСреднегоЗаработка
			|			ПО ОсновныеНачисления.СпособРасчета = БазаСреднегоЗаработка.СпособРасчета
			|				И ОсновныеНачисления.ДатаНачалаСобытия = БазаСреднегоЗаработка.ДатаНачалаСобытия
			|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало = БазаСреднегоЗаработка.ДатаНачалаРасчетногоПериода
			|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание = БазаСреднегоЗаработка.ДатаОкончанияРасчетногоПериода
			|				И ОсновныеНачисления.Сотрудник = БазаСреднегоЗаработка.Сотрудник
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ОсновныеНачисления.Регистратор,
			|		ОсновныеНачисления.НомерСтроки,
			|		ВЫБОР
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработок)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|						КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|							ТОГДА 1
			|						ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|					КОНЕЦ
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработокНеиндексируемый)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза
			|			КОГДА БазаСреднегоЗаработка.ЧислоМесяцев = 0
			|				ТОГДА 0
			|			ИНАЧЕ ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиямНеИндексируемые)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					ИНАЧЕ БазаСреднегоЗаработка.РезультатБаза
			|				КОНЕЦ * ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ЧислоМесяцев > БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка
			|						ТОГДА БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка / БазаСреднегоЗаработка.ЧислоМесяцев
			|					ИНАЧЕ 1
			|				КОНЕЦ
			|		КОНЕЦ,
			|		БазаСреднегоЗаработка.КодДоходаЕСНРазрез,
			|		БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез
			|	ИЗ
			|		ВТ_ОтпускПоБеременностиИРодамПоУходуЗаРебенком КАК ОсновныеНачисления
			|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.РасчетСреднегоЗаработка.БазаЕСНДополнительныеНачисления(
			|					&парамИзмерения,
			|					&парамИзмерения,
			|					&парамРазрезыЕСН,
			|					Организация = &парамГоловнаяОрганизация
			|						И Результат <> 0
			|						И (Сотрудник, ПериодРегистрации, ДатаНачалаСобытия) В
			|							(ВЫБРАТЬ
			|								Список.Сотрудник,
			|								Список.ПериодРегистрации,
			|								Список.ДатаНачалаСобытия
			|							ИЗ
			|								ВТ_СотрудникиПериодыОтпускПоБеременностиИРодамПоУходуЗаРебенком КАК Список)) КАК БазаСреднегоЗаработка
			|			ПО ОсновныеНачисления.СпособРасчета = БазаСреднегоЗаработка.СпособРасчета
			|				И ОсновныеНачисления.ДатаНачалаСобытия = БазаСреднегоЗаработка.ДатаНачалаСобытия
			|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало = БазаСреднегоЗаработка.ДатаНачалаРасчетногоПериода
			|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание = БазаСреднегоЗаработка.ДатаОкончанияРасчетногоПериода
			|				И ОсновныеНачисления.Сотрудник = БазаСреднегоЗаработка.Сотрудник) КАК БазаСреднегоЗаработка
			|
			|СГРУППИРОВАТЬ ПО
			|	БазаСреднегоЗаработка.Регистратор,
			|	БазаСреднегоЗаработка.НомерСтроки,
			|	БазаСреднегоЗаработка.КодДоходаЕСНРазрез,
			|	БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	Регистратор,
			|	НомерСтроки";
			
		Иначе	
			
			БазаСреднегоЗаработкаОтпускПоБеременностиИРодамПоУходуЗаРебенкомТекст = 
			"ВЫБРАТЬ
            |   НЕОПРЕДЕЛЕНО КАК Регистратор,
            |   0 КАК НомерСтроки,
            |   НЕОПРЕДЕЛЕНО КАК КодДоходаЕСНРазрез,
            |   ЛОЖЬ КАК ОблагаетсяЕНВДРазрез,
            |   0 КАК РезультатБаза
            |ПОМЕСТИТЬ ВТ_БазаСреднегоЗаработкаОтпускПоБеременностиИРодамПоУходуЗаРебенком";
			
		КонецЕсли;	

        Запрос.Текст = БазаСреднегоЗаработкаОтпускПоБеременностиИРодамПоУходуЗаРебенкомТекст;
		//временная таблица - ВТ_БазаСреднегоЗаработкаОтпускПоБеременностиИРодамПоУходуЗаРебенком
		Запрос.Выполнить();
		
		// Закончили получение базы среднего заработка для пособия по уходу за ребенком и отпуск по беременности и родам
		///////////////////////////////////////////////////////////////////////////////////

        ///////////////////////////////////////////////////////////////////////////////////
		// ПОЛУЧЕНИЕ БАЗЫ СРЕДНЕГО ЗАРАБОТКА для 
        // прочих больничных
		// базу надо получать при наличии ЕНВД 		
		ПолучатьБазу = Ложь;
		ПрочиеБЛТекст = "";
		Если ВыделятьЕНВД  Тогда
			
			// ВТ_ПрочиеБЛ
			//
			ПрочиеБЛТекст =
			"ВЫБРАТЬ
			|	ОсновныеНачисления.Регистратор,
			|	ОсновныеНачисления.НомерСтроки,
			|	РасчетСреднегоЗаработка.Сотрудник,
			|	ОсновныеНачисления.ДатаНачалаСобытия,
			|	ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало,
			|	ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание,
			|	ОсновныеНачисления.ВидРасчета.СпособРасчета КАК СпособРасчета
			|ПОМЕСТИТЬ ВТ_ПрочиеБЛ
			|ИЗ
			|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.РасчетСреднегоЗаработка КАК РасчетСреднегоЗаработка
			|		ПО ОсновныеНачисления.ВидРасчета.СпособРасчета = РасчетСреднегоЗаработка.СпособРасчета
			|			И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало = РасчетСреднегоЗаработка.ДатаНачалаРасчетногоПериода
			|			И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание = РасчетСреднегоЗаработка.ДатаОкончанияРасчетногоПериода
			|			И ОсновныеНачисления.ДатаНачалаСобытия = РасчетСреднегоЗаработка.ДатаНачалаСобытия
			|			И (ОсновныеНачисления.Сотрудник = ВЫБОР
			|				КОГДА РасчетСреднегоЗаработка.Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ВнутреннееСовместительство)
			|						И РасчетСреднегоЗаработка.СпособРасчета В (ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС), ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПособиеПоУходуЗаРебенкомДо1_5Лет))
			|					ТОГДА ЕСТЬNULL(РасчетСреднегоЗаработка.Регистратор.Сотрудник, РасчетСреднегоЗаработка.Сотрудник)
			|				ИНАЧЕ РасчетСреднегоЗаработка.Сотрудник
			|			КОНЕЦ)
			|			И (РасчетСреднегоЗаработка.Организация = &парамГоловнаяОрганизация)
			|ГДЕ
			|	ОсновныеНачисления.ВидРасчета.СпособРасчета В(&парамПоСреднемуЗаработку)
			|	И (НЕ ОсновныеНачисления.Сторно)
			|	И (&парамНеОтбиратьСотрудников
			|			ИЛИ ОсновныеНачисления.Сотрудник В
			|				(ВЫБРАТЬ
			|					ВТСписокСотрудников.Сотрудник
			|				ИЗ
			|					ВТСписокСотрудников КАК ВТСписокСотрудников))
			|	И ОсновныеНачисления.ОбособленноеПодразделение = &парамОрганизация
			|	И ОсновныеНачисления.ПериодРегистрации = &парамПериодРегистрации
			|	И ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочийНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболеваниеНовыйСтраховойСлучай))
			|	И ОсновныеНачисления.ВидРасчета.СтратегияОтраженияВУчете = ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
			|	И ОсновныеНачисления.Результат <> 0
			|	И ОсновныеНачисления.ВидРасчета В(&парамСписокНачислений)";
			
		КонецЕсли;
		
		Если Не ПустаяСтрока(ПрочиеБЛТекст) Тогда
			// ВТ_СотрудникиПериодыПрочиеБЛ
			// условия для виртуальной таблицы
			
			Запрос.Текст = ПрочиеБЛТекст;
			Запрос.Выполнить();
			
			Запрос.Текст =
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ОсновныеНачисления.Сотрудник КАК Сотрудник,
			|	ОсновныеНачисления.ДатаНачалаСобытия КАК ДатаНачалаСобытия
			|ПОМЕСТИТЬ ВТ_СотрудникиПериодыПрочиеБЛ
			|ИЗ
			|	ВТ_ПрочиеБЛ КАК ОсновныеНачисления
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	Сотрудник,
			|	ДатаНачалаСобытия";
			Результат = Запрос.Выполнить().Выгрузить();
			ПолучатьБазу = Результат[0].Количество > 0;	
		КонецЕсли;
		
		Если ПолучатьБазу Тогда
			
			БазаСреднегоЗаработкаПрочиеБЛТекст =
			"ВЫБРАТЬ
			|	БазаСреднегоЗаработка.Регистратор КАК Регистратор,
			|	БазаСреднегоЗаработка.НомерСтроки КАК НомерСтроки,
			|	БазаСреднегоЗаработка.КодДоходаЕСНРазрез,
			|	БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез,
			|	СУММА(БазаСреднегоЗаработка.РезультатБаза) КАК РезультатБаза
			|ПОМЕСТИТЬ ВТ_БазаСреднегоЗаработкаПрочиеБЛ
			|ИЗ
			|	(ВЫБРАТЬ
			|		ОсновныеНачисления.Регистратор КАК Регистратор,
			|		ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
			|		ВЫБОР
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработок)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|						КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|							ТОГДА 1
			|						ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|					КОНЕЦ
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработокНеиндексируемый)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза
			|			КОГДА БазаСреднегоЗаработка.ЧислоМесяцев = 0
			|				ТОГДА 0
			|			ИНАЧЕ ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиямНеИндексируемые)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					ИНАЧЕ БазаСреднегоЗаработка.РезультатБаза
			|				КОНЕЦ * ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ЧислоМесяцев > БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка
			|						ТОГДА БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка / БазаСреднегоЗаработка.ЧислоМесяцев
			|					ИНАЧЕ 1
			|				КОНЕЦ
			|		КОНЕЦ КАК РезультатБаза,
			|		БазаСреднегоЗаработка.КодДоходаЕСНРазрез КАК КодДоходаЕСНРазрез,
			|		БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез КАК ОблагаетсяЕНВДРазрез
			|	ИЗ
			|		ВТ_ПрочиеБЛ КАК ОсновныеНачисления
			|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.РасчетСреднегоЗаработка.БазаЕСНОсновныеНачисления(
			|					&парамИзмерения,
			|					&парамИзмерения,
			|					&парамРазрезыЕСН,
			|					Организация = &парамГоловнаяОрганизация
			|						И Результат <> 0
			|						И ПериодРегистрации = &парамПериодРегистрации
			|						И (Сотрудник, ДатаНачалаСобытия) В
			|							(ВЫБРАТЬ
			|								Список.Сотрудник,
			|								Список.ДатаНачалаСобытия
			|							ИЗ
			|								ВТ_СотрудникиПериодыПрочиеБЛ КАК Список)) КАК БазаСреднегоЗаработка
			|			ПО ОсновныеНачисления.СпособРасчета = БазаСреднегоЗаработка.СпособРасчета
			|				И ОсновныеНачисления.ДатаНачалаСобытия = БазаСреднегоЗаработка.ДатаНачалаСобытия
			|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало = БазаСреднегоЗаработка.ДатаНачалаРасчетногоПериода
			|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание = БазаСреднегоЗаработка.ДатаОкончанияРасчетногоПериода
			|				И ОсновныеНачисления.Сотрудник = БазаСреднегоЗаработка.Сотрудник
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ОсновныеНачисления.Регистратор,
			|		ОсновныеНачисления.НомерСтроки,
			|		ВЫБОР
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработок)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|						КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|							ТОГДА 1
			|						ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|					КОНЕЦ
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработокНеиндексируемый)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза
			|			КОГДА БазаСреднегоЗаработка.ЧислоМесяцев = 0
			|				ТОГДА 0
			|			ИНАЧЕ ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиямНеИндексируемые)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					ИНАЧЕ БазаСреднегоЗаработка.РезультатБаза
			|				КОНЕЦ * ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ЧислоМесяцев > БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка
			|						ТОГДА БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка / БазаСреднегоЗаработка.ЧислоМесяцев
			|					ИНАЧЕ 1
			|				КОНЕЦ
			|		КОНЕЦ,
			|		БазаСреднегоЗаработка.КодДоходаЕСНРазрез,
			|		БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез
			|	ИЗ
			|		ВТ_ПрочиеБЛ КАК ОсновныеНачисления
			|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.РасчетСреднегоЗаработка.БазаЕСНДополнительныеНачисления(
			|					&парамИзмерения,
			|					&парамИзмерения,
			|					&парамРазрезыЕСН,
			|					Организация = &парамГоловнаяОрганизация
			|						И Результат <> 0
			|						И ПериодРегистрации = &парамПериодРегистрации
			|						И (Сотрудник, ДатаНачалаСобытия) В
			|							(ВЫБРАТЬ
			|								Список.Сотрудник,
			|								Список.ДатаНачалаСобытия
			|							ИЗ
			|								ВТ_СотрудникиПериодыПрочиеБЛ КАК Список)) КАК БазаСреднегоЗаработка
			|			ПО ОсновныеНачисления.СпособРасчета = БазаСреднегоЗаработка.СпособРасчета
			|				И ОсновныеНачисления.ДатаНачалаСобытия = БазаСреднегоЗаработка.ДатаНачалаСобытия
			|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало = БазаСреднегоЗаработка.ДатаНачалаРасчетногоПериода
			|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание = БазаСреднегоЗаработка.ДатаОкончанияРасчетногоПериода
			|				И ОсновныеНачисления.Сотрудник = БазаСреднегоЗаработка.Сотрудник) КАК БазаСреднегоЗаработка
			|
			|СГРУППИРОВАТЬ ПО
			|	БазаСреднегоЗаработка.Регистратор,
			|	БазаСреднегоЗаработка.НомерСтроки,
			|	БазаСреднегоЗаработка.КодДоходаЕСНРазрез,
			|	БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	Регистратор,
			|	НомерСтроки";
			
		Иначе	
			
			БазаСреднегоЗаработкаПрочиеБЛТекст = 
			"ВЫБРАТЬ
            |   НЕОПРЕДЕЛЕНО КАК Регистратор,
            |   0 КАК НомерСтроки,
            |   НЕОПРЕДЕЛЕНО КАК КодДоходаЕСНРазрез,
            |   ЛОЖЬ КАК ОблагаетсяЕНВДРазрез,
            |   0 КАК РезультатБаза
            |ПОМЕСТИТЬ ВТ_БазаСреднегоЗаработкаПрочиеБЛ";
			
		КонецЕсли;	

        Запрос.Текст = БазаСреднегоЗаработкаПрочиеБЛТекст;
		//временная таблица - ВТ_БазаСреднегоЗаработкаПрочиеБЛ
		Запрос.Выполнить();
		
		// Закончили получение базы среднего заработка для прочих больничных
		///////////////////////////////////////////////////////////////////////////////////

		// объединим базы среднего в одну временную таблицу
	    БазаСреднегоЗаработкаТекст = 
		"ВЫБРАТЬ
		|	БазаСреднегоЗаработкаПрочиеНачисления.Регистратор КАК Регистратор,
		|	БазаСреднегоЗаработкаПрочиеНачисления.НомерСтроки КАК НомерСтроки,
		|	БазаСреднегоЗаработкаПрочиеНачисления.КодДоходаЕСНРазрез,
		|	БазаСреднегоЗаработкаПрочиеНачисления.ОблагаетсяЕНВДРазрез,
		|	БазаСреднегоЗаработкаПрочиеНачисления.РезультатБаза
		|ПОМЕСТИТЬ ВТ_БазаСреднегоЗаработка
		|ИЗ
		|	ВТ_БазаСреднегоЗаработкаПрочиеНачисления КАК БазаСреднегоЗаработкаПрочиеНачисления
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	БазаСреднегоЗаработкаОтпускПоБеременностиИРодамПоУходуЗаРебенком.Регистратор,
		|	БазаСреднегоЗаработкаОтпускПоБеременностиИРодамПоУходуЗаРебенком.НомерСтроки,
		|	БазаСреднегоЗаработкаОтпускПоБеременностиИРодамПоУходуЗаРебенком.КодДоходаЕСНРазрез,
		|	БазаСреднегоЗаработкаОтпускПоБеременностиИРодамПоУходуЗаРебенком.ОблагаетсяЕНВДРазрез,
		|	БазаСреднегоЗаработкаОтпускПоБеременностиИРодамПоУходуЗаРебенком.РезультатБаза
		|ИЗ
		|	ВТ_БазаСреднегоЗаработкаОтпускПоБеременностиИРодамПоУходуЗаРебенком КАК БазаСреднегоЗаработкаОтпускПоБеременностиИРодамПоУходуЗаРебенком
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	БазаСреднегоЗаработкаПрочиеБЛ.Регистратор,
		|	БазаСреднегоЗаработкаПрочиеБЛ.НомерСтроки,
		|	БазаСреднегоЗаработкаПрочиеБЛ.КодДоходаЕСНРазрез,
		|	БазаСреднегоЗаработкаПрочиеБЛ.ОблагаетсяЕНВДРазрез,
		|	БазаСреднегоЗаработкаПрочиеБЛ.РезультатБаза
		|ИЗ
		|	ВТ_БазаСреднегоЗаработкаПрочиеБЛ КАК БазаСреднегоЗаработкаПрочиеБЛ
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	НомерСтроки";
		Запрос.Текст = БазаСреднегоЗаработкаТекст;
		//временная таблица - ВТ_БазаСреднегоЗаработка
		Запрос.Выполнить();

		///////////////////////////////////////////////////////////////////////////////////
		//получим отражение в учете сторно записей
		
		//временная таблица - ВТ_ОтражениеВУчетеСторно
		Запрос.Текст = ПолучитьТекстЗапросаОтражениеСторноЗаписей(); 
		Запрос.Выполнить();
		
		//получили отражение в учете сторно записей
		///////////////////////////////////////////////////////////////////////////////////
		
		///////////////////////////////////////////////////////////////////////////////////
		// ПОЛУЧЕНИЕ СПОСОБОВ ОТРАЖЕНИЯ В УЧЕТЕ ПЛАНОВЫХ НАЧИСЛЕНИЙ
		// таблица ВТ_УчетПлановыхНачислений
		
		УчетПлановыхНачисленийТекст =
		 "ВЫБРАТЬ
		 |	ОсновныеНачисления.Регистратор КАК Регистратор,
		 |	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		 |	ОсновныеНачисления.Сотрудник КАК Сотрудник,
		 |	ОсновныеНачисления.ДатаНачалаСобытия,
		 |	ОсновныеНачисления.ВидРасчета
		 |ПОМЕСТИТЬ ВТ_ОсновыеНачисленияДляПлановый
		 |ИЗ
		 |	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		 |ГДЕ
		 |	ОсновныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		 |	И ОсновныеНачисления.ПериодРегистрации = &парамПериодРегистрации
		 |	И (&парамНеОтбиратьСотрудников
		 |			ИЛИ ОсновныеНачисления.Сотрудник В
		 |				(ВЫБРАТЬ
		 |					ВТСписокСотрудников.Сотрудник
		 |				ИЗ
		 |					ВТСписокСотрудников КАК ВТСписокСотрудников))
		 |	И ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете <> ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.НеОбрабатывать)
		 |	И ОсновныеНачисления.Результат <> 0
		 |	И ОсновныеНачисления.ВидРасчета В(&парамСписокНачислений)
		 |	И (НЕ ОсновныеНачисления.Сторно)
		 |;
		 |
		 |////////////////////////////////////////////////////////////////////////////////
		 |ВЫБРАТЬ
		 |	ОсновныеНачисления.Регистратор КАК Регистратор,
		 |	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		 |	ОсновныеНачисления.Сотрудник КАК Сотрудник,
		 |	ОсновныеНачисления.ВидРасчета КАК ВидРасчета,
		 |	МАКСИМУМ(РеглУчетПлановыхНачисленийРаботниковОрганизаций.Период) КАК Период
		 |ПОМЕСТИТЬ ВТ_СведенияОНачислениях
		 |ИЗ
		 |	ВТ_ОсновыеНачисленияДляПлановый КАК ОсновныеНачисления
		 |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РеглУчетПлановыхНачисленийРаботниковОрганизаций КАК РеглУчетПлановыхНачисленийРаботниковОрганизаций
		 |		ПО ОсновныеНачисления.ВидРасчета = РеглУчетПлановыхНачисленийРаботниковОрганизаций.ВидРасчета
		 |			И (РеглУчетПлановыхНачисленийРаботниковОрганизаций.Период <= ОсновныеНачисления.ДатаНачалаСобытия)
		 |			И ОсновныеНачисления.Сотрудник = РеглУчетПлановыхНачисленийРаботниковОрганизаций.Сотрудник
		 |
		 |СГРУППИРОВАТЬ ПО
		 |	ОсновныеНачисления.Регистратор,
		 |	ОсновныеНачисления.НомерСтроки,
		 |	ОсновныеНачисления.Сотрудник,
		 |	ОсновныеНачисления.ВидРасчета
		 |;
		 |
		 |////////////////////////////////////////////////////////////////////////////////
		 |ВЫБРАТЬ
		 |	ВЫБОР
		 |		КОГДА РеглУчетПлановыхНачисленийРаботниковОрганизаций.СпособОтраженияВБухучете = ЗНАЧЕНИЕ(Справочник.СпособыОтраженияЗарплатыВРеглУчете.ПустаяСсылка)
		 |			ТОГДА ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.ПустаяСсылка)
		 |		ИНАЧЕ РеглУчетПлановыхНачисленийРаботниковОрганизаций.ОтнесениеРасходовКДеятельностиЕНВД
		 |	КОНЕЦ КАК ОтнесениеРасходовКДеятельностиЕНВД,
		 |	СведенияОНачисленияхСрез.Регистратор КАК Регистратор,
		 |	СведенияОНачисленияхСрез.НомерСтроки КАК НомерСтроки
		 |ПОМЕСТИТЬ ВТ_УчетПлановыхНачислений
		 |ИЗ
		 |	РегистрСведений.РеглУчетПлановыхНачисленийРаботниковОрганизаций КАК РеглУчетПлановыхНачисленийРаботниковОрганизаций
		 |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_СведенияОНачислениях КАК СведенияОНачисленияхСрез
		 |		ПО (СведенияОНачисленияхСрез.Сотрудник = РеглУчетПлановыхНачисленийРаботниковОрганизаций.Сотрудник)
		 |			И (СведенияОНачисленияхСрез.ВидРасчета = РеглУчетПлановыхНачисленийРаботниковОрганизаций.ВидРасчета)
		 |			И (СведенияОНачисленияхСрез.Период = РеглУчетПлановыхНачисленийРаботниковОрганизаций.Период)
		 |
		 |ИНДЕКСИРОВАТЬ ПО
		 |	Регистратор,
		 |	НомерСтроки";
		Запрос.Текст = УчетПлановыхНачисленийТекст;
		Запрос.Выполнить();
		
						
		// ПОЛУЧИЛИ СПОСОБЫ ОТРАЖЕНИЯ В УЧЕТЕ ПЛАНОВЫХ НАЧИСЛЕНИЙ
		///////////////////////////////////////////////////////////////////////////////////
		
		ОсновныеНачисленияТекст =
		"ВЫБРАТЬ
		|	ОсновныеНачисления.Регистратор КАК Регистратор,
		|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ОсновныеНачисления.Сотрудник КАК Сотрудник,
		|	ОсновныеНачисления.ДатаНачалаСобытия,
		|	ОсновныеНачисления.ПодразделениеОрганизации,
		|	ОсновныеНачисления.ОбособленноеПодразделение
		|ПОМЕСТИТЬ ВТ_ОсновыеНачисления
		|ИЗ
		|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|ГДЕ
		|	ОсновныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|	И ОсновныеНачисления.ПериодРегистрации = &парамПериодРегистрации
		|	И (&парамНеОтбиратьСотрудников
		|			ИЛИ ОсновныеНачисления.Сотрудник В
		|				(ВЫБРАТЬ
		|					ВТСписокСотрудников.Сотрудник
		|				ИЗ
		|					ВТСписокСотрудников КАК ВТСписокСотрудников))
		|	И ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете <> ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.НеОбрабатывать)
		|	И ОсновныеНачисления.ВидРасчета.СтратегияОтраженияВУчете = ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакЗаданоНаНачалоСобытия)
		|	И ОсновныеНачисления.Результат <> 0
		|	И ОсновныеНачисления.ВидРасчета В(&парамСписокНачислений)
		|	И (НЕ ОсновныеНачисления.Сторно)";
		Запрос.Текст = ОсновныеНачисленияТекст;
		Запрос.Выполнить();
		
		///////////////////////////////////////////////////////////////////////////////////
		// ПОЛУЧЕНИЕ СПОСОБОВ ОТРАЖЕНИЯ В УЧЕТЕ ОСНОВНОГО ЗАРАБОТКА РАБОТНИКОВ
		// таблица ВТ_УчетОсновногоЗаработка

		УчетОсновногоЗаработкаТекст = 
		"ВЫБРАТЬ
		|	ОсновныеНачисления.Регистратор КАК Регистратор,
		|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ОсновныеНачисления.Сотрудник КАК Сотрудник,
		|	МАКСИМУМ(УчетЗарВРеглУчете.Период) КАК Период
		|ПОМЕСТИТЬ ВТ_СведенияОРаботниках
		|ИЗ
		|	ВТ_ОсновыеНачисления КАК ОсновныеНачисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаРаботниковОрганизацииВРегламентированномУчете КАК УчетЗарВРеглУчете
		|		ПО ОсновныеНачисления.Сотрудник = УчетЗарВРеглУчете.Сотрудник
		|			И (УчетЗарВРеглУчете.Период <= ОсновныеНачисления.ДатаНачалаСобытия)
		|
		|СГРУППИРОВАТЬ ПО
		|	ОсновныеНачисления.Регистратор,
		|	ОсновныеНачисления.НомерСтроки,
		|	ОсновныеНачисления.Сотрудник
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Сотрудник,
		|	Период
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА УчетЗарВРеглУчете.СпособОтраженияВБухучете = ЗНАЧЕНИЕ(Справочник.СпособыОтраженияЗарплатыВРеглУчете.ПустаяСсылка)
		|			ТОГДА ЛОЖЬ
		|		ИНАЧЕ УчетЗарВРеглУчете.ПодпадаетПодЕНВД
		|	КОНЕЦ КАК ПодпадаетПодЕНВД,
		|	СведенияОРаботникахСрез.Регистратор КАК Регистратор,
		|	СведенияОРаботникахСрез.НомерСтроки КАК НомерСтроки
		|ПОМЕСТИТЬ ВТ_УчетОсновногоЗаработка
		|ИЗ
		|	РегистрСведений.УчетОсновногоЗаработкаРаботниковОрганизацииВРегламентированномУчете КАК УчетЗарВРеглУчете
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_СведенияОРаботниках КАК СведенияОРаботникахСрез
		|		ПО (СведенияОРаботникахСрез.Сотрудник = УчетЗарВРеглУчете.Сотрудник)
		|			И (СведенияОРаботникахСрез.Период = УчетЗарВРеглУчете.Период)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	НомерСтроки";
		Запрос.Текст = УчетОсновногоЗаработкаТекст;
		Запрос.Выполнить();
		
		// ПОЛУЧИЛИ СПОСОБЫ ОТРАЖЕНИЯ В УЧЕТЕ ОСНОВНОГО ЗАРАБОТКА РАБОТНИКОВ
		///////////////////////////////////////////////////////////////////////////////////
		
		
		///////////////////////////////////////////////////////////////////////////////////
		// ПОЛУЧЕНИЕ СПОСОБОВ ОТРАЖЕНИЯ В УЧЕТЕ ОСНОВНОГО ЗАРАБОТКА ПОДРАЗДЕЛЕНИЯ
		// таблица ВТ_УчетОсновногоЗаработкаПодразделения
		
		УчетОсновногоЗаработкаПодразделенияТекст =
		"ВЫБРАТЬ
		|	ОсновныеНачисления.Регистратор КАК Регистратор,
		|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ОсновныеНачисления.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
		|	МАКСИМУМ(УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.Период) КАК Период
		|ПОМЕСТИТЬ ВТ_СведенияОПодразделениях
		|ИЗ
		|	ВТ_ОсновыеНачисления КАК ОсновныеНачисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации КАК УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации
		|		ПО ОсновныеНачисления.ПодразделениеОрганизации = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.ПодразделениеОрганизации
		|			И (УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.Период <= ОсновныеНачисления.ДатаНачалаСобытия)
		|
		|СГРУППИРОВАТЬ ПО
		|	ОсновныеНачисления.ПодразделениеОрганизации,
		|	ОсновныеНачисления.Регистратор,
		|	ОсновныеНачисления.НомерСтроки
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ПодразделениеОрганизации,
		|	Период
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СведенияОПодразделенияхСрез.Регистратор КАК Регистратор,
		|	СведенияОПодразделенияхСрез.НомерСтроки КАК НомерСтроки,
		|	ВЫБОР
		|		КОГДА УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.СпособОтраженияВБухучете = ЗНАЧЕНИЕ(Справочник.СпособыОтраженияЗарплатыВРеглУчете.ПустаяСсылка)
		|			ТОГДА ЛОЖЬ
		|		ИНАЧЕ УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.ПодпадаетПодЕНВД
		|	КОНЕЦ КАК ПодпадаетПодЕНВД
		|ПОМЕСТИТЬ ВТ_УчетОсновногоЗаработкаПодразделения
		|ИЗ
		|	ВТ_СведенияОПодразделениях КАК СведенияОПодразделенияхСрез
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации КАК УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации
		|		ПО СведенияОПодразделенияхСрез.ПодразделениеОрганизации = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.ПодразделениеОрганизации
		|			И СведенияОПодразделенияхСрез.Период = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.Период
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	НомерСтроки";		
		Запрос.Текст = УчетОсновногоЗаработкаПодразделенияТекст;
		Запрос.Выполнить();
		
		// ПОЛУЧИЛИ СПОСОБЫ ОТРАЖЕНИЯ В УЧЕТЕ ОСНОВНОГО ЗАРАБОТКА ПОДРАЗДЕЛЕНИЯ
		///////////////////////////////////////////////////////////////////////////////////
		
		///////////////////////////////////////////////////////////////////////////////////
		// ПОЛУЧЕНИЕ СПОСОБОВ ОТРАЖЕНИЯ В УЧЕТЕ ОСНОВНОГО ЗАРАБОТКА ОРГАНИЗАЦИИ
		// таблица ВТ_УчетОсновногоЗаработкаОрганизации
		
		УчетОсновногоЗаработкаОрганизацииТекст =
		"ВЫБРАТЬ
		|	ОсновныеНачисления.Регистратор КАК Регистратор,
		|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ОсновныеНачисления.ОбособленноеПодразделение КАК ОбособленноеПодразделение,
		|	МАКСИМУМ(УчетОсновногоЗаработкаОрганизации.Период) КАК Период
		|ПОМЕСТИТЬ ВТ_СведенияПоОрганизации
		|ИЗ
		|	ВТ_ОсновыеНачисления КАК ОсновныеНачисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаОрганизации КАК УчетОсновногоЗаработкаОрганизации
		|		ПО ОсновныеНачисления.ОбособленноеПодразделение = УчетОсновногоЗаработкаОрганизации.Организация
		|			И (УчетОсновногоЗаработкаОрганизации.Период <= ОсновныеНачисления.ДатаНачалаСобытия)
		|
		|СГРУППИРОВАТЬ ПО
		|	ОсновныеНачисления.ОбособленноеПодразделение,
		|	ОсновныеНачисления.Регистратор,
		|	ОсновныеНачисления.НомерСтроки
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ОбособленноеПодразделение,
		|	Период
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СведенияПоОрганизации.Регистратор КАК Регистратор,
		|	СведенияПоОрганизации.НомерСтроки КАК НомерСтроки,
		|	ВЫБОР
		|		КОГДА УчетОсновногоЗаработкаОрганизации.СпособОтраженияВБухучете = ЗНАЧЕНИЕ(Справочник.СпособыОтраженияЗарплатыВРеглУчете.ПустаяСсылка)
		|			ТОГДА ЛОЖЬ
		|		ИНАЧЕ УчетОсновногоЗаработкаОрганизации.ПодпадаетПодЕНВД
		|	КОНЕЦ КАК ПодпадаетПодЕНВД
		|ПОМЕСТИТЬ ВТ_УчетОсновногоЗаработкаОрганизации
		|ИЗ
		|	ВТ_СведенияПоОрганизации КАК СведенияПоОрганизации
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаОрганизации КАК УчетОсновногоЗаработкаОрганизации
		|		ПО СведенияПоОрганизации.ОбособленноеПодразделение = УчетОсновногоЗаработкаОрганизации.Организация
		|			И СведенияПоОрганизации.Период = УчетОсновногоЗаработкаОрганизации.Период
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	НомерСтроки";		
		Запрос.Текст = УчетОсновногоЗаработкаОрганизацииТекст;
		Запрос.Выполнить();
		
		// ПОЛУЧИЛИ СПОСОБЫ ОТРАЖЕНИЯ В УЧЕТЕ ОСНОВНОГО ЗАРАБОТКА ОРГАНИЗАЦИИ
		///////////////////////////////////////////////////////////////////////////////////

		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	ОсновныеНачисления.Регистратор КАК Регистратор,
		|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ОсновныеНачисления.Сотрудник КАК Сотрудник,
		|	ОсновныеНачисления.ФизЛицо КАК ФизЛицо,
		|	ВЫБОР
		|		КОГДА ОсновныеНачисления.Сторно
		|			ТОГДА ОтражениеВУчетеСторно.КодДоходаЕСН
		|		ИНАЧЕ ОсновныеНачисления.ВидРасчета.КодДоходаСтраховыеВзносы
		|	КОНЕЦ КАК КодДоходаЕСН,
		|	ОтражениеВУчетеСторно.ОблагаетсяЕНВД КАК ОблагаетсяЕНВД,
		|	ОтражениеВУчетеСторно.Результат КАК РезультатСторно,
		|	ОтражениеВУчетеСторно.ПериодДействияНачало КАК ПериодДействияНачалоСторно,
		|	ОтражениеВУчетеСторно.ПериодДействияКонец КАК ПериодДействияКонецСторно,
		|	ВЫБОР
		|		КОГДА (НЕ &ЕстьЕНВД)
		|			ТОГДА 0
		|		КОГДА РеглУчетПлановыхНачисленийРаботниковОрганизаций.ОтнесениеРасходовКДеятельностиЕНВД = ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.РасходыОтносятсяКЕНВД)
		|			ТОГДА 100
		|		КОГДА РеглУчетПлановыхНачисленийРаботниковОрганизаций.ОтнесениеРасходовКДеятельностиЕНВД = ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.РасходыОтносятсяКнеЕНВД)
		|			ТОГДА 0
		|		КОГДА ОсновныеНачисления.ВидРасчета.ОтнесениеРасходовКДеятельностиЕНВД = ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.РасходыОтносятсяКЕНВД)
		|				И ОсновныеНачисления.ВидРасчета.СпособОтраженияВБухучете.СчетДт <> ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяССылка)
		|				И ОсновныеНачисления.ВидРасчета.СпособОтраженияВБухучете.СчетКт <> ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяССылка)
		|			ТОГДА 100
		|		КОГДА ОсновныеНачисления.ВидРасчета.ОтнесениеРасходовКДеятельностиЕНВД = ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.РасходыОтносятсяКнеЕНВД)
		|				И ОсновныеНачисления.ВидРасчета.СпособОтраженияВБухучете.СчетДт <> ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяССылка)
		|				И ОсновныеНачисления.ВидРасчета.СпособОтраженияВБухучете.СчетКт <> ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяССылка)
		|			ТОГДА 0
		|		КОГДА Распределение.ПодпадаетПодЕНВД ЕСТЬ НЕ NULL 
		|			ТОГДА ВЫБОР
		|					КОГДА Распределение.ПодпадаетПодЕНВД
		|						ТОГДА 100
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		КОГДА ЕНВДПроцент.ПодпадаетПодЕНВД ЕСТЬ НЕ NULL 
		|			ТОГДА ЕНВДПроцент.ПодпадаетПодЕНВД
		|		КОГДА УчетЗарВРеглУчете.ПодпадаетПодЕНВД
		|			ТОГДА 100
		|		КОГДА УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.ПодпадаетПодЕНВД
		|			ТОГДА 100
		|		КОГДА УчетОсновногоЗаработкаОрганизации.ПодпадаетПодЕНВД
		|			ТОГДА 100
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК ПроцентЕНВД,
		|	Распределение.ДоляСпособаОтражения КАК ДоляСпособаОтражения,
		|	ОсновныеНачисления.ВидРасчета КАК ВидРасчета,
		|	ОсновныеНачисления.Организация КАК Организация,
		|	ОсновныеНачисления.Результат КАК Результат,
		|	ОсновныеНачисления.ДополнительныйРезультат,
		|	ОсновныеНачисления.ПериодДействия КАК ПериодДействия,
		|	ОсновныеНачисления.ПериодДействияНачало КАК ПериодДействияНачало,
		|	ОсновныеНачисления.ПериодДействияКонец КАК ПериодДействияКонец,
		|	ОсновныеНачисления.ГрафикРаботы КАК ГрафикРаботы,
		|	ОсновныеНачисления.ВидУчетаВремени КАК ВидУчетаВремени,
		|	ОсновныеНачисления.Сторно КАК Сторно,
		|	ВЫБОР
		|		КОГДА ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводствеНовыйСтраховойСлучай))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве)
		|		КОГДА ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенкомНовыйСтраховойСлучай))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком)
		|		КОГДА ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболеваниеНовыйСтраховойСлучай))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание)
		|		КОГДА ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочийНовыйСтраховойСлучай))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий)
		|		ИНАЧЕ ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете
		|	КОНЕЦ КАК ВариантОбработкиЗаписиПриОтраженииВРеглУчете,
		|	ОсновныеНачисления.ВидРасчета.СтратегияОтраженияВУчете КАК СтратегияОтраженияВУчете,
		|	ОсновныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования КАК ВидПособияСоциальногоСтрахования,
		|	ОсновныеНачисления.Показатель1 КАК СреднийДневнойЗаработок,
		|	ОсновныеНачисления.НормаДней КАК НормаДней,
		|	ВЫБОР
		|		КОГДА ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводствеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенкомНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболеваниеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочийНовыйСтраховойСлучай))
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК УчитыватьКакНовыйСтраховойСлучай,
		|	ОсновныеНачисления.ДатаНачалаСобытия КАК ДатаНачалаСобытия,
		|	ОсновныеНачисления.Сотрудник.Наименование КАК СотрудникНаименование
		|ПОМЕСТИТЬ ДанныеУчета
		|ИЗ
		|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_УчетПлановыхНачислений КАК РеглУчетПлановыхНачисленийРаботниковОрганизаций
		|		ПО ОсновныеНачисления.Регистратор = РеглУчетПлановыхНачисленийРаботниковОрганизаций.Регистратор
		|			И ОсновныеНачисления.НомерСтроки = РеглУчетПлановыхНачисленийРаботниковОрганизаций.НомерСтроки
		|			И ((НЕ ОсновныеНачисления.Сторно))
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_УчетОсновногоЗаработка КАК УчетЗарВРеглУчете
		|		ПО ОсновныеНачисления.Регистратор = УчетЗарВРеглУчете.Регистратор
		|			И ОсновныеНачисления.НомерСтроки = УчетЗарВРеглУчете.НомерСтроки
		|			И ((НЕ ОсновныеНачисления.Сторно))
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаспределениеОсновногоЗаработкаРаботниковОрганизаций КАК Распределение
		|		ПО ОсновныеНачисления.Сотрудник = Распределение.Сотрудник
		|			И (РеглУчетПлановыхНачисленийРаботниковОрганизаций.ОтнесениеРасходовКДеятельностиЕНВД ЕСТЬ NULL )
		|			И (ОсновныеНачисления.ВидРасчета.СтратегияОтраженияВУчете = ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакЗаданоНаНачалоСобытия))
		|			И ((НЕ ОсновныеНачисления.Сторно))
		|			И (НАЧАЛОПЕРИОДА(ОсновныеНачисления.ДатаНачалаСобытия, МЕСЯЦ) = Распределение.ПериодРегистрации)
		|			И (Распределение.ДоляСпособаОтражения <> 0)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_УчетОсновногоЗаработкаПодразделения КАК УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации
		|		ПО ОсновныеНачисления.Регистратор = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.Регистратор
		|			И ОсновныеНачисления.НомерСтроки = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.НомерСтроки
		|			И ((НЕ ОсновныеНачисления.Сторно))
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПроцентДеятельностиЕНВДСотрудников КАК ЕНВДПроцент
		|		ПО ОсновныеНачисления.Сотрудник = ЕНВДПроцент.Сотрудник
		|			И ((НЕ ОсновныеНачисления.Сторно))
		|			И (ВЫБОР
		|				КОГДА ОсновныеНачисления.ВидРасчета.СтратегияОтраженияВУчете = ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакЗаданоНаНачалоСобытия)
		|					ТОГДА ВЫБОР
		|							КОГДА НАЧАЛОПЕРИОДА(ОсновныеНачисления.ДатаНачалаСобытия, МЕСЯЦ) > ОсновныеНачисления.ПериодРегистрации
		|								ТОГДА ОсновныеНачисления.ПериодРегистрации
		|							ИНАЧЕ НАЧАЛОПЕРИОДА(ОсновныеНачисления.ДатаНачалаСобытия, МЕСЯЦ)
		|						КОНЕЦ
		|				КОГДА ОсновныеНачисления.ПериодДействия > ОсновныеНачисления.ПериодРегистрации
		|					ТОГДА ОсновныеНачисления.ПериодРегистрации
		|				ИНАЧЕ ОсновныеНачисления.ПериодДействия
		|			КОНЕЦ = ЕНВДПроцент.ПериодРегистрации)
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрРасчета.ЕСНОсновныеНачисления КАК ЕСНОсновныеНачисления
		|		ПО ОсновныеНачисления.Сотрудник = ЕСНОсновныеНачисления.Сотрудник
		|			И (ЕСНОсновныеНачисления.ВидРасчета = ОсновныеНачисления.ВидРасчета)
		|			И (ЕСНОсновныеНачисления.ПериодРегистрации = &парамПериодРегистрации)
		|			И (ЕСНОсновныеНачисления.ПериодДействияНачало >= ОсновныеНачисления.ПериодДействияНачало)
		|			И (ЕСНОсновныеНачисления.ПериодДействияКонец <= ОсновныеНачисления.ПериодДействияКонец)
		|			И (ЕСНОсновныеНачисления.ДокументОснование = ОсновныеНачисления.Регистратор)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ОтражениеВУчетеСторно КАК ОтражениеВУчетеСторно
		|		ПО ОсновныеНачисления.Регистратор = ОтражениеВУчетеСторно.Регистратор
		|			И ОсновныеНачисления.НомерСтроки = ОтражениеВУчетеСторно.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_УчетОсновногоЗаработкаОрганизации КАК УчетОсновногоЗаработкаОрганизации
		|		ПО ОсновныеНачисления.Регистратор = УчетОсновногоЗаработкаОрганизации.Регистратор
		|			И ОсновныеНачисления.НомерСтроки = УчетОсновногоЗаработкаОрганизации.НомерСтроки
		|			И ((НЕ ОсновныеНачисления.Сторно))
		|ГДЕ
		|	ЕСНОсновныеНачисления.Сотрудник ЕСТЬ NULL 
		|	И ОсновныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|	И ОсновныеНачисления.ВидРасчета В(&парамСписокНачислений)
		|	И ОсновныеНачисления.Результат <> 0
		|	И (&парамНеОтбиратьСотрудников
		|			ИЛИ ОсновныеНачисления.Сотрудник В
		|				(ВЫБРАТЬ
		|					ВТСписокСотрудников.Сотрудник
		|				ИЗ
		|					ВТСписокСотрудников КАК ВТСписокСотрудников))
		|	И ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете <> ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.НеОбрабатывать)
		|	И ОсновныеНачисления.ПериодРегистрации = &парамПериодРегистрации
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	НомерСтроки
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ФизическиеЛица.Ссылка КАК Физлицо,
		|	ВЫБОР
		|		КОГДА ФизическиеЛица.ЛьготаПриНачисленииПособий = ЗНАЧЕНИЕ(Перечисление.ВидыЛьготПриНачисленииБольничных.Маяк)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВыплатыПособийЗаСчетФедеральногоБюджета.Маяк)
		|		КОГДА ФизическиеЛица.ЛьготаПриНачисленииПособий = ЗНАЧЕНИЕ(Перечисление.ВидыЛьготПриНачисленииБольничных.ПодразделенияОсобогоРиска)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВыплатыПособийЗаСчетФедеральногоБюджета.ПодразделенияОсобогоРиска)
		|		КОГДА ФизическиеЛица.ЛьготаПриНачисленииПособий = ЗНАЧЕНИЕ(Перечисление.ВидыЛьготПриНачисленииБольничных.Семипалатинск)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВыплатыПособийЗаСчетФедеральногоБюджета.Семипалатинск)
		|		КОГДА ФизическиеЛица.ЛьготаПриНачисленииПособий = ЗНАЧЕНИЕ(Перечисление.ВидыЛьготПриНачисленииБольничных.Чернобыль)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВыплатыПособийЗаСчетФедеральногоБюджета.Чернобыль)
		|		КОГДА ФизическиеЛицаСтажи.НомерСтроки ЕСТЬ НЕ NULL 
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВыплатыПособийЗаСчетФедеральногоБюджета.ЗачетНестраховыхПериодов)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВыплатыПособийЗаСчетФедеральногоБюджета.ПустаяСсылка)
		|	КОНЕЦ КАК ВыплатаЗаСчетФедеральногоБюджета
		|ПОМЕСТИТЬ ВТЛьготыФизлиц
		|ИЗ
		|	Справочник.ФизическиеЛица КАК ФизическиеЛица
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ФизическиеЛица.Стажи КАК ФизическиеЛицаСтажи
		|		ПО ФизическиеЛица.Ссылка = ФизическиеЛицаСтажи.Ссылка
		|			И (ФизическиеЛицаСтажи.ВидСтажа = ЗНАЧЕНИЕ(Справочник.ВидыСтажа.РасширенныйСтраховойСтажДляБЛ))
		|ГДЕ
		|	ФизическиеЛица.Ссылка В
		|			(ВЫБРАТЬ
		|				ДанныеУчета.ФизЛицо
		|			ИЗ
		|				ДанныеУчета КАК ДанныеУчета)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Физлицо
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ОсновныеНачисления.Регистратор КАК Регистратор,
		|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ОсновныеНачисления.ПериодДействия,
		|	ОсновныеНачисления.ПериодДействияНачало,
		|	ОсновныеНачисления.ПериодДействияКонец,
		|	ОсновныеНачисления.Показатель1,
		|	ОсновныеНачисления.Показатель2,
		|	ОсновныеНачисления.Показатель3,
		|	ОсновныеНачисления.Сторно,
		|	ОсновныеНачисления.Результат,
		|	ВЫБОР
		|		КОГДА ОсновныеНачисления.ПодразделениеОрганизации.КодПоОКАТО <> """"
		|			ТОГДА ВЫБОР
		|					КОГДА ОсновныеНачисления.ПодразделениеОрганизации.РайонныйКоэффициентРФ > 1
		|						ТОГДА ОсновныеНачисления.ПодразделениеОрганизации.РайонныйКоэффициентРФ
		|					ИНАЧЕ 1
		|				КОНЕЦ
		|		КОГДА ОсновныеНачисления.ОбособленноеПодразделение.РайонныйКоэффициентРФ > 1
		|			ТОГДА ОсновныеНачисления.ОбособленноеПодразделение.РайонныйКоэффициентРФ
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК РайонныйКоэффициентРФ,
		|	ОсновныеНачисления.ПодразделениеОрганизации.КодПоОКАТО КАК КодПоОКАТОПодразделения,
		|	ВЫРАЗИТЬ(ОсновныеНачисления.Показатель1 * 0.4 * 30.4 КАК ЧИСЛО(15, 2)) КАК МесячноеПособие
		|ПОМЕСТИТЬ ВТЗаписиПособийПоУходу
		|ИЗ
		|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|ГДЕ
		|	ОсновныеНачисления.ПериодРегистрации = &парамПериодРегистрации
		|	И ОсновныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|	И ОсновныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования = ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПоУходуЗаРебенкомДоПолутораЛет)
		|	И (&парамНеОтбиратьСотрудников
		|			ИЛИ ОсновныеНачисления.Сотрудник В
		|				(ВЫБРАТЬ
		|					ВТСписокСотрудников.Сотрудник
		|				ИЗ
		|					ВТСписокСотрудников КАК ВТСписокСотрудников))
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	НомерСтроки
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ОсновныеНачисления.Регистратор КАК Регистратор,
		|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ВЫБОР
		|		КОГДА ОсновныеНачисления.Результат = 0
		|			ТОГДА 0
		|		КОГДА ОсновныеНачисления.Показатель2 = 0
		|			ТОГДА 0
		|		КОГДА ОсновныеНачисления.Показатель3 = 0
		|			ТОГДА 0
		|		КОГДА ОсновныеНачисления.Показатель2 = ОсновныеНачисления.Показатель3
		|			ТОГДА 1
		|		ИНАЧЕ ВЫБОР
		|				КОГДА ОсновныеНачисления.МесячноеПособие > (ВЫРАЗИТЬ(МаксимумПособияПоУходуЗаРебенкомДоПолутораЛет.Размер * 0.4 / 12 КАК ЧИСЛО(15, 2)))
		|					ТОГДА ВЫРАЗИТЬ(МаксимумПособияПоУходуЗаРебенкомДоПолутораЛет.Размер * 0.4 / 12 КАК ЧИСЛО(15, 2))
		|				КОГДА ОсновныеНачисления.МесячноеПособие < (ВЫРАЗИТЬ(МинимумПособияПоУходуЗаПервымРебенкомДоПолутораЛет.Размер * ОсновныеНачисления.РайонныйКоэффициентРФ КАК ЧИСЛО(15, 2)))
		|					ТОГДА ВЫРАЗИТЬ(МинимумПособияПоУходуЗаПервымРебенкомДоПолутораЛет.Размер * ОсновныеНачисления.РайонныйКоэффициентРФ КАК ЧИСЛО(15, 2))
		|				ИНАЧЕ ОсновныеНачисления.МесячноеПособие
		|			КОНЕЦ * ВЫБОР
		|				КОГДА ОсновныеНачисления.ПериодДействияНачало = ОсновныеНачисления.ПериодДействия
		|						И ОсновныеНачисления.ПериодДействияКонец = КОНЕЦПЕРИОДА(ОсновныеНачисления.ПериодДействия, МЕСЯЦ)
		|					ТОГДА 1
		|				ИНАЧЕ РАЗНОСТЬДАТ(ОсновныеНачисления.ПериодДействияНачало, ДОБАВИТЬКДАТЕ(ОсновныеНачисления.ПериодДействияКонец, СЕКУНДА, 1), ДЕНЬ) / РАЗНОСТЬДАТ(ОсновныеНачисления.ПериодДействия, ДОБАВИТЬКДАТЕ(КОНЕЦПЕРИОДА(ОсновныеНачисления.ПериодДействия, МЕСЯЦ), СЕКУНДА, 1), ДЕНЬ)
		|			КОНЕЦ * ВЫБОР
		|				КОГДА ОсновныеНачисления.Сторно
		|					ТОГДА -1
		|				ИНАЧЕ 1
		|			КОНЕЦ / ОсновныеНачисления.Результат
		|	КОНЕЦ КАК ДоляПособияНаПервогоРебенка
		|ПОМЕСТИТЬ РасчетПособийПоУходуЗаПервымРебенком
		|ИЗ
		|	ВТЗаписиПособийПоУходу КАК ОсновныеНачисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			ЗаписиПособийПоУходу.Регистратор КАК Регистратор,
		|			ЗаписиПособийПоУходу.НомерСтроки КАК НомерСтроки,
		|			ГосударственныеПособия.ВидПособия КАК ВидПособия,
		|			МАКСИМУМ(ГосударственныеПособия.Период) КАК ДатаИзмененияРазмераПособия
		|		ИЗ
		|			ВТЗаписиПособийПоУходу КАК ЗаписиПособийПоУходу
		|				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ГосударственныеПособия КАК ГосударственныеПособия
		|				ПО ЗаписиПособийПоУходу.ПериодДействия >= ГосударственныеПособия.Период
		|		ГДЕ
		|			ГосударственныеПособия.ВидПособия = ЗНАЧЕНИЕ(Перечисление.РазмерыГосударственныхПособий.МинимумПособияПоУходуЗаПервымРебенкомДоПолутораЛет)
		|		
		|		СГРУППИРОВАТЬ ПО
		|			ЗаписиПособийПоУходу.Регистратор,
		|			ЗаписиПособийПоУходу.НомерСтроки,
		|			ГосударственныеПособия.ВидПособия) КАК ДатыИзРегистраМинимум
		|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ГосударственныеПособия КАК МинимумПособияПоУходуЗаПервымРебенкомДоПолутораЛет
		|			ПО ДатыИзРегистраМинимум.ВидПособия = МинимумПособияПоУходуЗаПервымРебенкомДоПолутораЛет.ВидПособия
		|				И ДатыИзРегистраМинимум.ДатаИзмененияРазмераПособия = МинимумПособияПоУходуЗаПервымРебенкомДоПолутораЛет.Период
		|		ПО ОсновныеНачисления.Регистратор = ДатыИзРегистраМинимум.Регистратор
		|			И ОсновныеНачисления.НомерСтроки = ДатыИзРегистраМинимум.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			ЗаписиПособийПоУходу.Регистратор КАК Регистратор,
		|			ЗаписиПособийПоУходу.НомерСтроки КАК НомерСтроки,
		|			МАКСИМУМ(ГосударственныеПособия.Период) КАК ДатаИзмененияРазмераПособия
		|		ИЗ
		|			ВТЗаписиПособийПоУходу КАК ЗаписиПособийПоУходу
		|				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПредельнаяВеличинаБазыСтраховыхВзносов КАК ГосударственныеПособия
		|				ПО ЗаписиПособийПоУходу.ПериодДействия >= ГосударственныеПособия.Период
		|		
		|		СГРУППИРОВАТЬ ПО
		|			ЗаписиПособийПоУходу.Регистратор,
		|			ЗаписиПособийПоУходу.НомерСтроки) КАК ДатыИзРегистраМаксимум
		|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПредельнаяВеличинаБазыСтраховыхВзносов КАК МаксимумПособияПоУходуЗаРебенкомДоПолутораЛет
		|			ПО ДатыИзРегистраМаксимум.ДатаИзмененияРазмераПособия = МаксимумПособияПоУходуЗаРебенкомДоПолутораЛет.Период
		|		ПО ОсновныеНачисления.Регистратор = ДатыИзРегистраМаксимум.Регистратор
		|			И ОсновныеНачисления.НомерСтроки = ДатыИзРегистраМаксимум.НомерСтроки
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	НомерСтроки
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДанныеУчета.Регистратор КАК Регистратор,
		|	ДанныеУчета.Регистратор КАК ДокументОснование,
		|	ДанныеУчета.НомерСтроки КАК НомерСтроки,
		|	ДанныеУчета.Сотрудник,
		|	ДанныеУчета.СотрудникНаименование КАК СотрудникНаименование,
		|	ДанныеУчета.ФизЛицо КАК Физлицо,
		|	ДанныеУчета.КодДоходаЕСН,
		|	ДанныеУчета.ОблагаетсяЕНВД КАК ОблагаетсяЕНВД,
		|	ДанныеУчета.РезультатСторно КАК РезультатСторно,
		|	ДанныеУчета.ПроцентЕНВД,
		|	ДанныеУчета.ВидРасчета,
		|	ДанныеУчета.Результат КАК Результат,
		|	ДанныеУчета.ДополнительныйРезультат,
		|	ДанныеУчета.ПериодДействияНачало,
		|	ДанныеУчета.ПериодДействияКонец,
		|	ДанныеУчета.ГрафикРаботы,
		|	ДанныеУчета.Сторно,
		|	ДанныеУчета.ВариантОбработкиЗаписиПриОтраженииВРеглУчете,
		|	ДанныеУчета.СтратегияОтраженияВУчете,
		|	ДанныеУчета.ВидУчетаВремени,
		|	СоответствиеКодов.ВидПоСтраховымВзносам КАК КодДоходаЕСНРазрез,
		|	ЕСТЬNULL(База.ОблагаетсяЕНВДРазрез, БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез) КАК ОблагаетсяЕНВДРазрез,
		|	ВЫБОР
		|		КОГДА ДанныеУчета.ДоляСпособаОтражения ЕСТЬ НЕ NULL 
		|			ТОГДА ДанныеУчета.ДоляСпособаОтражения
		|		КОГДА База.РезультатБаза ЕСТЬ НЕ NULL 
		|			ТОГДА База.РезультатБаза
		|		ИНАЧЕ БазаСреднегоЗаработка.РезультатБаза
		|	КОНЕЦ КАК РезультатБаза,
		|	ЕСТЬNULL(ДанныеУчетаБЛ.ДоляБЛЗаСчетРаботодателя, 0) КАК ДоляБЛЗаСчетРаботодателя,
		|	ЕСТЬNULL(ДанныеУчетаБЛ.ДниЗаСчетРаботодателя, 0) КАК ДниЗаСчетРаботодателя,
		|	ЕСТЬNULL(ДанныеУчетаБЛ.ВсегоДнейНетрудоспособности, 0) КАК ВсегоДнейНетрудоспособности,
		|	ДанныеУчета.НормаДней,
		|	ДанныеУчета.ВидПособияСоциальногоСтрахования,
		|	ЕСТЬNULL(ДанныеУчета.СреднийДневнойЗаработок, 0) КАК СреднийДневнойЗаработок,
		|	ЕСТЬNULL(РасчетПособийПоУходуЗаПервымРебенком.ДоляПособияНаПервогоРебенка, 0) КАК ДоляПособияНаПервогоРебенка,
		|	ДанныеУчета.ДоляСпособаОтражения,
		|	ДанныеУчета.ДатаНачалаСобытия,
		|	ДанныеУчета.УчитыватьКакНовыйСтраховойСлучай,
		|	0 КАК Скидка,
		|	ДанныеУчета.ПериодДействияНачалоСторно КАК ПериодДействияНачалоСторно,
		|	ДанныеУчета.ПериодДействияКонецСторно КАК ПериодДействияКонецСторно,
		|	ЛОЖЬ КАК ЭтоЕдиновременноеПособиеФСС,
		|	ВЫБОР
		|		КОГДА ДанныеУчета.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий))
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ЭтоПособияФСС,
		|	ВЫБОР
		|		КОГДА ДанныеУчета.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий))
		|				И ДанныеУчета.ДополнительныйРезультат <> 0
		|			ТОГДА ЛьготыФизлиц.ВыплатаЗаСчетФедеральногоБюджета
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ КАК ВыплатаЗаСчетФедеральногоБюджета
		|ИЗ
		|	ДанныеУчета КАК ДанныеУчета
		|		ЛЕВОЕ СОЕДИНЕНИЕ База КАК База
		|		ПО ДанныеУчета.Регистратор = База.Регистратор
		|			И ДанныеУчета.НомерСтроки = База.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_БазаСреднегоЗаработка КАК БазаСреднегоЗаработка
		|		ПО ДанныеУчета.Регистратор = БазаСреднегоЗаработка.Регистратор
		|			И ДанныеУчета.НомерСтроки = БазаСреднегоЗаработка.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКодовЕСНиСтраховыхВзносов КАК СоответствиеКодов
		|		ПО (ЕСТЬNULL(База.КодДоходаЕСНРазрез, БазаСреднегоЗаработка.КодДоходаЕСНРазрез) = СоответствиеКодов.КодДоходаЕСН)
		|		ЛЕВОЕ СОЕДИНЕНИЕ РасчетПособийПоУходуЗаПервымРебенком КАК РасчетПособийПоУходуЗаПервымРебенком
		|		ПО ДанныеУчета.Регистратор = РасчетПособийПоУходуЗаПервымРебенком.Регистратор
		|			И ДанныеУчета.НомерСтроки = РасчетПособийПоУходуЗаПервымРебенком.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			ОсновныеНачисления.Регистратор КАК Регистратор,
		|			ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|			ЕСТЬNULL(ВЫБОР
		|					КОГДА РАЗНОСТЬДАТ(ОсновныеНачисления.ДатаНачалаСобытия, ОсновныеНачисления.ПериодДействияНачало, ДЕНЬ) >= 2
		|						ТОГДА 0
		|					ИНАЧЕ ФактическийПериодДействияЗаписей.ДнейЗаСчетРаботодателя / ФактическийПериодДействияЗаписей.КалендарныхДней
		|				КОНЕЦ, 0) КАК ДоляБЛЗаСчетРаботодателя,
		|			ЕСТЬNULL(ВЫБОР
		|					КОГДА РАЗНОСТЬДАТ(ОсновныеНачисления.ДатаНачалаСобытия, ОсновныеНачисления.ПериодДействияНачало, ДЕНЬ) >= 2
		|						ТОГДА 0
		|					ИНАЧЕ ФактическийПериодДействияЗаписей.ДнейЗаСчетРаботодателя
		|				КОНЕЦ, 0) КАК ДниЗаСчетРаботодателя,
		|			ЕСТЬNULL(ФактическийПериодДействияЗаписей.КалендарныхДней, 0) КАК ВсегоДнейНетрудоспособности
		|		ИЗ
		|			(ВЫБРАТЬ
		|				ОсновныеНачисления.Регистратор КАК Регистратор,
		|				ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|				ОсновныеНачисления.ПериодДействия КАК ПериодДействия,
		|				ОсновныеНачисления.ПериодДействияНачало КАК ПериодДействияНачало,
		|				ОсновныеНачисления.ПериодДействияКонец КАК ПериодДействияКонец,
		|				ОсновныеНачисления.ГрафикРаботы КАК ГрафикРаботы,
		|				ОсновныеНачисления.ВидУчетаВремени КАК ВидУчетаВремени,
		|				ОсновныеНачисления.НормаДней КАК НормаДней,
		|				ОсновныеНачисления.ДатаНачалаСобытия КАК ДатаНачалаСобытия,
		|				ОсновныеНачисления.НормаЧасов КАК НормаЧасов
		|			ИЗ
		|				РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|			ГДЕ
		|				ОсновныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|				И ОсновныеНачисления.ПериодРегистрации = &парамПериодРегистрации
		|				И ОсновныеНачисления.ВидРасчета В(&парамСписокНачислений)
		|				И ОсновныеНачисления.Результат <> 0
		|				И ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете <> ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.НеОбрабатывать)
		|				И ОсновныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования <> ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка)
		|				И (&парамНеОтбиратьСотрудников
		|						ИЛИ ОсновныеНачисления.Сотрудник В
		|							(ВЫБРАТЬ
		|								ВТСписокСотрудников.Сотрудник
		|							ИЗ
		|								ВТСписокСотрудников КАК ВТСписокСотрудников))) КАК ОсновныеНачисления
		|				ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|					ФактическийПериодДействияЗаписей.Регистратор КАК Регистратор,
		|					ФактическийПериодДействияЗаписей.НомерСтроки КАК НомерСтроки,
		|					СУММА(ВЫБОР
		|							КОГДА ФактическийПериодДействияЗаписей.ПериодДействияНачало = ФактическийПериодДействияЗаписей.ДатаНачалаСобытия
		|								ТОГДА ВЫБОР
		|										КОГДА ФактическийПериодДействияЗаписей.ПериодДействияКонец >= ДОБАВИТЬКДАТЕ(ФактическийПериодДействияЗаписей.ДатаНачалаСобытия, ДЕНЬ, 1)
		|											ТОГДА 2
		|										ИНАЧЕ 1
		|									КОНЕЦ
		|							КОГДА ФактическийПериодДействияЗаписей.ПериодДействияНачало > ДОБАВИТЬКДАТЕ(ФактическийПериодДействияЗаписей.ДатаНачалаСобытия, ДЕНЬ, 1)
		|								ТОГДА 0
		|							ИНАЧЕ 1
		|						КОНЕЦ) КАК ДнейЗаСчетРаботодателя,
		|					СУММА(РАЗНОСТЬДАТ(ФактическийПериодДействияЗаписей.ПериодДействияНачало, НАЧАЛОПЕРИОДА(ФактическийПериодДействияЗаписей.ПериодДействияКонец, ДЕНЬ), ДЕНЬ) + 1) КАК КалендарныхДней
		|				ИЗ
		|					РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций.ФактическийПериодДействия(
		|							ВидРасчета В (&парамСписокНачислений)
		|								И ОбособленноеПодразделение = &парамОрганизация
		|								И ВариантОбработкиЗаписиПриОтраженииВРеглУчете <> ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.НеОбрабатывать)
		|								И ВидРасчета.ВидПособияСоциальногоСтрахования <> ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка)
		|								И ПериодРегистрации = &парамПериодРегистрации
		|								И (&парамНеОтбиратьСотрудников
		|									ИЛИ Сотрудник В
		|										(ВЫБРАТЬ
		|											ВТСписокСотрудников.Сотрудник
		|										ИЗ
		|											ВТСписокСотрудников КАК ВТСписокСотрудников))) КАК ФактическийПериодДействияЗаписей
		|				
		|				СГРУППИРОВАТЬ ПО
		|					ФактическийПериодДействияЗаписей.Регистратор,
		|					ФактическийПериодДействияЗаписей.НомерСтроки) КАК ФактическийПериодДействияЗаписей
		|				ПО ОсновныеНачисления.Регистратор = ФактическийПериодДействияЗаписей.Регистратор
		|					И ОсновныеНачисления.НомерСтроки = ФактическийПериодДействияЗаписей.НомерСтроки
		|		
		|		СГРУППИРОВАТЬ ПО
		|			ОсновныеНачисления.Регистратор,
		|			ОсновныеНачисления.ВидУчетаВремени,
		|			ОсновныеНачисления.ДатаНачалаСобытия,
		|			ОсновныеНачисления.ПериодДействияНачало,
		|			ОсновныеНачисления.ПериодДействияКонец,
		|			ОсновныеНачисления.НормаЧасов,
		|			ОсновныеНачисления.НормаДней,
		|			ОсновныеНачисления.НомерСтроки,
		|			ФактическийПериодДействияЗаписей.ДнейЗаСчетРаботодателя,
		|			ФактическийПериодДействияЗаписей.КалендарныхДней) КАК ДанныеУчетаБЛ
		|		ПО ДанныеУчета.Регистратор = ДанныеУчетаБЛ.Регистратор
		|			И ДанныеУчета.НомерСтроки = ДанныеУчетаБЛ.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			ФактическийПериодДействияЗаписей.Регистратор КАК Регистратор,
		|			ФактическийПериодДействияЗаписей.НомерСтроки КАК НомерСтроки,
		|			СУММА(РАЗНОСТЬДАТ(ФактическийПериодДействияЗаписей.ПериодДействияНачало, НАЧАЛОПЕРИОДА(ФактическийПериодДействияЗаписей.ПериодДействияКонец, ДЕНЬ), ДЕНЬ) + 1) КАК КалендарныхДней
		|		ИЗ
		|			РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций.ФактическийПериодДействия(
		|					ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС)
		|						И ВидРасчета В (&парамСписокНачислений)
		|						И ОбособленноеПодразделение = &парамОрганизация
		|						И ВариантОбработкиЗаписиПриОтраженииВРеглУчете <> ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.НеОбрабатывать)
		|						И ПериодРегистрации = &парамПериодРегистрации
		|						И (&парамНеОтбиратьСотрудников
		|							ИЛИ Сотрудник В
		|								(ВЫБРАТЬ
		|									ВТСписокСотрудников.Сотрудник
		|								ИЗ
		|									ВТСписокСотрудников КАК ВТСписокСотрудников))) КАК ФактическийПериодДействияЗаписей
		|		
		|		СГРУППИРОВАТЬ ПО
		|			ФактическийПериодДействияЗаписей.Регистратор,
		|			ФактическийПериодДействияЗаписей.НомерСтроки) КАК ДанныеФПД
		|		ПО ДанныеУчета.Регистратор = ДанныеФПД.Регистратор
		|			И ДанныеУчета.НомерСтроки = ДанныеФПД.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТЛьготыФизлиц КАК ЛьготыФизлиц
		|		ПО ДанныеУчета.ФизЛицо = ЛьготыФизлиц.Физлицо
		|
		|УПОРЯДОЧИТЬ ПО
		|	СотрудникНаименование,
		|	Регистратор,
		|	НомерСтроки,
		|	КодДоходаЕСНРазрез,
		|	ОблагаетсяЕНВДРазрез
		|АВТОУПОРЯДОЧИВАНИЕ";
		
    Иначе
        
		// обработка дополнительных начислений
		Если Не ЭтоПервичныеНачисления Тогда
			
			//соберем базу для зависимых начислений
			БазаТекст = 
			"ВЫБРАТЬ
            |   База.Регистратор КАК Регистратор,
            |   База.НомерСтроки КАК НомерСтроки,
            |   База.КодДоходаЕСНРазрез,
            |   База.ОблагаетсяЕНВДРазрез,
            |   СУММА(База.РезультатБаза) КАК РезультатБаза
            |ПОМЕСТИТЬ База
            |ИЗ
            |   (ВЫБРАТЬ
            |       ДополнительныеНачисленияБазаЕСНОсновныеНачисления.Регистратор КАК Регистратор,
            |       ДополнительныеНачисленияБазаЕСНОсновныеНачисления.НомерСтроки КАК НомерСтроки,
            |       ДополнительныеНачисленияБазаЕСНОсновныеНачисления.КодДоходаЕСНРазрез КАК КодДоходаЕСНРазрез,
            |       ДополнительныеНачисленияБазаЕСНОсновныеНачисления.ОблагаетсяЕНВДРазрез КАК ОблагаетсяЕНВДРазрез,
            |       ДополнительныеНачисленияБазаЕСНОсновныеНачисления.РезультатБаза КАК РезультатБаза
            |   ИЗ
            |       РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций.БазаЕСНОсновныеНачисления(
            |               &парамИзмерения,
            |               &парамИзмерения,
            |               &парамРазрезыЕСН,
            |               Организация = &парамГоловнаяОрганизация
            |                   И НАЧАЛОПЕРИОДА(ПериодРегистрации, МЕСЯЦ) = &парамПериодРегистрации
            |                   И (&парамНеОтбиратьСотрудников
            |                       ИЛИ Сотрудник В
            |                           (ВЫБРАТЬ
            |                               ВТСписокСотрудников.Сотрудник
            |                           ИЗ
            |                               ВТСписокСотрудников КАК ВТСписокСотрудников))
            |                   И (НЕ Сторно)
            |                   И ВидРасчета В (&парамСписокНачислений)
            |                   И (НЕ ВидРасчета.СпособРасчета В (&парамПоСреднемуЗаработку))
            |                   И ВидРасчета.КодДоходаСтраховыеВзносы = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.РаспределятьПоБазовымНачислениям)) КАК ДополнительныеНачисленияБазаЕСНОсновныеНачисления
            |   
            |   ОБЪЕДИНИТЬ ВСЕ
            |   
            |   ВЫБРАТЬ
            |       ДополнительныеНачисленияБазаЕСНДополнительныеНачисления.Регистратор,
            |       ДополнительныеНачисленияБазаЕСНДополнительныеНачисления.НомерСтроки,
            |       ДополнительныеНачисленияБазаЕСНДополнительныеНачисления.КодДоходаЕСНРазрез,
            |       ДополнительныеНачисленияБазаЕСНДополнительныеНачисления.ОблагаетсяЕНВДРазрез,
            |       ДополнительныеНачисленияБазаЕСНДополнительныеНачисления.РезультатБаза
            |   ИЗ
            |       РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций.БазаЕСНДополнительныеНачисления(
            |               &парамИзмерения,
            |               &парамИзмерения,
            |               &парамРазрезыЕСН,
            |               Организация = &парамГоловнаяОрганизация
            |                   И НАЧАЛОПЕРИОДА(ПериодРегистрации, МЕСЯЦ) = &парамПериодРегистрации
            |                   И (&парамНеОтбиратьСотрудников
            |                       ИЛИ Сотрудник В
            |                           (ВЫБРАТЬ
            |                               ВТСписокСотрудников.Сотрудник
            |                           ИЗ
            |                               ВТСписокСотрудников КАК ВТСписокСотрудников))
            |                   И (НЕ Сторно)
            |                   И ВидРасчета В (&парамСписокНачислений)
            |                   И (НЕ ВидРасчета.СпособРасчета В (&парамПоСреднемуЗаработку))
            |                   И ВидРасчета.КодДоходаСтраховыеВзносы = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.РаспределятьПоБазовымНачислениям)) КАК ДополнительныеНачисленияБазаЕСНДополнительныеНачисления) КАК База
            |
            |СГРУППИРОВАТЬ ПО
            |   База.Регистратор,
            |   База.ОблагаетсяЕНВДРазрез,
            |   База.КодДоходаЕСНРазрез,
            |   База.НомерСтроки
            |
            |ИНДЕКСИРОВАТЬ ПО
            |   Регистратор,
            |   НомерСтроки";
			
		Иначе	
			
			// для первичных начислений не собираем базу	
			БазаТекст = 
			"ВЫБРАТЬ
			|	НЕОПРЕДЕЛЕНО КАК Регистратор,
			|	0 КАК НомерСтроки,
			|	ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ПустаяСсылка) КАК КодДоходаЕСНРазрез,
			|	ЛОЖЬ КАК ОблагаетсяЕНВДРазрез,
			|	0 КАК РезультатБаза
			|ПОМЕСТИТЬ База";
			
		КонецЕсли;
		
		Запрос.Текст = БазаТекст;
		//временная таблица - База
		Запрос.Выполнить();
		
		 ///////////////////////////////////////////////////////////////////////////////////
		// ПОЛУЧЕНИЕ БАЗЫ СРЕДНЕГО ЗАРАБОТКА для прочих начислений
		
		ПолучатьБазу = Ложь;
			
		// ВТ_ПрочиеНачисления
		//
        Запрос.Текст =
        "ВЫБРАТЬ
        |	ДополнительныеНачисления.Сотрудник,
        |	ДополнительныеНачисления.Регистратор,
        |	ДополнительныеНачисления.НомерСтроки,
        |	ДополнительныеНачисления.ДатаНачалаСобытия,
        |	ДополнительныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало,
        |	ДополнительныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание,
        |	ДополнительныеНачисления.ВидРасчета.СпособРасчета КАК СпособРасчета
        |ПОМЕСТИТЬ ВТ_ПрочиеНачисления
        |ИЗ
        |	РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисления
        |ГДЕ
        |	ДополнительныеНачисления.ВидРасчета.СтратегияОтраженияВУчете = ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
        |	И НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) = &парамПериодРегистрации
        |	И (&парамНеОтбиратьСотрудников
        |			ИЛИ ДополнительныеНачисления.Сотрудник В
        |				(ВЫБРАТЬ
        |					ВТСписокСотрудников.Сотрудник
        |				ИЗ
        |					ВТСписокСотрудников КАК ВТСписокСотрудников))
        |	И ДополнительныеНачисления.ОбособленноеПодразделение = &парамОрганизация
        |	И ДополнительныеНачисления.ВидРасчета.СпособРасчета В(&парамПоСреднемуЗаработку)
        |	И ДополнительныеНачисления.ВидРасчета В(&парамСписокНачислений)
        |	И ДополнительныеНачисления.Результат <> 0
        |	И (НЕ ДополнительныеНачисления.Сторно)";
        Запрос.Выполнить();
		
		// ВТ_СотрудникиПериодыПрочиеНачисления
		// условия для виртуальной таблицы
		Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДополнительныеНачисления.Сотрудник КАК Сотрудник,
		|	ДополнительныеНачисления.ДатаНачалаСобытия КАК ДатаНачалаСобытия
		|ПОМЕСТИТЬ ВТ_СотрудникиПериодыПрочиеНачисления
		|ИЗ
		|	ВТ_ПрочиеНачисления КАК ДополнительныеНачисления
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Сотрудник,
		|	ДатаНачалаСобытия";
		Результат = Запрос.Выполнить().Выгрузить();
		ПолучатьБазу = Результат[0].Количество > 0;

		Если ПолучатьБазу Тогда
			
			БазаСреднегоЗаработкаТекст =
			"ВЫБРАТЬ
			|	БазаСреднегоЗаработка.Регистратор КАК Регистратор,
			|	БазаСреднегоЗаработка.НомерСтроки КАК НомерСтроки,
			|	БазаСреднегоЗаработка.КодДоходаЕСНРазрез,
			|	БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез,
			|	СУММА(БазаСреднегоЗаработка.РезультатБаза) КАК РезультатБаза
			|ПОМЕСТИТЬ ВТ_БазаСреднегоЗаработка
			|ИЗ
			|	(ВЫБРАТЬ
			|		ДополнительныеНачисления.Регистратор КАК Регистратор,
			|		ДополнительныеНачисления.НомерСтроки КАК НомерСтроки,
			|		ВЫБОР
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработок)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|						КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|							ТОГДА 1
			|						ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|					КОНЕЦ
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработокНеиндексируемый)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза
			|			КОГДА БазаСреднегоЗаработка.ЧислоМесяцев = 0
			|				ТОГДА 0
			|			ИНАЧЕ ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиямНеИндексируемые)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					ИНАЧЕ БазаСреднегоЗаработка.РезультатБаза
			|				КОНЕЦ * ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ЧислоМесяцев > БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка
			|						ТОГДА БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка / БазаСреднегоЗаработка.ЧислоМесяцев
			|					ИНАЧЕ 1
			|				КОНЕЦ
			|		КОНЕЦ КАК РезультатБаза,
			|		БазаСреднегоЗаработка.КодДоходаЕСНРазрез КАК КодДоходаЕСНРазрез,
			|		БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез КАК ОблагаетсяЕНВДРазрез
			|	ИЗ
			|		ВТ_ПрочиеНачисления КАК ДополнительныеНачисления
			|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.РасчетСреднегоЗаработка.БазаЕСНОсновныеНачисления(
			|					&парамИзмерения,
			|					&парамИзмерения,
			|					&парамРазрезыЕСН,
			|					Организация = &парамГоловнаяОрганизация
			|						И Результат <> 0
			|						И ПериодРегистрации = &парамПериодРегистрации
			|						И (Сотрудник, ДатаНачалаСобытия) В
			|							(ВЫБРАТЬ
			|								Список.Сотрудник,
			|								Список.ДатаНачалаСобытия
			|							ИЗ
			|								ВТ_СотрудникиПериодыПрочиеНачисления КАК Список)) КАК БазаСреднегоЗаработка
			|			ПО ДополнительныеНачисления.СпособРасчета = БазаСреднегоЗаработка.СпособРасчета
			|				И ДополнительныеНачисления.ДатаНачалаСобытия = БазаСреднегоЗаработка.ДатаНачалаСобытия
			|				И ДополнительныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало = БазаСреднегоЗаработка.ДатаНачалаРасчетногоПериода
			|				И ДополнительныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание = БазаСреднегоЗаработка.ДатаОкончанияРасчетногоПериода
			|				И ДополнительныеНачисления.Сотрудник = БазаСреднегоЗаработка.Сотрудник
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ДополнительныеНачисления.Регистратор,
			|		ДополнительныеНачисления.НомерСтроки,
			|		ВЫБОР
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработок)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|						КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|							ТОГДА 1
			|						ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|					КОНЕЦ
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработокНеиндексируемый)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза
			|			КОГДА БазаСреднегоЗаработка.ЧислоМесяцев = 0
			|				ТОГДА 0
			|			ИНАЧЕ ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиямНеИндексируемые)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					ИНАЧЕ БазаСреднегоЗаработка.РезультатБаза
			|				КОНЕЦ * ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ЧислоМесяцев > БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка
			|						ТОГДА БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка / БазаСреднегоЗаработка.ЧислоМесяцев
			|					ИНАЧЕ 1
			|				КОНЕЦ
			|		КОНЕЦ,
			|		БазаСреднегоЗаработка.КодДоходаЕСНРазрез,
			|		БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез
			|	ИЗ
			|		ВТ_ПрочиеНачисления КАК ДополнительныеНачисления
			|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.РасчетСреднегоЗаработка.БазаЕСНДополнительныеНачисления(
			|					&парамИзмерения,
			|					&парамИзмерения,
			|					&парамРазрезыЕСН,
			|					Организация = &парамГоловнаяОрганизация
			|						И Результат <> 0
			|						И ПериодРегистрации = &парамПериодРегистрации
			|						И (Сотрудник, ДатаНачалаСобытия) В
			|							(ВЫБРАТЬ
			|								Список.Сотрудник,
			|								Список.ДатаНачалаСобытия
			|							ИЗ
			|								ВТ_СотрудникиПериодыПрочиеНачисления КАК Список)) КАК БазаСреднегоЗаработка
			|			ПО ДополнительныеНачисления.ДатаНачалаСобытия = БазаСреднегоЗаработка.ДатаНачалаСобытия
			|				И ДополнительныеНачисления.Сотрудник = БазаСреднегоЗаработка.Сотрудник) КАК БазаСреднегоЗаработка
			|
			|СГРУППИРОВАТЬ ПО
			|	БазаСреднегоЗаработка.Регистратор,
			|	БазаСреднегоЗаработка.НомерСтроки,
			|	БазаСреднегоЗаработка.КодДоходаЕСНРазрез,
			|	БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	Регистратор,
			|	НомерСтроки";
			
		Иначе	
			
			БазаСреднегоЗаработкаТекст = 
			"ВЫБРАТЬ
            |   НЕОПРЕДЕЛЕНО КАК Регистратор,
            |   0 КАК НомерСтроки,
            |   НЕОПРЕДЕЛЕНО КАК КодДоходаЕСНРазрез,
            |   ЛОЖЬ КАК ОблагаетсяЕНВДРазрез,
            |   0 КАК РезультатБаза
            |ПОМЕСТИТЬ ВТ_БазаСреднегоЗаработка";
			
		КонецЕсли;	

		Запрос.Текст = БазаСреднегоЗаработкаТекст;
		//временная таблица - ВТ_БазаСреднегоЗаработка
		Запрос.Выполнить();
		
		// Закончили получение базы среднего заработка для прочих начислений
		///////////////////////////////////////////////////////////////////////////////////

 		ОтражениеВУчетеСторноТекст = 
		"ВЫБРАТЬ
		|	ДополнительныеНачисления.Регистратор КАК Регистратор,
		|	ДополнительныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ДополнительныеНачисления.Сотрудник КАК Сотрудник,
		|	ДополнительныеНачисления.ВидРасчета КАК ВидРасчета,
		|	ДополнительныеНачисления.СторнируемыйДокумент КАК СторнируемыйДокумент
		|ПОМЕСТИТЬ ВТ_ДополнительныеНачисленияСторно
		|ИЗ
		|	РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисления
		|ГДЕ
		|	ДополнительныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|	И НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) = &парамПериодРегистрации
		|	И (&парамНеОтбиратьСотрудников
		|			ИЛИ ДополнительныеНачисления.Сотрудник В
		|				(ВЫБРАТЬ
		|					ВТСписокСотрудников.Сотрудник
		|				ИЗ
		|					ВТСписокСотрудников КАК ВТСписокСотрудников))
		|	И ДополнительныеНачисления.Результат <> 0
		|	И ДополнительныеНачисления.Сторно
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	СторнируемыйДокумент";
		
		Запрос.Текст = ОтражениеВУчетеСторноТекст;
		//временная таблица - ВТ_ДополнительныеНачисленияСторно
		Результат = Запрос.Выполнить().Выгрузить();
		КоличествоСторноЗаписей = Результат[0].Количество; 
		
		Если КоличествоСторноЗаписей <> 0 Тогда
			
			Запрос.Текст = 
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ДополнительныеНачисленияСторно.Регистратор КАК Регистратор,
			|	ДополнительныеНачисленияСторно.НомерСтроки КАК НомерСтроки,
			|	ДополнительныеНачисленияСторно.Сотрудник КАК Сотрудник,
			|	ДополнительныеНачисленияСторно.ВидРасчета КАК ВидРасчета,
			|	ДополнительныеНачисленияСторно.СторнируемыйДокумент КАК СторнируемыйДокумент,
			|	НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) КАК ПериодРегистрации
			|ПОМЕСТИТЬ ВТ_СторноСотрудники
			|ИЗ
			|	ВТ_ДополнительныеНачисленияСторно КАК ДополнительныеНачисленияСторно
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисления
			|		ПО ДополнительныеНачисленияСторно.СторнируемыйДокумент = ДополнительныеНачисления.Регистратор
			|ГДЕ
			|	ДополнительныеНачисления.ОбособленноеПодразделение = &парамОрганизация
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	Сотрудник,
			|	ВидРасчета,
			|	ПериодРегистрации,
			|	СторнируемыйДокумент";
			
			//временная таблица - ВТ_СторноСотрудники
			Запрос.Выполнить();

			ОтражениеВУчетеСторноТекст = 
			"ВЫБРАТЬ
			|	ДополнительныеНачисления.Регистратор КАК Регистратор,
			|	ДополнительныеНачисления.НомерСтроки КАК НомерСтроки,
			|	ЕСНДополнительныеНачисления.КодДоходаЕСН,
			|	ЕСНДополнительныеНачисления.ОблагаетсяЕНВД,
			|	ЕСНДополнительныеНачисления.Результат
			|ПОМЕСТИТЬ ВТ_ОтражениеВУчетеСторно
			|ИЗ
			|	ВТ_СторноСотрудники КАК ДополнительныеНачисления
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			|			НАЧАЛОПЕРИОДА(ЕСНДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) КАК ПериодРегистрации,
			|			ЕСНДополнительныеНачисления.ВидРасчета КАК ВидРасчета,
			|			ЕСНДополнительныеНачисления.Сотрудник КАК Сотрудник,
			|			ЕСНДополнительныеНачисления.Результат КАК Результат,
			|			СоответствиеКодов.ВидПоСтраховымВзносам КАК КодДоходаЕСН,
			|			ЕСНДополнительныеНачисления.ОблагаетсяЕНВД КАК ОблагаетсяЕНВД,
			|			ЕСНДополнительныеНачисления.ДокументОснование КАК ДокументОснование
			|		ИЗ
			|			РегистрРасчета.ЕСНДополнительныеНачисления КАК ЕСНДополнительныеНачисления
			|				ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКодовЕСНиСтраховыхВзносов КАК СоответствиеКодов
			|				ПО ЕСНДополнительныеНачисления.КодДоходаЕСН = СоответствиеКодов.КодДоходаЕСН
			|		ГДЕ
			|			(ЕСНДополнительныеНачисления.ПериодРегистрации, ЕСНДополнительныеНачисления.Сотрудник, ЕСНДополнительныеНачисления.ВидРасчета) В
			|					(ВЫБРАТЬ
			|						Начисления.ПериодРегистрации,
			|						Начисления.Сотрудник,
			|						Начисления.ВидРасчета
			|					ИЗ
			|						ВТ_СторноСотрудники КАК Начисления)) КАК ЕСНДополнительныеНачисления
			|		ПО ДополнительныеНачисления.ВидРасчета = ЕСНДополнительныеНачисления.ВидРасчета
			|			И ДополнительныеНачисления.Сотрудник = ЕСНДополнительныеНачисления.Сотрудник
			|			И ДополнительныеНачисления.СторнируемыйДокумент = ЕСНДополнительныеНачисления.ДокументОснование
			|			И ДополнительныеНачисления.ПериодРегистрации = ЕСНДополнительныеНачисления.ПериодРегистрации
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	Регистратор,
			|	НомерСтроки";
			
		Иначе
			
			ОтражениеВУчетеСторноТекст = 
			"ВЫБРАТЬ
			|	НЕОПРЕДЕЛЕНО КАК Регистратор,
			|	НЕОПРЕДЕЛЕНО КАК НомерСтроки,
			|	НЕОПРЕДЕЛЕНО КАК КодДоходаЕСН,
			|	ЛОЖЬ КАК ОблагаетсяЕНВД,
			|	0 КАК Результат
			|ПОМЕСТИТЬ ВТ_ОтражениеВУчетеСторно";
			
		КонецЕсли;
		
		Запрос.Текст = ОтражениеВУчетеСторноТекст;
		//временная таблица - ВТ_ОтражениеВУчетеСторно
		Запрос.Выполнить();

		ТекстЗапроса = 
		"ВЫБРАТЬ
		|	ДополнительныеНачисления.Регистратор КАК Регистратор,
		|	ДополнительныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ДополнительныеНачисления.Сотрудник КАК Сотрудник,
		|	ДополнительныеНачисления.ФизЛицо КАК ФизЛицо,
		|	ВЫБОР
		|		КОГДА ДополнительныеНачисления.Сторно
		|			ТОГДА ОтражениеВУчетеСторно.КодДоходаЕСН
		|		ИНАЧЕ ДополнительныеНачисления.ВидРасчета.КодДоходаСтраховыеВзносы
		|	КОНЕЦ КАК КодДоходаЕСН,
		|	ОтражениеВУчетеСторно.ОблагаетсяЕНВД КАК ОблагаетсяЕНВД,
		|	ОтражениеВУчетеСторно.Результат КАК РезультатСторно,
		|	ВЫБОР
		|		КОГДА (НЕ &ЕстьЕНВД)
		|			ТОГДА 0
		|		КОГДА РеглУчетПлановыхНачисленийРаботниковОрганизаций.ОтнесениеРасходовКДеятельностиЕНВД = ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.РасходыОтносятсяКЕНВД)
		|			ТОГДА 100
		|		КОГДА РеглУчетПлановыхНачисленийРаботниковОрганизаций.ОтнесениеРасходовКДеятельностиЕНВД = ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.РасходыОтносятсяКнеЕНВД)
		|			ТОГДА 0
		|		КОГДА ДополнительныеНачисления.ВидРасчета.ОтнесениеРасходовКДеятельностиЕНВД = ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.РасходыОтносятсяКЕНВД)
		|				И ДополнительныеНачисления.ВидРасчета.СпособОтраженияВБухучете.СчетДт <> ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяССылка)
		|				И ДополнительныеНачисления.ВидРасчета.СпособОтраженияВБухучете.СчетКт <> ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяССылка)
		|			ТОГДА 100
		|		КОГДА ДополнительныеНачисления.ВидРасчета.ОтнесениеРасходовКДеятельностиЕНВД = ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.РасходыОтносятсяКнеЕНВД)
		|				И ДополнительныеНачисления.ВидРасчета.СпособОтраженияВБухучете.СчетДт <> ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяССылка)
		|				И ДополнительныеНачисления.ВидРасчета.СпособОтраженияВБухучете.СчетКт <> ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяССылка)
		|			ТОГДА 0
		|		КОГДА Распределение.ПодпадаетПодЕНВД ЕСТЬ НЕ NULL 
		|			ТОГДА ВЫБОР
		|					КОГДА Распределение.ПодпадаетПодЕНВД
		|						ТОГДА 100
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		КОГДА ЕНВДПроцент.ПодпадаетПодЕНВД ЕСТЬ НЕ NULL 
		|			ТОГДА ЕНВДПроцент.ПодпадаетПодЕНВД
		|		КОГДА УчетЗарВРеглУчете.ПодпадаетПодЕНВД ЕСТЬ НЕ NULL 
		|			ТОГДА ВЫБОР
		|					КОГДА УчетЗарВРеглУчете.ПодпадаетПодЕНВД
		|						ТОГДА 100
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		КОГДА УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.ПодпадаетПодЕНВД
		|			ТОГДА 100
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК ПроцентЕНВД,
		|	Распределение.ДоляСпособаОтражения КАК ДоляСпособаОтражения,
		|	ДополнительныеНачисления.ВидРасчета КАК ВидРасчета,
		|	ДополнительныеНачисления.Организация КАК Организация,
		|	ДополнительныеНачисления.Результат КАК Результат,
		|	ДополнительныеНачисления.ВидРасчета.КатегорияРасчета КАК КатегорияРасчета,
		|	ДополнительныеНачисления.ВидРасчета.СтратегияОтраженияВУчете КАК СтратегияОтраженияВУчете,
		|	ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования КАК ВидПособияСоциальногоСтрахования,
		|	ДополнительныеНачисления.Сторно КАК Сторно,
		|	ДополнительныеНачисления.ДатаНачалаСобытия КАК ДатаНачалаСобытия,
		|	ДополнительныеНачисления.ПериодРегистрации КАК ПериодРегистрации,
		|	ВЫБОР
		|		КОГДА ДополнительныеНачисления.ДокументОснование.ВидДоговора ЕСТЬ NULL 
		|			ТОГДА ДополнительныеНачисления.СкидкаПриНалогообложении
		|		КОГДА ДополнительныеНачисления.ДокументОснование.ВидДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровСФизЛицами.Авторский)
		|			ТОГДА ВЫБОР
		|					КОГДА ДополнительныеНачисления.ДокументОснование.ВидАвторскогоДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыАвторскогоДоговора.АвторскогоЗаказа)
		|						ТОГДА ДополнительныеНачисления.СкидкаПриНалогообложении
		|					КОГДА ДополнительныеНачисления.ДокументОснование.КодВычета = ЗНАЧЕНИЕ(Справочник.ВычетыНДФЛ.Код405)
		|						ТОГДА ДополнительныеНачисления.Результат
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Скидка,
		|	ВЫБОР
		|		КОГДА ДополнительныеНачисления.ДокументОснование.ВидДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровСФизЛицами.Авторский)
		|				И ДополнительныеНачисления.ДокументОснование.ВидАвторскогоДоговора <> ЗНАЧЕНИЕ(Перечисление.ВидыАвторскогоДоговора.АвторскогоЗаказа)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК СкидкаНеРассчитана,
		|	ВЫБОР
		|		КОГДА ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования В (ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПриПостановкеНаУчетВРанниеСрокиБеременности), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПриРожденииРебенка), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПриУсыновленииРебенка), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ВСвязиСоСмертью))
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ЭтоЕдиновременноеПособиеФСС,
		|	ДополнительныеНачисления.Сотрудник.Наименование КАК СотрудникНаименование
		|ПОМЕСТИТЬ ВТДанныеУчета
		|ИЗ
		|	РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрРасчета.ЕСНДополнительныеНачисления КАК ЕСНДополнительныеНачисления
		|		ПО ДополнительныеНачисления.Сотрудник = ЕСНДополнительныеНачисления.Сотрудник
		|			И (ЕСНДополнительныеНачисления.ВидРасчета = ДополнительныеНачисления.ВидРасчета)
		|			И (ЕСНДополнительныеНачисления.ПериодРегистрации = &парамПериодРегистрации)
		|			И (ЕСНДополнительныеНачисления.ДокументОснование = ДополнительныеНачисления.Регистратор)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ОтражениеВУчетеСторно КАК ОтражениеВУчетеСторно
		|		ПО ДополнительныеНачисления.Регистратор = ОтражениеВУчетеСторно.Регистратор
		|			И ДополнительныеНачисления.НомерСтроки = ОтражениеВУчетеСторно.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			ВЫБОР
		|				КОГДА РеглУчетПлановыхНачисленийРаботниковОрганизаций.СпособОтраженияВБухучете = ЗНАЧЕНИЕ(Справочник.СпособыОтраженияЗарплатыВРеглУчете.ПустаяСсылка)
		|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.ПустаяСсылка)
		|				ИНАЧЕ РеглУчетПлановыхНачисленийРаботниковОрганизаций.ОтнесениеРасходовКДеятельностиЕНВД
		|			КОНЕЦ КАК ОтнесениеРасходовКДеятельностиЕНВД,
		|			СведенияОНачисленияхСрез.Регистратор КАК Регистратор,
		|			СведенияОНачисленияхСрез.НомерСтроки КАК НомерСтроки
		|		ИЗ
		|			РегистрСведений.РеглУчетПлановыхНачисленийРаботниковОрганизаций КАК РеглУчетПлановыхНачисленийРаботниковОрганизаций
		|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|					ДополнительныеНачисления.Регистратор КАК Регистратор,
		|					ДополнительныеНачисления.НомерСтроки КАК НомерСтроки,
		|					ДополнительныеНачисления.Сотрудник КАК Сотрудник,
		|					ДополнительныеНачисления.ВидРасчета КАК ВидРасчета,
		|					МАКСИМУМ(РеглУчетПлановыхНачисленийРаботниковОрганизаций.Период) КАК Период,
		|					ДополнительныеНачисления.ДокументОснование КАК ДокументОснование
		|				ИЗ
		|					РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисления
		|						ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РеглУчетПлановыхНачисленийРаботниковОрганизаций КАК РеглУчетПлановыхНачисленийРаботниковОрганизаций
		|						ПО ДополнительныеНачисления.ВидРасчета = РеглУчетПлановыхНачисленийРаботниковОрганизаций.ВидРасчета
		|							И (РеглУчетПлановыхНачисленийРаботниковОрганизаций.Период <= ДополнительныеНачисления.ПериодРегистрации)
		|							И ДополнительныеНачисления.Сотрудник = РеглУчетПлановыхНачисленийРаботниковОрганизаций.Сотрудник
		|							И ДополнительныеНачисления.ДокументОснование = РеглУчетПлановыхНачисленийРаботниковОрганизаций.ДокументОснование
		|				ГДЕ
		|					ДополнительныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|					И НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) = &парамПериодРегистрации
		|					И (&парамНеОтбиратьСотрудников
		|							ИЛИ ДополнительныеНачисления.Сотрудник В
		|								(ВЫБРАТЬ
		|									ВТСписокСотрудников.Сотрудник
		|								ИЗ
		|									ВТСписокСотрудников КАК ВТСписокСотрудников))
		|					И ДополнительныеНачисления.ВидРасчета В(&парамСписокНачислений)
		|					И ДополнительныеНачисления.Результат <> 0
		|					И (НЕ ДополнительныеНачисления.Сторно)
		|				
		|				СГРУППИРОВАТЬ ПО
		|					ДополнительныеНачисления.Регистратор,
		|					ДополнительныеНачисления.НомерСтроки,
		|					ДополнительныеНачисления.Сотрудник,
		|					ДополнительныеНачисления.ВидРасчета,
		|					ДополнительныеНачисления.ДокументОснование) КАК СведенияОНачисленияхСрез
		|				ПО (СведенияОНачисленияхСрез.Сотрудник = РеглУчетПлановыхНачисленийРаботниковОрганизаций.Сотрудник)
		|					И (СведенияОНачисленияхСрез.ВидРасчета = РеглУчетПлановыхНачисленийРаботниковОрганизаций.ВидРасчета)
		|					И (СведенияОНачисленияхСрез.Период = РеглУчетПлановыхНачисленийРаботниковОрганизаций.Период)
		|					И (СведенияОНачисленияхСрез.ДокументОснование = РеглУчетПлановыхНачисленийРаботниковОрганизаций.ДокументОснование)) КАК РеглУчетПлановыхНачисленийРаботниковОрганизаций
		|		ПО ДополнительныеНачисления.Регистратор = РеглУчетПлановыхНачисленийРаботниковОрганизаций.Регистратор
		|			И ДополнительныеНачисления.НомерСтроки = РеглУчетПлановыхНачисленийРаботниковОрганизаций.НомерСтроки
		|			И ((НЕ ДополнительныеНачисления.Сторно))
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаспределениеОсновногоЗаработкаРаботниковОрганизаций КАК Распределение
		|		ПО ДополнительныеНачисления.Сотрудник = Распределение.Сотрудник
		|			И (НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) = Распределение.ПериодРегистрации)
		|			И (РеглУчетПлановыхНачисленийРаботниковОрганизаций.ОтнесениеРасходовКДеятельностиЕНВД ЕСТЬ NULL )
		|			И (ДополнительныеНачисления.ВидРасчета.СтратегияОтраженияВУчете <> ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления))
		|			И ((НЕ ДополнительныеНачисления.Сторно))
		|			И (Распределение.ДоляСпособаОтражения <> 0)
		|			И ((НЕ ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования В (ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПриПостановкеНаУчетВРанниеСрокиБеременности), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПриРожденииРебенка), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПриУсыновленииРебенка), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ВСвязиСоСмертью))))
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			ВЫБОР
		|				КОГДА УчетЗарВРеглУчете.СпособОтраженияВБухучете = ЗНАЧЕНИЕ(Справочник.СпособыОтраженияЗарплатыВРеглУчете.ПустаяСсылка)
		|					ТОГДА NULL
		|				ИНАЧЕ УчетЗарВРеглУчете.ПодпадаетПодЕНВД
		|			КОНЕЦ КАК ПодпадаетПодЕНВД,
		|			СведенияОРаботникахСрез.Регистратор КАК Регистратор,
		|			СведенияОРаботникахСрез.НомерСтроки КАК НомерСтроки
		|		ИЗ
		|			РегистрСведений.УчетОсновногоЗаработкаРаботниковОрганизацииВРегламентированномУчете КАК УчетЗарВРеглУчете
		|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|					ДополнительныеНачисления.Регистратор КАК Регистратор,
		|					ДополнительныеНачисления.НомерСтроки КАК НомерСтроки,
		|					ДополнительныеНачисления.Сотрудник КАК Сотрудник,
		|					МАКСИМУМ(УчетЗарВРеглУчете.Период) КАК Период
		|				ИЗ
		|					РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисления
		|						ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаРаботниковОрганизацииВРегламентированномУчете КАК УчетЗарВРеглУчете
		|						ПО ДополнительныеНачисления.Сотрудник = УчетЗарВРеглУчете.Сотрудник
		|							И (УчетЗарВРеглУчете.Период <= ДополнительныеНачисления.ПериодРегистрации)
		|				ГДЕ
		|					ДополнительныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|					И НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) = &парамПериодРегистрации
		|					И (&парамНеОтбиратьСотрудников
		|							ИЛИ ДополнительныеНачисления.Сотрудник В
		|								(ВЫБРАТЬ
		|									ВТСписокСотрудников.Сотрудник
		|								ИЗ
		|									ВТСписокСотрудников КАК ВТСписокСотрудников))
		|					И ДополнительныеНачисления.ВидРасчета В(&парамСписокНачислений)
		|					И ДополнительныеНачисления.ВидРасчета.СтратегияОтраженияВУчете <> ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
		|					И ДополнительныеНачисления.Результат <> 0
		|					И (НЕ ДополнительныеНачисления.Сторно)
		|				
		|				СГРУППИРОВАТЬ ПО
		|					ДополнительныеНачисления.Регистратор,
		|					ДополнительныеНачисления.НомерСтроки,
		|					ДополнительныеНачисления.Сотрудник) КАК СведенияОРаботникахСрез
		|				ПО (СведенияОРаботникахСрез.Сотрудник = УчетЗарВРеглУчете.Сотрудник)
		|					И (СведенияОРаботникахСрез.Период = УчетЗарВРеглУчете.Период)) КАК УчетЗарВРеглУчете
		|		ПО ДополнительныеНачисления.Регистратор = УчетЗарВРеглУчете.Регистратор
		|			И ДополнительныеНачисления.НомерСтроки = УчетЗарВРеглУчете.НомерСтроки
		|			И ((НЕ ДополнительныеНачисления.Сторно))
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			СведенияОПодразделенияхСрез.Регистратор КАК Регистратор,
		|			СведенияОПодразделенияхСрез.НомерСтроки КАК НомерСтроки,
		|			ВЫБОР
		|				КОГДА УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.СпособОтраженияВБухучете = ЗНАЧЕНИЕ(Справочник.СпособыОтраженияЗарплатыВРеглУчете.ПустаяСсылка)
		|					ТОГДА ЛОЖЬ
		|				ИНАЧЕ УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.ПодпадаетПодЕНВД
		|			КОНЕЦ КАК ПодпадаетПодЕНВД
		|		ИЗ
		|			(ВЫБРАТЬ
		|				ДополнительныеНачисления.Регистратор КАК Регистратор,
		|				ДополнительныеНачисления.НомерСтроки КАК НомерСтроки,
		|				ДополнительныеНачисления.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
		|				МАКСИМУМ(УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.Период) КАК Период
		|			ИЗ
		|				РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисления
		|					ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации КАК УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации
		|					ПО ДополнительныеНачисления.ПодразделениеОрганизации = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.ПодразделениеОрганизации
		|						И (УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.Период <= ДополнительныеНачисления.ПериодРегистрации)
		|			ГДЕ
		|				ДополнительныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|				И НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) = &парамПериодРегистрации
		|				И (&парамНеОтбиратьСотрудников
		|						ИЛИ ДополнительныеНачисления.Сотрудник В
		|							(ВЫБРАТЬ
		|								ВТСписокСотрудников.Сотрудник
		|							ИЗ
		|								ВТСписокСотрудников КАК ВТСписокСотрудников))
		|				И ДополнительныеНачисления.ВидРасчета В(&парамСписокНачислений)
		|				И ДополнительныеНачисления.ВидРасчета.СтратегияОтраженияВУчете <> ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
		|				И ДополнительныеНачисления.Результат <> 0
		|				И (НЕ ДополнительныеНачисления.Сторно)
		|			
		|			СГРУППИРОВАТЬ ПО
		|				ДополнительныеНачисления.ПодразделениеОрганизации,
		|				ДополнительныеНачисления.Регистратор,
		|				ДополнительныеНачисления.НомерСтроки) КАК СведенияОПодразделенияхСрез
		|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации КАК УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации
		|				ПО СведенияОПодразделенияхСрез.ПодразделениеОрганизации = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.ПодразделениеОрганизации
		|					И СведенияОПодразделенияхСрез.Период = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.Период) КАК УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации
		|		ПО ДополнительныеНачисления.Регистратор = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.Регистратор
		|			И ДополнительныеНачисления.НомерСтроки = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.НомерСтроки
		|			И ((НЕ ДополнительныеНачисления.Сторно))
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПроцентДеятельностиЕНВДСотрудников КАК ЕНВДПроцент
		|		ПО ДополнительныеНачисления.Сотрудник = ЕНВДПроцент.Сотрудник
		|			И (ЕНВДПроцент.ПериодРегистрации = НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ))
		|			И ((НЕ ДополнительныеНачисления.Сторно))
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			СведенияОбОрганизацииСрез.Регистратор КАК Регистратор,
		|			СведенияОбОрганизацииСрез.НомерСтроки КАК НомерСтроки,
		|			ВЫБОР
		|				КОГДА УчетОсновногоЗаработкаОрганизации.СпособОтраженияВБухучете = ЗНАЧЕНИЕ(Справочник.СпособыОтраженияЗарплатыВРеглУчете.ПустаяСсылка)
		|					ТОГДА ЛОЖЬ
		|				ИНАЧЕ УчетОсновногоЗаработкаОрганизации.ПодпадаетПодЕНВД
		|			КОНЕЦ КАК ПодпадаетПодЕНВД
		|		ИЗ
		|			(ВЫБРАТЬ
		|				ДополнительныеНачисления.Регистратор КАК Регистратор,
		|				ДополнительныеНачисления.НомерСтроки КАК НомерСтроки,
		|				ДополнительныеНачисления.ОбособленноеПодразделение КАК ОбособленноеПодразделение,
		|				МАКСИМУМ(УчетОсновногоЗаработкаОрганизации.Период) КАК Период
		|			ИЗ
		|				РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисления
		|					ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаОрганизации КАК УчетОсновногоЗаработкаОрганизации
		|					ПО ДополнительныеНачисления.ОбособленноеПодразделение = УчетОсновногоЗаработкаОрганизации.Организация
		|						И (УчетОсновногоЗаработкаОрганизации.Период <= ДополнительныеНачисления.ПериодРегистрации)
		|			ГДЕ
		|				ДополнительныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|				И НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) = &парамПериодРегистрации
		|				И (&парамНеОтбиратьСотрудников
		|						ИЛИ ДополнительныеНачисления.Сотрудник В
		|							(ВЫБРАТЬ
		|								ВТСписокСотрудников.Сотрудник
		|							ИЗ
		|								ВТСписокСотрудников КАК ВТСписокСотрудников))
		|				И ДополнительныеНачисления.ВидРасчета В(&парамСписокНачислений)
		|				И ДополнительныеНачисления.ВидРасчета.СтратегияОтраженияВУчете <> ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
		|				И ДополнительныеНачисления.Результат <> 0
		|				И (НЕ ДополнительныеНачисления.Сторно)
		|			
		|			СГРУППИРОВАТЬ ПО
		|				ДополнительныеНачисления.ОбособленноеПодразделение,
		|				ДополнительныеНачисления.Регистратор,
		|				ДополнительныеНачисления.НомерСтроки) КАК СведенияОбОрганизацииСрез
		|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаОрганизации КАК УчетОсновногоЗаработкаОрганизации
		|				ПО СведенияОбОрганизацииСрез.Период = УчетОсновногоЗаработкаОрганизации.Период
		|					И СведенияОбОрганизацииСрез.ОбособленноеПодразделение = УчетОсновногоЗаработкаОрганизации.Организация) КАК УчетОсновногоЗаработкаОрганизации
		|		ПО ДополнительныеНачисления.Регистратор = УчетОсновногоЗаработкаОрганизации.Регистратор
		|			И ДополнительныеНачисления.НомерСтроки = УчетОсновногоЗаработкаОрганизации.НомерСтроки
		|			И ((НЕ ДополнительныеНачисления.Сторно))
		|ГДЕ
		|	ЕСНДополнительныеНачисления.Сотрудник ЕСТЬ NULL 
		|	И ДополнительныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|	И (&парамНеОтбиратьСотрудников
		|			ИЛИ ДополнительныеНачисления.Сотрудник В
		|				(ВЫБРАТЬ
		|					ВТСписокСотрудников.Сотрудник
		|				ИЗ
		|					ВТСписокСотрудников КАК ВТСписокСотрудников))
		|	И ДополнительныеНачисления.Результат <> 0
		|	И ДополнительныеНачисления.ВидРасчета В(&парамСписокНачислений)
		|	И НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) = &парамПериодРегистрации
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	НомерСтроки
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДанныеУчета.Регистратор КАК Регистратор,
		|	ДанныеУчета.Регистратор КАК ДокументОснование,
		|	ДанныеУчета.НомерСтроки КАК НомерСтроки,
		|	ДанныеУчета.Сотрудник,
		|	ДанныеУчета.СотрудникНаименование КАК СотрудникНаименование,
		|	ДанныеУчета.ФизЛицо,
		|	ДанныеУчета.КодДоходаЕСН,
		|	ДанныеУчета.ОблагаетсяЕНВД КАК ОблагаетсяЕНВД,
		|	ДанныеУчета.РезультатСторно КАК РезультатСторно,
		|	ДанныеУчета.ПроцентЕНВД,
		|	ДанныеУчета.ВидРасчета,
		|	ДанныеУчета.Результат КАК Результат,
		|	0 КАК ДополнительныйРезультат,
		|	ДанныеУчета.СтратегияОтраженияВУчете,
		|	ДанныеУчета.ВидПособияСоциальногоСтрахования,
		|	ДанныеУчета.ПериодРегистрации,
		|	ДанныеУчета.ДатаНачалаСобытия КАК ДатаНачалаСобытия,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ПустаяСсылка) КАК ВариантОбработкиЗаписиПриОтраженииВРеглУчете,
		|	СоответствиеКодов.ВидПоСтраховымВзносам КАК КодДоходаЕСНРазрез,
		|	ЕСТЬNULL(База.ОблагаетсяЕНВДРазрез, БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез) КАК ОблагаетсяЕНВДРазрез,
		|	ВЫБОР
		|		КОГДА ДанныеУчета.ДоляСпособаОтражения ЕСТЬ НЕ NULL 
		|			ТОГДА ДанныеУчета.ДоляСпособаОтражения
		|		КОГДА База.РезультатБаза ЕСТЬ НЕ NULL 
		|			ТОГДА База.РезультатБаза
		|		ИНАЧЕ БазаСреднегоЗаработка.РезультатБаза
		|	КОНЕЦ КАК РезультатБаза,
		|	ДанныеУчета.Сторно КАК Сторно,
		|	ДанныеУчета.ДоляСпособаОтражения,
		|	ИСТИНА КАК УчитыватьКакНовыйСтраховойСлучай,
		|	ВЫБОР
		|		КОГДА ДанныеУчета.КодДоходаЕСН В (&ДоходыАвторские)
		|			ТОГДА ДанныеУчета.Скидка * ВЫБОР
		|					КОГДА ДанныеУчета.СкидкаНеРассчитана
		|						ТОГДА ЕСТЬNULL(СтраховыеВзносыСкидкиКДоходамСрезПоследних.НормативЗатрат / 100, 0)
		|					ИНАЧЕ 1
		|				КОНЕЦ
		|		КОГДА ДанныеУчета.КодДоходаЕСН = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.МатпомощьПриРожденииРебенка)
		|			ТОГДА ДанныеУчета.Скидка
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Скидка,
		|	ДанныеУчета.ЭтоЕдиновременноеПособиеФСС КАК ЭтоЕдиновременноеПособиеФСС,
		|	ЛОЖЬ КАК ЭтоПособияФСС
		|ИЗ
		|	ВТДанныеУчета КАК ДанныеУчета
		|		ЛЕВОЕ СОЕДИНЕНИЕ База КАК База
		|		ПО ДанныеУчета.Регистратор = База.Регистратор
		|			И ДанныеУчета.НомерСтроки = База.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_БазаСреднегоЗаработка КАК БазаСреднегоЗаработка
		|		ПО ДанныеУчета.Регистратор = БазаСреднегоЗаработка.Регистратор
		|			И ДанныеУчета.НомерСтроки = БазаСреднегоЗаработка.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКодовЕСНиСтраховыхВзносов КАК СоответствиеКодов
		|		ПО (ЕСТЬNULL(База.КодДоходаЕСНРазрез, БазаСреднегоЗаработка.КодДоходаЕСНРазрез) = СоответствиеКодов.КодДоходаЕСН)
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтраховыеВзносыСкидкиКДоходам.СрезПоследних(&парамПериодРегистрации, ВидДохода В (&ДоходыАвторские)) КАК СтраховыеВзносыСкидкиКДоходамСрезПоследних
		|		ПО ДанныеУчета.КодДоходаЕСН = СтраховыеВзносыСкидкиКДоходамСрезПоследних.ВидДохода
		|
		|УПОРЯДОЧИТЬ ПО
		|	СотрудникНаименование,
		|	Регистратор,
		|	НомерСтроки,
		|	КодДоходаЕСНРазрез,
		|	ОблагаетсяЕНВДРазрез
		|АВТОУПОРЯДОЧИВАНИЕ";

	КонецЕсли;

	Запрос.Текст = ТекстЗапроса;
	РезультатЗапроса = Запрос.Выполнить();
	
	Возврат РезультатЗапроса;

КонецФункции // ПолучитьДанныеУчета2010()

// алгоритмы за 2010 год
//////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////
// алгоритмы с 2011 года

// Процедура формирует набор записей по данным из запроса
//
// Параметры:
//	РезультатДанныеУчета		- выборка по резултату запроса, возвращенная функцией 
//								  ПолучитьДанныеУчета
//	Успешно						- в этот параметр возвращается значение Ложь, если обработка не выполнена
//								  (например, если не окзалось базовых данных)
//	НаборЗаписей
//
Процедура ОбработатьДанныеУчета2011(ДокументОбъект, ВыделятьЕНВД, ВыборкаПоШапкеДокумента,РезультатДанныеУчета, Успешно, НаборЗаписей, ТаблицаОшибок)

	// признак основных начислений
	ЭтоОсновныеНачисления = (ТипЗнч(НаборЗаписей) = Тип("РегистрРасчетаНаборЗаписей.ЕСНОсновныеНачисления"));
	
	мДлинаСуток = 86400;		// в секундах
	
	ПособияСоциальномуСтрахованию 		  = ДокументОбъект.ПособияПоСоциальномуСтрахованию;
	ПособияПоУходуЗаРебенкомДоПолутораЛет = ДокументОбъект.ПособияПоУходуЗаРебенкомДоПолутораЛет;
	
	РаспределятьПоБазовымНачислениям = Справочники.ДоходыПоСтраховымВзносам.РаспределятьПоБазовымНачислениям;
	
	// структура поиска для позиционирования в ДанныеУчетаВспомогательные
	// при необходимости суммирования "базовых" ресурсов
	СтруктураПоиска = Новый Структура("Регистратор,НомерСтроки");
	
	// структура поиска в таблице ошибок мТаблицаОшибок
	СтруктураПоискаОшибок = Новый Структура("Регистратор,НомерСтроки,КодОшибки");
	
	// основная выборка - по ней ведем обход и вводим записи движений
	ДанныеУчета = РезультатДанныеУчета.Выбрать();
		
	// вспомогательная выборка - по ней ведем суммирование базовых результатов
	ДанныеУчетаВспомогательные = РезультатДанныеУчета.Выбрать();
	
	ПродолжатьОбработку = ДанныеУчета.Следующий();
	Пока ПродолжатьОбработку Цикл
		
		СтрокаДанных = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
		
		Если ДанныеУчета.Сторно и Не ДанныеУчета.ЭтоЕдиновременноеПособиеФСС и Не ДанныеУчета.ЭтоПособияФСС Тогда
			
			// необходимо обойти все данные относящиеся к одной строке основного регистра и 
			// выполнить распределение, нормируя на долю 
			ЕстьДанныеУчетаСторно = Истина;
			
			// текущий ключ поиска 
			ТекущийРегистратор = ДанныеУчета.Регистратор;
			ТекущийНомерСтроки = ДанныеУчета.НомерСтроки;
			// позиционируемся во вспомогательной выборке по запросу для суммирования "базовых" данных
			СтруктураПоиска.Регистратор = ТекущийРегистратор;
			СтруктураПоиска.НомерСтроки = ТекущийНомерСтроки;
			Если ДанныеУчетаВспомогательные.Регистратор <> ТекущийРегистратор ИЛИ 
				ДанныеУчетаВспомогательные.НомерСтроки <> ТекущийНомерСтроки Тогда
				// ищем следующую строку во спомогательной выборке если она не является искомой	
				ДанныеУчетаВспомогательные.НайтиСледующий(СтруктураПоиска);
			КонецЕсли;
			
			СуммаПоСтроке = 0;
			// суммируем базовые ресурсы по текущей строке набора записей
			Пока ДанныеУчетаВспомогательные.Регистратор = ТекущийРегистратор И ДанныеУчетаВспомогательные.НомерСтроки = ТекущийНомерСтроки Цикл
				Если ДанныеУчетаВспомогательные.РезультатСторно = NULL Тогда
					//нет данных отражения в учете сторно-записи
					Успешно = Ложь;
					ЕстьДанныеУчетаСторно = Ложь;
					ЗарегистрироватьОшибкуОбработкиДанныхУчета(ТаблицаОшибок, ДанныеУчетаВспомогательные, ЭтоОсновныеНачисления, СтруктураПоискаОшибок, 1);
				Иначе
					СуммаПоСтроке = СуммаПоСтроке + ДанныеУчетаВспомогательные.РезультатСторно;
				КонецЕсли;
				Если Не ДанныеУчетаВспомогательные.Следующий() Тогда
					Прервать;
				КонецЕсли;
			КонецЦикла;
			
			// суммарная доля, которую уже "разбросали" на строки с одинаковым регистратором и номером строки
			СуммарнаяДоля = 0;
			СуммарнаяДоляДоп = 0;
			// полный результат
			ПолныйРезультат = ДанныеУчета.Результат;
			ПолныйРезультатДоп = ДанныеУчета.ДополнительныйРезультат;
			// обходим строки и вычисляем долю результата по базовым записям
			ПерваяИзГруппыСтрок = Истина;
			Пока ДанныеУчета.Регистратор = ТекущийРегистратор И ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
				// если это не первая из группы "базовых" строк по одной строке основного регистра
				// то создаем очередную строку движений
				Если Не ПерваяИзГруппыСтрок Тогда
					СтрокаДанных = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
				Иначе
					ПерваяИзГруппыСтрок = Ложь;
				КонецЕсли;
				
				Если СуммаПоСтроке = 0 Тогда
					Доля = 0;
					ДоляДоп = 0;
				Иначе
					Если ДанныеУчета.РезультатСторно = NULL Тогда
						Доля = 0;
						ДоляДоп = 0;
					Иначе
						Доля = Окр(ПолныйРезультат * ДанныеУчета.РезультатСторно / СуммаПоСтроке,2);
						ДоляДоп = Окр(ПолныйРезультатДоп * ДанныеУчета.РезультатСторно / СуммаПоСтроке,2);
					КонецЕсли;
				КонецЕсли;
				
				СтрокаДанных.ОблагаетсяЕНВД = ДанныеУчета.ОблагаетсяЕНВД;
				СтрокаДанных.Результат = ?(ПолныйРезультат > 0,Мин(Доля,ПолныйРезультат - СуммарнаяДоля),Макс(Доля,ПолныйРезультат - СуммарнаяДоля));
				ДополнительныйРезультат = ?(ПолныйРезультатДоп > 0,Мин(ДоляДоп, ПолныйРезультатДоп - СуммарнаяДоляДоп),Макс(ДоляДоп,ПолныйРезультатДоп - СуммарнаяДоляДоп));
				СуммарнаяДоля = СуммарнаяДоля + СтрокаДанных.Результат;
				СуммарнаяДоляДоп = СуммарнаяДоляДоп + ДополнительныйРезультат;
				
				Если ДанныеУчета.ЭтоПособияФСС Тогда
					
					Если ЕстьДанныеУчетаСторно Тогда
						СтрокаДанных.ПериодДействияНачало = ДанныеУчета.ПериодДействияНачалоСторно;	
						СтрокаДанных.ПериодДействияКонец  = ДанныеУчета.ПериодДействияКонецСторно;
					КонецЕсли;
					
					Если ДанныеУчета.ВидПособияСоциальногоСтрахования = Перечисления.ВидыПособийСоциальногоСтрахования.ПоУходуЗаРебенкомДоПолутораЛет Тогда
						
						СтрокаУчетаПособий = ДокументОбъект.ПособияПоУходуЗаРебенкомДоПолутораЛет.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,СтрокаДанных);
						ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета,"ВыплатаЗаСчетФедеральногоБюджета");
						СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком = СтрокаДанных.Результат * ДанныеУчета.ДоляПособияНаПервогоРебенка;
						СтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенком = СтрокаДанных.Результат - СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком;
						СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм = ДополнительныйРезультат * ДанныеУчета.ДоляПособияНаПервогоРебенка;
						СтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенкомСверхНорм = ДополнительныйРезультат - СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм;
						
					ИначеЕсли ЗначениеЗаполнено(ДанныеУчета.ВидПособияСоциальногоСтрахования) Тогда 
						
						СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
						СтрокаУчетаПособий.ПериодДействияНачало = СтрокаДанных.ПериодДействияНачало;	
						СтрокаУчетаПособий.ПериодДействияКонец  = СтрокаДанных.ПериодДействияКонец;
						СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
						СтрокаУчетаПособий.СуммаСверхНорм = ДополнительныйРезультат;
						
						СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
						
						Если ЕстьДанныеУчетаСторно Тогда
							
							СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетФСС;
							СтрокаУчетаПособий.ОплаченныеДни = -1 * ДанныеУчета.ВсегоДнейНетрудоспособностиСторно;
							
							Если ДанныеУчета.ВариантОбработкиЗаписиПриОтраженииВРеглУчете = Перечисления.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание
								 И ДанныеУчета.КодДоходаЕСН = Справочники.ДоходыПоСтраховымВзносам.НеОблагаетсяЦеликом Тогда
								 
								 СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетРаботодателя;
								 СтрокаУчетаПособий.СуммаСверхНорм = 0;
								 СтрокаУчетаПособий.ВыплатаЗаСчетФедеральногоБюджета = Перечисления.ВыплатыПособийЗаСчетФедеральногоБюджета.ПустаяСсылка();
								 
							КонецЕсли;
							
						КонецЕсли;
						
					КонецЕсли;
					
				ИначеЕсли ДанныеУчета.ЭтоЕдиновременноеПособиеФСС Тогда
					
					СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
					СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетФСС;
					СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
					СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
					
				ИначеЕсли ДанныеУчета.ВариантОбработкиЗаписиПриОтраженииВРеглУчете = Перечисления.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйЗаСчетРаботодателя Тогда
					
					СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
					СтрокаУчетаПособий.ПериодДействияНачало = СтрокаДанных.ПериодДействияНачало;	
					СтрокаУчетаПособий.ПериодДействияКонец  = СтрокаДанных.ПериодДействияКонец;
					СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетРаботодателя;
					СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
					СтрокаУчетаПособий.СуммаСверхНорм = 0;
					СтрокаУчетаПособий.ВыплатаЗаСчетФедеральногоБюджета = Перечисления.ВыплатыПособийЗаСчетФедеральногоБюджета.ПустаяСсылка();
					СтрокаУчетаПособий.ВидПособияСоциальногоСтрахования = Перечисления.ВидыПособийСоциальногоСтрахования.Нетрудоспособность;
					СтрокаУчетаПособий.ОплаченныеДни = -1 * ДанныеУчета.ВсегоДнейНетрудоспособности;
					СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
					Если ЕстьДанныеУчетаСторно Тогда
						СтрокаУчетаПособий.ОплаченныеДни = -1 * ДанныеУчета.ВсегоДнейНетрудоспособностиСторно;
					КонецЕсли;
					
				КонецЕсли;	
				
				Если Не ДанныеУчета.Следующий() Тогда
					ПродолжатьОбработку = Ложь;
					Прервать;
				КонецЕсли;
				
			КонецЦикла;
			// ошибки округления складываются на последнюю запись из группы базовых записей
			СтрокаДанных.Результат = СтрокаДанных.Результат + ПолныйРезультат - СуммарнаяДоля;
			
		ИначеЕсли ДанныеУчета.ЭтоЕдиновременноеПособиеФСС Тогда
			
			СтрокаДанных.ОблагаетсяЕНВД = ВыделятьЕНВД и ДанныеУчета.ПроцентЕНВД = 100;
			
			СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
			СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетФСС;
			СтрокаУчетаПособий.ОблагаетсяЕНВД = СтрокаДанных.ОблагаетсяЕНВД;
			СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
			СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
			
			Если Не ЗначениеЗаполнено(ДанныеУчета.КодДоходаЕСН) Тогда
				// у вида расчета не заполнен реквизит КодДоходаЕСН
				Успешно = Ложь;
				ЗарегистрироватьОшибкуОбработкиДанныхУчета(ТаблицаОшибок, ДанныеУчета, ЭтоОсновныеНачисления, СтруктураПоискаОшибок, 6);
			КонецЕсли;
			
			Если Не ДанныеУчета.Следующий() Тогда
				ПродолжатьОбработку = Ложь;
			КонецЕсли;
			
		ИначеЕсли ДанныеУчета.ЭтоПособияФСС Тогда
			
			// текущий ключ поиска 
			ТекущийРегистратор = ДанныеУчета.Регистратор;
			ТекущийНомерСтроки = ДанныеУчета.НомерСтроки;
			
			Если ДанныеУчета.ВариантОбработкиЗаписиПриОтраженииВРеглУчете = Перечисления.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве Тогда
				
				СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыПоСтраховымВзносам.НеОблагаетсяЦеликом;
				СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
				СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетФСС;
				СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
				СтрокаУчетаПособий.ОплаченныеДни = ?(ДанныеУчета.Сторно,-ДанныеУчета.ВсегоДнейНетрудоспособности,ДанныеУчета.ВсегоДнейНетрудоспособности);
				СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
				
				Если ЗначениеЗаполнено(ДанныеУчета.ДоляСпособаОтражения) Тогда
					
					// текущий ключ поиска 
					ТекущийРегистратор = ДанныеУчета.Регистратор;
					ТекущийНомерСтроки = ДанныеУчета.НомерСтроки;
					// позиционируемся во вспомогательной выборке по запросу для суммирования "базовых" данных
					СтруктураПоиска.Регистратор = ТекущийРегистратор;
					СтруктураПоиска.НомерСтроки = ТекущийНомерСтроки;
					Если ДанныеУчетаВспомогательные.Регистратор <> ТекущийРегистратор ИЛИ 
						ДанныеУчетаВспомогательные.НомерСтроки <> ТекущийНомерСтроки Тогда
						// ищем следующую строку во спомогательной выборке если она не является искомой	
						ДанныеУчетаВспомогательные.НайтиСледующий(СтруктураПоиска);
					КонецЕсли;
					
					СуммаПоСтроке = 0;
					// суммируем базовые ресурсы по текущей строке набора записей
					Пока ДанныеУчетаВспомогательные.Регистратор = ТекущийРегистратор И ДанныеУчетаВспомогательные.НомерСтроки = ТекущийНомерСтроки Цикл
						Если Не ДанныеУчетаВспомогательные.РезультатБаза = NULL Тогда
							СуммаПоСтроке = СуммаПоСтроке + ДанныеУчетаВспомогательные.РезультатБаза;
						КонецЕсли;
						Если Не ДанныеУчетаВспомогательные.Следующий() Тогда
							Прервать;
						КонецЕсли;
					КонецЦикла;
					
					// суммарная доля, которую уже "разбросали" на строки с одинаковым регистратором и номером строки
					СуммарнаяДоля = 0;
					// полный результат
					ПолныйРезультат = ДанныеУчета.Результат;
					// обходим строки и вычисляем долю результата по базовым записям
					ПерваяИзГруппыСтрок = Истина;
					ТекущаяСтрокаДанных = СтрокаДанных;
					ТекущаяСтрокаУчетаПособий = СтрокаУчетаПособий;
					Пока ДанныеУчета.Регистратор = ТекущийРегистратор И ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
						// если это не первая из группы "базовых" строк по одной строке основного регистра
						// то создаем очередную строку движений
						Если Не ПерваяИзГруппыСтрок Тогда
							НоваяСтрокаДанных = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
							НоваяСтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
							ТекущаяСтрокаДанных = НоваяСтрокаДанных;
							ТекущаяСтрокаУчетаПособий = НоваяСтрокаУчетаПособий;
							ЗаполнитьЗначенияСвойств(ТекущаяСтрокаУчетаПособий,СтрокаУчетаПособий);
							ТекущаяСтрокаУчетаПособий.ОблагаетсяЕНВД = Ложь;
						Иначе
							ПерваяИзГруппыСтрок = Ложь;
						КонецЕсли;
						
						Если ЗначениеЗаполнено(ДанныеУчета.ПроцентЕНВД) Тогда
							ТекущаяСтрокаДанных.ОблагаетсяЕНВД = Истина;
							ТекущаяСтрокаУчетаПособий.ОблагаетсяЕНВД = Истина;
						КонецЕсли;
						
						Если СуммаПоСтроке = 0 Тогда
							Доля = 0;
						Иначе
							Если ДанныеУчета.РезультатБаза = NULL Тогда
								Доля = 0;
							Иначе
								Доля = Окр(ПолныйРезультат * ДанныеУчета.РезультатБаза / СуммаПоСтроке,2);
							КонецЕсли;
						КонецЕсли;
						
						ТекущаяСтрокаДанных.Результат = ?(ПолныйРезультат > 0,Мин(Доля,ПолныйРезультат - СуммарнаяДоля),Макс(Доля,ПолныйРезультат - СуммарнаяДоля));
						ТекущаяСтрокаУчетаПособий.СуммаВсего = ТекущаяСтрокаДанных.Результат;
						СуммарнаяДоля = СуммарнаяДоля + ТекущаяСтрокаДанных.Результат;
						
						Если Не ДанныеУчета.Следующий() Тогда
							ПродолжатьОбработку = Ложь;
							Прервать;
						КонецЕсли;
					КонецЦикла;
					// ошибки округления складываются на последнюю запись из группы базовых записей
					ТекущаяСтрокаДанных.Результат = ТекущаяСтрокаДанных.Результат + ПолныйРезультат - СуммарнаяДоля;
					ТекущаяСтрокаУчетаПособий.СуммаВсего = ТекущаяСтрокаДанных.Результат;
					
				ИначеЕсли ЗначениеЗаполнено(ДанныеУчета.ПроцентЕНВД) Тогда
					
					Если ДанныеУчета.ПроцентЕНВД = 100 Тогда
						
						СтрокаДанных.ОблагаетсяЕНВД = Истина;
						СтрокаУчетаПособий.ОблагаетсяЕНВД = Истина;
						
					Иначе	
						
						// заводим новую строку данных - для ввода доли дохода под ЕНВД
						НоваяСтрока = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
						НоваяСтрока.КодДоходаЕСН = СтрокаДанных.КодДоходаЕСН;
						
						// вычислим результат для дохода под ЕНВД
						РезультатПодЕНВД = Окр(ДанныеУчета.Результат * ДанныеУчета.ПроцентЕНВД / 100,2);
						СкидкаПодЕНВД = Окр(ДанныеУчета.Скидка * ДанныеУчета.ПроцентЕНВД / 100,2);
						// ресурсы
						НоваяСтрока.Результат = РезультатПодЕНВД;
						
						// основной строке данных уменьшаем результат
						СтрокаДанных.Результат = ДанныеУчета.Результат - РезультатПодЕНВД;
						СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
						
						// это строка для подпадающего под ЕНВД дохода
						// "обычная строка" уже введена в движения выше
						НоваяСтрока.ОблагаетсяЕНВД = Истина;
						
						// сторка ЕНВД
						НоваяСтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
						ЗаполнитьЗначенияСвойств(НоваяСтрокаУчетаПособий,СтрокаУчетаПособий);
						НоваяСтрокаУчетаПособий.СуммаВсего = НоваяСтрока.Результат;
						НоваяСтрокаУчетаПособий.ОблагаетсяЕНВД = НоваяСтрока.ОблагаетсяЕНВД;
						
					КонецЕсли;
					
				КонецЕсли;
				
			ИначеЕсли ДанныеУчета.ВидПособияСоциальногоСтрахования = Перечисления.ВидыПособийСоциальногоСтрахования.ПоУходуЗаРебенкомДоПолутораЛет Тогда
				
				СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыПоСтраховымВзносам.ПособияЗаСчетФСС;
				СтрокаУчетаПособий = ПособияПоУходуЗаРебенкомДоПолутораЛет.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,СтрокаДанных);
				ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета,"ВыплатаЗаСчетФедеральногоБюджета");
				СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком = СтрокаДанных.Результат * ДанныеУчета.ДоляПособияНаПервогоРебенка;
				СтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенком = СтрокаДанных.Результат - СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком;
				СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм = ДанныеУчета.ДополнительныйРезультат * ДанныеУчета.ДоляПособияНаПервогоРебенка;
				СтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенкомСверхНорм = ДанныеУчета.ДополнительныйРезультат - СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм;
				
				Если ЗначениеЗаполнено(ДанныеУчета.ДоляСпособаОтражения) Тогда
					
					// текущий ключ поиска 
					ТекущийРегистратор = ДанныеУчета.Регистратор;
					ТекущийНомерСтроки = ДанныеУчета.НомерСтроки;
					// позиционируемся во вспомогательной выборке по запросу для суммирования "базовых" данных
					СтруктураПоиска.Регистратор = ТекущийРегистратор;
					СтруктураПоиска.НомерСтроки = ТекущийНомерСтроки;
					Если ДанныеУчетаВспомогательные.Регистратор <> ТекущийРегистратор ИЛИ 
						ДанныеУчетаВспомогательные.НомерСтроки <> ТекущийНомерСтроки Тогда
						// ищем следующую строку во спомогательной выборке если она не является искомой	
						ДанныеУчетаВспомогательные.НайтиСледующий(СтруктураПоиска);
					КонецЕсли;
					
					СуммаПоСтроке = 0;
					// суммируем базовые ресурсы по текущей строке набора записей
					Пока ДанныеУчетаВспомогательные.Регистратор = ТекущийРегистратор И ДанныеУчетаВспомогательные.НомерСтроки = ТекущийНомерСтроки Цикл
						Если Не ДанныеУчетаВспомогательные.РезультатБаза = NULL Тогда
							СуммаПоСтроке = СуммаПоСтроке + ДанныеУчетаВспомогательные.РезультатБаза;
						КонецЕсли;
						Если Не ДанныеУчетаВспомогательные.Следующий() Тогда
							Прервать;
						КонецЕсли;
					КонецЦикла;
					
					// суммарная доля, которую уже "разбросали" на строки с одинаковым регистратором и номером строки
					СуммарнаяДоля = 0;
					СуммарнаяДоляДополнительныйРезультат = 0;
					// полный результат
					ПолныйРезультат = ДанныеУчета.Результат;
					ПолныйРезультатДополнительныйРезультат = ДанныеУчета.ДополнительныйРезультат;
					// обходим строки и вычисляем долю результата по базовым записям
					ПерваяИзГруппыСтрок = Истина;
					ТекущаяСтрокаДанных = СтрокаДанных;
					ТекущаяСтрокаУчетаПособий = СтрокаУчетаПособий;
					Пока ДанныеУчета.Регистратор = ТекущийРегистратор И ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
						// если это не первая из группы "базовых" строк по одной строке основного регистра
						// то создаем очередную строку движений
						Если Не ПерваяИзГруппыСтрок Тогда
							НоваяСтрокаДанных = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
							НоваяСтрокаУчетаПособий = ПособияПоУходуЗаРебенкомДоПолутораЛет.Добавить();
							ТекущаяСтрокаДанных = НоваяСтрокаДанных;
							ТекущаяСтрокаУчетаПособий = НоваяСтрокаУчетаПособий;
							ЗаполнитьЗначенияСвойств(ТекущаяСтрокаУчетаПособий,СтрокаУчетаПособий);
							ТекущаяСтрокаУчетаПособий.ОблагаетсяЕНВД = Ложь;
						Иначе
							ПерваяИзГруппыСтрок = Ложь;
						КонецЕсли;
						
						ДоляПособияНаПервогоРебенка =  ДанныеУчета.ДоляПособияНаПервогоРебенка;
						
						Если ЗначениеЗаполнено(ДанныеУчета.ПроцентЕНВД) Тогда
							ТекущаяСтрокаДанных.ОблагаетсяЕНВД = Истина;
							ТекущаяСтрокаУчетаПособий.ОблагаетсяЕНВД = Истина;
						КонецЕсли;
						
						Если СуммаПоСтроке = 0 Тогда
							Доля = 0;
							ДоляДополнительныйРезультат = 0;
						Иначе
							Если ДанныеУчета.РезультатБаза = NULL Тогда
								Доля = 0;
								ДоляДополнительныйРезультат = 0;
							Иначе
								Доля = Окр(ПолныйРезультат * ДанныеУчета.РезультатБаза / СуммаПоСтроке,2);
								ДоляДополнительныйРезультат = Окр(ПолныйРезультатДополнительныйРезультат * ДанныеУчета.РезультатБаза / СуммаПоСтроке,2);
							КонецЕсли;
						КонецЕсли;
						
						ТекущаяСтрокаДанных.Результат = ?(ПолныйРезультат > 0,Мин(Доля,ПолныйРезультат - СуммарнаяДоля),Макс(Доля,ПолныйРезультат - СуммарнаяДоля));
						СуммарнаяДоля = СуммарнаяДоля + ТекущаяСтрокаДанных.Результат;
						
						ТекущаяСтрокаСуммаСверхНорм = ?(ПолныйРезультатДополнительныйРезультат > 0,Мин(ДоляДополнительныйРезультат,ПолныйРезультатДополнительныйРезультат - СуммарнаяДоляДополнительныйРезультат),Макс(ДоляДополнительныйРезультат,ПолныйРезультатДополнительныйРезультат - СуммарнаяДоляДополнительныйРезультат));
						СуммарнаяДоляДополнительныйРезультат = СуммарнаяДоляДополнительныйРезультат + ТекущаяСтрокаСуммаСверхНорм;
						
						ТекущаяСтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком = ТекущаяСтрокаДанных.Результат * ДоляПособияНаПервогоРебенка;
						ТекущаяСтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенком = ТекущаяСтрокаДанных.Результат - ТекущаяСтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком;
						ТекущаяСтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм = ТекущаяСтрокаСуммаСверхНорм * ДоляПособияНаПервогоРебенка;
						ТекущаяСтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенкомСверхНорм = ТекущаяСтрокаСуммаСверхНорм - ТекущаяСтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм;
						
						Если Не ДанныеУчета.Следующий() Тогда
							ПродолжатьОбработку = Ложь;
							Прервать;
						КонецЕсли;
					КонецЦикла;
					// ошибки округления складываются на последнюю запись из группы базовых записей
					ТекущаяСтрокаДанных.Результат = ТекущаяСтрокаДанных.Результат + ПолныйРезультат - СуммарнаяДоля;
					
					ТекущаяСтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком = ТекущаяСтрокаДанных.Результат * ДоляПособияНаПервогоРебенка;
					ТекущаяСтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенком = ТекущаяСтрокаДанных.Результат - ТекущаяСтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком;
					ТекущаяСтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм = (ТекущаяСтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм + ПолныйРезультатДополнительныйРезультат - СуммарнаяДоляДополнительныйРезультат)  * ДоляПособияНаПервогоРебенка;
					ТекущаяСтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенкомСверхНорм = ТекущаяСтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм + ПолныйРезультатДополнительныйРезультат - СуммарнаяДоляДополнительныйРезультат - ТекущаяСтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм;
					
				ИначеЕсли ЗначениеЗаполнено(ДанныеУчета.ПроцентЕНВД) Тогда
					
					Если ДанныеУчета.ПроцентЕНВД = 100 Тогда
						
						СтрокаДанных.ОблагаетсяЕНВД = Истина;
						СтрокаУчетаПособий.ОблагаетсяЕНВД = Истина;
						
					Иначе	
						
						// заводим новую строку данных - для ввода доли дохода под ЕНВД
						НоваяСтрока = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
						НоваяСтрока.КодДоходаЕСН = СтрокаДанных.КодДоходаЕСН;
						
						// вычислим результат для дохода под ЕНВД
						РезультатПодЕНВД = Окр(ДанныеУчета.Результат * ДанныеУчета.ПроцентЕНВД / 100,2);
						СкидкаПодЕНВД = Окр(ДанныеУчета.Скидка * ДанныеУчета.ПроцентЕНВД / 100,2);
						
						РезультатПодЕНВДДополнительныйРезультат = Окр(ДанныеУчета.ДополнительныйРезультат * ДанныеУчета.ПроцентЕНВД / 100,2);
						
						// ресурсы
						НоваяСтрока.Результат = РезультатПодЕНВД;
						
						// основной строке данных уменьшаем результат
						СтрокаДанных.Результат = ДанныеУчета.Результат - РезультатПодЕНВД;
						
						СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком = СтрокаДанных.Результат * ДанныеУчета.ДоляПособияНаПервогоРебенка;
						СтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенком = СтрокаДанных.Результат - СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком;
						СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм = (ДанныеУчета.ДополнительныйРезультат - РезультатПодЕНВДДополнительныйРезультат) * ДанныеУчета.ДоляПособияНаПервогоРебенка;
						СтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенкомСверхНорм = (ДанныеУчета.ДополнительныйРезультат - РезультатПодЕНВДДополнительныйРезультат) - СтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм;
						
						// это строка для подпадающего под ЕНВД дохода
						// "обычная строка" уже введена в движения выше
						НоваяСтрока.ОблагаетсяЕНВД = Истина;
						
						// сторка ЕНВД
						НоваяСтрокаУчетаПособий = ПособияПоУходуЗаРебенкомДоПолутораЛет.Добавить();
						ЗаполнитьЗначенияСвойств(НоваяСтрокаУчетаПособий,СтрокаУчетаПособий);
						НоваяСтрокаУчетаПособий.ОблагаетсяЕНВД = НоваяСтрока.ОблагаетсяЕНВД;
						
						НоваяСтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком = НоваяСтрока.Результат * ДанныеУчета.ДоляПособияНаПервогоРебенка;
						НоваяСтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенком = НоваяСтрока.Результат - НоваяСтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенком;
						НоваяСтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм = РезультатПодЕНВДДополнительныйРезультат * ДанныеУчета.ДоляПособияНаПервогоРебенка;
						НоваяСтрокаУчетаПособий.ПособиеПоУходуЗаВторымРебенкомСверхНорм = РезультатПодЕНВДДополнительныйРезультат - НоваяСтрокаУчетаПособий.ПособиеПоУходуЗаПервымРебенкомСверхНорм;
						
					КонецЕсли;
					
				КонецЕсли;	
				
			Иначе 
				
				СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыПоСтраховымВзносам.ПособияЗаСчетФСС;
				СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
				СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетФСС;
				СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
				СтрокаУчетаПособий.СуммаСверхНорм = ДанныеУчета.ДополнительныйРезультат;
				СтрокаУчетаПособий.ОплаченныеДни = ?(ДанныеУчета.Сторно,-ДанныеУчета.ВсегоДнейНетрудоспособности,ДанныеУчета.ВсегоДнейНетрудоспособности);
				СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
				
				Если ЗначениеЗаполнено(ДанныеУчета.ДоляСпособаОтражения) Тогда
					
					// текущий ключ поиска 
					ТекущийРегистратор = ДанныеУчета.Регистратор;
					ТекущийНомерСтроки = ДанныеУчета.НомерСтроки;
					// позиционируемся во вспомогательной выборке по запросу для суммирования "базовых" данных
					СтруктураПоиска.Регистратор = ТекущийРегистратор;
					СтруктураПоиска.НомерСтроки = ТекущийНомерСтроки;
					Если ДанныеУчетаВспомогательные.Регистратор <> ТекущийРегистратор ИЛИ 
						ДанныеУчетаВспомогательные.НомерСтроки <> ТекущийНомерСтроки Тогда
						// ищем следующую строку во спомогательной выборке если она не является искомой	
						ДанныеУчетаВспомогательные.НайтиСледующий(СтруктураПоиска);
					КонецЕсли;
					
					СуммаПоСтроке = 0;
					// суммируем базовые ресурсы по текущей строке набора записей
					Пока ДанныеУчетаВспомогательные.Регистратор = ТекущийРегистратор И ДанныеУчетаВспомогательные.НомерСтроки = ТекущийНомерСтроки Цикл
						Если Не ДанныеУчетаВспомогательные.РезультатБаза = NULL Тогда
							СуммаПоСтроке = СуммаПоСтроке + ДанныеУчетаВспомогательные.РезультатБаза;
						КонецЕсли;
						Если Не ДанныеУчетаВспомогательные.Следующий() Тогда
							Прервать;
						КонецЕсли;
					КонецЦикла;
					
					// суммарная доля, которую уже "разбросали" на строки с одинаковым регистратором и номером строки
					СуммарнаяДоля = 0;
					СуммарнаяДоляДополнительныйРезультат = 0;
					// полный результат
					ПолныйРезультат = ДанныеУчета.Результат;
					ПолныйРезультатДополнительныйРезультат = ДанныеУчета.ДополнительныйРезультат;
					// обходим строки и вычисляем долю результата по базовым записям
					ПерваяИзГруппыСтрок = Истина;
					ТекущаяСтрокаДанных = СтрокаДанных;
					ТекущаяСтрокаУчетаПособий = СтрокаУчетаПособий;
					Пока ДанныеУчета.Регистратор = ТекущийРегистратор И ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
						// если это не первая из группы "базовых" строк по одной строке основного регистра
						// то создаем очередную строку движений
						Если Не ПерваяИзГруппыСтрок Тогда
							НоваяСтрокаДанных = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
							НоваяСтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
							ТекущаяСтрокаДанных = НоваяСтрокаДанных;
							ТекущаяСтрокаУчетаПособий = НоваяСтрокаУчетаПособий;
							ЗаполнитьЗначенияСвойств(ТекущаяСтрокаУчетаПособий,СтрокаУчетаПособий);
							ТекущаяСтрокаУчетаПособий.ОблагаетсяЕНВД = Ложь;
						Иначе
							ПерваяИзГруппыСтрок = Ложь;
						КонецЕсли;
						
						Если ЗначениеЗаполнено(ДанныеУчета.ПроцентЕНВД) Тогда
							ТекущаяСтрокаДанных.ОблагаетсяЕНВД = Истина;
							ТекущаяСтрокаУчетаПособий.ОблагаетсяЕНВД = Истина;
						КонецЕсли;
						
						Если СуммаПоСтроке = 0 Тогда
							Доля = 0;
							ДоляДополнительныйРезультат = 0;
						Иначе
							Если ДанныеУчета.РезультатБаза = NULL Тогда
								Доля = 0;
								ДоляДополнительныйРезультат = 0;
							Иначе
								Доля = Окр(ПолныйРезультат * ДанныеУчета.РезультатБаза / СуммаПоСтроке,2);
								ДоляДополнительныйРезультат = Окр(ПолныйРезультатДополнительныйРезультат * ДанныеУчета.РезультатБаза / СуммаПоСтроке,2);
							КонецЕсли;
						КонецЕсли;
						
						ТекущаяСтрокаДанных.Результат = ?(ПолныйРезультат > 0,Мин(Доля,ПолныйРезультат - СуммарнаяДоля),Макс(Доля,ПолныйРезультат - СуммарнаяДоля));
						ТекущаяСтрокаУчетаПособий.СуммаВсего = ТекущаяСтрокаДанных.Результат;
						СуммарнаяДоля = СуммарнаяДоля + ТекущаяСтрокаДанных.Результат;
						
						ТекущаяСтрокаУчетаПособий.СуммаСверхНорм = ?(ПолныйРезультатДополнительныйРезультат > 0,Мин(ДоляДополнительныйРезультат,ПолныйРезультатДополнительныйРезультат - СуммарнаяДоляДополнительныйРезультат),Макс(ДоляДополнительныйРезультат,ПолныйРезультатДополнительныйРезультат - СуммарнаяДоляДополнительныйРезультат));
						СуммарнаяДоляДополнительныйРезультат = СуммарнаяДоляДополнительныйРезультат + ТекущаяСтрокаУчетаПособий.СуммаСверхНорм;
						
						Если Не ДанныеУчета.Следующий() Тогда
							ПродолжатьОбработку = Ложь;
							Прервать;
						КонецЕсли;
					КонецЦикла;
					// ошибки округления складываются на последнюю запись из группы базовых записей
					ТекущаяСтрокаДанных.Результат = ТекущаяСтрокаДанных.Результат + ПолныйРезультат - СуммарнаяДоля;
					ТекущаяСтрокаУчетаПособий.СуммаВсего = ТекущаяСтрокаДанных.Результат;
					ТекущаяСтрокаУчетаПособий.СуммаСверхНорм = ТекущаяСтрокаУчетаПособий.СуммаСверхНорм + ПолныйРезультатДополнительныйРезультат - СуммарнаяДоляДополнительныйРезультат;
					
				ИначеЕсли ЗначениеЗаполнено(ДанныеУчета.ПроцентЕНВД) Тогда
					
					Если ДанныеУчета.ПроцентЕНВД = 100 Тогда
						
						СтрокаДанных.ОблагаетсяЕНВД = Истина;
						СтрокаУчетаПособий.ОблагаетсяЕНВД = Истина;
						
					Иначе	
						
						// заводим новую строку данных - для ввода доли дохода под ЕНВД
						НоваяСтрока = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
						НоваяСтрока.КодДоходаЕСН = СтрокаДанных.КодДоходаЕСН;
						
						// вычислим результат для дохода под ЕНВД
						РезультатПодЕНВД = Окр(ДанныеУчета.Результат * ДанныеУчета.ПроцентЕНВД / 100,2);
						СкидкаПодЕНВД = Окр(ДанныеУчета.Скидка * ДанныеУчета.ПроцентЕНВД / 100,2);
						
						РезультатПодЕНВДДополнительныйРезультат = Окр(ДанныеУчета.ДополнительныйРезультат * ДанныеУчета.ПроцентЕНВД / 100,2);
						
						// ресурсы
						НоваяСтрока.Результат = РезультатПодЕНВД;
						
						// основной строке данных уменьшаем результат
						СтрокаДанных.Результат = ДанныеУчета.Результат - РезультатПодЕНВД;
						СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
						СтрокаУчетаПособий.СуммаСверхНорм = ДанныеУчета.ДополнительныйРезультат - РезультатПодЕНВДДополнительныйРезультат;
						
						// это строка для подпадающего под ЕНВД дохода
						// "обычная строка" уже введена в движения выше
						НоваяСтрока.ОблагаетсяЕНВД = Истина;
						
						// сторка ЕНВД
						НоваяСтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
						ЗаполнитьЗначенияСвойств(НоваяСтрокаУчетаПособий,СтрокаУчетаПособий);
						НоваяСтрокаУчетаПособий.СуммаВсего = НоваяСтрока.Результат;
						НоваяСтрокаУчетаПособий.СуммаСверхНорм = РезультатПодЕНВДДополнительныйРезультат;
						НоваяСтрокаУчетаПособий.ОблагаетсяЕНВД = НоваяСтрока.ОблагаетсяЕНВД;
						
					КонецЕсли;
					
				КонецЕсли;	
				
			КонецЕсли;
			
			Пока ДанныеУчета.Регистратор = ТекущийРегистратор И ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
				Если Не ДанныеУчета.Следующий() Тогда
					ПродолжатьОбработку = Ложь;
					Прервать;
				КонецЕсли;
			КонецЦикла;
			
			
		ИначеЕсли ДанныеУчета.ВариантОбработкиЗаписиПриОтраженииВРеглУчете = Перечисления.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйЗаСчетРаботодателя Тогда
				
			Если ЗначениеЗаполнено(ДанныеУчета.ДоляСпособаОтражения) Тогда
				
				// текущий ключ поиска 
				ТекущийРегистратор = ДанныеУчета.Регистратор;
				ТекущийНомерСтроки = ДанныеУчета.НомерСтроки;
				// позиционируемся во вспомогательной выборке по запросу для суммирования "базовых" данных
				СтруктураПоиска.Регистратор = ТекущийРегистратор;
				СтруктураПоиска.НомерСтроки = ТекущийНомерСтроки;
				Если ДанныеУчетаВспомогательные.Регистратор <> ТекущийРегистратор ИЛИ 
					ДанныеУчетаВспомогательные.НомерСтроки <> ТекущийНомерСтроки Тогда
					// ищем следующую строку во спомогательной выборке если она не является искомой	
					ДанныеУчетаВспомогательные.НайтиСледующий(СтруктураПоиска);
				КонецЕсли;
				
				СуммаПоСтроке = 0;
				// суммируем базовые ресурсы по текущей строке набора записей
				Пока ДанныеУчетаВспомогательные.Регистратор = ТекущийРегистратор И ДанныеУчетаВспомогательные.НомерСтроки = ТекущийНомерСтроки Цикл
					Если Не ДанныеУчетаВспомогательные.РезультатБаза = NULL Тогда
						СуммаПоСтроке = СуммаПоСтроке + ДанныеУчетаВспомогательные.РезультатБаза;
					КонецЕсли;
					Если Не ДанныеУчетаВспомогательные.Следующий() Тогда
						Прервать;
					КонецЕсли;
				КонецЦикла;
				
				// суммарная доля, которую уже "разбросали" на строки с одинаковым регистратором и номером строки
				СуммарнаяДоля = 0;
				// полный результат
				ПолныйРезультат = ДанныеУчета.Результат;
				// обходим строки и вычисляем долю результата по базовым записям
				ПерваяИзГруппыСтрок = Истина;
				СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
				Пока ДанныеУчета.Регистратор = ТекущийРегистратор И ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
					// если это не первая из группы "базовых" строк по одной строке основного регистра
					// то создаем очередную строку движений
					Если Не ПерваяИзГруппыСтрок Тогда
						СтрокаДанных = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
						СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
					Иначе
						ПерваяИзГруппыСтрок = Ложь;
					КонецЕсли;
					
					Если ЗначениеЗаполнено(ДанныеУчета.ПроцентЕНВД) Тогда
						СтрокаДанных.ОблагаетсяЕНВД = Истина;	
					КонецЕсли;
					
					Если СуммаПоСтроке = 0 Тогда
						Доля = 0;
					Иначе
						Если ДанныеУчета.РезультатБаза = NULL Тогда
							Доля = 0;
						Иначе
							Доля = Окр(ПолныйРезультат * ДанныеУчета.РезультатБаза / СуммаПоСтроке,2);
						КонецЕсли;
					КонецЕсли;
					
					СтрокаДанных.Результат = ?(ПолныйРезультат > 0,Мин(Доля,ПолныйРезультат - СуммарнаяДоля),Макс(Доля,ПолныйРезультат - СуммарнаяДоля));
					СуммарнаяДоля = СуммарнаяДоля + СтрокаДанных.Результат;
					
					ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
					СтрокаУчетаПособий.ОблагаетсяЕНВД = СтрокаДанных.ОблагаетсяЕНВД;
					СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетРаботодателя;
					СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
					СтрокаУчетаПособий.СуммаСверхНорм = 0;
					СтрокаУчетаПособий.ВыплатаЗаСчетФедеральногоБюджета = Перечисления.ВыплатыПособийЗаСчетФедеральногоБюджета.ПустаяСсылка();
					СтрокаУчетаПособий.ВидПособияСоциальногоСтрахования = Перечисления.ВидыПособийСоциальногоСтрахования.Нетрудоспособность;
					СтрокаУчетаПособий.ОплаченныеДни = ДанныеУчета.ВсегоДнейНетрудоспособности;
					СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
					
					Если Не ДанныеУчета.Следующий() Тогда
						ПродолжатьОбработку = Ложь;
						Прервать;
					КонецЕсли;
				КонецЦикла;
				// ошибки округления складываются на последнюю запись из группы базовых записей
				СтрокаДанных.Результат = СтрокаДанных.Результат + ПолныйРезультат - СуммарнаяДоля;
				СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
				
			ИначеЕсли ЗначениеЗаполнено(ДанныеУчета.ПроцентЕНВД) и ДанныеУчета.ПроцентЕНВД < 100 Тогда
				
				СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
				СтрокаУчетаПособий.ОблагаетсяЕНВД = СтрокаДанных.ОблагаетсяЕНВД;
				СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетРаботодателя;
				СтрокаУчетаПособий.СуммаСверхНорм = 0;
				СтрокаУчетаПособий.ВыплатаЗаСчетФедеральногоБюджета = Перечисления.ВыплатыПособийЗаСчетФедеральногоБюджета.ПустаяСсылка();
				СтрокаУчетаПособий.ВидПособияСоциальногоСтрахования = Перечисления.ВидыПособийСоциальногоСтрахования.Нетрудоспособность;
				СтрокаУчетаПособий.ОплаченныеДни = ДанныеУчета.ВсегоДнейНетрудоспособности;
				СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
				
				// заводим новую строку данных - для ввода доли дохода под ЕНВД
				НоваяСтрока = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
				
				// вычислим результат для дохода под ЕНВД
				РезультатПодЕНВД = Окр(ДанныеУчета.Результат * ДанныеУчета.ПроцентЕНВД / 100,2);
				СкидкаПодЕНВД = Окр(ДанныеУчета.Скидка * ДанныеУчета.ПроцентЕНВД / 100,2);
				// ресурсы
				НоваяСтрока.Результат = РезультатПодЕНВД;
				
				// основной строке данных уменьшаем результат
				СтрокаДанных.Результат = ДанныеУчета.Результат - РезультатПодЕНВД;
				СтрокаУчетаПособий.СуммаВсего = СтрокаДанных.Результат;
				
				// это строка для подпадающего под ЕНВД дохода
				// "обычная строка" уже введена в движения выше
				НоваяСтрока.ОблагаетсяЕНВД = Истина;
				
				// сторка ЕНВД
				СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
				СтрокаУчетаПособий.ОблагаетсяЕНВД = НоваяСтрока.ОблагаетсяЕНВД;
				СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетРаботодателя;
				СтрокаУчетаПособий.СуммаСверхНорм = 0;
				СтрокаУчетаПособий.ВыплатаЗаСчетФедеральногоБюджета = Перечисления.ВыплатыПособийЗаСчетФедеральногоБюджета.ПустаяСсылка();
				СтрокаУчетаПособий.ВидПособияСоциальногоСтрахования = Перечисления.ВидыПособийСоциальногоСтрахования.Нетрудоспособность;
				СтрокаУчетаПособий.ОплаченныеДни = ДанныеУчета.ВсегоДнейНетрудоспособности;
				СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
				СтрокаУчетаПособий.СуммаВсего = НоваяСтрока.Результат;
				
				Если Не ДанныеУчета.Следующий() Тогда
					ПродолжатьОбработку = Ложь;
				КонецЕсли;	
				
			Иначе
				
				СтрокаДанных.ОблагаетсяЕНВД = ВыделятьЕНВД и ДанныеУчета.ПроцентЕНВД = 100;
				
				ТекущийРегистратор = ДанныеУчета.Регистратор;
				ТекущийНомерСтроки = ДанныеУчета.НомерСтроки;
				
				СтрокаУчетаПособий = ПособияСоциальномуСтрахованию.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаУчетаПособий,ДанныеУчета);
				СтрокаУчетаПособий.ОблагаетсяЕНВД = СтрокаДанных.ОблагаетсяЕНВД;
				СтрокаУчетаПособий.СпособФинансированияПособий = Перечисления.СпособыФинансированияПособийСоцстрахования.ЗаСчетРаботодателя;
				СтрокаУчетаПособий.СуммаВсего = ДанныеУчета.Результат;
				СтрокаУчетаПособий.СуммаСверхНорм = 0;
				СтрокаУчетаПособий.ВыплатаЗаСчетФедеральногоБюджета = Перечисления.ВыплатыПособийЗаСчетФедеральногоБюджета.ПустаяСсылка();
				СтрокаУчетаПособий.ВидПособияСоциальногоСтрахования = Перечисления.ВидыПособийСоциальногоСтрахования.Нетрудоспособность;
				СтрокаУчетаПособий.ОплаченныеДни = ДанныеУчета.ВсегоДнейНетрудоспособности;
				СтрокаУчетаПособий.ДатаСтраховогоСлучая = ДанныеУчета.ДатаНачалаСобытия;
				
				Пока ДанныеУчета.Регистратор = ТекущийРегистратор И ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
					Если Не ДанныеУчета.Следующий() Тогда
						ПродолжатьОбработку = Ложь;
						Прервать;
					КонецЕсли;
				КонецЦикла;
				
			КонецЕсли;
			
		ИначеЕсли ЗначениеЗаполнено(ДанныеУчета.ДоляСпособаОтражения)  Тогда
			// необходимо обойти все данные относящиеся к одной строке основного регистра и 
			// выполнить распределение, нормируя на долю 
			
			// текущий ключ поиска 
			ТекущийРегистратор = ДанныеУчета.Регистратор;
			ТекущийНомерСтроки = ДанныеУчета.НомерСтроки;
			// позиционируемся во вспомогательной выборке по запросу для суммирования "базовых" данных
			СтруктураПоиска.Регистратор = ТекущийРегистратор;
			СтруктураПоиска.НомерСтроки = ТекущийНомерСтроки;
			Если ДанныеУчетаВспомогательные.Регистратор <> ТекущийРегистратор ИЛИ 
				ДанныеУчетаВспомогательные.НомерСтроки <> ТекущийНомерСтроки Тогда
				// ищем следующую строку во спомогательной выборке если она не является искомой	
				ДанныеУчетаВспомогательные.НайтиСледующий(СтруктураПоиска);
			КонецЕсли;
			
			СуммаПоСтроке = 0;
			// суммируем базовые ресурсы по текущей строке набора записей
			Пока ДанныеУчетаВспомогательные.Регистратор = ТекущийРегистратор И ДанныеУчетаВспомогательные.НомерСтроки = ТекущийНомерСтроки Цикл
				Если Не ДанныеУчетаВспомогательные.РезультатБаза = NULL Тогда
					СуммаПоСтроке = СуммаПоСтроке + ДанныеУчетаВспомогательные.РезультатБаза;
				КонецЕсли;
				Если Не ДанныеУчетаВспомогательные.Следующий() Тогда
					Прервать;
				КонецЕсли;
			КонецЦикла;
			
			// суммарная доля, которую уже "разбросали" на строки с одинаковым регистратором и номером строки
			СуммарнаяДоля = 0;
			СуммарнаяДоляСкидка = 0;
			
			// полный результат
			ПолныйРезультат = ДанныеУчета.Результат;
			ПолныйРезультатСкидка = ДанныеУчета.Скидка;
			
			// обходим строки и вычисляем долю результата по базовым записям
			ПерваяИзГруппыСтрок = Истина;
			Пока ДанныеУчета.Регистратор = ТекущийРегистратор И ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
				// если это не первая из группы "базовых" строк по одной строке основного регистра
				// то создаем очередную строку движений
				Если Не ПерваяИзГруппыСтрок Тогда
					СтрокаДанных = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
				Иначе
					ПерваяИзГруппыСтрок = Ложь;
				КонецЕсли;
				
				Если ЗначениеЗаполнено(ДанныеУчета.ПроцентЕНВД) Тогда
					СтрокаДанных.ОблагаетсяЕНВД = Истина;	
				КонецЕсли;
				
				Если СуммаПоСтроке = 0 Тогда
					Доля = 0;
				Иначе
					Если ДанныеУчета.РезультатБаза = NULL Тогда
						Доля = 0;
					Иначе
						Доля = Окр(ПолныйРезультат * ДанныеУчета.РезультатБаза / СуммаПоСтроке,2);
					КонецЕсли;
				КонецЕсли;
				
				СтрокаДанных.Результат = ?(ПолныйРезультат > 0,Мин(Доля,ПолныйРезультат - СуммарнаяДоля),Макс(Доля,ПолныйРезультат - СуммарнаяДоля));
				СуммарнаяДоля = СуммарнаяДоля + СтрокаДанных.Результат;
				
				Если Не ЭтоОсновныеНачисления Тогда
					СтрокаДанных.Скидка = ?(ПолныйРезультатСкидка > 0,Мин(Доля,ПолныйРезультатСкидка - СуммарнаяДоляСкидка),Макс(Доля,ПолныйРезультатСкидка - СуммарнаяДоляСкидка));
					СуммарнаяДоляСкидка = СуммарнаяДоляСкидка + СтрокаДанных.Скидка;
				КонецЕсли;
				
				Если Не ДанныеУчета.Следующий() Тогда
					ПродолжатьОбработку = Ложь;
					Прервать;
				КонецЕсли;
			КонецЦикла;
			// ошибки округления складываются на последнюю запись из группы базовых записей
			СтрокаДанных.Результат = СтрокаДанных.Результат + ПолныйРезультат - СуммарнаяДоля;
			Если Не ЭтоОсновныеНачисления Тогда
				СтрокаДанных.Скидка = СтрокаДанных.Скидка + ПолныйРезультатСкидка - СуммарнаяДоляСкидка;
			КонецЕсли;
			
		ИначеЕсли ДанныеУчета.КодДоходаЕСН <> РаспределятьПоБазовымНачислениям 
			И ДанныеУчета.СтратегияОтраженияВУчете <> Перечисления.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления
			И ЗначениеЗаполнено(ДанныеУчета.ПроцентЕНВД) Тогда
			
			// это условие не должно выполняться при обработке вторичных данных 
			// для них всегда КодДоходаЕСН = РаспределятьПоБазовымНачислениям
			
			Если Не ЗначениеЗаполнено(ДанныеУчета.КодДоходаЕСН) Тогда
				// у вида расчета не заполнен реквизит КодДоходаЕСН
				Успешно = Ложь;
				ЗарегистрироватьОшибкуОбработкиДанныхУчета(ТаблицаОшибок, ДанныеУчета, ЭтоОсновныеНачисления, СтруктураПоискаОшибок, 6);
			КонецЕсли;
			
			Если ДанныеУчета.ПроцентЕНВД = 100 Тогда
				// строке данных проставляем признак дохода подпадающего под ЕНВД
				СтрокаДанных.ОблагаетсяЕНВД = Истина;
			Иначе
				// заводим новую строку данных - для ввода доли дохода под ЕНВД
				НоваяСтрока = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
				
				// вычислим результат для дохода под ЕНВД
				РезультатПодЕНВД = Окр(ДанныеУчета.Результат * ДанныеУчета.ПроцентЕНВД / 100,2);
				СкидкаПодЕНВД = Окр(ДанныеУчета.Скидка * ДанныеУчета.ПроцентЕНВД / 100,2);
				// ресурсы
				НоваяСтрока.Результат = РезультатПодЕНВД;
				
				// основной строке данных уменьшаем результат
				СтрокаДанных.Результат = ДанныеУчета.Результат - РезультатПодЕНВД;
				
				Если Не ЭтоОсновныеНачисления Тогда
					НоваяСтрока.Скидка    = СкидкаПодЕНВД;
					СтрокаДанных.Скидка   = ДанныеУчета.Скидка - СкидкаПодЕНВД;
				КонецЕсли;
				
				// это строка для подпадающего под ЕНВД дохода
				// "обычная строка" уже введена в движения выше
				НоваяСтрока.ОблагаетсяЕНВД = Истина;
				
			КонецЕсли;
			
			Если Не ДанныеУчета.Следующий() Тогда
				ПродолжатьОбработку = Ложь;
			КонецЕсли;
			
		ИначеЕсли ДанныеУчета.КодДоходаЕСН = РаспределятьПоБазовымНачислениям 
			ИЛИ ДанныеУчета.СтратегияОтраженияВУчете = Перечисления.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления Тогда
			// тут обрабатываем начисления, которые необходимо отразить в учете как базовые начисления 
			// вычисляем результат нормируя его на базу для строк базы относящихся 
			// к одной строке основного регистра
			
			// текущий ключ поиска 
			// текущий ключ поиска 
			ТекущийРегистратор = ДанныеУчета.Регистратор;
			ТекущийНомерСтроки = ДанныеУчета.НомерСтроки;
			// позиционируемся во вспомогательной выборке по запросу для суммирования "базовых" данных
			СтруктураПоиска.Регистратор = ТекущийРегистратор;
			СтруктураПоиска.НомерСтроки = ТекущийНомерСтроки;
			Если 	ДанныеУчетаВспомогательные.Регистратор <> ТекущийРегистратор ИЛИ 
				ДанныеУчетаВспомогательные.НомерСтроки <> ТекущийНомерСтроки Тогда
				// ищем следующую строку во спомогательной выборке если она не является искомой	
				ДанныеУчетаВспомогательные.НайтиСледующий(СтруктураПоиска);
			КонецЕсли;
			
			СуммаПоСтроке = 0;
			
			// по этим переменным будем уточнять расшифровку ошибки
			НуженКодЕСН 	= Ложь;
			НужнаДоляЕНВД 	= Ложь;
			НеЗаданКодЕСН 	= Ложь;
			
			// суммируем базовые ресурсы по текущей строке набора записей
			Пока ДанныеУчетаВспомогательные.Регистратор = ТекущийРегистратор И ДанныеУчетаВспомогательные.НомерСтроки = ТекущийНомерСтроки Цикл
				Если ДанныеУчетаВспомогательные.РезультатБаза = NULL Тогда
					// ошибки нет в том случае, когда код ЕСН задан явно и ЕНВД не используется
					// собственно проверку и регистрацию ошибки произведем позже
				Иначе
					СуммаПоСтроке = СуммаПоСтроке + ДанныеУчетаВспомогательные.РезультатБаза;
				КонецЕсли;
				
				Если ДанныеУчетаВспомогательные.КодДоходаЕСН = РаспределятьПоБазовымНачислениям и ДанныеУчетаВспомогательные.КодДоходаЕСНРазрез = NULL Тогда
					НуженКодЕСН = Истина;
				ИначеЕсли Не ЗначениеЗаполнено(ДанныеУчетаВспомогательные.КодДоходаЕСН) Тогда
					// у в.р. не задан код ЕСН
					НеЗаданКодЕСН = Истина;
				КонецЕсли;
				
				Если ДанныеУчетаВспомогательные.ОблагаетсяЕНВДРазрез = NULL  и ВыделятьЕНВД Тогда
					НужнаДоляЕНВД = Истина;
				КонецЕсли;
				
				Если Не ДанныеУчетаВспомогательные.Следующий() Тогда
					Прервать;
				КонецЕсли;
			КонецЦикла;
			
			Если НуженКодЕСН или НужнаДоляЕНВД или НеЗаданКодЕСН Тогда
				//есть ошибка, определим код ошибки и зарегистрируем ее
				КодОшибки = ?(НуженКодЕСН и НужнаДоляЕНВД, 3, ?(НужнаДоляЕНВД и НеЗаданКодЕСН, 7, ?(НуженКодЕСН, 4, ?(НужнаДоляЕНВД,5,?(НеЗаданКодЕСН,6,0)))));
				Успешно = Ложь;
				ЗарегистрироватьОшибкуОбработкиДанныхУчета(ТаблицаОшибок, ДанныеУчета, ЭтоОсновныеНачисления, СтруктураПоискаОшибок, КодОшибки);
			КонецЕсли;
			
			// суммарная доля, которую уже "разбросали" на строки с одинаковым регистратором и номером строки
			СуммарнаяДоля = 0;
			// полный результат
			ПолныйРезультат = ДанныеУчета.Результат;
			// обходим строки и вычисляем долю результата по базовым записям
			ПерваяИзГруппыСтрок = Истина;
			Пока ДанныеУчета.Регистратор = ТекущийРегистратор И ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
				// если это не первая из группы "базовых" строк по одной строке основного регистра
				// то создаем очередную строку движений
				Если Не ПерваяИзГруппыСтрок Тогда
					СтрокаДанных = СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления);
				Иначе
					ПерваяИзГруппыСтрок = Ложь;
				КонецЕсли;
				
				Если СуммаПоСтроке = 0 Тогда
					Доля = 0;
				Иначе
					Если ДанныеУчета.РезультатБаза = NULL Тогда
						Доля = 0;
					Иначе
						Доля = Окр(ПолныйРезультат * ДанныеУчета.РезультатБаза / СуммаПоСтроке,2);
					КонецЕсли;
				КонецЕсли;
				
				// вид дохода заполним данными базы
				Если ДанныеУчета.КодДоходаЕСН = РаспределятьПоБазовымНачислениям и ДанныеУчета.КодДоходаЕСНРазрез = NULL Тогда
					НуженКодЕСН = Истина;
					// делаем пустым код дохода ЕСН 
					СтрокаДанных.КодДоходаЕСН  = Справочники.ДоходыПоСтраховымВзносам.ПустаяСсылка();
				ИначеЕсли Не ЗначениеЗаполнено(ДанныеУчета.КодДоходаЕСН) Тогда
					// у в.р. не задан код ЕСН
					НеЗаданКодЕСН = Истина;
				Иначе
					СтрокаДанных.КодДоходаЕСН  = ?(ДанныеУчета.КодДоходаЕСН = РаспределятьПоБазовымНачислениям, ДанныеУчета.КодДоходаЕСНРазрез, ДанныеУчета.КодДоходаЕСН);
				КонецЕсли;
				
				// признак обложения ЕНВД заполним данными базы
				Если ДанныеУчета.ОблагаетсяЕНВДРазрез = NULL Тогда
					Если ВыделятьЕНВД Тогда
						НужнаДоляЕНВД = Истина;
					КонецЕсли;
					СтрокаДанных.ОблагаетсяЕНВД  = Ложь;
				Иначе
					СтрокаДанных.ОблагаетсяЕНВД  = ДанныеУчета.ОблагаетсяЕНВДРазрез;
				КонецЕсли;
				
				СтрокаДанных.Результат = Доля;
				СуммарнаяДоля = СуммарнаяДоля + Доля;
				Если Не ДанныеУчета.Следующий() Тогда
					ПродолжатьОбработку = Ложь;
					Прервать;
				КонецЕсли;
				
			КонецЦикла;
			
			// ошибки округления скаладываются на последнюю запись из группы базовых записей
			СтрокаДанных.Результат = СтрокаДанных.Результат + (ПолныйРезультат - СуммарнаяДоля);
		Иначе
			Если Не ЗначениеЗаполнено(ДанныеУчета.КодДоходаЕСН) Тогда
				// у вида расчета не заполнен реквизит КодДоходаЕСН
				Успешно = Ложь;
				ЗарегистрироватьОшибкуОбработкиДанныхУчета(ТаблицаОшибок, ДанныеУчета, ЭтоОсновныеНачисления, СтруктураПоискаОшибок, 6);
			КонецЕсли;	
			Если Не ДанныеУчета.Следующий() Тогда
				ПродолжатьОбработку = Ложь;
			КонецЕсли;
		КонецЕсли;
		
	КонецЦикла;

	// при записи не затираем уже введенные движения
	НаборЗаписей.Записать(Ложь);// выполняем дозапись (набор записей чистится автоматически)
	
КонецПроцедуры  //ОбработатьДанныеУчета2011

// получение первичных данных для расчета ЕСН
// первичные в данном случае, это те, для которых учет ЕСН <> РаспределятьПоБазовымНачислениям,
// или те которые определяют свой ЕСН-учет по базовым начисленияи и при этом базируются на прошлом периоде, 
// или те у которых категория начисления = "Первичное"
// 
// Параметры:
//	Основные	- булево, если Истина, то получаем данные по основным начислениям иначе - по доп.
//
// Возвращаемое значение:
//	Результат запроса
//
Функция ПолучитьДанныеУчета2011(ВыборкаПоШапкеДокумента, ВыделятьЕНВД, СписокНачислений, ОрганичениеНаСотрудников, ЭтоОсновныеНачисления, ЭтоПервичныеНачисления)
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Запрос.УстановитьПараметр("парамНеОтбиратьСотрудников", ОрганичениеНаСотрудников = Неопределено);
	Запрос.УстановитьПараметр("ОбрабатыватьРаботающихВСтудотряде", Константы.ИспользуетсяТрудРаботающихВСтудотряде.Получить());
	Запрос.УстановитьПараметр("ДатаЗакона213ФЗ", ПроведениеРасчетов.ДатаЗаменыЕСНСтраховымиВзносами());
 	Запрос.УстановитьПараметр("ДатаЗакона343ФЗ", ПроведениеРасчетов.ДатаНачалаРеформыСоцСтрахования());

	Измерения = Новый Массив(1);
	Измерения[0] = "Сотрудник";
	
	Разрезы = Новый Массив(2);
	Разрезы[0] = "КодДоходаЕСН";
	Разрезы[1] = "ОблагаетсяЕНВД";

	Запрос.УстановитьПараметр("парамИзмерения",		Измерения);
	Запрос.УстановитьПараметр("парамРазрезыЕСН",	Разрезы);
	
	Запрос.УстановитьПараметр("парамСписокНачислений", 		СписокНачислений);
	Запрос.УстановитьПараметр("парамПериодРегистрации",		ВыборкаПоШапкеДокумента.ПериодРегистрации);
	Запрос.УстановитьПараметр("парамОрганизация",			ВыборкаПоШапкеДокумента.ОбособленноеПодразделение);
	Запрос.УстановитьПараметр("парамГоловнаяОрганизация",	ВыборкаПоШапкеДокумента.Организация);
	Запрос.УстановитьПараметр("ЕстьЕНВД",					ВыделятьЕНВД);
	
	// для учета особенностей расчета среднего заработка
	ОсновнойЗаработок = Новый Массив(5);
	ОсновнойЗаработок[0] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработку;
	ОсновнойЗаработок[1] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуБЛ;
	ОсновнойЗаработок[2] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуПособий;
	ОсновнойЗаработок[3] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуИндексируемые;
	ОсновнойЗаработок[4] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуПособийС2010;
	
	ПоФиксПремиям = Новый Массив(3);
	ПоФиксПремиям[0] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиям;
	ПоФиксПремиям[1] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиямБЛ;
	ПоФиксПремиям[2] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиямПособий;
	
	ПоПремиям = Новый Массив(6);
	ПоПремиям[0] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиям;
	ПоПремиям[1] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиямБЛ;
	ПоПремиям[2] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиямПособий;
	ПоПремиям[3] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиямИндексируемые;
	ПоПремиям[4] = ПланыВидовРасчета.СреднийЗаработок.ПоГодовойПремииИндексируемые;
	ПоПремиям[5] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиямПособийС2010;
	
	ФиксГодовыеПремии = Новый Массив(5);
	ФиксГодовыеПремии[0] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксГодовойПремии;
	ФиксГодовыеПремии[1] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксГодовойПремииБЛ;
	ФиксГодовыеПремии[2] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксГодовойПремииПособий;
	ФиксГодовыеПремии[3] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиямНеИндексируемые;
	ФиксГодовыеПремии[4] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксГодовойПремииНеИндексируемые;
	
	Запрос.УстановитьПараметр("парамОсновнойЗаработок",	ОсновнойЗаработок);
	Запрос.УстановитьПараметр("парамОсновнойЗаработокНеиндексируемый",	ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуНеИндексируемые);
	Запрос.УстановитьПараметр("парамПоПремиям",			ПоПремиям);
	Запрос.УстановитьПараметр("парамПоФиксПремиям",		ПоФиксПремиям);
	Запрос.УстановитьПараметр("парамПоФиксПремиямНеИндексируемые",	ФиксГодовыеПремии);

	МассивПоСреднемуЗаработку = Новый Массив;
	МассивПоСреднемуЗаработку.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработку);
	МассивПоСреднемуЗаработку.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуДляОтпускаПоКалендарнымДням);
	МассивПоСреднемуЗаработку.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуДляОтпускаПоШестидневке);
	МассивПоСреднемуЗаработку.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС);
	МассивПоСреднемуЗаработку.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ПособиеПоУходуЗаРебенкомДо1_5Лет);
	МассивПоСреднемуЗаработку.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ДоплатаДоСреднегоЗаработка);
	МассивПоСреднемуЗаработку.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ДоплатаДоСреднегоЗаработкаФСС);
	Запрос.УстановитьПараметр("парамПоСреднемуЗаработку", МассивПоСреднемуЗаработку);
	
	
	МассивАвторскихДоходов = Новый Массив;
	МассивАвторскихДоходов.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеАудиовизуальныеПроизведения);
	МассивАвторскихДоходов.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеГрафическиеПроизведения);
	МассивАвторскихДоходов.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеДругиеМузыкальныеПроизведения);
	МассивАвторскихДоходов.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеИсполнениеПроизведений);
	МассивАвторскихДоходов.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеЛитературныеПроизведения);
	МассивАвторскихДоходов.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеМузыкальноСценическиеПроизведение);
	МассивАвторскихДоходов.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеНаучныеТруды);
	МассивАвторскихДоходов.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеОткрытия);
	МассивАвторскихДоходов.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеСкульптуры);
	Запрос.УстановитьПараметр("ДоходыАвторские", МассивАвторскихДоходов);
	
		
	// ФизлицаДляРасчета
	//
	Если ОрганичениеНаСотрудников = Неопределено Тогда
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	НЕОПРЕДЕЛЕНО КАК Сотрудник
		|ПОМЕСТИТЬ ВТСписокСотрудников";
		Запрос.Выполнить();
		
	Иначе
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ТаблицаСотрудников.Сотрудник КАК Сотрудник
		|ПОМЕСТИТЬ ВТСписокСотрудников
		|ИЗ
		|	&парамТаблицаСотрудников КАК ТаблицаСотрудников";
		Запрос.УстановитьПараметр("парамТаблицаСотрудников", ОрганичениеНаСотрудников);
		Запрос.Выполнить();
		
	КонецЕсли;
	
	ВписатьВЗапросСоответствиеКодовЕСНиСтраховыхВзносов(Запрос);
	
	Если ЭтоОсновныеНачисления Тогда
		
		Если Не ЭтоПервичныеНачисления Тогда
			
			//соберем базу для зависимых начислений
			БазаТекст = 
			"ВЫБРАТЬ
			|	База.Регистратор КАК Регистратор,
			|	База.НомерСтроки КАК НомерСтроки,
			|	База.КодДоходаЕСНРазрез,
			|	База.ОблагаетсяЕНВДРазрез,
			|	СУММА(База.РезультатБаза) КАК РезультатБаза
			|ПОМЕСТИТЬ База
			|ИЗ
			|	(ВЫБРАТЬ
			|		ОсновныеНачисленияБазаЕСНОсновныеНачисления.Регистратор КАК Регистратор,
			|		ОсновныеНачисленияБазаЕСНОсновныеНачисления.НомерСтроки КАК НомерСтроки,
			|		ВЫБОР
			|			КОГДА &ОбрабатыватьРаботающихВСтудотряде
			|					И ОсновныеНачисленияБазаЕСНОсновныеНачисления.Сотрудник.ЯвляетсяСтудентомРаботающимВСтудотряде
			|				ТОГДА ВЫБОР
			|						КОГДА ОсновныеНачисленияБазаЕСНОсновныеНачисления.КодДоходаЕСНРазрез = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоговорыГПХ)
			|							ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоГражданскоПравовомуДоговору)
			|						КОГДА ОсновныеНачисленияБазаЕСНОсновныеНачисления.КодДоходаЕСНРазрез = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ОблагаетсяЦеликом)
			|							ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоТрудовомуДоговору)
			|						ИНАЧЕ ОсновныеНачисленияБазаЕСНОсновныеНачисления.КодДоходаЕСНРазрез
			|					КОНЕЦ
			|			ИНАЧЕ ОсновныеНачисленияБазаЕСНОсновныеНачисления.КодДоходаЕСНРазрез
			|		КОНЕЦ КАК КодДоходаЕСНРазрез,
			|		ОсновныеНачисленияБазаЕСНОсновныеНачисления.РезультатБаза КАК РезультатБаза,
			|		ОсновныеНачисленияБазаЕСНОсновныеНачисления.ОблагаетсяЕНВДРазрез КАК ОблагаетсяЕНВДРазрез
			|	ИЗ
			|		РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций.БазаЕСНОсновныеНачисления(
			|				&парамИзмерения,
			|				&парамИзмерения,
			|				&парамРазрезыЕСН,
			|				Организация = &парамГоловнаяОрганизация
			|					И ПериодРегистрации = &парамПериодРегистрации
			|					И (НЕ ВидРасчета.СпособРасчета В (&парамПоСреднемуЗаработку))
			|					И (&парамНеОтбиратьСотрудников
			|						ИЛИ Сотрудник В
			|							(ВЫБРАТЬ
			|								ВТСписокСотрудников.Сотрудник
			|							ИЗ
			|								ВТСписокСотрудников КАК ВТСписокСотрудников))
			|					И (НЕ Сторно)
			|					И ВариантОбработкиЗаписиПриОтраженииВРеглУчете = ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ПустаяСсылка)
			|					И (&ЕстьЕНВД
			|							И ВидРасчета.СтратегияОтраженияВУчете = ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
			|						ИЛИ ВидРасчета.КодДоходаСтраховыеВзносы = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.РаспределятьПоБазовымНачислениям))
			|					И Результат <> 0
			|					И ВидРасчета В (&парамСписокНачислений)) КАК ОсновныеНачисленияБазаЕСНОсновныеНачисления
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ОсновныеНачисленияБазаЕСНДополнительныеНачисления.Регистратор,
			|		ОсновныеНачисленияБазаЕСНДополнительныеНачисления.НомерСтроки,
			|		ВЫБОР
			|			КОГДА &ОбрабатыватьРаботающихВСтудотряде
			|					И ОсновныеНачисленияБазаЕСНДополнительныеНачисления.Сотрудник.ЯвляетсяСтудентомРаботающимВСтудотряде
			|				ТОГДА ВЫБОР
			|						КОГДА ОсновныеНачисленияБазаЕСНДополнительныеНачисления.КодДоходаЕСНРазрез = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоговорыГПХ)
			|							ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоГражданскоПравовомуДоговору)
			|						КОГДА ОсновныеНачисленияБазаЕСНДополнительныеНачисления.КодДоходаЕСНРазрез = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ОблагаетсяЦеликом)
			|							ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоТрудовомуДоговору)
			|						ИНАЧЕ ОсновныеНачисленияБазаЕСНДополнительныеНачисления.КодДоходаЕСНРазрез
			|					КОНЕЦ
			|			ИНАЧЕ ОсновныеНачисленияБазаЕСНДополнительныеНачисления.КодДоходаЕСНРазрез
			|		КОНЕЦ,
			|		ОсновныеНачисленияБазаЕСНДополнительныеНачисления.РезультатБаза,
			|		ОсновныеНачисленияБазаЕСНДополнительныеНачисления.ОблагаетсяЕНВДРазрез
			|	ИЗ
			|		РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций.БазаЕСНДополнительныеНачисления(
			|				&парамИзмерения,
			|				&парамИзмерения,
			|				&парамРазрезыЕСН,
			|				Организация = &парамГоловнаяОрганизация
			|					И ПериодРегистрации = &парамПериодРегистрации
			|					И (НЕ ВидРасчета.СпособРасчета В (&парамПоСреднемуЗаработку))
			|					И (&парамНеОтбиратьСотрудников
			|						ИЛИ Сотрудник В
			|							(ВЫБРАТЬ
			|								ВТСписокСотрудников.Сотрудник
			|							ИЗ
			|								ВТСписокСотрудников КАК ВТСписокСотрудников))
			|					И (НЕ Сторно)
			|					И (&ЕстьЕНВД
			|							И ВидРасчета.СтратегияОтраженияВУчете = ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
			|						ИЛИ ВидРасчета.КодДоходаСтраховыеВзносы = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.РаспределятьПоБазовымНачислениям))
			|					И Результат <> 0
			|					И ВидРасчета В (&парамСписокНачислений)) КАК ОсновныеНачисленияБазаЕСНДополнительныеНачисления) КАК База
			|
			|СГРУППИРОВАТЬ ПО
			|	База.Регистратор,
			|	База.КодДоходаЕСНРазрез,
			|	База.НомерСтроки,
			|	База.ОблагаетсяЕНВДРазрез
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	Регистратор,
			|	НомерСтроки";
			
		Иначе	
			
			// для первичных начислений не собираем базу	
			БазаТекст = 
			"ВЫБРАТЬ
			|	НЕОПРЕДЕЛЕНО КАК Регистратор,
			|	НЕОПРЕДЕЛЕНО КАК НомерСтроки,
			|	НЕОПРЕДЕЛЕНО КАК КодДоходаЕСНРазрез,
			|	ЛОЖЬ КАК ОблагаетсяЕНВДРазрез,
			|	0 КАК РезультатБаза
			|ПОМЕСТИТЬ База";
			
		КонецЕсли;	
		
		Запрос.Текст = БазаТекст;
		//временная таблица - База
		Запрос.Выполнить();
		

        ///////////////////////////////////////////////////////////////////////////////////
		// ПОЛУЧЕНИЕ БАЗЫ СРЕДНЕГО ЗАРАБОТКА для прочих начислений
		
		ПолучатьБазу = Ложь;
			
		// ВТ_ПрочиеНачисления
		//
		Запрос.Текст =
		"ВЫБРАТЬ
		|	ОсновныеНачисления.Сотрудник,
		|	ОсновныеНачисления.Регистратор,
		|	ОсновныеНачисления.НомерСтроки,
		|	ОсновныеНачисления.ДатаНачалаСобытия,
		|	ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало,
		|	ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание,
		|	ВЫБОР
		|		КОГДА ОсновныеНачисления.ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ДоплатаДоСреднегоЗаработкаФСС)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС)
		|		ИНАЧЕ ОсновныеНачисления.ВидРасчета.СпособРасчета
		|	КОНЕЦ КАК СпособРасчета
		|ПОМЕСТИТЬ ВТ_ПрочиеНачисления
		|ИЗ
		|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|ГДЕ
		|	ОсновныеНачисления.ВидРасчета.СпособРасчета В(&парамПоСреднемуЗаработку)
		|	И (&парамНеОтбиратьСотрудников
		|			ИЛИ ОсновныеНачисления.Сотрудник В
		|				(ВЫБРАТЬ
		|					ВТСписокСотрудников.Сотрудник
		|				ИЗ
		|					ВТСписокСотрудников КАК ВТСписокСотрудников))
		|	И (НЕ ОсновныеНачисления.Сторно)
		|	И ОсновныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|	И ОсновныеНачисления.ПериодРегистрации = &парамПериодРегистрации
		|	И ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете = ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ПустаяСсылка)
		|	И ОсновныеНачисления.ВидРасчета.СтратегияОтраженияВУчете = ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
		|	И ОсновныеНачисления.Результат <> 0
		|	И ОсновныеНачисления.ВидРасчета В(&парамСписокНачислений)";
		Запрос.Выполнить();
		
		// ВТ_СотрудникиПериодыПрочиеНачисления
		// условия для виртуальной таблицы
		Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ОсновныеНачисления.Сотрудник КАК Сотрудник,
		|	ОсновныеНачисления.ДатаНачалаСобытия КАК ДатаНачалаСобытия
		|ПОМЕСТИТЬ ВТ_СотрудникиПериодыПрочиеНачисления
		|ИЗ
		|	ВТ_ПрочиеНачисления КАК ОсновныеНачисления
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Сотрудник,
		|	ДатаНачалаСобытия";
		Результат = Запрос.Выполнить().Выгрузить();
		ПолучатьБазу = Результат[0].Количество > 0;

		Если ПолучатьБазу Тогда
			
			БазаСреднегоЗаработкаПрочиеНачисленияТекст =
			"ВЫБРАТЬ
			|	БазаСреднегоЗаработка.Регистратор КАК Регистратор,
			|	БазаСреднегоЗаработка.НомерСтроки КАК НомерСтроки,
			|	БазаСреднегоЗаработка.КодДоходаЕСНРазрез,
			|	СУММА(БазаСреднегоЗаработка.РезультатБаза) КАК РезультатБаза,
			|	БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез
			|ПОМЕСТИТЬ ВТ_БазаСреднегоЗаработка
			|ИЗ
			|	(ВЫБРАТЬ
			|		ОсновныеНачисления.Регистратор КАК Регистратор,
			|		ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
			|		ВЫБОР
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработок)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|						КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|							ТОГДА 1
			|						ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|					КОНЕЦ
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработокНеиндексируемый)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза
			|			КОГДА БазаСреднегоЗаработка.ЧислоМесяцев = 0
			|				ТОГДА 0
			|			ИНАЧЕ ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиямНеИндексируемые)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					ИНАЧЕ БазаСреднегоЗаработка.РезультатБаза
			|				КОНЕЦ * ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ЧислоМесяцев > БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка
			|						ТОГДА БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка / БазаСреднегоЗаработка.ЧислоМесяцев
			|					ИНАЧЕ 1
			|				КОНЕЦ
			|		КОНЕЦ КАК РезультатБаза,
			|		ВЫБОР
			|			КОГДА &ОбрабатыватьРаботающихВСтудотряде
			|					И ОсновныеНачисления.Сотрудник.ЯвляетсяСтудентомРаботающимВСтудотряде
			|				ТОГДА ВЫБОР
			|						КОГДА БазаСреднегоЗаработка.КодДоходаЕСНРазрез = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоговорыГПХ)
			|							ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоГражданскоПравовомуДоговору)
			|						КОГДА БазаСреднегоЗаработка.КодДоходаЕСНРазрез = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ОблагаетсяЦеликом)
			|							ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоТрудовомуДоговору)
			|						ИНАЧЕ БазаСреднегоЗаработка.КодДоходаЕСНРазрез
			|					КОНЕЦ
			|			ИНАЧЕ БазаСреднегоЗаработка.КодДоходаЕСНРазрез
			|		КОНЕЦ КАК КодДоходаЕСНРазрез,
			|		БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез КАК ОблагаетсяЕНВДРазрез
			|	ИЗ
			|		ВТ_ПрочиеНачисления КАК ОсновныеНачисления
			|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.РасчетСреднегоЗаработка.БазаЕСНОсновныеНачисления(
			|					&парамИзмерения,
			|					&парамИзмерения,
			|					&парамРазрезыЕСН,
			|					Организация = &парамГоловнаяОрганизация
			|						И Результат <> 0
			|						И ПериодРегистрации = &парамПериодРегистрации
			|						И (Сотрудник, ДатаНачалаСобытия) В
			|							(ВЫБРАТЬ
			|								Список.Сотрудник,
			|								Список.ДатаНачалаСобытия
			|							ИЗ
			|								ВТ_СотрудникиПериодыПрочиеНачисления КАК Список)) КАК БазаСреднегоЗаработка
			|			ПО ОсновныеНачисления.СпособРасчета = БазаСреднегоЗаработка.СпособРасчета
			|				И ОсновныеНачисления.ДатаНачалаСобытия = БазаСреднегоЗаработка.ДатаНачалаСобытия
			|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало = БазаСреднегоЗаработка.ДатаНачалаРасчетногоПериода
			|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание = БазаСреднегоЗаработка.ДатаОкончанияРасчетногоПериода
			|				И ОсновныеНачисления.Сотрудник = БазаСреднегоЗаработка.Сотрудник
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ОсновныеНачисления.Регистратор,
			|		ОсновныеНачисления.НомерСтроки,
			|		ВЫБОР
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработок)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|						КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|							ТОГДА 1
			|						ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|					КОНЕЦ
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработокНеиндексируемый)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза
			|			КОГДА БазаСреднегоЗаработка.ЧислоМесяцев = 0
			|				ТОГДА 0
			|			ИНАЧЕ ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиямНеИндексируемые)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					ИНАЧЕ БазаСреднегоЗаработка.РезультатБаза
			|				КОНЕЦ * ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ЧислоМесяцев > БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка
			|						ТОГДА БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка / БазаСреднегоЗаработка.ЧислоМесяцев
			|					ИНАЧЕ 1
			|				КОНЕЦ
			|		КОНЕЦ,
			|		ВЫБОР
			|			КОГДА &ОбрабатыватьРаботающихВСтудотряде
			|					И ОсновныеНачисления.Сотрудник.ЯвляетсяСтудентомРаботающимВСтудотряде
			|				ТОГДА ВЫБОР
			|						КОГДА БазаСреднегоЗаработка.КодДоходаЕСНРазрез = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоговорыГПХ)
			|							ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоГражданскоПравовомуДоговору)
			|						КОГДА БазаСреднегоЗаработка.КодДоходаЕСНРазрез = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ОблагаетсяЦеликом)
			|							ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоТрудовомуДоговору)
			|						ИНАЧЕ БазаСреднегоЗаработка.КодДоходаЕСНРазрез
			|					КОНЕЦ
			|			ИНАЧЕ БазаСреднегоЗаработка.КодДоходаЕСНРазрез
			|		КОНЕЦ,
			|		БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез
			|	ИЗ
			|		ВТ_ПрочиеНачисления КАК ОсновныеНачисления
			|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.РасчетСреднегоЗаработка.БазаЕСНДополнительныеНачисления(
			|					&парамИзмерения,
			|					&парамИзмерения,
			|					&парамРазрезыЕСН,
			|					Организация = &парамГоловнаяОрганизация
			|						И Результат <> 0
			|						И ПериодРегистрации = &парамПериодРегистрации
			|						И (Сотрудник, ДатаНачалаСобытия) В
			|							(ВЫБРАТЬ
			|								Список.Сотрудник,
			|								Список.ДатаНачалаСобытия
			|							ИЗ
			|								ВТ_СотрудникиПериодыПрочиеНачисления КАК Список)) КАК БазаСреднегоЗаработка
			|			ПО ОсновныеНачисления.СпособРасчета = БазаСреднегоЗаработка.СпособРасчета
			|				И ОсновныеНачисления.ДатаНачалаСобытия = БазаСреднегоЗаработка.ДатаНачалаСобытия
			|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало = БазаСреднегоЗаработка.ДатаНачалаРасчетногоПериода
			|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание = БазаСреднегоЗаработка.ДатаОкончанияРасчетногоПериода
			|				И ОсновныеНачисления.Сотрудник = БазаСреднегоЗаработка.Сотрудник) КАК БазаСреднегоЗаработка
			|
			|СГРУППИРОВАТЬ ПО
			|	БазаСреднегоЗаработка.Регистратор,
			|	БазаСреднегоЗаработка.НомерСтроки,
			|	БазаСреднегоЗаработка.КодДоходаЕСНРазрез,
			|	БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	Регистратор,
			|	НомерСтроки";
			
		Иначе	
			
			БазаСреднегоЗаработкаПрочиеНачисленияТекст = 
			"ВЫБРАТЬ
            |   НЕОПРЕДЕЛЕНО КАК Регистратор,
            |   0 КАК НомерСтроки,
            |   НЕОПРЕДЕЛЕНО КАК КодДоходаЕСНРазрез,
			|   ЛОЖЬ КАК ОблагаетсяЕНВДРазрез,
            |   0 КАК РезультатБаза
            |ПОМЕСТИТЬ ВТ_БазаСреднегоЗаработка";
			
		КонецЕсли;	

		Запрос.Текст = БазаСреднегоЗаработкаПрочиеНачисленияТекст;
		//временная таблица - ВТ_БазаСреднегоЗаработка
		Запрос.Выполнить();
		
		// Закончили получение базы среднего заработка для прочих начислений
		///////////////////////////////////////////////////////////////////////////////////
		
		///////////////////////////////////////////////////////////////////////////////////
		//получим отражение в учете сторно записей, не обрабатываем
		//все пособия за счет ФСС и ФСС_НС
		
		//временная таблица - ВТ_ОтражениеВУчетеСторно
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ОсновныеНачисления.Регистратор КАК Регистратор,
		|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ОсновныеНачисления.Сотрудник КАК Сотрудник,
		|	ОсновныеНачисления.ОбособленноеПодразделение,
		|	ОсновныеНачисления.ПериодДействияНачало КАК ПериодДействияНачало,
		|	ОсновныеНачисления.ПериодДействияКонец КАК ПериодДействияКонец,
		|	ОсновныеНачисления.ВидРасчета КАК ВидРасчета,
		|	ОсновныеНачисления.СторнируемыйДокумент КАК СторнируемыйДокумент,
		|	ОсновныеНачисления.ВидРасчета.СпособРасчета КАК ВидРасчетаСпособРасчета
		|ПОМЕСТИТЬ ВТ_ОсновныеНачисленияСторно
		|ИЗ
		|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|ГДЕ
		|	ОсновныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|	И ОсновныеНачисления.ПериодРегистрации = &парамПериодРегистрации
		|	И (&парамНеОтбиратьСотрудников
		|			ИЛИ ОсновныеНачисления.Сотрудник В
		|				(ВЫБРАТЬ
		|					ВТСписокСотрудников.Сотрудник
		|				ИЗ
		|					ВТСписокСотрудников КАК ВТСписокСотрудников))
		|	И (НЕ ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.НеОбрабатывать), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводствеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболеваниеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочийНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенкомНовыйСтраховойСлучай)))
		|	И ОсновныеНачисления.Результат <> 0
		|	И ОсновныеНачисления.Сторно
		|	И ОсновныеНачисления.ВидРасчета В(&парамСписокНачислений)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Сотрудник,
		|	ВидРасчета,
		|	СторнируемыйДокумент,
		|	ПериодДействияНачало,
		|	ПериодДействияКонец
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ОсновныеНачисленияСторно.Сотрудник КАК Сотрудник,
		|	ОсновныеНачисленияСторно.ВидРасчета КАК ВидРасчета,
		|	ОсновныеНачисления.ПериодРегистрации КАК ПериодРегистрации
		|ПОМЕСТИТЬ ВТ_СторноСотрудники
		|ИЗ
		|	ВТ_ОсновныеНачисленияСторно КАК ОсновныеНачисленияСторно
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|		ПО ОсновныеНачисленияСторно.СторнируемыйДокумент = ОсновныеНачисления.Регистратор
		|ГДЕ
		|	ОсновныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Сотрудник,
		|	ВидРасчета,
		|	ПериодРегистрации
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ОсновныеНачисления.Регистратор КАК Регистратор,
		|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ЕСНОсновныеНачисления.КодДоходаЕСН,
		|	ЕСНОсновныеНачисления.ОблагаетсяЕНВД,
		|	ЕСНОсновныеНачисления.ПериодДействияНачало,
		|	ЕСНОсновныеНачисления.ПериодДействияКонец,
		|	ЕСНОсновныеНачисления.Результат
		|ПОМЕСТИТЬ ВТ_ОтражениеВУчетеСторно
		|ИЗ
		|	ВТ_ОсновныеНачисленияСторно КАК ОсновныеНачисления
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			ЕСНОсновныеНачисления.ВидРасчета КАК ВидРасчета,
		|			ЕСНОсновныеНачисления.ПериодДействияНачало КАК ПериодДействияНачало,
		|			ЕСНОсновныеНачисления.ПериодДействияКонец КАК ПериодДействияКонец,
		|			ЕСНОсновныеНачисления.Сотрудник КАК Сотрудник,
		|			ЕСНОсновныеНачисления.Результат КАК Результат,
		|			СоответствиеКодов.ВидПоСтраховымВзносам КАК КодДоходаЕСН,
		|			ЕСНОсновныеНачисления.ОблагаетсяЕНВД КАК ОблагаетсяЕНВД,
		|			ЕСНОсновныеНачисления.ДокументОснование КАК ДокументОснование
		|		ИЗ
		|			РегистрРасчета.ЕСНОсновныеНачисления КАК ЕСНОсновныеНачисления
		|				ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКодовЕСНиСтраховыхВзносов КАК СоответствиеКодов
		|				ПО ЕСНОсновныеНачисления.КодДоходаЕСН = СоответствиеКодов.КодДоходаЕСН
		|		ГДЕ
		|			(ЕСНОсновныеНачисления.ПериодРегистрации, ЕСНОсновныеНачисления.Сотрудник, ЕСНОсновныеНачисления.ВидРасчета) В
		|					(ВЫБРАТЬ
		|						ОсновныеНачисления.ПериодРегистрации,
		|						ОсновныеНачисления.Сотрудник,
		|						ОсновныеНачисления.ВидРасчета
		|					ИЗ
		|						ВТ_СторноСотрудники КАК ОсновныеНачисления)
		|			И (НЕ ЕСНОсновныеНачисления.Сторно)) КАК ЕСНОсновныеНачисления
		|		ПО ОсновныеНачисления.ВидРасчета = ЕСНОсновныеНачисления.ВидРасчета
		|			И ОсновныеНачисления.Сотрудник = ЕСНОсновныеНачисления.Сотрудник
		|			И (ОсновныеНачисления.СторнируемыйДокумент = ЕСНОсновныеНачисления.ДокументОснование
		|				ИЛИ ОсновныеНачисления.ВидРасчетаСпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.СдельныйЗаработок))
		|			И (ЕСНОсновныеНачисления.ПериодДействияНачало МЕЖДУ ОсновныеНачисления.ПериодДействияНачало И ОсновныеНачисления.ПериодДействияКонец
		|				ИЛИ ОсновныеНачисления.ПериодДействияНачало МЕЖДУ ЕСНОсновныеНачисления.ПериодДействияНачало И ЕСНОсновныеНачисления.ПериодДействияКонец)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	НомерСтроки";
		Запрос.Выполнить();
		
		//получили отражение в учете сторно записей, кроме пособий
		///////////////////////////////////////////////////////////////////////////////////
		
		///////////////////////////////////////////////////////////////////////////////////
		// ПОЛУЧЕНИЕ СПОСОБОВ ОТРАЖЕНИЯ В УЧЕТЕ ПЛАНОВЫХ НАЧИСЛЕНИЙ
		// таблица ВТ_УчетПлановыхНачислений
		
		УчетПлановыхНачисленийТекст =
		"ВЫБРАТЬ
		|	ОсновныеНачисления.Регистратор КАК Регистратор,
		|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ОсновныеНачисления.Сотрудник КАК Сотрудник,
		|	ВЫБОР
		|		КОГДА ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводствеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболеваниеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочийНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенкомНовыйСтраховойСлучай))
		|				И ОсновныеНачисления.ДатаНачалаСобытия < ОсновныеНачисления.ПериодРегистрации
		|			ТОГДА ОсновныеНачисления.ПериодРегистрации
		|		ИНАЧЕ ОсновныеНачисления.ДатаНачалаСобытия
		|	КОНЕЦ КАК ДатаНачалаСобытия,
		|	ОсновныеНачисления.ВидРасчета
		|ПОМЕСТИТЬ ВТ_ОсновыеНачисленияДляПлановый
		|ИЗ
		|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|ГДЕ
		|	ОсновныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|	И ОсновныеНачисления.ПериодРегистрации = &парамПериодРегистрации
		|	И (&парамНеОтбиратьСотрудников
		|			ИЛИ ОсновныеНачисления.Сотрудник В
		|				(ВЫБРАТЬ
		|					ВТСписокСотрудников.Сотрудник
		|				ИЗ
		|					ВТСписокСотрудников КАК ВТСписокСотрудников))
		|	И ОсновныеНачисления.Результат <> 0
		|	И ОсновныеНачисления.ВидРасчета В(&парамСписокНачислений)
		|	И (ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете <> ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.НеОбрабатывать)
		|				И (НЕ ОсновныеНачисления.Сторно)
		|			ИЛИ ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводствеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболеваниеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочийНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенкомНовыйСтраховойСлучай)))
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ОсновныеНачисления.Регистратор КАК Регистратор,
		|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ОсновныеНачисления.Сотрудник КАК Сотрудник,
		|	ОсновныеНачисления.ВидРасчета КАК ВидРасчета,
		|	МАКСИМУМ(РеглУчетПлановыхНачисленийРаботниковОрганизаций.Период) КАК Период
		|ПОМЕСТИТЬ ВТ_СведенияОНачислениях
		|ИЗ
		|	ВТ_ОсновыеНачисленияДляПлановый КАК ОсновныеНачисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РеглУчетПлановыхНачисленийРаботниковОрганизаций КАК РеглУчетПлановыхНачисленийРаботниковОрганизаций
		|		ПО ОсновныеНачисления.ВидРасчета = РеглУчетПлановыхНачисленийРаботниковОрганизаций.ВидРасчета
		|			И ОсновныеНачисления.Сотрудник = РеглУчетПлановыхНачисленийРаботниковОрганизаций.Сотрудник
		|
		|СГРУППИРОВАТЬ ПО
		|	ОсновныеНачисления.Регистратор,
		|	ОсновныеНачисления.НомерСтроки,
		|	ОсновныеНачисления.Сотрудник,
		|	ОсновныеНачисления.ВидРасчета
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА РеглУчетПлановыхНачисленийРаботниковОрганизаций.СпособОтраженияВБухучете = ЗНАЧЕНИЕ(Справочник.СпособыОтраженияЗарплатыВРеглУчете.ПустаяСсылка)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.ПустаяСсылка)
		|		ИНАЧЕ РеглУчетПлановыхНачисленийРаботниковОрганизаций.ОтнесениеРасходовКДеятельностиЕНВД
		|	КОНЕЦ КАК ОтнесениеРасходовКДеятельностиЕНВД,
		|	СведенияОНачисленияхСрез.Регистратор КАК Регистратор,
		|	СведенияОНачисленияхСрез.НомерСтроки КАК НомерСтроки
		|ПОМЕСТИТЬ ВТ_УчетПлановыхНачислений
		|ИЗ
		|	РегистрСведений.РеглУчетПлановыхНачисленийРаботниковОрганизаций КАК РеглУчетПлановыхНачисленийРаботниковОрганизаций
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_СведенияОНачислениях КАК СведенияОНачисленияхСрез
		|		ПО (СведенияОНачисленияхСрез.Сотрудник = РеглУчетПлановыхНачисленийРаботниковОрганизаций.Сотрудник)
		|			И (СведенияОНачисленияхСрез.ВидРасчета = РеглУчетПлановыхНачисленийРаботниковОрганизаций.ВидРасчета)
		|			И (СведенияОНачисленияхСрез.Период = РеглУчетПлановыхНачисленийРаботниковОрганизаций.Период)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	НомерСтроки";
		Запрос.Текст = УчетПлановыхНачисленийТекст;
		Запрос.Выполнить();
		
						
		// ПОЛУЧИЛИ СПОСОБЫ ОТРАЖЕНИЯ В УЧЕТЕ ПЛАНОВЫХ НАЧИСЛЕНИЙ
		///////////////////////////////////////////////////////////////////////////////////
		
		ОсновныеНачисленияТекст =
		"ВЫБРАТЬ
		|	ОсновныеНачисления.Регистратор КАК Регистратор,
		|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ОсновныеНачисления.Сотрудник КАК Сотрудник,
		|	ВЫБОР
		|		КОГДА ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводствеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболеваниеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочийНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенкомНовыйСтраховойСлучай))
		|				И ОсновныеНачисления.ДатаНачалаСобытия < ОсновныеНачисления.ПериодРегистрации
		|			ТОГДА ОсновныеНачисления.ПериодРегистрации
		|		ИНАЧЕ ОсновныеНачисления.ДатаНачалаСобытия
		|	КОНЕЦ КАК ДатаНачалаСобытия,
		|	ОсновныеНачисления.ПодразделениеОрганизации,
		|	ОсновныеНачисления.ОбособленноеПодразделение
		|ПОМЕСТИТЬ ВТ_ОсновыеНачисления
		|ИЗ
		|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|ГДЕ
		|	ОсновныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|	И ОсновныеНачисления.ПериодРегистрации = &парамПериодРегистрации
		|	И (&парамНеОтбиратьСотрудников
		|			ИЛИ ОсновныеНачисления.Сотрудник В
		|				(ВЫБРАТЬ
		|					ВТСписокСотрудников.Сотрудник
		|				ИЗ
		|					ВТСписокСотрудников КАК ВТСписокСотрудников))
		|	И ОсновныеНачисления.Результат <> 0
		|	И ОсновныеНачисления.ВидРасчета В(&парамСписокНачислений)
		|	И (ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете <> ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.НеОбрабатывать)
		|				И (НЕ ОсновныеНачисления.Сторно)
		|				И ОсновныеНачисления.ВидРасчета.СтратегияОтраженияВУчете = ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакЗаданоНаНачалоСобытия)
		|			ИЛИ ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводствеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболеваниеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочийНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенкомНовыйСтраховойСлучай)))";
		Запрос.Текст = ОсновныеНачисленияТекст;
		Запрос.Выполнить();
		
		
		///////////////////////////////////////////////////////////////////////////////////
		// ПОЛУЧЕНИЕ СПОСОБОВ ОТРАЖЕНИЯ В УЧЕТЕ ОСНОВНОГО ЗАРАБОТКА РАБОТНИКОВ
		// таблица ВТ_УчетОсновногоЗаработка

		УчетОсновногоЗаработкаТекст = 
		"ВЫБРАТЬ
		|	ОсновныеНачисления.Регистратор КАК Регистратор,
		|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ОсновныеНачисления.Сотрудник КАК Сотрудник,
		|	МАКСИМУМ(УчетЗарВРеглУчете.Период) КАК Период
		|ПОМЕСТИТЬ ВТ_СведенияОРаботниках
		|ИЗ
		|	ВТ_ОсновыеНачисления КАК ОсновныеНачисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаРаботниковОрганизацииВРегламентированномУчете КАК УчетЗарВРеглУчете
		|		ПО ОсновныеНачисления.Сотрудник = УчетЗарВРеглУчете.Сотрудник
		|			И (УчетЗарВРеглУчете.Период <= ОсновныеНачисления.ДатаНачалаСобытия)
		|
		|СГРУППИРОВАТЬ ПО
		|	ОсновныеНачисления.Регистратор,
		|	ОсновныеНачисления.НомерСтроки,
		|	ОсновныеНачисления.Сотрудник
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Сотрудник,
		|	Период
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА УчетЗарВРеглУчете.СпособОтраженияВБухучете = ЗНАЧЕНИЕ(Справочник.СпособыОтраженияЗарплатыВРеглУчете.ПустаяСсылка)
		|			ТОГДА ЛОЖЬ
		|		ИНАЧЕ УчетЗарВРеглУчете.ПодпадаетПодЕНВД
		|	КОНЕЦ КАК ПодпадаетПодЕНВД,
		|	СведенияОРаботникахСрез.Регистратор КАК Регистратор,
		|	СведенияОРаботникахСрез.НомерСтроки КАК НомерСтроки
		|ПОМЕСТИТЬ ВТ_УчетОсновногоЗаработка
		|ИЗ
		|	РегистрСведений.УчетОсновногоЗаработкаРаботниковОрганизацииВРегламентированномУчете КАК УчетЗарВРеглУчете
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_СведенияОРаботниках КАК СведенияОРаботникахСрез
		|		ПО (СведенияОРаботникахСрез.Сотрудник = УчетЗарВРеглУчете.Сотрудник)
		|			И (СведенияОРаботникахСрез.Период = УчетЗарВРеглУчете.Период)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	НомерСтроки";
		Запрос.Текст = УчетОсновногоЗаработкаТекст;
		Запрос.Выполнить();
		
		// ПОЛУЧИЛИ СПОСОБЫ ОТРАЖЕНИЯ В УЧЕТЕ ОСНОВНОГО ЗАРАБОТКА РАБОТНИКОВ
		///////////////////////////////////////////////////////////////////////////////////
		
		///////////////////////////////////////////////////////////////////////////////////
		// ПОЛУЧЕНИЕ СПОСОБОВ ОТРАЖЕНИЯ В УЧЕТЕ ОСНОВНОГО ЗАРАБОТКА ПОДРАЗДЕЛЕНИЯ
		// таблица ВТ_УчетОсновногоЗаработкаПодразделения
		
		УчетОсновногоЗаработкаПодразделенияТекст =
		"ВЫБРАТЬ
		|	ОсновныеНачисления.Регистратор КАК Регистратор,
		|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ОсновныеНачисления.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
		|	МАКСИМУМ(УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.Период) КАК Период
		|ПОМЕСТИТЬ ВТ_СведенияОПодразделениях
		|ИЗ
		|	ВТ_ОсновыеНачисления КАК ОсновныеНачисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации КАК УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации
		|		ПО ОсновныеНачисления.ПодразделениеОрганизации = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.ПодразделениеОрганизации
		|			И (УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.Период <= ОсновныеНачисления.ДатаНачалаСобытия)
		|
		|СГРУППИРОВАТЬ ПО
		|	ОсновныеНачисления.ПодразделениеОрганизации,
		|	ОсновныеНачисления.Регистратор,
		|	ОсновныеНачисления.НомерСтроки
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ПодразделениеОрганизации,
		|	Период
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СведенияОПодразделенияхСрез.Регистратор КАК Регистратор,
		|	СведенияОПодразделенияхСрез.НомерСтроки КАК НомерСтроки,
		|	ВЫБОР
		|		КОГДА УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.СпособОтраженияВБухучете = ЗНАЧЕНИЕ(Справочник.СпособыОтраженияЗарплатыВРеглУчете.ПустаяСсылка)
		|			ТОГДА ЛОЖЬ
		|		ИНАЧЕ УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.ПодпадаетПодЕНВД
		|	КОНЕЦ КАК ПодпадаетПодЕНВД
		|ПОМЕСТИТЬ ВТ_УчетОсновногоЗаработкаПодразделения
		|ИЗ
		|	ВТ_СведенияОПодразделениях КАК СведенияОПодразделенияхСрез
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации КАК УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации
		|		ПО СведенияОПодразделенияхСрез.ПодразделениеОрганизации = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.ПодразделениеОрганизации
		|			И СведенияОПодразделенияхСрез.Период = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.Период
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	НомерСтроки";		
		Запрос.Текст = УчетОсновногоЗаработкаПодразделенияТекст;
		Запрос.Выполнить();
		
		// ПОЛУЧИЛИ СПОСОБЫ ОТРАЖЕНИЯ В УЧЕТЕ ОСНОВНОГО ЗАРАБОТКА ПОДРАЗДЕЛЕНИЯ
		///////////////////////////////////////////////////////////////////////////////////
		
		///////////////////////////////////////////////////////////////////////////////////
		// ПОЛУЧЕНИЕ СПОСОБОВ ОТРАЖЕНИЯ В УЧЕТЕ ОСНОВНОГО ЗАРАБОТКА ОРГАНИЗАЦИИ
		// таблица ВТ_УчетОсновногоЗаработкаОрганизации
		
		УчетОсновногоЗаработкаОрганизацииТекст =
		"ВЫБРАТЬ
		|	ОсновныеНачисления.Регистратор КАК Регистратор,
		|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ОсновныеНачисления.ОбособленноеПодразделение КАК ОбособленноеПодразделение,
		|	МАКСИМУМ(УчетОсновногоЗаработкаОрганизации.Период) КАК Период
		|ПОМЕСТИТЬ ВТ_СведенияПоОрганизации
		|ИЗ
		|	ВТ_ОсновыеНачисления КАК ОсновныеНачисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаОрганизации КАК УчетОсновногоЗаработкаОрганизации
		|		ПО ОсновныеНачисления.ОбособленноеПодразделение = УчетОсновногоЗаработкаОрганизации.Организация
		|			И (УчетОсновногоЗаработкаОрганизации.Период <= ОсновныеНачисления.ДатаНачалаСобытия)
		|
		|СГРУППИРОВАТЬ ПО
		|	ОсновныеНачисления.ОбособленноеПодразделение,
		|	ОсновныеНачисления.Регистратор,
		|	ОсновныеНачисления.НомерСтроки
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ОбособленноеПодразделение,
		|	Период
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СведенияПоОрганизации.Регистратор КАК Регистратор,
		|	СведенияПоОрганизации.НомерСтроки КАК НомерСтроки,
		|	ВЫБОР
		|		КОГДА УчетОсновногоЗаработкаОрганизации.СпособОтраженияВБухучете = ЗНАЧЕНИЕ(Справочник.СпособыОтраженияЗарплатыВРеглУчете.ПустаяСсылка)
		|			ТОГДА ЛОЖЬ
		|		ИНАЧЕ УчетОсновногоЗаработкаОрганизации.ПодпадаетПодЕНВД
		|	КОНЕЦ КАК ПодпадаетПодЕНВД
		|ПОМЕСТИТЬ ВТ_УчетОсновногоЗаработкаОрганизации
		|ИЗ
		|	ВТ_СведенияПоОрганизации КАК СведенияПоОрганизации
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаОрганизации КАК УчетОсновногоЗаработкаОрганизации
		|		ПО СведенияПоОрганизации.ОбособленноеПодразделение = УчетОсновногоЗаработкаОрганизации.Организация
		|			И СведенияПоОрганизации.Период = УчетОсновногоЗаработкаОрганизации.Период
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	НомерСтроки";		
		Запрос.Текст = УчетОсновногоЗаработкаОрганизацииТекст;
		Запрос.Выполнить();
		
		// ПОЛУЧИЛИ СПОСОБЫ ОТРАЖЕНИЯ В УЧЕТЕ ОСНОВНОГО ЗАРАБОТКА ОРГАНИЗАЦИИ
		///////////////////////////////////////////////////////////////////////////////////
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	ОсновныеНачисления.Регистратор КАК Регистратор,
		|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ОсновныеНачисления.Сотрудник КАК Сотрудник,
		|	ОсновныеНачисления.ФизЛицо КАК ФизЛицо,
		|	ВЫБОР
		|		КОГДА ОсновныеНачисления.Сторно
		|			ТОГДА ОтражениеВУчетеСторно.КодДоходаЕСН
		|		КОГДА &ОбрабатыватьРаботающихВСтудотряде
		|				И ОсновныеНачисления.Сотрудник.ЯвляетсяСтудентомРаботающимВСтудотряде
		|			ТОГДА ВЫБОР
		|					КОГДА ОсновныеНачисления.ВидРасчета.КодДоходаСтраховыеВзносы = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоговорыГПХ)
		|						ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоГражданскоПравовомуДоговору)
		|					КОГДА ОсновныеНачисления.ВидРасчета.КодДоходаСтраховыеВзносы = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ОблагаетсяЦеликом)
		|						ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоТрудовомуДоговору)
		|					ИНАЧЕ ОсновныеНачисления.ВидРасчета.КодДоходаСтраховыеВзносы
		|				КОНЕЦ
		|		ИНАЧЕ ОсновныеНачисления.ВидРасчета.КодДоходаСтраховыеВзносы
		|	КОНЕЦ КАК КодДоходаЕСН,
		|	ОтражениеВУчетеСторно.ОблагаетсяЕНВД КАК ОблагаетсяЕНВД,
		|	ВЫБОР
		|		КОГДА (НЕ &ЕстьЕНВД)
		|			ТОГДА 0
		|		КОГДА РеглУчетПлановыхНачисленийРаботниковОрганизаций.ОтнесениеРасходовКДеятельностиЕНВД = ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.РасходыОтносятсяКЕНВД)
		|			ТОГДА 100
		|		КОГДА РеглУчетПлановыхНачисленийРаботниковОрганизаций.ОтнесениеРасходовКДеятельностиЕНВД = ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.РасходыОтносятсяКнеЕНВД)
		|			ТОГДА 0
		|		КОГДА ОсновныеНачисления.ВидРасчета.ОтнесениеРасходовКДеятельностиЕНВД = ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.РасходыОтносятсяКЕНВД)
		|				И ОсновныеНачисления.ВидРасчета.СпособОтраженияВБухучете.СчетДт <> ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяССылка)
		|				И ОсновныеНачисления.ВидРасчета.СпособОтраженияВБухучете.СчетКт <> ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяССылка)
		|				И ОсновныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования = ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка)
		|			ТОГДА 100
		|		КОГДА ОсновныеНачисления.ВидРасчета.ОтнесениеРасходовКДеятельностиЕНВД = ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.РасходыОтносятсяКнеЕНВД)
		|				И ОсновныеНачисления.ВидРасчета.СпособОтраженияВБухучете.СчетДт <> ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяССылка)
		|				И ОсновныеНачисления.ВидРасчета.СпособОтраженияВБухучете.СчетКт <> ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяССылка)
		|				И ОсновныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования = ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка)
		|			ТОГДА 0
		|		КОГДА Распределение.ПодпадаетПодЕНВД ЕСТЬ НЕ NULL 
		|			ТОГДА ВЫБОР
		|					КОГДА Распределение.ПодпадаетПодЕНВД
		|						ТОГДА 100
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		КОГДА ЕНВДПроцент.ПодпадаетПодЕНВД ЕСТЬ НЕ NULL 
		|			ТОГДА ЕНВДПроцент.ПодпадаетПодЕНВД
		|		КОГДА УчетЗарВРеглУчете.ПодпадаетПодЕНВД
		|			ТОГДА 100
		|		КОГДА УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.ПодпадаетПодЕНВД
		|			ТОГДА 100
		|		КОГДА УчетОсновногоЗаработкаОрганизации.ПодпадаетПодЕНВД
		|			ТОГДА 100
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК ПроцентЕНВД,
		|	Распределение.ДоляСпособаОтражения КАК ДоляСпособаОтражения,
		|	ОтражениеВУчетеСторно.Результат КАК РезультатСторно,
		|	ОтражениеВУчетеСторно.ПериодДействияНачало КАК ПериодДействияНачалоСторно,
		|	ОтражениеВУчетеСторно.ПериодДействияКонец КАК ПериодДействияКонецСторно,
		|	ОсновныеНачисления.ВидРасчета КАК ВидРасчета,
		|	ОсновныеНачисления.Организация КАК Организация,
		|	ОсновныеНачисления.Результат КАК Результат,
		|	ОсновныеНачисления.ДополнительныйРезультат,
		|	ОсновныеНачисления.ПериодДействия КАК ПериодДействия,
		|	ОсновныеНачисления.ПериодДействияНачало КАК ПериодДействияНачало,
		|	ОсновныеНачисления.ПериодДействияКонец КАК ПериодДействияКонец,
		|	ОсновныеНачисления.ГрафикРаботы КАК ГрафикРаботы,
		|	ОсновныеНачисления.ВидУчетаВремени КАК ВидУчетаВремени,
		|	ОсновныеНачисления.Сторно КАК Сторно,
		|	ВЫБОР
		|		КОГДА ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводствеНовыйСтраховойСлучай))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве)
		|		КОГДА ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенкомНовыйСтраховойСлучай))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком)
		|		КОГДА ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболеваниеНовыйСтраховойСлучай))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание)
		|		КОГДА ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочийНовыйСтраховойСлучай))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий)
		|		КОГДА ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйЗаСчетРаботодателя), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйЗаСчетРаботодателяНовыйСтраховойСлучай))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйЗаСчетРаботодателя)
		|		ИНАЧЕ ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете
		|	КОНЕЦ КАК ВариантОбработкиЗаписиПриОтраженииВРеглУчете,
		|	ОсновныеНачисления.ВидРасчета.СтратегияОтраженияВУчете КАК СтратегияОтраженияВУчете,
		|	ОсновныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования КАК ВидПособияСоциальногоСтрахования,
		|	ОсновныеНачисления.Показатель1 КАК СреднийДневнойЗаработок,
		|	ОсновныеНачисления.НормаДней КАК НормаДней,
		|	ВЫБОР
		|		КОГДА ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводствеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенкомНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболеваниеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочийНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйЗаСчетРаботодателяНовыйСтраховойСлучай))
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК УчитыватьКакНовыйСтраховойСлучай,
		|	ОсновныеНачисления.ДатаНачалаСобытия КАК ДатаНачалаСобытия,
		|	ОсновныеНачисления.Сотрудник.Наименование КАК СотрудникНаименование
		|ПОМЕСТИТЬ ДанныеУчета
		|ИЗ
		|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_УчетПлановыхНачислений КАК РеглУчетПлановыхНачисленийРаботниковОрганизаций
		|		ПО ОсновныеНачисления.Регистратор = РеглУчетПлановыхНачисленийРаботниковОрганизаций.Регистратор
		|			И ОсновныеНачисления.НомерСтроки = РеглУчетПлановыхНачисленийРаботниковОрганизаций.НомерСтроки
		|			И ((НЕ ОсновныеНачисления.Сторно)
		|				ИЛИ ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводствеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболеваниеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочийНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенкомНовыйСтраховойСлучай)))
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_УчетОсновногоЗаработка КАК УчетЗарВРеглУчете
		|		ПО ОсновныеНачисления.Регистратор = УчетЗарВРеглУчете.Регистратор
		|			И ОсновныеНачисления.НомерСтроки = УчетЗарВРеглУчете.НомерСтроки
		|			И ((НЕ ОсновныеНачисления.Сторно)
		|				ИЛИ ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводствеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболеваниеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочийНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенкомНовыйСтраховойСлучай)))
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаспределениеОсновногоЗаработкаРаботниковОрганизаций КАК Распределение
		|		ПО ОсновныеНачисления.Сотрудник = Распределение.Сотрудник
		|			И (Распределение.ДоляСпособаОтражения <> 0)
		|			И (РеглУчетПлановыхНачисленийРаботниковОрганизаций.ОтнесениеРасходовКДеятельностиЕНВД ЕСТЬ NULL )
		|			И (ОсновныеНачисления.ВидРасчета.СтратегияОтраженияВУчете = ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакЗаданоНаНачалоСобытия)
		|					И (НЕ ОсновныеНачисления.Сторно)
		|					И НАЧАЛОПЕРИОДА(ОсновныеНачисления.ДатаНачалаСобытия, МЕСЯЦ) = Распределение.ПериодРегистрации
		|				ИЛИ ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводствеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболеваниеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочийНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенкомНовыйСтраховойСлучай))
		|					И ОсновныеНачисления.ПериодРегистрации = Распределение.ПериодРегистрации)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_УчетОсновногоЗаработкаПодразделения КАК УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации
		|		ПО ОсновныеНачисления.Регистратор = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.Регистратор
		|			И ОсновныеНачисления.НомерСтроки = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.НомерСтроки
		|			И ((НЕ ОсновныеНачисления.Сторно)
		|				ИЛИ ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводствеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболеваниеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочийНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенкомНовыйСтраховойСлучай)))
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПроцентДеятельностиЕНВДСотрудников КАК ЕНВДПроцент
		|		ПО ОсновныеНачисления.Сотрудник = ЕНВДПроцент.Сотрудник
		|			И ((НЕ ОсновныеНачисления.Сторно)
		|				ИЛИ ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводствеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболеваниеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочийНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенкомНовыйСтраховойСлучай)))
		|			И (ВЫБОР
		|				КОГДА ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводствеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболеваниеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочийНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенкомНовыйСтраховойСлучай))
		|					ТОГДА ОсновныеНачисления.ПериодРегистрации
		|				КОГДА ОсновныеНачисления.ВидРасчета.СтратегияОтраженияВУчете = ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакЗаданоНаНачалоСобытия)
		|					ТОГДА ВЫБОР
		|							КОГДА НАЧАЛОПЕРИОДА(ОсновныеНачисления.ДатаНачалаСобытия, МЕСЯЦ) > ОсновныеНачисления.ПериодРегистрации
		|								ТОГДА ОсновныеНачисления.ПериодРегистрации
		|							ИНАЧЕ НАЧАЛОПЕРИОДА(ОсновныеНачисления.ДатаНачалаСобытия, МЕСЯЦ)
		|						КОНЕЦ
		|				КОГДА ОсновныеНачисления.ПериодДействия > ОсновныеНачисления.ПериодРегистрации
		|					ТОГДА ОсновныеНачисления.ПериодРегистрации
		|				ИНАЧЕ ОсновныеНачисления.ПериодДействия
		|			КОНЕЦ = ЕНВДПроцент.ПериодРегистрации)
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрРасчета.ЕСНОсновныеНачисления КАК ЕСНОсновныеНачисления
		|		ПО ОсновныеНачисления.Сотрудник = ЕСНОсновныеНачисления.Сотрудник
		|			И (ЕСНОсновныеНачисления.ВидРасчета = ОсновныеНачисления.ВидРасчета)
		|			И (ЕСНОсновныеНачисления.ПериодРегистрации = &парамПериодРегистрации)
		|			И (ЕСНОсновныеНачисления.ПериодДействияНачало >= ОсновныеНачисления.ПериодДействияНачало)
		|			И (ЕСНОсновныеНачисления.ПериодДействияКонец <= ОсновныеНачисления.ПериодДействияКонец)
		|			И (ЕСНОсновныеНачисления.ДокументОснование = ОсновныеНачисления.Регистратор)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ОтражениеВУчетеСторно КАК ОтражениеВУчетеСторно
		|		ПО ОсновныеНачисления.Регистратор = ОтражениеВУчетеСторно.Регистратор
		|			И ОсновныеНачисления.НомерСтроки = ОтражениеВУчетеСторно.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_УчетОсновногоЗаработкаОрганизации КАК УчетОсновногоЗаработкаОрганизации
		|		ПО ОсновныеНачисления.Регистратор = УчетОсновногоЗаработкаОрганизации.Регистратор
		|			И ОсновныеНачисления.НомерСтроки = УчетОсновногоЗаработкаОрганизации.НомерСтроки
		|			И ((НЕ ОсновныеНачисления.Сторно)
		|				ИЛИ ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводствеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболеваниеНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочийНовыйСтраховойСлучай), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенкомНовыйСтраховойСлучай)))
		|ГДЕ
		|	ЕСНОсновныеНачисления.Сотрудник ЕСТЬ NULL 
		|	И ОсновныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|	И ОсновныеНачисления.ВидРасчета В(&парамСписокНачислений)
		|	И ОсновныеНачисления.Результат <> 0
		|	И (&парамНеОтбиратьСотрудников
		|			ИЛИ ОсновныеНачисления.Сотрудник В
		|				(ВЫБРАТЬ
		|					ВТСписокСотрудников.Сотрудник
		|				ИЗ
		|					ВТСписокСотрудников КАК ВТСписокСотрудников))
		|	И ОсновныеНачисления.ВариантОбработкиЗаписиПриОтраженииВРеглУчете <> ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.НеОбрабатывать)
		|	И ОсновныеНачисления.ПериодРегистрации = &парамПериодРегистрации
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	НомерСтроки
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ФизическиеЛица.Ссылка КАК Физлицо,
		|	ВЫБОР
		|		КОГДА ФизическиеЛица.ЛьготаПриНачисленииПособий = ЗНАЧЕНИЕ(Перечисление.ВидыЛьготПриНачисленииБольничных.Маяк)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВыплатыПособийЗаСчетФедеральногоБюджета.Маяк)
		|		КОГДА ФизическиеЛица.ЛьготаПриНачисленииПособий = ЗНАЧЕНИЕ(Перечисление.ВидыЛьготПриНачисленииБольничных.ПодразделенияОсобогоРиска)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВыплатыПособийЗаСчетФедеральногоБюджета.ПодразделенияОсобогоРиска)
		|		КОГДА ФизическиеЛица.ЛьготаПриНачисленииПособий = ЗНАЧЕНИЕ(Перечисление.ВидыЛьготПриНачисленииБольничных.Семипалатинск)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВыплатыПособийЗаСчетФедеральногоБюджета.Семипалатинск)
		|		КОГДА ФизическиеЛица.ЛьготаПриНачисленииПособий = ЗНАЧЕНИЕ(Перечисление.ВидыЛьготПриНачисленииБольничных.Чернобыль)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВыплатыПособийЗаСчетФедеральногоБюджета.Чернобыль)
		|		КОГДА ФизическиеЛицаСтажи.НомерСтроки ЕСТЬ НЕ NULL 
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВыплатыПособийЗаСчетФедеральногоБюджета.ЗачетНестраховыхПериодов)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВыплатыПособийЗаСчетФедеральногоБюджета.ПустаяСсылка)
		|	КОНЕЦ КАК ВыплатаЗаСчетФедеральногоБюджета
		|ПОМЕСТИТЬ ВТЛьготыФизлиц
		|ИЗ
		|	Справочник.ФизическиеЛица КАК ФизическиеЛица
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ФизическиеЛица.Стажи КАК ФизическиеЛицаСтажи
		|		ПО ФизическиеЛица.Ссылка = ФизическиеЛицаСтажи.Ссылка
		|			И (ФизическиеЛицаСтажи.ВидСтажа = ЗНАЧЕНИЕ(Справочник.ВидыСтажа.РасширенныйСтраховойСтажДляБЛ))
		|ГДЕ
		|	ФизическиеЛица.Ссылка В
		|			(ВЫБРАТЬ
		|				ДанныеУчета.ФизЛицо
		|			ИЗ
		|				ДанныеУчета КАК ДанныеУчета)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Физлицо
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ОсновныеНачисления.Регистратор КАК Регистратор,
		|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ОсновныеНачисления.ПериодДействия,
		|	ОсновныеНачисления.ПериодДействияНачало,
		|	ОсновныеНачисления.ПериодДействияКонец,
		|	ОсновныеНачисления.Показатель1,
		|	ОсновныеНачисления.Показатель2,
		|	ОсновныеНачисления.Показатель3,
		|	ОсновныеНачисления.Сторно,
		|	ОсновныеНачисления.Результат,
		|	ВЫБОР
		|		КОГДА ОсновныеНачисления.ПодразделениеОрганизации.КодПоОКАТО <> """"
		|			ТОГДА ВЫБОР
		|					КОГДА ОсновныеНачисления.ПодразделениеОрганизации.РайонныйКоэффициентРФ > 1
		|						ТОГДА ОсновныеНачисления.ПодразделениеОрганизации.РайонныйКоэффициентРФ
		|					ИНАЧЕ 1
		|				КОНЕЦ
		|		КОГДА ОсновныеНачисления.ОбособленноеПодразделение.РайонныйКоэффициентРФ > 1
		|			ТОГДА ОсновныеНачисления.ОбособленноеПодразделение.РайонныйКоэффициентРФ
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК РайонныйКоэффициентРФ,
		|	ОсновныеНачисления.ПодразделениеОрганизации.КодПоОКАТО КАК КодПоОКАТОПодразделения,
		|	ВЫРАЗИТЬ(ОсновныеНачисления.Показатель1 * 0.4 * 30.4 КАК ЧИСЛО(15, 2)) КАК МесячноеПособие,
		|	ОсновныеНачисления.ДатаНачалаСобытия
		|ПОМЕСТИТЬ ВТЗаписиПособийПоУходу
		|ИЗ
		|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|ГДЕ
		|	ОсновныеНачисления.ПериодРегистрации = &парамПериодРегистрации
		|	И ОсновныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|	И ОсновныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования = ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПоУходуЗаРебенкомДоПолутораЛет)
		|	И (&парамНеОтбиратьСотрудников
		|			ИЛИ ОсновныеНачисления.Сотрудник В
		|				(ВЫБРАТЬ
		|					ВТСписокСотрудников.Сотрудник
		|				ИЗ
		|					ВТСписокСотрудников КАК ВТСписокСотрудников))
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	НомерСтроки
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ОсновныеНачисления.Регистратор КАК Регистратор,
		|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ВЫБОР
		|		КОГДА ОсновныеНачисления.Результат = 0
		|			ТОГДА 0
		|		КОГДА ОсновныеНачисления.Показатель2 = 0
		|			ТОГДА 0
		|		КОГДА ОсновныеНачисления.Показатель3 = 0
		|			ТОГДА 0
		|		КОГДА ОсновныеНачисления.Показатель2 = ОсновныеНачисления.Показатель3
		|			ТОГДА 1
		|		ИНАЧЕ ВЫБОР
		|				КОГДА ОсновныеНачисления.МесячноеПособие < (ВЫРАЗИТЬ(МинимумПособияПоУходуЗаПервымРебенкомДоПолутораЛет.Размер * ОсновныеНачисления.РайонныйКоэффициентРФ КАК ЧИСЛО(15, 2)))
		|					ТОГДА ВЫРАЗИТЬ(МинимумПособияПоУходуЗаПервымРебенкомДоПолутораЛет.Размер * ОсновныеНачисления.РайонныйКоэффициентРФ КАК ЧИСЛО(15, 2))
		|				КОГДА ОсновныеНачисления.ДатаНачалаСобытия < &ДатаЗакона343ФЗ
		|						И ОсновныеНачисления.МесячноеПособие > (ВЫРАЗИТЬ(МаксимумПособияПоУходуЗаРебенкомДоПолутораЛет.Размер * 0.4 / 12 КАК ЧИСЛО(15, 2)))
		|					ТОГДА ВЫРАЗИТЬ(МаксимумПособияПоУходуЗаРебенкомДоПолутораЛет.Размер * 0.4 / 12 КАК ЧИСЛО(15, 2))
		|				ИНАЧЕ ОсновныеНачисления.МесячноеПособие
		|			КОНЕЦ * ВЫБОР
		|				КОГДА ОсновныеНачисления.ПериодДействияНачало = ОсновныеНачисления.ПериодДействия
		|						И ОсновныеНачисления.ПериодДействияКонец = КОНЕЦПЕРИОДА(ОсновныеНачисления.ПериодДействия, МЕСЯЦ)
		|					ТОГДА 1
		|				ИНАЧЕ РАЗНОСТЬДАТ(ОсновныеНачисления.ПериодДействияНачало, ДОБАВИТЬКДАТЕ(ОсновныеНачисления.ПериодДействияКонец, СЕКУНДА, 1), ДЕНЬ) / РАЗНОСТЬДАТ(ОсновныеНачисления.ПериодДействия, ДОБАВИТЬКДАТЕ(КОНЕЦПЕРИОДА(ОсновныеНачисления.ПериодДействия, МЕСЯЦ), СЕКУНДА, 1), ДЕНЬ)
		|			КОНЕЦ * ВЫБОР
		|				КОГДА ОсновныеНачисления.Сторно
		|					ТОГДА -1
		|				ИНАЧЕ 1
		|			КОНЕЦ / ОсновныеНачисления.Результат
		|	КОНЕЦ КАК ДоляПособияНаПервогоРебенка
		|ПОМЕСТИТЬ РасчетПособийПоУходуЗаПервымРебенком
		|ИЗ
		|	ВТЗаписиПособийПоУходу КАК ОсновныеНачисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			ЗаписиПособийПоУходу.Регистратор КАК Регистратор,
		|			ЗаписиПособийПоУходу.НомерСтроки КАК НомерСтроки,
		|			ГосударственныеПособия.ВидПособия КАК ВидПособия,
		|			МАКСИМУМ(ГосударственныеПособия.Период) КАК ДатаИзмененияРазмераПособия
		|		ИЗ
		|			ВТЗаписиПособийПоУходу КАК ЗаписиПособийПоУходу
		|				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ГосударственныеПособия КАК ГосударственныеПособия
		|				ПО ЗаписиПособийПоУходу.ПериодДействия >= ГосударственныеПособия.Период
		|		ГДЕ
		|			ГосударственныеПособия.ВидПособия = ЗНАЧЕНИЕ(Перечисление.РазмерыГосударственныхПособий.МинимумПособияПоУходуЗаПервымРебенкомДоПолутораЛет)
		|		
		|		СГРУППИРОВАТЬ ПО
		|			ЗаписиПособийПоУходу.Регистратор,
		|			ЗаписиПособийПоУходу.НомерСтроки,
		|			ГосударственныеПособия.ВидПособия) КАК ДатыИзРегистраМинимум
		|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ГосударственныеПособия КАК МинимумПособияПоУходуЗаПервымРебенкомДоПолутораЛет
		|			ПО ДатыИзРегистраМинимум.ВидПособия = МинимумПособияПоУходуЗаПервымРебенкомДоПолутораЛет.ВидПособия
		|				И ДатыИзРегистраМинимум.ДатаИзмененияРазмераПособия = МинимумПособияПоУходуЗаПервымРебенкомДоПолутораЛет.Период
		|		ПО ОсновныеНачисления.Регистратор = ДатыИзРегистраМинимум.Регистратор
		|			И ОсновныеНачисления.НомерСтроки = ДатыИзРегистраМинимум.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПредельнаяВеличинаБазыСтраховыхВзносов.СрезПоследних(&ДатаЗакона213ФЗ, ) КАК МаксимумПособияПоУходуЗаРебенкомДоПолутораЛет
		|		ПО (ИСТИНА)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	НомерСтроки
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДанныеУчета.Регистратор КАК Регистратор,
		|	ДанныеУчета.Регистратор КАК ДокументОснование,
		|	ДанныеУчета.НомерСтроки КАК НомерСтроки,
		|	ДанныеУчета.Сотрудник,
		|	ДанныеУчета.СотрудникНаименование КАК СотрудникНаименование,
		|	ДанныеУчета.ФизЛицо КАК Физлицо,
		|	ДанныеУчета.КодДоходаЕСН,
		|	ДанныеУчета.ОблагаетсяЕНВД КАК ОблагаетсяЕНВД,
		|	ДанныеУчета.РезультатСторно КАК РезультатСторно,
		|	ДанныеУчета.ПроцентЕНВД,
		|	ДанныеУчета.ВидРасчета,
		|	ДанныеУчета.Результат КАК Результат,
		|	ДанныеУчета.ДополнительныйРезультат,
		|	ДанныеУчета.ПериодДействияНачало,
		|	ДанныеУчета.ПериодДействияКонец,
		|	ДанныеУчета.ГрафикРаботы,
		|	ДанныеУчета.Сторно,
		|	ДанныеУчета.ВариантОбработкиЗаписиПриОтраженииВРеглУчете,
		|	ДанныеУчета.СтратегияОтраженияВУчете,
		|	ДанныеУчета.ВидУчетаВремени,
		|	СоответствиеКодов.ВидПоСтраховымВзносам КАК КодДоходаЕСНРазрез,
		|	ЕСТЬNULL(База.ОблагаетсяЕНВДРазрез, БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез) КАК ОблагаетсяЕНВДРазрез,
		|	ВЫБОР
		|		КОГДА ДанныеУчета.ДоляСпособаОтражения ЕСТЬ НЕ NULL 
		|			ТОГДА ДанныеУчета.ДоляСпособаОтражения
		|		КОГДА База.РезультатБаза ЕСТЬ НЕ NULL 
		|			ТОГДА База.РезультатБаза
		|		ИНАЧЕ БазаСреднегоЗаработка.РезультатБаза
		|	КОНЕЦ КАК РезультатБаза,
		|	РАЗНОСТЬДАТ(ДанныеУчета.ПериодДействияНачало, НАЧАЛОПЕРИОДА(ДанныеУчета.ПериодДействияКонец, ДЕНЬ), ДЕНЬ) + 1 КАК ВсегоДнейНетрудоспособности,
		|	РАЗНОСТЬДАТ(ДанныеУчета.ПериодДействияНачалоСторно, НАЧАЛОПЕРИОДА(ДанныеУчета.ПериодДействияКонецСторно, ДЕНЬ), ДЕНЬ) + 1 КАК ВсегоДнейНетрудоспособностиСторно,
		|	ДанныеУчета.НормаДней,
		|	ДанныеУчета.ВидПособияСоциальногоСтрахования,
		|	ЕСТЬNULL(ДанныеУчета.СреднийДневнойЗаработок, 0) КАК СреднийДневнойЗаработок,
		|	ЕСТЬNULL(РасчетПособийПоУходуЗаПервымРебенком.ДоляПособияНаПервогоРебенка, 0) КАК ДоляПособияНаПервогоРебенка,
		|	ДанныеУчета.ДоляСпособаОтражения,
		|	ДанныеУчета.ДатаНачалаСобытия,
		|	ДанныеУчета.УчитыватьКакНовыйСтраховойСлучай,
		|	0 КАК Скидка,
		|	ДанныеУчета.ПериодДействияНачалоСторно КАК ПериодДействияНачалоСторно,
		|	ДанныеУчета.ПериодДействияКонецСторно КАК ПериодДействияКонецСторно,
		|	ЛОЖЬ КАК ЭтоЕдиновременноеПособиеФСС,
		|	ВЫБОР
		|		КОГДА ДанныеУчета.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий))
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ЭтоПособияФСС,
		|	ВЫБОР
		|		КОГДА ДанныеУчета.ВариантОбработкиЗаписиПриОтраженииВРеглУчете В (ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйТравмаНаПроизводстве), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ОтпускПоБеременностиИРодамПоУходуЗаРебенком), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйОбщееЗаболевание), ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.БольничныйПрочий))
		|				И ДанныеУчета.ДополнительныйРезультат <> 0
		|			ТОГДА ЛьготыФизлиц.ВыплатаЗаСчетФедеральногоБюджета
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ КАК ВыплатаЗаСчетФедеральногоБюджета
		|ИЗ
		|	ДанныеУчета КАК ДанныеУчета
		|		ЛЕВОЕ СОЕДИНЕНИЕ База КАК База
		|		ПО ДанныеУчета.Регистратор = База.Регистратор
		|			И ДанныеУчета.НомерСтроки = База.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_БазаСреднегоЗаработка КАК БазаСреднегоЗаработка
		|		ПО ДанныеУчета.Регистратор = БазаСреднегоЗаработка.Регистратор
		|			И ДанныеУчета.НомерСтроки = БазаСреднегоЗаработка.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКодовЕСНиСтраховыхВзносов КАК СоответствиеКодов
		|		ПО (ЕСТЬNULL(База.КодДоходаЕСНРазрез, БазаСреднегоЗаработка.КодДоходаЕСНРазрез) = СоответствиеКодов.КодДоходаЕСН)
		|		ЛЕВОЕ СОЕДИНЕНИЕ РасчетПособийПоУходуЗаПервымРебенком КАК РасчетПособийПоУходуЗаПервымРебенком
		|		ПО ДанныеУчета.Регистратор = РасчетПособийПоУходуЗаПервымРебенком.Регистратор
		|			И ДанныеУчета.НомерСтроки = РасчетПособийПоУходуЗаПервымРебенком.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТЛьготыФизлиц КАК ЛьготыФизлиц
		|		ПО ДанныеУчета.ФизЛицо = ЛьготыФизлиц.Физлицо
		|
		|УПОРЯДОЧИТЬ ПО
		|	СотрудникНаименование,
		|	Регистратор,
		|	НомерСтроки,
		|	КодДоходаЕСНРазрез,
		|	ОблагаетсяЕНВДРазрез
		|АВТОУПОРЯДОЧИВАНИЕ";
		
	Иначе
		
		// обработка дополнительных начислений
		Если Не ЭтоПервичныеНачисления Тогда
			
			//соберем базу для зависимых начислений
			БазаТекст = 
			"ВЫБРАТЬ
			|	База.Регистратор КАК Регистратор,
			|	База.НомерСтроки КАК НомерСтроки,
			|	База.КодДоходаЕСНРазрез,
			|	СУММА(База.РезультатБаза) КАК РезультатБаза,
			|	База.ОблагаетсяЕНВДРазрез
			|ПОМЕСТИТЬ База
			|ИЗ
			|	(ВЫБРАТЬ
			|		ДополнительныеНачисленияБазаЕСНОсновныеНачисления.Регистратор КАК Регистратор,
			|		ДополнительныеНачисленияБазаЕСНОсновныеНачисления.НомерСтроки КАК НомерСтроки,
			|		ВЫБОР
			|			КОГДА &ОбрабатыватьРаботающихВСтудотряде
			|					И ДополнительныеНачисленияБазаЕСНОсновныеНачисления.Сотрудник.ЯвляетсяСтудентомРаботающимВСтудотряде
			|				ТОГДА ВЫБОР
			|						КОГДА ДополнительныеНачисленияБазаЕСНОсновныеНачисления.КодДоходаЕСНРазрез = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоговорыГПХ)
			|							ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоГражданскоПравовомуДоговору)
			|						КОГДА ДополнительныеНачисленияБазаЕСНОсновныеНачисления.КодДоходаЕСНРазрез = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ОблагаетсяЦеликом)
			|							ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоТрудовомуДоговору)
			|						ИНАЧЕ ДополнительныеНачисленияБазаЕСНОсновныеНачисления.КодДоходаЕСНРазрез
			|					КОНЕЦ
			|			ИНАЧЕ ДополнительныеНачисленияБазаЕСНОсновныеНачисления.КодДоходаЕСНРазрез
			|		КОНЕЦ КАК КодДоходаЕСНРазрез,
			|		ДополнительныеНачисленияБазаЕСНОсновныеНачисления.РезультатБаза КАК РезультатБаза,
			|		ДополнительныеНачисленияБазаЕСНОсновныеНачисления.ОблагаетсяЕНВДРазрез КАК ОблагаетсяЕНВДРазрез
			|	ИЗ
			|		РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций.БазаЕСНОсновныеНачисления(
			|				&парамИзмерения,
			|				&парамИзмерения,
			|				&парамРазрезыЕСН,
			|				Организация = &парамГоловнаяОрганизация
			|					И НАЧАЛОПЕРИОДА(ПериодРегистрации, МЕСЯЦ) = &парамПериодРегистрации
			|					И (&парамНеОтбиратьСотрудников
			|						ИЛИ Сотрудник В
			|							(ВЫБРАТЬ
			|								ВТСписокСотрудников.Сотрудник
			|							ИЗ
			|								ВТСписокСотрудников КАК ВТСписокСотрудников))
			|					И (НЕ Сторно)
			|					И ВидРасчета В (&парамСписокНачислений)
			|					И (НЕ ВидРасчета.СпособРасчета В (&парамПоСреднемуЗаработку))
			|					И ВидРасчета.КодДоходаСтраховыеВзносы = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.РаспределятьПоБазовымНачислениям)) КАК ДополнительныеНачисленияБазаЕСНОсновныеНачисления
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ДополнительныеНачисленияБазаЕСНДополнительныеНачисления.Регистратор,
			|		ДополнительныеНачисленияБазаЕСНДополнительныеНачисления.НомерСтроки,
			|		ВЫБОР
			|			КОГДА &ОбрабатыватьРаботающихВСтудотряде
			|					И ДополнительныеНачисленияБазаЕСНДополнительныеНачисления.Сотрудник.ЯвляетсяСтудентомРаботающимВСтудотряде
			|				ТОГДА ВЫБОР
			|						КОГДА ДополнительныеНачисленияБазаЕСНДополнительныеНачисления.КодДоходаЕСНРазрез = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоговорыГПХ)
			|							ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоГражданскоПравовомуДоговору)
			|						КОГДА ДополнительныеНачисленияБазаЕСНДополнительныеНачисления.КодДоходаЕСНРазрез = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ОблагаетсяЦеликом)
			|							ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоТрудовомуДоговору)
			|						ИНАЧЕ ДополнительныеНачисленияБазаЕСНДополнительныеНачисления.КодДоходаЕСНРазрез
			|					КОНЕЦ
			|			ИНАЧЕ ДополнительныеНачисленияБазаЕСНДополнительныеНачисления.КодДоходаЕСНРазрез
			|		КОНЕЦ,
			|		ДополнительныеНачисленияБазаЕСНДополнительныеНачисления.РезультатБаза,
			|		ДополнительныеНачисленияБазаЕСНДополнительныеНачисления.ОблагаетсяЕНВДРазрез
			|	ИЗ
			|		РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций.БазаЕСНДополнительныеНачисления(
			|				&парамИзмерения,
			|				&парамИзмерения,
			|				&парамРазрезыЕСН,
			|				Организация = &парамГоловнаяОрганизация
			|					И НАЧАЛОПЕРИОДА(ПериодРегистрации, МЕСЯЦ) = &парамПериодРегистрации
			|					И (&парамНеОтбиратьСотрудников
			|						ИЛИ Сотрудник В
			|							(ВЫБРАТЬ
			|								ВТСписокСотрудников.Сотрудник
			|							ИЗ
			|								ВТСписокСотрудников КАК ВТСписокСотрудников))
			|					И (НЕ Сторно)
			|					И ВидРасчета В (&парамСписокНачислений)
			|					И (НЕ ВидРасчета.СпособРасчета В (&парамПоСреднемуЗаработку))
			|					И ВидРасчета.КодДоходаСтраховыеВзносы = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.РаспределятьПоБазовымНачислениям)) КАК ДополнительныеНачисленияБазаЕСНДополнительныеНачисления) КАК База
			|
			|СГРУППИРОВАТЬ ПО
			|	База.Регистратор,
			|	База.КодДоходаЕСНРазрез,
			|	База.НомерСтроки,
			|	База.ОблагаетсяЕНВДРазрез
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	Регистратор,
			|	НомерСтроки";
			
		Иначе	
			
			// для первичных начислений не собираем базу	
			БазаТекст = 
			"ВЫБРАТЬ
			|	НЕОПРЕДЕЛЕНО КАК Регистратор,
			|	0 КАК НомерСтроки,
			|	ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ПустаяСсылка) КАК КодДоходаЕСНРазрез,
			|	ЛОЖЬ КАК ОблагаетсяЕНВДРазрез,
			|	0 КАК РезультатБаза
			|ПОМЕСТИТЬ База";
			
		КонецЕсли;
		
		Запрос.Текст = БазаТекст;
		//временная таблица - База
		Запрос.Выполнить();
		
		 ///////////////////////////////////////////////////////////////////////////////////
		// ПОЛУЧЕНИЕ БАЗЫ СРЕДНЕГО ЗАРАБОТКА для прочих начислений
		
		ПолучатьБазу = Ложь;
			
		// ВТ_ПрочиеНачисления
		//
        Запрос.Текст =
        "ВЫБРАТЬ
        |	ДополнительныеНачисления.Сотрудник,
        |	ДополнительныеНачисления.Регистратор,
        |	ДополнительныеНачисления.НомерСтроки,
        |	ДополнительныеНачисления.ДатаНачалаСобытия,
        |	ДополнительныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало,
        |	ДополнительныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание,
        |	ДополнительныеНачисления.ВидРасчета.СпособРасчета КАК СпособРасчета
        |ПОМЕСТИТЬ ВТ_ПрочиеНачисления
        |ИЗ
        |	РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисления
        |ГДЕ
        |	ДополнительныеНачисления.ВидРасчета.СтратегияОтраженияВУчете = ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
        |	И НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) = &парамПериодРегистрации
        |	И (&парамНеОтбиратьСотрудников
        |			ИЛИ ДополнительныеНачисления.Сотрудник В
        |				(ВЫБРАТЬ
        |					ВТСписокСотрудников.Сотрудник
        |				ИЗ
        |					ВТСписокСотрудников КАК ВТСписокСотрудников))
        |	И ДополнительныеНачисления.ОбособленноеПодразделение = &парамОрганизация
        |	И ДополнительныеНачисления.ВидРасчета.СпособРасчета В(&парамПоСреднемуЗаработку)
        |	И ДополнительныеНачисления.ВидРасчета В(&парамСписокНачислений)
        |	И ДополнительныеНачисления.Результат <> 0
        |	И ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования = ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка)
        |	И (НЕ ДополнительныеНачисления.Сторно)";
        Запрос.Выполнить();
		
		// ВТ_СотрудникиПериодыПрочиеНачисления
		// условия для виртуальной таблицы
		Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДополнительныеНачисления.Сотрудник КАК Сотрудник,
		|	ДополнительныеНачисления.ДатаНачалаСобытия КАК ДатаНачалаСобытия
		|ПОМЕСТИТЬ ВТ_СотрудникиПериодыПрочиеНачисления
		|ИЗ
		|	ВТ_ПрочиеНачисления КАК ДополнительныеНачисления
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Сотрудник,
		|	ДатаНачалаСобытия";
		Результат = Запрос.Выполнить().Выгрузить();
		ПолучатьБазу = Результат[0].Количество > 0;

		Если ПолучатьБазу Тогда
			
			БазаСреднегоЗаработкаТекст =
			"ВЫБРАТЬ
			|	БазаСреднегоЗаработка.Регистратор КАК Регистратор,
			|	БазаСреднегоЗаработка.НомерСтроки КАК НомерСтроки,
			|	БазаСреднегоЗаработка.КодДоходаЕСНРазрез,
			|	БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез,
			|	СУММА(БазаСреднегоЗаработка.РезультатБаза) КАК РезультатБаза
			|ПОМЕСТИТЬ ВТ_БазаСреднегоЗаработка
			|ИЗ
			|	(ВЫБРАТЬ
			|		ДополнительныеНачисления.Регистратор КАК Регистратор,
			|		ДополнительныеНачисления.НомерСтроки КАК НомерСтроки,
			|		ВЫБОР
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработок)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|						КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|							ТОГДА 1
			|						ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|					КОНЕЦ
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработокНеиндексируемый)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза
			|			КОГДА БазаСреднегоЗаработка.ЧислоМесяцев = 0
			|				ТОГДА 0
			|			ИНАЧЕ ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиямНеИндексируемые)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					ИНАЧЕ БазаСреднегоЗаработка.РезультатБаза
			|				КОНЕЦ * ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ЧислоМесяцев > БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка
			|						ТОГДА БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка / БазаСреднегоЗаработка.ЧислоМесяцев
			|					ИНАЧЕ 1
			|				КОНЕЦ
			|		КОНЕЦ КАК РезультатБаза,
			|		ВЫБОР
			|			КОГДА &ОбрабатыватьРаботающихВСтудотряде
			|					И ДополнительныеНачисления.Сотрудник.ЯвляетсяСтудентомРаботающимВСтудотряде
			|				ТОГДА ВЫБОР
			|						КОГДА БазаСреднегоЗаработка.КодДоходаЕСНРазрез = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоговорыГПХ)
			|							ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоГражданскоПравовомуДоговору)
			|						КОГДА БазаСреднегоЗаработка.КодДоходаЕСНРазрез = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ОблагаетсяЦеликом)
			|							ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоТрудовомуДоговору)
			|						ИНАЧЕ БазаСреднегоЗаработка.КодДоходаЕСНРазрез
			|					КОНЕЦ
			|			ИНАЧЕ БазаСреднегоЗаработка.КодДоходаЕСНРазрез
			|		КОНЕЦ КАК КодДоходаЕСНРазрез,
			|		БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез КАК ОблагаетсяЕНВДРазрез
			|	ИЗ
			|		ВТ_ПрочиеНачисления КАК ДополнительныеНачисления
			|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.РасчетСреднегоЗаработка.БазаЕСНОсновныеНачисления(
			|					&парамИзмерения,
			|					&парамИзмерения,
			|					&парамРазрезыЕСН,
			|					Организация = &парамГоловнаяОрганизация
			|						И Результат <> 0
			|						И ПериодРегистрации = &парамПериодРегистрации
			|						И (Сотрудник, ДатаНачалаСобытия) В
			|							(ВЫБРАТЬ
			|								Список.Сотрудник,
			|								Список.ДатаНачалаСобытия
			|							ИЗ
			|								ВТ_СотрудникиПериодыПрочиеНачисления КАК Список)) КАК БазаСреднегоЗаработка
			|			ПО ДополнительныеНачисления.СпособРасчета = БазаСреднегоЗаработка.СпособРасчета
			|				И ДополнительныеНачисления.ДатаНачалаСобытия = БазаСреднегоЗаработка.ДатаНачалаСобытия
			|				И ДополнительныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало = БазаСреднегоЗаработка.ДатаНачалаРасчетногоПериода
			|				И ДополнительныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание = БазаСреднегоЗаработка.ДатаОкончанияРасчетногоПериода
			|				И ДополнительныеНачисления.Сотрудник = БазаСреднегоЗаработка.Сотрудник
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ДополнительныеНачисления.Регистратор,
			|		ДополнительныеНачисления.НомерСтроки,
			|		ВЫБОР
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработок)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|						КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|							ТОГДА 1
			|						ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|					КОНЕЦ
			|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамОсновнойЗаработокНеиндексируемый)
			|				ТОГДА БазаСреднегоЗаработка.РезультатБаза
			|			КОГДА БазаСреднегоЗаработка.ЧислоМесяцев = 0
			|				ТОГДА 0
			|			ИНАЧЕ ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиям)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.КоэффициентИндексации < 1
			|									ТОГДА 1
			|								ИНАЧЕ БазаСреднегоЗаработка.КоэффициентИндексации
			|							КОНЕЦ * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&парамПоФиксПремиямНеИндексируемые)
			|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
			|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
			|									ТОГДА 0
			|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
			|							КОНЕЦ
			|					ИНАЧЕ БазаСреднегоЗаработка.РезультатБаза
			|				КОНЕЦ * ВЫБОР
			|					КОГДА БазаСреднегоЗаработка.ЧислоМесяцев > БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка
			|						ТОГДА БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка / БазаСреднегоЗаработка.ЧислоМесяцев
			|					ИНАЧЕ 1
			|				КОНЕЦ
			|		КОНЕЦ,
			|		ВЫБОР
			|			КОГДА &ОбрабатыватьРаботающихВСтудотряде
			|					И ДополнительныеНачисления.Сотрудник.ЯвляетсяСтудентомРаботающимВСтудотряде
			|				ТОГДА ВЫБОР
			|						КОГДА БазаСреднегоЗаработка.КодДоходаЕСНРазрез = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоговорыГПХ)
			|							ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоГражданскоПравовомуДоговору)
			|						КОГДА БазаСреднегоЗаработка.КодДоходаЕСНРазрез = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ОблагаетсяЦеликом)
			|							ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоТрудовомуДоговору)
			|						ИНАЧЕ БазаСреднегоЗаработка.КодДоходаЕСНРазрез
			|					КОНЕЦ
			|			ИНАЧЕ БазаСреднегоЗаработка.КодДоходаЕСНРазрез
			|		КОНЕЦ,
			|		БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез
			|	ИЗ
			|		ВТ_ПрочиеНачисления КАК ДополнительныеНачисления
			|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.РасчетСреднегоЗаработка.БазаЕСНДополнительныеНачисления(
			|					&парамИзмерения,
			|					&парамИзмерения,
			|					&парамРазрезыЕСН,
			|					Организация = &парамГоловнаяОрганизация
			|						И Результат <> 0
			|						И ПериодРегистрации = &парамПериодРегистрации
			|						И (Сотрудник, ДатаНачалаСобытия) В
			|							(ВЫБРАТЬ
			|								Список.Сотрудник,
			|								Список.ДатаНачалаСобытия
			|							ИЗ
			|								ВТ_СотрудникиПериодыПрочиеНачисления КАК Список)) КАК БазаСреднегоЗаработка
			|			ПО ДополнительныеНачисления.ДатаНачалаСобытия = БазаСреднегоЗаработка.ДатаНачалаСобытия
			|				И ДополнительныеНачисления.Сотрудник = БазаСреднегоЗаработка.Сотрудник) КАК БазаСреднегоЗаработка
			|
			|СГРУППИРОВАТЬ ПО
			|	БазаСреднегоЗаработка.Регистратор,
			|	БазаСреднегоЗаработка.НомерСтроки,
			|	БазаСреднегоЗаработка.КодДоходаЕСНРазрез,
			|	БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	Регистратор,
			|	НомерСтроки";
			
		Иначе	
			
			БазаСреднегоЗаработкаТекст = 
			"ВЫБРАТЬ
            |   НЕОПРЕДЕЛЕНО КАК Регистратор,
            |   0 КАК НомерСтроки,
            |   НЕОПРЕДЕЛЕНО КАК КодДоходаЕСНРазрез,
			|   ЛОЖЬ КАК ОблагаетсяЕНВДРазрез,
            |   0 КАК РезультатБаза
            |ПОМЕСТИТЬ ВТ_БазаСреднегоЗаработка";
			
		КонецЕсли;	

		Запрос.Текст = БазаСреднегоЗаработкаТекст;
		//временная таблица - ВТ_БазаСреднегоЗаработка
		Запрос.Выполнить();
		
		// Закончили получение базы среднего заработка для прочих начислений
		///////////////////////////////////////////////////////////////////////////////////

 		ОтражениеВУчетеСторноТекст = 
		"ВЫБРАТЬ
		|	ДополнительныеНачисления.Регистратор КАК Регистратор,
		|	ДополнительныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ДополнительныеНачисления.Сотрудник КАК Сотрудник,
		|	ДополнительныеНачисления.ВидРасчета КАК ВидРасчета,
		|	ДополнительныеНачисления.СторнируемыйДокумент КАК СторнируемыйДокумент
		|ПОМЕСТИТЬ ВТ_ДополнительныеНачисленияСторно
		|ИЗ
		|	РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисления
		|ГДЕ
		|	ДополнительныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|	И НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) = &парамПериодРегистрации
		|	И (&парамНеОтбиратьСотрудников
		|			ИЛИ ДополнительныеНачисления.Сотрудник В
		|				(ВЫБРАТЬ
		|					ВТСписокСотрудников.Сотрудник
		|				ИЗ
		|					ВТСписокСотрудников КАК ВТСписокСотрудников))
		|	И ДополнительныеНачисления.Результат <> 0
		|	И ДополнительныеНачисления.Сторно
		|	И ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования = ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	СторнируемыйДокумент";  
		
		Запрос.Текст = ОтражениеВУчетеСторноТекст;
		//временная таблица - ВТ_ДополнительныеНачисленияСторно
		Результат = Запрос.Выполнить().Выгрузить();
		КоличествоСторноЗаписей = Результат[0].Количество; 
		
		Если КоличествоСторноЗаписей <> 0 Тогда
			
			Запрос.Текст = 
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ДополнительныеНачисленияСторно.Регистратор КАК Регистратор,
			|	ДополнительныеНачисленияСторно.НомерСтроки КАК НомерСтроки,
			|	ДополнительныеНачисленияСторно.Сотрудник КАК Сотрудник,
			|	ДополнительныеНачисленияСторно.ВидРасчета КАК ВидРасчета,
			|	ДополнительныеНачисленияСторно.СторнируемыйДокумент КАК СторнируемыйДокумент,
			|	НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) КАК ПериодРегистрации
			|ПОМЕСТИТЬ ВТ_СторноСотрудники
			|ИЗ
			|	ВТ_ДополнительныеНачисленияСторно КАК ДополнительныеНачисленияСторно
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисления
			|		ПО ДополнительныеНачисленияСторно.СторнируемыйДокумент = ДополнительныеНачисления.Регистратор
			|ГДЕ
			|	ДополнительныеНачисления.ОбособленноеПодразделение = &парамОрганизация
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	Сотрудник,
			|	ВидРасчета,
			|	ПериодРегистрации,
			|	СторнируемыйДокумент";
			
			//временная таблица - ВТ_СторноСотрудники
			Запрос.Выполнить();

			ОтражениеВУчетеСторноТекст = 
			"ВЫБРАТЬ
			|	ДополнительныеНачисления.Регистратор КАК Регистратор,
			|	ДополнительныеНачисления.НомерСтроки КАК НомерСтроки,
			|	ЕСНДополнительныеНачисления.КодДоходаЕСН,
			|	ЕСНДополнительныеНачисления.ОблагаетсяЕНВД,
			|	ЕСНДополнительныеНачисления.Результат
			|ПОМЕСТИТЬ ВТ_ОтражениеВУчетеСторно
			|ИЗ
			|	ВТ_СторноСотрудники КАК ДополнительныеНачисления
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			|			НАЧАЛОПЕРИОДА(ЕСНДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) КАК ПериодРегистрации,
			|			ЕСНДополнительныеНачисления.ВидРасчета КАК ВидРасчета,
			|			ЕСНДополнительныеНачисления.Сотрудник КАК Сотрудник,
			|			ЕСНДополнительныеНачисления.Результат КАК Результат,
			|			СоответствиеКодов.ВидПоСтраховымВзносам КАК КодДоходаЕСН,
			|			ЕСНДополнительныеНачисления.ОблагаетсяЕНВД КАК ОблагаетсяЕНВД,
			|			ЕСНДополнительныеНачисления.ДокументОснование КАК ДокументОснование
			|		ИЗ
			|			РегистрРасчета.ЕСНДополнительныеНачисления КАК ЕСНДополнительныеНачисления
			|				ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКодовЕСНиСтраховыхВзносов КАК СоответствиеКодов
			|				ПО ЕСНДополнительныеНачисления.КодДоходаЕСН = СоответствиеКодов.КодДоходаЕСН
			|		ГДЕ
			|			(ЕСНДополнительныеНачисления.ПериодРегистрации, ЕСНДополнительныеНачисления.Сотрудник, ЕСНДополнительныеНачисления.ВидРасчета) В
			|					(ВЫБРАТЬ
			|						Начисления.ПериодРегистрации,
			|						Начисления.Сотрудник,
			|						Начисления.ВидРасчета
			|					ИЗ
			|						ВТ_СторноСотрудники КАК Начисления)) КАК ЕСНДополнительныеНачисления
			|		ПО ДополнительныеНачисления.ВидРасчета = ЕСНДополнительныеНачисления.ВидРасчета
			|			И ДополнительныеНачисления.Сотрудник = ЕСНДополнительныеНачисления.Сотрудник
			|			И ДополнительныеНачисления.СторнируемыйДокумент = ЕСНДополнительныеНачисления.ДокументОснование
			|			И ДополнительныеНачисления.ПериодРегистрации = ЕСНДополнительныеНачисления.ПериодРегистрации
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	Регистратор,
			|	НомерСтроки";
			
		Иначе
			
			ОтражениеВУчетеСторноТекст = 
			"ВЫБРАТЬ
			|	НЕОПРЕДЕЛЕНО КАК Регистратор,
			|	НЕОПРЕДЕЛЕНО КАК НомерСтроки,
			|	НЕОПРЕДЕЛЕНО КАК КодДоходаЕСН,
			|	ЛОЖЬ КАК ОблагаетсяЕНВД,
			|	0 КАК Результат
			|ПОМЕСТИТЬ ВТ_ОтражениеВУчетеСторно";
			
		КонецЕсли;
		
		Запрос.Текст = ОтражениеВУчетеСторноТекст;
		//временная таблица - ВТ_ОтражениеВУчетеСторно
		Запрос.Выполнить();

		ТекстЗапроса = 
		"ВЫБРАТЬ
		|	ДополнительныеНачисления.Регистратор КАК Регистратор,
		|	ДополнительныеНачисления.НомерСтроки КАК НомерСтроки,
		|	ДополнительныеНачисления.Сотрудник КАК Сотрудник,
		|	ДополнительныеНачисления.ФизЛицо КАК ФизЛицо,
		|	ВЫБОР
		|		КОГДА ДополнительныеНачисления.Сторно
		|				И ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования = ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка)
		|			ТОГДА ОтражениеВУчетеСторно.КодДоходаЕСН
		|		КОГДА &ОбрабатыватьРаботающихВСтудотряде
		|				И ДополнительныеНачисления.Сотрудник.ЯвляетсяСтудентомРаботающимВСтудотряде
		|			ТОГДА ВЫБОР
		|					КОГДА ДополнительныеНачисления.ВидРасчета.КодДоходаСтраховыеВзносы = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоговорыГПХ)
		|						ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоГражданскоПравовомуДоговору)
		|					КОГДА ДополнительныеНачисления.ВидРасчета.КодДоходаСтраховыеВзносы = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ОблагаетсяЦеликом)
		|						ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоТрудовомуДоговору)
		|					ИНАЧЕ ДополнительныеНачисления.ВидРасчета.КодДоходаСтраховыеВзносы
		|				КОНЕЦ
		|		КОГДА &ОбрабатыватьРаботающихВСтудотряде
		|				И ДополнительныеНачисления.ДокументОснование.ВидДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровСФизЛицами.Подряда)
		|				И ДополнительныеНачисления.ДокументОснование.ЗаключенСоСтудентомРаботающимВСтудотряде
		|				И ДополнительныеНачисления.ВидРасчета.КодДоходаСтраховыеВзносы = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоговорыГПХ)
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоходыСтудентовЗаРаботуВСтудотрядеПоГражданскоПравовомуДоговору)
		|		ИНАЧЕ ДополнительныеНачисления.ВидРасчета.КодДоходаСтраховыеВзносы
		|	КОНЕЦ КАК КодДоходаЕСН,
		|	ОтражениеВУчетеСторно.ОблагаетсяЕНВД КАК ОблагаетсяЕНВД,
		|	ОтражениеВУчетеСторно.Результат КАК РезультатСторно,
		|	ВЫБОР
		|		КОГДА (НЕ &ЕстьЕНВД)
		|			ТОГДА 0
		|		КОГДА РеглУчетПлановыхНачисленийРаботниковОрганизаций.ОтнесениеРасходовКДеятельностиЕНВД = ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.РасходыОтносятсяКЕНВД)
		|			ТОГДА 100
		|		КОГДА РеглУчетПлановыхНачисленийРаботниковОрганизаций.ОтнесениеРасходовКДеятельностиЕНВД = ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.РасходыОтносятсяКнеЕНВД)
		|			ТОГДА 0
		|		КОГДА ДополнительныеНачисления.ВидРасчета.ОтнесениеРасходовКДеятельностиЕНВД = ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.РасходыОтносятсяКЕНВД)
		|				И ДополнительныеНачисления.ВидРасчета.СпособОтраженияВБухучете.СчетДт <> ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяССылка)
		|				И ДополнительныеНачисления.ВидРасчета.СпособОтраженияВБухучете.СчетКт <> ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяССылка)
		|				И ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования = ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка)
		|			ТОГДА 100
		|		КОГДА ДополнительныеНачисления.ВидРасчета.ОтнесениеРасходовКДеятельностиЕНВД = ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.РасходыОтносятсяКнеЕНВД)
		|				И ДополнительныеНачисления.ВидРасчета.СпособОтраженияВБухучете.СчетДт <> ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяССылка)
		|				И ДополнительныеНачисления.ВидРасчета.СпособОтраженияВБухучете.СчетКт <> ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяССылка)
		|				И ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования = ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка)
		|			ТОГДА 0
		|		КОГДА Распределение.ПодпадаетПодЕНВД ЕСТЬ НЕ NULL 
		|			ТОГДА ВЫБОР
		|					КОГДА Распределение.ПодпадаетПодЕНВД
		|						ТОГДА 100
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		КОГДА ЕНВДПроцент.ПодпадаетПодЕНВД ЕСТЬ НЕ NULL 
		|			ТОГДА ЕНВДПроцент.ПодпадаетПодЕНВД
		|		КОГДА УчетЗарВРеглУчете.ПодпадаетПодЕНВД ЕСТЬ НЕ NULL 
		|			ТОГДА ВЫБОР
		|					КОГДА УчетЗарВРеглУчете.ПодпадаетПодЕНВД
		|						ТОГДА 100
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		КОГДА УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.ПодпадаетПодЕНВД
		|			ТОГДА 100
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК ПроцентЕНВД,
		|	Распределение.ДоляСпособаОтражения КАК ДоляСпособаОтражения,
		|	ДополнительныеНачисления.ВидРасчета КАК ВидРасчета,
		|	ДополнительныеНачисления.Организация КАК Организация,
		|	ДополнительныеНачисления.Результат КАК Результат,
		|	ДополнительныеНачисления.ВидРасчета.КатегорияРасчета КАК КатегорияРасчета,
		|	ДополнительныеНачисления.ВидРасчета.СтратегияОтраженияВУчете КАК СтратегияОтраженияВУчете,
		|	ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования КАК ВидПособияСоциальногоСтрахования,
		|	ДополнительныеНачисления.Сторно КАК Сторно,
		|	ДополнительныеНачисления.ДатаНачалаСобытия КАК ДатаНачалаСобытия,
		|	ДополнительныеНачисления.ПериодРегистрации КАК ПериодРегистрации,
		|	ВЫБОР
		|		КОГДА ДополнительныеНачисления.ДокументОснование.ВидДоговора ЕСТЬ NULL 
		|			ТОГДА ДополнительныеНачисления.СкидкаПриНалогообложении
		|		КОГДА ДополнительныеНачисления.ДокументОснование.ВидДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровСФизЛицами.Авторский)
		|			ТОГДА ВЫБОР
		|					КОГДА ДополнительныеНачисления.ДокументОснование.ВидАвторскогоДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыАвторскогоДоговора.АвторскогоЗаказа)
		|						ТОГДА ДополнительныеНачисления.СкидкаПриНалогообложении
		|					КОГДА ДополнительныеНачисления.ДокументОснование.КодВычета = ЗНАЧЕНИЕ(Справочник.ВычетыНДФЛ.Код405)
		|						ТОГДА ДополнительныеНачисления.Результат
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Скидка,
		|	ВЫБОР
		|		КОГДА ДополнительныеНачисления.ДокументОснование.ВидДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровСФизЛицами.Авторский)
		|				И ДополнительныеНачисления.ДокументОснование.ВидАвторскогоДоговора <> ЗНАЧЕНИЕ(Перечисление.ВидыАвторскогоДоговора.АвторскогоЗаказа)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК СкидкаНеРассчитана,
		|	ВЫБОР
		|		КОГДА ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования В (ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПриПостановкеНаУчетВРанниеСрокиБеременности), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПриРожденииРебенка), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПриУсыновленииРебенка), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ВСвязиСоСмертью))
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ЭтоЕдиновременноеПособиеФСС,
		|	ДополнительныеНачисления.Сотрудник.Наименование КАК СотрудникНаименование
		|ПОМЕСТИТЬ ВТДанныеУчета
		|ИЗ
		|	РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрРасчета.ЕСНДополнительныеНачисления КАК ЕСНДополнительныеНачисления
		|		ПО ДополнительныеНачисления.Сотрудник = ЕСНДополнительныеНачисления.Сотрудник
		|			И (ЕСНДополнительныеНачисления.ВидРасчета = ДополнительныеНачисления.ВидРасчета)
		|			И (ЕСНДополнительныеНачисления.ПериодРегистрации = &парамПериодРегистрации)
		|			И (ЕСНДополнительныеНачисления.ДокументОснование = ДополнительныеНачисления.Регистратор)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ОтражениеВУчетеСторно КАК ОтражениеВУчетеСторно
		|		ПО ДополнительныеНачисления.Регистратор = ОтражениеВУчетеСторно.Регистратор
		|			И ДополнительныеНачисления.НомерСтроки = ОтражениеВУчетеСторно.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			ВЫБОР
		|				КОГДА РеглУчетПлановыхНачисленийРаботниковОрганизаций.СпособОтраженияВБухучете = ЗНАЧЕНИЕ(Справочник.СпособыОтраженияЗарплатыВРеглУчете.ПустаяСсылка)
		|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.ПустаяСсылка)
		|				ИНАЧЕ РеглУчетПлановыхНачисленийРаботниковОрганизаций.ОтнесениеРасходовКДеятельностиЕНВД
		|			КОНЕЦ КАК ОтнесениеРасходовКДеятельностиЕНВД,
		|			СведенияОНачисленияхСрез.Регистратор КАК Регистратор,
		|			СведенияОНачисленияхСрез.НомерСтроки КАК НомерСтроки
		|		ИЗ
		|			РегистрСведений.РеглУчетПлановыхНачисленийРаботниковОрганизаций КАК РеглУчетПлановыхНачисленийРаботниковОрганизаций
		|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|					ДополнительныеНачисления.Регистратор КАК Регистратор,
		|					ДополнительныеНачисления.НомерСтроки КАК НомерСтроки,
		|					ДополнительныеНачисления.Сотрудник КАК Сотрудник,
		|					ДополнительныеНачисления.ВидРасчета КАК ВидРасчета,
		|					МАКСИМУМ(РеглУчетПлановыхНачисленийРаботниковОрганизаций.Период) КАК Период,
		|					ДополнительныеНачисления.ДокументОснование КАК ДокументОснование
		|				ИЗ
		|					РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисления
		|						ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РеглУчетПлановыхНачисленийРаботниковОрганизаций КАК РеглУчетПлановыхНачисленийРаботниковОрганизаций
		|						ПО ДополнительныеНачисления.ВидРасчета = РеглУчетПлановыхНачисленийРаботниковОрганизаций.ВидРасчета
		|							И (РеглУчетПлановыхНачисленийРаботниковОрганизаций.Период <= ДополнительныеНачисления.ПериодРегистрации)
		|							И ДополнительныеНачисления.Сотрудник = РеглУчетПлановыхНачисленийРаботниковОрганизаций.Сотрудник
		|							И ДополнительныеНачисления.ДокументОснование = РеглУчетПлановыхНачисленийРаботниковОрганизаций.ДокументОснование
		|				ГДЕ
		|					ДополнительныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|					И НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) = &парамПериодРегистрации
		|					И (&парамНеОтбиратьСотрудников
		|							ИЛИ ДополнительныеНачисления.Сотрудник В
		|								(ВЫБРАТЬ
		|									ВТСписокСотрудников.Сотрудник
		|								ИЗ
		|									ВТСписокСотрудников КАК ВТСписокСотрудников))
		|					И ДополнительныеНачисления.ВидРасчета В(&парамСписокНачислений)
		|					И ДополнительныеНачисления.Результат <> 0
		|					И ((НЕ ДополнительныеНачисления.Сторно)
		|							ИЛИ ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования <> ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка))
		|				
		|				СГРУППИРОВАТЬ ПО
		|					ДополнительныеНачисления.Регистратор,
		|					ДополнительныеНачисления.НомерСтроки,
		|					ДополнительныеНачисления.Сотрудник,
		|					ДополнительныеНачисления.ВидРасчета,
		|					ДополнительныеНачисления.ДокументОснование) КАК СведенияОНачисленияхСрез
		|				ПО (СведенияОНачисленияхСрез.Сотрудник = РеглУчетПлановыхНачисленийРаботниковОрганизаций.Сотрудник)
		|					И (СведенияОНачисленияхСрез.ВидРасчета = РеглУчетПлановыхНачисленийРаботниковОрганизаций.ВидРасчета)
		|					И (СведенияОНачисленияхСрез.Период = РеглУчетПлановыхНачисленийРаботниковОрганизаций.Период)
		|					И (СведенияОНачисленияхСрез.ДокументОснование = РеглУчетПлановыхНачисленийРаботниковОрганизаций.ДокументОснование)) КАК РеглУчетПлановыхНачисленийРаботниковОрганизаций
		|		ПО ДополнительныеНачисления.Регистратор = РеглУчетПлановыхНачисленийРаботниковОрганизаций.Регистратор
		|			И ДополнительныеНачисления.НомерСтроки = РеглУчетПлановыхНачисленийРаботниковОрганизаций.НомерСтроки
		|			И ((НЕ ДополнительныеНачисления.Сторно)
		|				ИЛИ ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования <> ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка))
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаспределениеОсновногоЗаработкаРаботниковОрганизаций КАК Распределение
		|		ПО ДополнительныеНачисления.Сотрудник = Распределение.Сотрудник
		|			И (НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) = Распределение.ПериодРегистрации)
		|			И (РеглУчетПлановыхНачисленийРаботниковОрганизаций.ОтнесениеРасходовКДеятельностиЕНВД ЕСТЬ NULL )
		|			И (ДополнительныеНачисления.ВидРасчета.СтратегияОтраженияВУчете <> ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления))
		|			И ((НЕ ДополнительныеНачисления.Сторно))
		|			И (Распределение.ДоляСпособаОтражения <> 0)
		|			И ((НЕ ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования В (ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПриПостановкеНаУчетВРанниеСрокиБеременности), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПриРожденииРебенка), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПриУсыновленииРебенка), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ВСвязиСоСмертью))))
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			ВЫБОР
		|				КОГДА УчетЗарВРеглУчете.СпособОтраженияВБухучете = ЗНАЧЕНИЕ(Справочник.СпособыОтраженияЗарплатыВРеглУчете.ПустаяСсылка)
		|					ТОГДА NULL
		|				ИНАЧЕ УчетЗарВРеглУчете.ПодпадаетПодЕНВД
		|			КОНЕЦ КАК ПодпадаетПодЕНВД,
		|			СведенияОРаботникахСрез.Регистратор КАК Регистратор,
		|			СведенияОРаботникахСрез.НомерСтроки КАК НомерСтроки
		|		ИЗ
		|			РегистрСведений.УчетОсновногоЗаработкаРаботниковОрганизацииВРегламентированномУчете КАК УчетЗарВРеглУчете
		|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|					ДополнительныеНачисления.Регистратор КАК Регистратор,
		|					ДополнительныеНачисления.НомерСтроки КАК НомерСтроки,
		|					ДополнительныеНачисления.Сотрудник КАК Сотрудник,
		|					МАКСИМУМ(УчетЗарВРеглУчете.Период) КАК Период
		|				ИЗ
		|					РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисления
		|						ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаРаботниковОрганизацииВРегламентированномУчете КАК УчетЗарВРеглУчете
		|						ПО ДополнительныеНачисления.Сотрудник = УчетЗарВРеглУчете.Сотрудник
		|							И (УчетЗарВРеглУчете.Период <= ДополнительныеНачисления.ПериодРегистрации)
		|				ГДЕ
		|					ДополнительныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|					И НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) = &парамПериодРегистрации
		|					И (&парамНеОтбиратьСотрудников
		|							ИЛИ ДополнительныеНачисления.Сотрудник В
		|								(ВЫБРАТЬ
		|									ВТСписокСотрудников.Сотрудник
		|								ИЗ
		|									ВТСписокСотрудников КАК ВТСписокСотрудников))
		|					И ДополнительныеНачисления.ВидРасчета В(&парамСписокНачислений)
		|					И ДополнительныеНачисления.Результат <> 0
		|					И (ДополнительныеНачисления.ВидРасчета.СтратегияОтраженияВУчете <> ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
		|								И (НЕ ДополнительныеНачисления.Сторно)
		|							ИЛИ ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования <> ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка))
		|				
		|				СГРУППИРОВАТЬ ПО
		|					ДополнительныеНачисления.Регистратор,
		|					ДополнительныеНачисления.НомерСтроки,
		|					ДополнительныеНачисления.Сотрудник) КАК СведенияОРаботникахСрез
		|				ПО (СведенияОРаботникахСрез.Сотрудник = УчетЗарВРеглУчете.Сотрудник)
		|					И (СведенияОРаботникахСрез.Период = УчетЗарВРеглУчете.Период)) КАК УчетЗарВРеглУчете
		|		ПО ДополнительныеНачисления.Регистратор = УчетЗарВРеглУчете.Регистратор
		|			И ДополнительныеНачисления.НомерСтроки = УчетЗарВРеглУчете.НомерСтроки
		|			И ((НЕ ДополнительныеНачисления.Сторно)
		|				ИЛИ ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования <> ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка))
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			СведенияОПодразделенияхСрез.Регистратор КАК Регистратор,
		|			СведенияОПодразделенияхСрез.НомерСтроки КАК НомерСтроки,
		|			ВЫБОР
		|				КОГДА УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.СпособОтраженияВБухучете = ЗНАЧЕНИЕ(Справочник.СпособыОтраженияЗарплатыВРеглУчете.ПустаяСсылка)
		|					ТОГДА ЛОЖЬ
		|				ИНАЧЕ УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.ПодпадаетПодЕНВД
		|			КОНЕЦ КАК ПодпадаетПодЕНВД
		|		ИЗ
		|			(ВЫБРАТЬ
		|				ДополнительныеНачисления.Регистратор КАК Регистратор,
		|				ДополнительныеНачисления.НомерСтроки КАК НомерСтроки,
		|				ДополнительныеНачисления.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
		|				МАКСИМУМ(УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.Период) КАК Период
		|			ИЗ
		|				РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисления
		|					ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации КАК УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации
		|					ПО ДополнительныеНачисления.ПодразделениеОрганизации = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.ПодразделениеОрганизации
		|						И (УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.Период <= ДополнительныеНачисления.ПериодРегистрации)
		|			ГДЕ
		|				ДополнительныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|				И НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) = &парамПериодРегистрации
		|				И (&парамНеОтбиратьСотрудников
		|						ИЛИ ДополнительныеНачисления.Сотрудник В
		|							(ВЫБРАТЬ
		|								ВТСписокСотрудников.Сотрудник
		|							ИЗ
		|								ВТСписокСотрудников КАК ВТСписокСотрудников))
		|				И ДополнительныеНачисления.ВидРасчета В(&парамСписокНачислений)
		|				И ДополнительныеНачисления.Результат <> 0
		|				И (ДополнительныеНачисления.ВидРасчета.СтратегияОтраженияВУчете <> ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
		|							И (НЕ ДополнительныеНачисления.Сторно)
		|						ИЛИ ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования <> ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка))
		|			
		|			СГРУППИРОВАТЬ ПО
		|				ДополнительныеНачисления.ПодразделениеОрганизации,
		|				ДополнительныеНачисления.Регистратор,
		|				ДополнительныеНачисления.НомерСтроки) КАК СведенияОПодразделенияхСрез
		|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации КАК УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации
		|				ПО СведенияОПодразделенияхСрез.ПодразделениеОрганизации = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.ПодразделениеОрганизации
		|					И СведенияОПодразделенияхСрез.Период = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.Период) КАК УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации
		|		ПО ДополнительныеНачисления.Регистратор = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.Регистратор
		|			И ДополнительныеНачисления.НомерСтроки = УчетОсновногоЗаработкаРаботниковПодразделенияОрганизации.НомерСтроки
		|			И ((НЕ ДополнительныеНачисления.Сторно)
		|				ИЛИ ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования <> ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка))
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПроцентДеятельностиЕНВДСотрудников КАК ЕНВДПроцент
		|		ПО ДополнительныеНачисления.Сотрудник = ЕНВДПроцент.Сотрудник
		|			И (ЕНВДПроцент.ПериодРегистрации = НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ))
		|			И ((НЕ ДополнительныеНачисления.Сторно)
		|				ИЛИ ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования <> ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка))
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			СведенияОбОрганизацииСрез.Регистратор КАК Регистратор,
		|			СведенияОбОрганизацииСрез.НомерСтроки КАК НомерСтроки,
		|			ВЫБОР
		|				КОГДА УчетОсновногоЗаработкаОрганизации.СпособОтраженияВБухучете = ЗНАЧЕНИЕ(Справочник.СпособыОтраженияЗарплатыВРеглУчете.ПустаяСсылка)
		|					ТОГДА ЛОЖЬ
		|				ИНАЧЕ УчетОсновногоЗаработкаОрганизации.ПодпадаетПодЕНВД
		|			КОНЕЦ КАК ПодпадаетПодЕНВД
		|		ИЗ
		|			(ВЫБРАТЬ
		|				ДополнительныеНачисления.Регистратор КАК Регистратор,
		|				ДополнительныеНачисления.НомерСтроки КАК НомерСтроки,
		|				ДополнительныеНачисления.ОбособленноеПодразделение КАК ОбособленноеПодразделение,
		|				МАКСИМУМ(УчетОсновногоЗаработкаОрганизации.Период) КАК Период
		|			ИЗ
		|				РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисления
		|					ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаОрганизации КАК УчетОсновногоЗаработкаОрганизации
		|					ПО ДополнительныеНачисления.ОбособленноеПодразделение = УчетОсновногоЗаработкаОрганизации.Организация
		|						И (УчетОсновногоЗаработкаОрганизации.Период <= ДополнительныеНачисления.ПериодРегистрации)
		|			ГДЕ
		|				ДополнительныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|				И НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) = &парамПериодРегистрации
		|				И (&парамНеОтбиратьСотрудников
		|						ИЛИ ДополнительныеНачисления.Сотрудник В
		|							(ВЫБРАТЬ
		|								ВТСписокСотрудников.Сотрудник
		|							ИЗ
		|								ВТСписокСотрудников КАК ВТСписокСотрудников))
		|				И ДополнительныеНачисления.ВидРасчета В(&парамСписокНачислений)
		|				И ДополнительныеНачисления.Результат <> 0
		|				И (ДополнительныеНачисления.ВидРасчета.СтратегияОтраженияВУчете <> ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
		|							И (НЕ ДополнительныеНачисления.Сторно)
		|						ИЛИ ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования <> ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка))
		|			
		|			СГРУППИРОВАТЬ ПО
		|				ДополнительныеНачисления.ОбособленноеПодразделение,
		|				ДополнительныеНачисления.Регистратор,
		|				ДополнительныеНачисления.НомерСтроки) КАК СведенияОбОрганизацииСрез
		|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.УчетОсновногоЗаработкаОрганизации КАК УчетОсновногоЗаработкаОрганизации
		|				ПО СведенияОбОрганизацииСрез.Период = УчетОсновногоЗаработкаОрганизации.Период
		|					И СведенияОбОрганизацииСрез.ОбособленноеПодразделение = УчетОсновногоЗаработкаОрганизации.Организация) КАК УчетОсновногоЗаработкаОрганизации
		|		ПО ДополнительныеНачисления.Регистратор = УчетОсновногоЗаработкаОрганизации.Регистратор
		|			И ДополнительныеНачисления.НомерСтроки = УчетОсновногоЗаработкаОрганизации.НомерСтроки
		|			И ((НЕ ДополнительныеНачисления.Сторно)
		|				ИЛИ ДополнительныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования <> ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка))
		|ГДЕ
		|	ЕСНДополнительныеНачисления.Сотрудник ЕСТЬ NULL 
		|	И ДополнительныеНачисления.ОбособленноеПодразделение = &парамОрганизация
		|	И (&парамНеОтбиратьСотрудников
		|			ИЛИ ДополнительныеНачисления.Сотрудник В
		|				(ВЫБРАТЬ
		|					ВТСписокСотрудников.Сотрудник
		|				ИЗ
		|					ВТСписокСотрудников КАК ВТСписокСотрудников))
		|	И ДополнительныеНачисления.Результат <> 0
		|	И ДополнительныеНачисления.ВидРасчета В(&парамСписокНачислений)
		|	И НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) = &парамПериодРегистрации
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	НомерСтроки
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДанныеУчета.Регистратор КАК Регистратор,
		|	ДанныеУчета.Регистратор КАК ДокументОснование,
		|	ДанныеУчета.НомерСтроки КАК НомерСтроки,
		|	ДанныеУчета.Сотрудник,
		|	ДанныеУчета.СотрудникНаименование КАК СотрудникНаименование,
		|	ДанныеУчета.ФизЛицо,
		|	ДанныеУчета.КодДоходаЕСН,
		|	ДанныеУчета.ОблагаетсяЕНВД КАК ОблагаетсяЕНВД,
		|	ДанныеУчета.РезультатСторно КАК РезультатСторно,
		|	ДанныеУчета.ПроцентЕНВД,
		|	ДанныеУчета.ВидРасчета,
		|	ДанныеУчета.Результат КАК Результат,
		|	0 КАК ДополнительныйРезультат,
		|	ДанныеУчета.СтратегияОтраженияВУчете,
		|	ДанныеУчета.ВидПособияСоциальногоСтрахования,
		|	ДанныеУчета.ПериодРегистрации,
		|	ДанныеУчета.ДатаНачалаСобытия КАК ДатаНачалаСобытия,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.ПустаяСсылка) КАК ВариантОбработкиЗаписиПриОтраженииВРеглУчете,
		|	СоответствиеКодов.ВидПоСтраховымВзносам КАК КодДоходаЕСНРазрез,
		|	ЕСТЬNULL(База.ОблагаетсяЕНВДРазрез, БазаСреднегоЗаработка.ОблагаетсяЕНВДРазрез) КАК ОблагаетсяЕНВДРазрез,
		|	ВЫБОР
		|		КОГДА ДанныеУчета.ДоляСпособаОтражения ЕСТЬ НЕ NULL 
		|			ТОГДА ДанныеУчета.ДоляСпособаОтражения
		|		КОГДА База.РезультатБаза ЕСТЬ НЕ NULL 
		|			ТОГДА База.РезультатБаза
		|		ИНАЧЕ БазаСреднегоЗаработка.РезультатБаза
		|	КОНЕЦ КАК РезультатБаза,
		|	ДанныеУчета.Сторно КАК Сторно,
		|	ДанныеУчета.ДоляСпособаОтражения,
		|	ИСТИНА КАК УчитыватьКакНовыйСтраховойСлучай,
		|	ВЫБОР
		|		КОГДА ДанныеУчета.КодДоходаЕСН В (&ДоходыАвторские)
		|			ТОГДА ДанныеУчета.Скидка * ВЫБОР
		|					КОГДА ДанныеУчета.СкидкаНеРассчитана
		|						ТОГДА ЕСТЬNULL(СтраховыеВзносыСкидкиКДоходамСрезПоследних.НормативЗатрат / 100, 0)
		|					ИНАЧЕ 1
		|				КОНЕЦ
		|		КОГДА ДанныеУчета.КодДоходаЕСН = ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.МатпомощьПриРожденииРебенка)
		|			ТОГДА ДанныеУчета.Скидка
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Скидка,
		|	ДанныеУчета.ЭтоЕдиновременноеПособиеФСС КАК ЭтоЕдиновременноеПособиеФСС,
		|	ЛОЖЬ КАК ЭтоПособияФСС
		|ИЗ
		|	ВТДанныеУчета КАК ДанныеУчета
		|		ЛЕВОЕ СОЕДИНЕНИЕ База КАК База
		|		ПО ДанныеУчета.Регистратор = База.Регистратор
		|			И ДанныеУчета.НомерСтроки = База.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_БазаСреднегоЗаработка КАК БазаСреднегоЗаработка
		|		ПО ДанныеУчета.Регистратор = БазаСреднегоЗаработка.Регистратор
		|			И ДанныеУчета.НомерСтроки = БазаСреднегоЗаработка.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКодовЕСНиСтраховыхВзносов КАК СоответствиеКодов
		|		ПО (ЕСТЬNULL(База.КодДоходаЕСНРазрез, БазаСреднегоЗаработка.КодДоходаЕСНРазрез) = СоответствиеКодов.КодДоходаЕСН)
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтраховыеВзносыСкидкиКДоходам.СрезПоследних(&парамПериодРегистрации, ВидДохода В (&ДоходыАвторские)) КАК СтраховыеВзносыСкидкиКДоходамСрезПоследних
		|		ПО ДанныеУчета.КодДоходаЕСН = СтраховыеВзносыСкидкиКДоходамСрезПоследних.ВидДохода
		|
		|УПОРЯДОЧИТЬ ПО
		|	СотрудникНаименование,
		|	Регистратор,
		|	НомерСтроки,
		|	КодДоходаЕСНРазрез,
		|	ОблагаетсяЕНВДРазрез
		|АВТОУПОРЯДОЧИВАНИЕ";

	КонецЕсли;

	Запрос.Текст = ТекстЗапроса;
	РезультатЗапроса = Запрос.Выполнить();
	
	Возврат РезультатЗапроса;

КонецФункции // ПолучитьДанныеУчета2011()

// алгоритмы с 2011 года
//////////////////////////////////////////////////////////////////////////////////

// Процедура формирует набор записей по данным из запроса
//
// Параметры:
//	РезультатДанныеУчета		- выборка по резултату запроса, возвращенная функцией 
//								  ПолучитьДанныеУчета
//	Успешно						- в этот параметр возвращается значение Ложь, если обработка не выполнена
//								  (например, если не окзалось базовых данных)
//	НаборЗаписей
//
Процедура ОбработатьДанныеУчета(ДокументОбъект, ВыделятьЕНВД, ВыборкаПоШапкеДокумента,РезультатДанныеУчета, Успешно, НаборЗаписей, ТаблицаОшибок)

	Если ВыборкаПоШапкеДокумента.ПериодРегистрации < ПроведениеРасчетов.ДатаНачалаРеформыСоцСтрахования() Тогда
		ОбработатьДанныеУчета2010(ДокументОбъект, ВыделятьЕНВД, ВыборкаПоШапкеДокумента,РезультатДанныеУчета, Успешно, НаборЗаписей, ТаблицаОшибок);
	Иначе
		ОбработатьДанныеУчета2011(ДокументОбъект, ВыделятьЕНВД, ВыборкаПоШапкеДокумента,РезультатДанныеУчета, Успешно, НаборЗаписей, ТаблицаОшибок);
	КонецЕсли;
	
КонецПроцедуры  //ОбработатьДанныеУчета

Процедура ВписатьВЗапросСоответствиеКодовЕСНиСтраховыхВзносов(Запрос)

	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ДоходыЕСН.ДоговораГПХ) КАК КодДоходаЕСН,
	|	ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДоговорыГПХ) КАК ВидПоСтраховымВзносам
	|ПОМЕСТИТЬ ВТСоответствиеКодовЕСНиСтраховыхВзносов
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ДоходыЕСН.НеОблагаетсяЦеликом),
	|	ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.НеОблагаетсяЦеликом)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ДоходыЕСН.НеЯвляетсяОбъектом),
	|	ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.НеЯвляетсяОбъектом)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ДоходыЕСН.ОблагаетсяЦеликом),
	|	ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ОблагаетсяЦеликом)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ДоходыЕСН.Матпомощь),
	|	ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.Матпомощь)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ДоходыЕСН.ДенежноеДовольствиеВоеннослужащих),
	|	ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДенежноеДовольствиеВоеннослужащих)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ДоходыЕСН.ДенежноеСодержаниеПрокуроров),
	|	ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ДенежноеСодержаниеПрокуроров)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ДоходыЕСН.ДоговораАвторские),
	|	ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.АвторскиеЛитературныеПроизведения)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ДоходыЕСН.ПособияЗаСчетФСС),
	|	ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ПособияЗаСчетФСС)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ДоходыЕСН.РаспределятьПоБазовымНачислениям),
	|	ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.РаспределятьПоБазовымНачислениям)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ДоходыЕСН.МатпомощьПриРожденииРебенка),
	|	ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.МатпомощьПриРожденииРебенка)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ДоходыЕСН.ВыплатыЗаСчетПрибыли),
	|	ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ОблагаетсяЦеликом)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ДоходыЕСН.ПустаяСсылка),
	|	ЗНАЧЕНИЕ(Справочник.ДоходыПоСтраховымВзносам.ПустаяСсылка)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ДоходыПоСтраховымВзносам.Ссылка,
	|	ДоходыПоСтраховымВзносам.Ссылка
	|ИЗ
	|	Справочник.ДоходыПоСтраховымВзносам КАК ДоходыПоСтраховымВзносам
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	КодДоходаЕСН";
	Запрос.Выполнить();

КонецПроцедуры // СоответствиеКодовЕСНиСтраховыхВзносов()

// Процедура регистрирует в таблице мТаблицаОшибок ошибку обработки данных учета, для
// последующего формирования сообщений пользователю о строке табличной части в 
// которой есть ошибка, причине возникновения ошибки и что делать для устранения ошибки
//
Процедура ЗарегистрироватьОшибкуОбработкиДанныхУчета(ТаблицаОшибок, ДанныеУчета, ЭтоОсновныеНачисления, СтруктураПоискаОшибок, КодОшибки)
	
	//ошибку регистрируем, если для этого начисления еще не зарегистрирована ошибка
	СтруктураПоискаОшибок.Регистратор = ДанныеУчета.Регистратор;
	СтруктураПоискаОшибок.НомерСтроки = ДанныеУчета.НомерСтроки;
	СтруктураПоискаОшибок.КодОшибки   = КодОшибки;
	
	Если ТаблицаОшибок.НайтиСтроки(СтруктураПоискаОшибок).Количество() = 0 Тогда
		
		СтрокаТаблицыОшибок = ТаблицаОшибок.Добавить();
		СтрокаТаблицыОшибок.Сотрудник  = ДанныеУчета.Сотрудник;
		СтрокаТаблицыОшибок.ВидРасчета = ДанныеУчета.ВидРасчета;
		Если ЭтоОсновныеНачисления Тогда
			СтрокаТаблицыОшибок.ПериодДействияНачало = ДанныеУчета.ПериодДействияНачало;
			СтрокаТаблицыОшибок.ПериодДействияКонец  = ДанныеУчета.ПериодДействияКонец;
		Иначе
			СтрокаТаблицыОшибок.ПериодДействияНачало = Дата('00010101');
			СтрокаТаблицыОшибок.ПериодДействияКонец  = Дата('00010101');
		КонецЕсли;
		СтрокаТаблицыОшибок.Сторно 		= ДанныеУчета.Сторно;
		СтрокаТаблицыОшибок.КодОшибки 	= КодОшибки;
		СтрокаТаблицыОшибок.Регистратор = ДанныеУчета.Регистратор;
		СтрокаТаблицыОшибок.НомерСтроки = ДанныеУчета.НомерСтроки;
		СтрокаТаблицыОшибок.ВидПособияСоциальногоСтрахования = ДанныеУчета.ВидПособияСоциальногоСтрахования;
		
	КонецЕсли;

КонецПроцедуры // ЗарегистрироватьОшибкуОбработкиДанныхУчета()

Процедура ОбработатьТаблицуПособий(ДокументОбъект)

	ТаблицаПособий = ДокументОбъект.ПособияПоСоциальномуСтрахованию.Выгрузить();
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	Запрос.УстановитьПараметр("ТаблицаПособий", ТаблицаПособий);
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	ТаблицаПособий.НомерСтроки,
	|	ТаблицаПособий.Сотрудник,
	|	ТаблицаПособий.ФизЛицо,
	|	ТаблицаПособий.ВидПособияСоциальногоСтрахования КАК ВидПособияСоциальногоСтрахования,
	|	ТаблицаПособий.СпособФинансированияПособий КАК СпособФинансированияПособий,
	|	ТаблицаПособий.УчитыватьКакНовыйСтраховойСлучай,
	|	ТаблицаПособий.ДатаСтраховогоСлучая,
	|	ТаблицаПособий.ПериодДействияНачало КАК ПериодДействияНачало,
	|	ТаблицаПособий.ПериодДействияКонец,
	|	ТаблицаПособий.ОплаченныеДни,
	|	ТаблицаПособий.СуммаВсего,
	|	ТаблицаПособий.ОблагаетсяЕНВД КАК ОблагаетсяЕНВД,
	|	ТаблицаПособий.ВидРасчета,
	|	ТаблицаПособий.ДокументОснование КАК ДокументОснование,
	|	ТаблицаПособий.ВыплатаЗаСчетФедеральногоБюджета КАК ВыплатаЗаСчетФедеральногоБюджета,
	|	ТаблицаПособий.СуммаСверхНорм КАК СуммаСверхНорм,
	|	ТаблицаПособий.Сторно КАК Сторно
	|ПОМЕСТИТЬ ВТ_ТаблицаПособий
	|ИЗ
	|	&ТаблицаПособий КАК ТаблицаПособий
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ДокументОснование,
	|	ВидПособияСоциальногоСтрахования,
	|	СпособФинансированияПособий,
	|	ОблагаетсяЕНВД,
	|	ПериодДействияНачало,
	|	Сторно,
	|	ВыплатаЗаСчетФедеральногоБюджета
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Пособия.ВидПособияСоциальногоСтрахования КАК ВидПособияСоциальногоСтрахования,
	|	Пособия.СпособФинансированияПособий КАК СпособФинансированияПособий,
	|	Пособия.ОблагаетсяЕНВД КАК ОблагаетсяЕНВД,
	|	Пособия.ДокументОснование КАК ДокументОснование,
	|	МИНИМУМ(Пособия.ПериодДействияНачало) КАК ПериодДействияНачало,
	|	Пособия.УчитыватьКакНовыйСтраховойСлучай,
	|	Пособия.Сторно КАК Сторно,
	|	Пособия.ВыплатаЗаСчетФедеральногоБюджета
	|ПОМЕСТИТЬ ВТ_ПособияНовыйСтраховойСлучай
	|ИЗ
	|	ВТ_ТаблицаПособий КАК Пособия
	|ГДЕ
	|	Пособия.УчитыватьКакНовыйСтраховойСлучай
	|
	|СГРУППИРОВАТЬ ПО
	|	Пособия.ДокументОснование,
	|	Пособия.ОблагаетсяЕНВД,
	|	Пособия.ВидПособияСоциальногоСтрахования,
	|	Пособия.СпособФинансированияПособий,
	|	Пособия.УчитыватьКакНовыйСтраховойСлучай,
	|	Пособия.Сторно,
	|	Пособия.ВыплатаЗаСчетФедеральногоБюджета
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ДокументОснование,
	|	ВидПособияСоциальногоСтрахования,
	|	СпособФинансированияПособий,
	|	ОблагаетсяЕНВД,
	|	ПериодДействияНачало,
	|	Сторно
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Пособия.Сотрудник КАК Сотрудник,
	|	Пособия.ФизЛицо,
	|	Пособия.ВидПособияСоциальногоСтрахования КАК ВидПособияСоциальногоСтрахования,
	|	Пособия.СпособФинансированияПособий,
	|	Пособия.ДатаСтраховогоСлучая,
	|	Пособия.ПериодДействияНачало КАК ПериодДействияНачало,
	|	Пособия.ПериодДействияКонец,
	|	Пособия.ОплаченныеДни,
	|	Пособия.СуммаВсего,
	|	Пособия.ОблагаетсяЕНВД КАК ОблагаетсяЕНВД,
	|	Пособия.ВидРасчета,
	|	Пособия.ДокументОснование,
	|	Пособия.Сторно,
	|	ЕСТЬNULL(ВТ_ПособияНовыйСтраховойСлучай.УчитыватьКакНовыйСтраховойСлучай, ЛОЖЬ) КАК УчитыватьКакНовыйСтраховойСлучай,
	|	Пособия.ВыплатаЗаСчетФедеральногоБюджета,
	|	Пособия.СуммаСверхНорм
	|ИЗ
	|	ВТ_ТаблицаПособий КАК Пособия
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ПособияНовыйСтраховойСлучай КАК ВТ_ПособияНовыйСтраховойСлучай
	|		ПО Пособия.ДокументОснование = ВТ_ПособияНовыйСтраховойСлучай.ДокументОснование
	|			И Пособия.ВидПособияСоциальногоСтрахования = ВТ_ПособияНовыйСтраховойСлучай.ВидПособияСоциальногоСтрахования
	|			И Пособия.СпособФинансированияПособий = ВТ_ПособияНовыйСтраховойСлучай.СпособФинансированияПособий
	|			И Пособия.ОблагаетсяЕНВД = ВТ_ПособияНовыйСтраховойСлучай.ОблагаетсяЕНВД
	|			И Пособия.ПериодДействияНачало = ВТ_ПособияНовыйСтраховойСлучай.ПериодДействияНачало
	|			И Пособия.Сторно = ВТ_ПособияНовыйСтраховойСлучай.Сторно
	|			И Пособия.ВыплатаЗаСчетФедеральногоБюджета = ВТ_ПособияНовыйСтраховойСлучай.ВыплатаЗаСчетФедеральногоБюджета
	|
	|УПОРЯДОЧИТЬ ПО
	|	Пособия.НомерСтроки";
	
	Запрос.Текст = ТекстЗапроса;
	ТаблицаПособий = Запрос.Выполнить().Выгрузить();
	ДокументОбъект.ПособияПоСоциальномуСтрахованию.Загрузить(ТаблицаПособий);	

КонецПроцедуры

Функция ПолучитьДанныеУчета(ВыборкаПоШапкеДокумента, ВыделятьЕНВД, СписокНачислений, ОрганичениеНаСотрудников, ЭтоОсновныеНачисления, ЭтоПервичныеНачисления)

	Если ВыборкаПоШапкеДокумента.ПериодРегистрации < ПроведениеРасчетов.ДатаНачалаРеформыСоцСтрахования() Тогда
		Возврат ПолучитьДанныеУчета2010(ВыборкаПоШапкеДокумента, ВыделятьЕНВД, СписокНачислений, ОрганичениеНаСотрудников, ЭтоОсновныеНачисления, ЭтоПервичныеНачисления);
	Иначе
		Возврат ПолучитьДанныеУчета2011(ВыборкаПоШапкеДокумента, ВыделятьЕНВД, СписокНачислений, ОрганичениеНаСотрудников, ЭтоОсновныеНачисления, ЭтоПервичныеНачисления);
	КонецЕсли;

КонецФункции  // ПолучитьДанныеУчета

// Функция формирует таблицу начислений и последовательность их обработки
//
// Возвращаемое значение:
//  ТаблицаЗначений
//
Функция ПолучитьТаблицуНачислений(ВыборкаПоШапкеДокумента, ОрганичениеНаСотрудников)

	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	Запрос.УстановитьПараметр("парамНеОтбиратьСотрудников", ОрганичениеНаСотрудников = Неопределено);
	
	Если ОрганичениеНаСотрудников = Неопределено Тогда
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	НЕОПРЕДЕЛЕНО КАК Сотрудник
		|ПОМЕСТИТЬ ВТСписокСотрудников";
		Запрос.Выполнить();
		
	Иначе
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ТаблицаСотрудников.Сотрудник КАК Сотрудник
		|ПОМЕСТИТЬ ВТСписокСотрудников
		|ИЗ
		|	&парамТаблицаСотрудников КАК ТаблицаСотрудников";
		Запрос.УстановитьПараметр("парамТаблицаСотрудников", ОрганичениеНаСотрудников);
		Запрос.Выполнить();
		
	КонецЕсли;
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	""Основные"" КАК ВидНачисления,
	|	ВЫБОР
	|		КОГДА ОсновныеНачисления.ВидРасчета.КатегорияРасчета = ЗНАЧЕНИЕ(Справочник.КатегорииРасчетов.Первичное)
	|				ИЛИ ОсновныеНачисления.ВидРасчета.СтратегияОтраженияВУчете <> ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
	|				ИЛИ &ПособияОбрабатыватьКакПервичные
	|					И ОсновныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования <> ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка)
	|			ТОГДА ""00000""
	|		ИНАЧЕ ОсновныеНачисления.ВидРасчета.КатегорияРасчета.Код
	|	КОНЕЦ КАК ПорядокРасчета,
	|	ОсновныеНачисления.ВидРасчета
	|ИЗ
	|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ОсновныеНачисления.ВидРасчета КАК ВидРасчета
	|	ИЗ
	|		РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
	|	ГДЕ
	|		ОсновныеНачисления.ПериодРегистрации = &парамПериодРегистрации
	|		И (&парамНеОтбиратьСотрудников
	|				ИЛИ ОсновныеНачисления.Сотрудник В
	|					(ВЫБРАТЬ
	|						ВТСписокСотрудников.Сотрудник
	|					ИЗ
	|						ВТСписокСотрудников КАК ВТСписокСотрудников))
	|		И ОсновныеНачисления.ОбособленноеПодразделение = &парамОрганизация) КАК ОсновныеНачисления
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	""Дополнительные"",
	|	ВЫБОР
	|		КОГДА ДополнительныеНачисления.ВидРасчета.КатегорияРасчета = ЗНАЧЕНИЕ(Справочник.КатегорииРасчетов.Первичное)
	|				ИЛИ ДополнительныеНачисления.ВидРасчета.СтратегияОтраженияВУчете <> ЗНАЧЕНИЕ(Перечисление.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
	|			ТОГДА ""00000""
	|		ИНАЧЕ ДополнительныеНачисления.ВидРасчета.КатегорияРасчета.Код
	|	КОНЕЦ,
	|	ДополнительныеНачисления.ВидРасчета
	|ИЗ
	|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДополнительныеНачисления.ВидРасчета КАК ВидРасчета
	|	ИЗ
	|		РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисления
	|	ГДЕ
	|		НАЧАЛОПЕРИОДА(ДополнительныеНачисления.ПериодРегистрации, МЕСЯЦ) = &парамПериодРегистрации
	|		И (&парамНеОтбиратьСотрудников
	|				ИЛИ ДополнительныеНачисления.Сотрудник В
	|					(ВЫБРАТЬ
	|						ВТСписокСотрудников.Сотрудник
	|					ИЗ
	|						ВТСписокСотрудников КАК ВТСписокСотрудников))
	|		И ДополнительныеНачисления.ОбособленноеПодразделение = &парамОрганизация) КАК ДополнительныеНачисления
	|
	|УПОРЯДОЧИТЬ ПО
	|	ПорядокРасчета";
	
	Запрос.Текст = ТекстЗапроса;
	Запрос.УстановитьПараметр("парамПериодРегистрации", ВыборкаПоШапкеДокумента.ПериодРегистрации);
	Запрос.УстановитьПараметр("парамОрганизация", ВыборкаПоШапкеДокумента.ОбособленноеПодразделение);
	Запрос.УстановитьПараметр("ПособияОбрабатыватьКакПервичные", ВыборкаПоШапкеДокумента.ПериодРегистрации >= ПроведениеРасчетов.ДатаНачалаРеформыСоцСтрахования());
	
	ТаблицаНачислений = Запрос.Выполнить().Выгрузить();	
	
	Возврат ТаблицаНачислений;

КонецФункции // ПолучитьТаблицуНачислений()

// создает строку движений ЕСНОсновныеНачисления или ЕСНДополнительныеНачисления
// вызывается из ОбработатьДанныеУчета
// Параметры:
//	ДанныеУчета - спозиционированная выборка по результату запроса
//	НаборЗаписей
//
Функция СоздатьСтрокуДвижений(ВыборкаПоШапкеДокумента, ДанныеУчета, НаборЗаписей, ЭтоОсновныеНачисления)
	
	СтрокаДанных = НаборЗаписей.Добавить();
	
	// регистратор
	
	// вид расчета
	СтрокаДанных.ВидРасчета					= ДанныеУчета.ВидРасчета;
	// период регистрации
	СтрокаДанных.ПериодРегистрации			= ВыборкаПоШапкеДокумента.ПериодРегистрации;
	// признак сторно
	СтрокаДанных.Сторно						= ДанныеУчета.Сторно;
	
	Если ЭтоОсновныеНачисления Тогда
		// только для ЕСНОсновныеНачисления
		СтрокаДанных.ПериодДействияНачало	= ДанныеУчета.ПериодДействияНачало;
		СтрокаДанных.ПериодДействияКонец	= ДанныеУчета.ПериодДействияКонец;
		СтрокаДанных.ГрафикРаботы			= ДанныеУчета.ГрафикРаботы;
		СтрокаДанных.ВидУчетаВремени		= ДанныеУчета.ВидУчетаВремени;
	Иначе
		// только для ЕСНДополнительныеНачисления
		СтрокаДанных.Скидка = ДанныеУчета.Скидка;
	КонецЕсли;

	// измерения
	СтрокаДанных.Сотрудник					= ДанныеУчета.Сотрудник;
	СтрокаДанных.Физлицо					= ДанныеУчета.Физлицо;
	СтрокаДанных.Организация				= ВыборкаПоШапкеДокумента.Организация;

	// ресурсы
	СтрокаДанных.Результат					= ДанныеУчета.Результат;

	// реквизиты
	СтрокаДанных.КодДоходаЕСН				= ДанныеУчета.КодДоходаЕСН;
	СтрокаДанных.ОблагаетсяЕНВД				= Ложь;
	СтрокаДанных.ОбособленноеПодразделение	= ВыборкаПоШапкеДокумента.ОбособленноеПодразделение;
	СтрокаДанных.ДокументОснование			= ДанныеУчета.Регистратор;
	
	Возврат СтрокаДанных;
	
КонецФункции // СоздатьСтрокуДвижений()

// Выполняет автоматическое заполнение наборов записей о доходах ЕСН
// Параметры: 
//  НаборЗаписейОсновной, НаборЗаписейДополнительный
//  МассивПодразделений - массив подразделений, если Неопределено, тогда по всем
//
// Возвращаемое значение:
//  Истина, если автозаполнение полностью выполнено 
//	Ложь, если некоторые строки движений остались недозаполненными
//
Функция АвтозаполнениеНаборовЗаписейОДоходах(ДокументОбъект, ВыборкаПоШапкеДокумента, НаборЗаписейОсновной, НаборЗаписейДополнительный, ОрганичениеНаСотрудников, ТаблицаОшибок) Экспорт
	
	Успешно = Истина;
	
	// определим налоговый режим
	НалоговыйУчет.ОбновитьДанныеУчетнойПолитикиПоНалоговомуУчету(глЗначениеПеременной("УчетнаяПолитикаОтраженияЗарплатыВУчете"), КонецМесяца(ВыборкаПоШапкеДокумента.ПериодРегистрации), ВыборкаПоШапкеДокумента.ОбособленноеПодразделение);
	УчетнаяПолитика = глЗначениеПеременной("УчетнаяПолитикаОтраженияЗарплатыВУчете")[КонецМесяца(ВыборкаПоШапкеДокумента.ПериодРегистрации)][ВыборкаПоШапкеДокумента.ОбособленноеПодразделение];
	ЕНВД = УчетнаяПолитика.ОрганизацияЯвляетсяПлательщикомЕНВД;
	
	ТаблицаНачислений = ПолучитьТаблицуНачислений(ВыборкаПоШапкеДокумента, ОрганичениеНаСотрудников);
	ПорядкиРасчета = ТаблицаНачислений.ВыгрузитьКолонку("ПорядокРасчета");
	СтруктураПоиска = Новый Структура;
	СписокНачисленийДляОтбора = Новый Массив;
	
    ПорядокРасчета = Неопределено;
	Для Счетчик = 0 По ПорядкиРасчета.ВГраница() Цикл
		
		Если ПорядкиРасчета[Счетчик] = ПорядокРасчета Тогда
			Продолжить;
		КонецЕсли;
		
		ПорядокРасчета = ПорядкиРасчета[Счетчик];
		
		СписокНачисленийДляОтбора.Очистить();
		
		СтруктураПоиска.Вставить("ПорядокРасчета", ПорядокРасчета);
		
		//основные начисления
		СтруктураПоиска.Вставить("ВидНачисления", "Основные");
		СтрокиТаблицы = ТаблицаНачислений.НайтиСтроки(СтруктураПоиска);
		Для каждого Строка Из СтрокиТаблицы Цикл
			СписокНачисленийДляОтбора.Добавить(Строка.ВидРасчета);
		КонецЦикла;
		Если СписокНачисленийДляОтбора.Количество() > 0 Тогда
			//получим и обработаем данные учета
			ДанныеУчета = ПолучитьДанныеУчета(ВыборкаПоШапкеДокумента, ЕНВД, СписокНачисленийДляОтбора, ОрганичениеНаСотрудников, Истина, ?(Счетчик = 0, Истина, Ложь));
			ОбработатьДанныеУчета(ДокументОбъект, ЕНВД, ВыборкаПоШапкеДокумента, ДанныеУчета, Успешно, НаборЗаписейОсновной, ТаблицаОшибок);
		КонецЕсли;
		
		//дополнительные начисления
		СписокНачисленийДляОтбора.Очистить();
		СтруктураПоиска.Вставить("ВидНачисления", "Дополнительные");
		СтрокиТаблицы = ТаблицаНачислений.НайтиСтроки(СтруктураПоиска);
		Для каждого Строка Из СтрокиТаблицы Цикл
			СписокНачисленийДляОтбора.Добавить(Строка.ВидРасчета);
		КонецЦикла;
		Если СписокНачисленийДляОтбора.Количество() > 0 Тогда
			//получим и обработаем данные учета
			ДанныеУчета = ПолучитьДанныеУчета(ВыборкаПоШапкеДокумента, ЕНВД, СписокНачисленийДляОтбора, ОрганичениеНаСотрудников, Ложь, ?(Счетчик = 0, Истина, Ложь));
			ОбработатьДанныеУчета(ДокументОбъект, ЕНВД, ВыборкаПоШапкеДокумента, ДанныеУчета, Успешно, НаборЗаписейДополнительный, ТаблицаОшибок);
		КонецЕсли;
		
	КонецЦикла;	
	
	ОбработатьТаблицуПособий(ДокументОбъект);
	
	Возврат Не Успешно;
	
КонецФункции