////////////////////////////////////////////////////////////////////////////////
// ЭКСПОРТНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

#Если ТолстыйКлиентОбычноеПриложение Тогда

// Процедура осуществляет печать документа. Можно направить печать на 
// экран или принтер, а также распечатать необходимое количество копий.
//
//  Название макета печати передается в качестве параметра,
// по переданному названию находим имя макета в соответствии.
//
// Параметры:
//  НазваниеМакета - строка, название макета.
//
Функция Печать(ИмяМакета, КоличествоЭкземпляров = 1, НаПринтер = Ложь) Экспорт
	
	// Получить экземпляр документа на печать
	Если ИмяМакета = "ПечатьФайла" Тогда
		
		ЕстьОшибки = Ложь;
		ТекстФайла = РегламентированнаяОтчетность.ПолучитьТекстФайла(ЭтотОбъект,ЕстьОшибки);
		Если ЕстьОшибки тогда
			Возврат Неопределено;
		КонецЕсли;	 
		
		Если ВидАДВ =  Перечисления.ВидыАДВ.АДВ2 тогда
			ТипЗаписи = "ОБМН";
			Макет = ПолучитьМакет("ФормаАДВ_2");
		Иначе	
			ТипЗаписи = "ДУБЛ";
			Макет = ПолучитьМакет("ФормаАДВ_3");
		КонецЕсли;	 
		
		//Обработка документов файла
		ОбластьЗаявление = Макет.ПолучитьОбласть("Заявление");
		Если ВидАДВ = Перечисления.ВидыАДВ.АДВ3 Тогда
			НормальныйШрифт = Новый Шрифт(ОбластьЗаявление.Области.СведенияПредставлялись.Шрифт);
			ЗачеркнутыйШрифт = Новый Шрифт(ОбластьЗаявление.Области.СведенияПредставлялись.Шрифт,,,,,,ИСТИНА);
		КонецЕсли;
		
		ДокументРезультат = Новый ТабличныйДокумент;
		ДокументРезультат.ПолеСверху = 0;
		ДокументРезультат.ПолеСлева  = 0;
		ДокументРезультат.ПолеСнизу  = 0;
		ДокументРезультат.ПолеСправа = 0;
		ДокументРезультат.ИмяПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства_ФорматЗаписей";
		ДокументРезультат.ОриентацияСтраницы = ОриентацияСтраницы.Портрет;
		
		Если ФорматФайла = Перечисления.ФорматФайлаПФР.Версия04 Тогда
			// формируем отчет по версии файла 04.00	
			
			//Получаем таблицу формата записи
			ДокументФорматЗаписей = ПолучитьМакет("ФорматЗаписей");
			ТаблицаФорматаЗаписи = ПроцедурыПерсонифицированногоУчета.ПолучитьФорматЗаписи(ТипЗаписи,ДокументФорматЗаписей);
			ТаблицаФорматаЗаписи.Индексы.Добавить("ИмяПоля");
			СтрокаТЗ = ТаблицаФорматаЗаписи.Найти("ДокументНомер","ИмяПоля");
			Если СтрокаТЗ <> Неопределено Тогда
				СтрокаТЗ.ТипПоля = "СТРОКА";
			КонецЕсли;
			
			
			//Обработка заголовка файла
			ИнформацияОПачке = Новый Структура;
			Если ПроцедурыПерсонифицированногоУчета.РазобратьЗаголовокФайла(ТекстФайла,ИнформацияОПачке)=0 тогда
				Возврат Неопределено;
			КонецЕсли;	
			ИнформацияОПачке.Вставить("ИнформацияОРаботодателе", Организация);
			ОтветственныеЛица = РегламентированнаяОтчетность.ОтветственныеЛицаОрганизаций(Организация,Дата,Ответственный.ФизЛицо);
			Для Н=5 по СтрЧислоСтрок(ТекстФайла) цикл
				
				//Прочитаем запись из файла
				СтрокаФайла = СтрПолучитьСтроку(ТекстФайла,Н);
				
				Запись = ПроцедурыПерсонифицированногоУчета.ПолучитьСтруктуруЗаписи(ТаблицаФорматаЗаписи);
				СтрОшибка = "";
				Если НЕ ПроцедурыПерсонифицированногоУчета.РазложитьСтрокуВСтруктуруЗаписи(СтрокаФайла,ТипЗаписи,ТаблицаФорматаЗаписи,Запись,СтрОшибка) тогда
					Сообщить("Ошибка в строке файла № "+Н+": "+СтрОшибка);
					Возврат Неопределено;
				КонецЕсли;	
				
				//Данные, указанные в свидетельстве
				ОбластьЗаявление.Параметры.СтраховойНомерПФР 			= Запись.СтраховойНомер; 
				ОбластьЗаявление.Параметры.ФамилияВСвидетельстве 		= Запись.ФамилияВСвидетельстве; 
				ОбластьЗаявление.Параметры.ИмяВСвидетельстве 			= Запись.ИмяВСвидетельстве; 
				ОбластьЗаявление.Параметры.ОтчествоВСвидетельстве 		= Запись.ОтчествоВСвидетельстве; 
				
				//Изменившиеся данные
				ОбластьЗаявление.Параметры.Фамилия 						= Запись.Фамилия; 
				ОбластьЗаявление.Параметры.Имя 							= Запись.Имя; 
				ОбластьЗаявление.Параметры.Отчество 					= ?(Запись.ПризнакОтменыОтчества = "ОТМН", "отменено", Запись.Отчество); 
				ОбластьЗаявление.Параметры.Пол 							= Запись.Пол + "     (м/ж)"; 
				ОбластьЗаявление.Параметры.ДатаРождения 				= ПроцедурыПерсонифицированногоУчета.ДатаВОтчет(Запись.СтандартнаяДатаРождения); 
				
				//Место рождения
				ОбластьЗаявление.Параметры.МестоРожденияГород 			= 	Запись.МестоРожденияНаселенныйПункт;
				ОбластьЗаявление.Параметры.МестоРожденияРайон 			= 	Запись.МестоРожденияРайон;
				ОбластьЗаявление.Параметры.МестоРожденияОбласть			= 	Запись.МестоРожденияОбласть;
				ОбластьЗаявление.Параметры.МестоРожденияСтрана 			= 	Запись.МестоРожденияСтрана;
				ОбластьЗаявление.Параметры.Гражданство 					= 	Запись.Гражданство;
				
				//Паспортные данные
				НаименованиеДокумента 									= 	Запись.ДокументНаименование;
				Серия1 													= 	Запись.ДокументСерияРимскиеЦифры;
				Серия2 													= 	Запись.ДокументСерияРусскиеБуквы;
				
				СерияНомер = Серия1 +?(Запись.ДокументВид = "ПАСПОРТ РОССИИ", " ", ?(Запись.ДокументВид = "ПАСПОРТ", "-", "") ) + Серия2 +",  " + Запись.ДокументНомер;
				
				ОбластьЗаявление.Параметры.НаименованиеДокумента		= 	НаименованиеДокумента;
				ОбластьЗаявление.Параметры.СерияНомер			 		= 	СерияНомер;
				ОбластьЗаявление.Параметры.ДатаВыдачи 					= 	ПроцедурыПерсонифицированногоУчета.ДатаВОтчет(Запись.ДокументДатаВыдачи);
				ОбластьЗаявление.Параметры.КемВыдан 					= 	Запись.ДокументКемВыдан;
				
				//Адреса
				ОбластьЗаявление.Параметры.АдресРегистрации 			=	ВРег(РегламентированнаяОтчетность.ПредставлениеАдреса(НРег(Запись.АдресРегистрации),0,""));
				ОбластьЗаявление.Параметры.АдресФактический 			= 	ВРег(РегламентированнаяОтчетность.ПредставлениеАдреса(НРег(Запись.АдресФактический),0,""));
				ОбластьЗаявление.Параметры.Телефоны 					= 	Запись.Телефоны;
				
				//Подвал
				ОбластьЗаявление.Параметры.ДатаЗаполнения				= 	"Дата заполнения " + Символы.ПС + ПроцедурыПерсонифицированногоУчета.ДатаВОтчет(Запись.ДатаЗаполнения);
				
				//Поля, присутствующие только в форме АДВ-3
				Если ВидАДВ = Перечисления.ВидыАДВ.АДВ3 тогда	
					ОбластьЗаявление.Параметры.ПолВСвидетельстве 							= Запись.ПолВСвидетельстве + "     (м/ж)"; 
					ОбластьЗаявление.Параметры.ДатаРожденияВСвидетельстве 					= ПроцедурыПерсонифицированногоУчета.ДатаВОтчет(Запись.СтандартнаяДатаРожденияВСвидетельстве); 
					
					//Место рождения, указанное в свидетельстве
					ОбластьЗаявление.Параметры.МестоРожденияГородВСвидетельстве 			= 	Запись.МестоРожденияНаселенныйПунктВСвидетельстве;
					ОбластьЗаявление.Параметры.МестоРожденияРайонВСвидетельстве 			= 	Запись.МестоРожденияРайонВСвидетельстве;
					ОбластьЗаявление.Параметры.МестоРожденияОбластьВСвидетельстве			= 	Запись.МестоРожденияОбластьВСвидетельстве;
					ОбластьЗаявление.Параметры.МестоРожденияСтранаВСвидетельстве 			= 	Запись.МестоРожденияСтранаВСвидетельстве;
					
					Если Запись.ОтметкаОПредставленииСведений <> "ПРЕДСТАВЛ" тогда
						ОбластьЗаявление.Области.СведенияПредставлялись.Шрифт 		= ЗачеркнутыйШрифт;
						ОбластьЗаявление.Области.СведенияБудутПредставлены.Шрифт 	= НормальныйШрифт;
					Иначе	
						ОбластьЗаявление.Области.СведенияПредставлялись.Шрифт 		= НормальныйШрифт;
						ОбластьЗаявление.Области.СведенияБудутПредставлены.Шрифт 	= ЗачеркнутыйШрифт;
					КонецЕсли;	 
					ОбластьЗаявление.Параметры.ДатаЗаполнения = ПроцедурыПерсонифицированногоУчета.ДатаВОтчет(Запись.ДатаЗаполнения);
					ОбластьЗаявление.Параметры.ДолжностьРуководителя		 		= ОтветственныеЛица.РуководительДолжность;
					ОбластьЗаявление.Параметры.РасшифровкаПодписиРуководителя	= ОтветственныеЛица.Руководитель;
				КонецЕсли;	
				
				ДокументРезультат.Вывести(ОбластьЗаявление);
				ДокументРезультат.ВывестиГоризонтальныйРазделительСтраниц();
			КонецЦикла;	
			
			Если ВидАДВ =  Перечисления.ВидыАДВ.АДВ2 тогда
				УниверсальныеМеханизмы.НапечататьДокумент(ДокументРезультат,1,Ложь,"Заявления об обмене страхового свидетельства АДВ-2");
			иначе	
				УниверсальныеМеханизмы.НапечататьДокумент(ДокументРезультат,1,Ложь,"Заявления о выдаче дубликата страхового свидетельства АДВ-3");
			КонецЕсли;	 
			
			
			//Печать описи документов
			ДокументОписи = Новый ТабличныйДокумент;
			ДокументОписи.ИмяПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства_АДВ_6";
			
			ПроцедурыПерсонифицированногоУчета.ВывестиОписьАДВ6(ДокументОписи,ИнформацияОПачке,ОтветственныеЛица);
			Возврат УниверсальныеМеханизмы.НапечататьДокумент(ДокументОписи,1,Ложь,"Опись документов АДВ-6");
			
		ИначеЕсли ФорматФайла = Перечисления.ФорматФайлаПФР.Версия07 Тогда
			
			// формируем отчет по версии файла 07.00
			
			ДеревоПФР = ПроцедурыПерсонифицированногоУчета.ПреобразоватьВДеревоXML(ТекстФайла);
			
			Если ДеревоПФР = Неопределено Тогда
				Отказ = Ложь;
				ОбщегоНазначения.СообщитьОбОшибке("Не удалось разобрать файл с данными!",Отказ, ОбщегоНазначения.ПредставлениеДокументаПриПроведении(Ссылка));
				Возврат Неопределено 
			КонецЕсли;
			ДеревоПФР = ДеревоПФР.Строки.Найти("ФайлПФР","Имя");
			Если ДеревоПФР = Неопределено Тогда
				Отказ = Ложь;
				ОбщегоНазначения.СообщитьОбОшибке("Не удалось разобрать файл с данными!",Отказ, ОбщегоНазначения.ПредставлениеДокументаПриПроведении(Ссылка));
				Возврат Неопределено 
			КонецЕсли;
			СтрокаДереваПачкаВходящихДокументов = ДеревоПФР.Строки.Найти("ПачкаВходящихДокументов","Имя");
			Если СтрокаДереваПачкаВходящихДокументов <> Неопределено Тогда
				Для Каждого СтрокаДереваЗаявление Из СтрокаДереваПачкаВходящихДокументов.Строки Цикл
					Если СтрокаДереваЗаявление.Имя = "ЗАЯВЛЕНИЕ_О_ДУБЛИКАТЕ" Или СтрокаДереваЗаявление.Имя = "ЗАЯВЛЕНИЕ_ОБ_ОБМЕНЕ" Тогда
						
						//Данные, указанные в свидетельстве
						ОбластьЗаявление.Параметры.СтраховойНомерПФР = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваЗаявление, "СтраховойНомер");
						СтрокаДереваФИОИзСтрахового = СтрокаДереваЗаявление.Строки.Найти("ФИОизСтрахового");
						Если СтрокаДереваФИОИзСтрахового <> Неопределено Тогда
							ОбластьЗаявление.Параметры.ФамилияВСвидетельстве 	= ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваФИОИзСтрахового, "Фамилия"); 
							ОбластьЗаявление.Параметры.ИмяВСвидетельстве 		= ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваФИОИзСтрахового, "Имя"); 
							ОбластьЗаявление.Параметры.ОтчествоВСвидетельстве 	= ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваФИОИзСтрахового, "Отчество"); 
						КонецЕсли;
						
						//Изменившиеся данные
						СтрокаДереваИзменившиесяДанные = СтрокаДереваЗаявление.Строки.Найти("ИзменившиесяДанные");
						Если СтрокаДереваИзменившиесяДанные <> Неопределено Тогда
							СтрокаДереваФИО = СтрокаДереваИзменившиесяДанные.Строки.Найти("ФИО");
							Если СтрокаДереваФИО <> Неопределено Тогда
								ОбластьЗаявление.Параметры.Фамилия 				= ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваФИО, "Фамилия");
								ОбластьЗаявление.Параметры.Имя 					= ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваФИО, "Имя");
								ПризнакОтменыОтчества = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваЗаявление, "ПризнакОтменыОтчества");
								ОбластьЗаявление.Параметры.Отчество 			= ?(ПризнакОтменыОтчества = "ОТМЕНЕНО", "отменено", ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваФИО, "Отчество")); 
							КонецЕсли;
							Пол = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваИзменившиесяДанные, "Пол");
							Если Пол = "МУЖСКОЙ" Тогда
								ОбластьЗаявление.Параметры.Пол 					= "М     (м/ж)"; 
							ИначеЕсли Пол = "ЖЕНСКИЙ" Тогда
								ОбластьЗаявление.Параметры.Пол 					= "Ж     (м/ж)"; 
							Иначе
								ОбластьЗаявление.Параметры.Пол 					= "      (м/ж)"; 
							КонецЕсли;
							
							
							СтрокаДереваДатаРожденияОсобая = СтрокаДереваИзменившиесяДанные.Строки.Найти("ДатаРожденияОсобая");
							Если СтрокаДереваДатаРожденияОсобая = Неопределено Тогда
								ДатаРождения = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваИзменившиесяДанные, "ДатаРождения");
								Если ЗначениеЗаполнено(ДатаРождения) Тогда
									ОбластьЗаявление.Параметры.ДатаРождения	= ПроцедурыПерсонифицированногоУчета.ДатаXMLВОтчет(ДатаРождения); 
								Иначе
									ОбластьЗаявление.Параметры.ДатаРождения	= ""
								КонецЕсли;
							Иначе
								ОбластьЗаявление.Параметры.ДатаРождения = 
								ПроцедурыПерсонифицированногоУчета.ДатаВОтчет(Дата(ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваДатаРожденияОсобая,"Год"),
								ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваДатаРожденияОсобая,"Месяц"),
								ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваДатаРожденияОсобая,"День"))); 
							КонецЕсли;
							
							//Место рождения
							СтрокаДереваМестоРождения = СтрокаДереваИзменившиесяДанные.Строки.Найти("МестоРождения");
							Если СтрокаДереваМестоРождения <> Неопределено Тогда
								ТипМестаРождения = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваМестоРождения, "ТипМестаРождения");
								Если ТипМестаРождения = "ОСОБОЕ" Тогда
									ОбластьЗаявление.Параметры.МестоРожденияТип = "особое";
								КонецЕсли;
								ОбластьЗаявление.Параметры.МестоРожденияГород = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваМестоРождения, "ГородРождения");
								ОбластьЗаявление.Параметры.МестоРожденияРайон = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваМестоРождения, "РайонРождения");
								ОбластьЗаявление.Параметры.МестоРожденияОбласть = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваМестоРождения, "РегионРождения");
								ОбластьЗаявление.Параметры.МестоРожденияСтрана = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваМестоРождения, "СтранаРождения");
							КонецЕсли;
							
							ОбластьЗаявление.Параметры.Гражданство = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваИзменившиесяДанные, "Гражданство");
							
							//Адреса
							СтрокаДереваАдресРегистрации = СтрокаДереваИзменившиесяДанные.Строки.Найти("АдресРегистрации");
							Если СтрокаДереваАдресРегистрации <> Неопределено Тогда
								ОбластьЗаявление.Параметры.АдресРегистрации = ПроцедурыПерсонифицированногоУчета.ПредставлениеАдресадляПФР(СтрокаДереваАдресРегистрации);
							КонецЕсли;
							
							СтрокаДереваАдресФактический = СтрокаДереваИзменившиесяДанные.Строки.Найти("АдресФактический");
							Если СтрокаДереваАдресФактический <> Неопределено Тогда
								ОбластьЗаявление.Параметры.АдресФактический = ПроцедурыПерсонифицированногоУчета.ПредставлениеАдресадляПФР(СтрокаДереваАдресФактический);
							КонецЕсли;
							
							ОбластьЗаявление.Параметры.Телефоны = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваИзменившиесяДанные, "Телефон");
							
							
							
						КонецЕсли;
						
						//Паспортные данные
						СтрокаДереваУдостоверяющийДокумент = СтрокаДереваЗаявление.Строки.Найти("УдостоверяющийДокумент");
						Если СтрокаДереваУдостоверяющийДокумент <> Неопределено Тогда
							ТипУдостоверяющего = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваУдостоверяющийДокумент, "ТипУдостоверяющего");
							
							СтрокаДереваДокумент = СтрокаДереваУдостоверяющийДокумент.Строки.Найти("Документ");
							Если СтрокаДереваДокумент <> Неопределено Тогда
								
								НаименованиеДокумента = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваДокумент, "НаименованиеУдостоверяющего");
								Серия1 = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваДокумент, "СерияРимскиеЦифры");
								Серия2 = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваДокумент, "СерияРусскиеБуквы");
								СерияНомер = Серия1 +?(ТипУдостоверяющего = "ПАСПОРТ РОССИИ", " ", ?(ТипУдостоверяющего = "ПАСПОРТ", "-", "") ) + Серия2 +",  " + ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваДокумент, "НомерУдостоверяющего");
								ОбластьЗаявление.Параметры.НаименованиеДокумента = НаименованиеДокумента;
								ОбластьЗаявление.Параметры.СерияНомер = СерияНомер;
								ОбластьЗаявление.Параметры.ДатаВыдачи = ПроцедурыПерсонифицированногоУчета.ДатаXMLВОтчет(ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваДокумент, "ДатаВыдачи"));
								ОбластьЗаявление.Параметры.КемВыдан = СокрЛП(ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваДокумент, "КемВыдан"));
								
							КонецЕсли;
							
						КонецЕсли;
						
						//Подвал
						ОбластьЗаявление.Параметры.ДатаЗаполнения = "Дата заполнения " + Символы.ПС + ПроцедурыПерсонифицированногоУчета.ДатаXMLВОтчет(ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваЗаявление, "ДатаЗаполнения"));
						
						
						//Поля, присутствующие только в форме АДВ-3
						Если СтрокаДереваЗаявление.Имя = "ЗАЯВЛЕНИЕ_О_ДУБЛИКАТЕ" Тогда 
							ПолИзСтрахового = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваЗаявление, "ПолИзСтрахового");
							
							Если ПолИзСтрахового = "МУЖСКОЙ" Тогда
								ОбластьЗаявление.Параметры.ПолВСвидетельстве 					= "М     (м/ж)"; 
							ИначеЕсли ПолИзСтрахового = "ЖЕНСКИЙ" Тогда
								ОбластьЗаявление.Параметры.ПолВСвидетельстве 					= "Ж     (м/ж)"; 
							КонецЕсли;
							
							СтрокаДереваДатаРожденияОсобая = СтрокаДереваЗаявление.Строки.Найти("ДатаРожденияИзСтраховогоОсобая");
							Если СтрокаДереваДатаРожденияОсобая = Неопределено Тогда
								ОбластьЗаявление.Параметры.ДатаРожденияВСвидетельстве = ПроцедурыПерсонифицированногоУчета.ДатаXMLВОтчет(ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваЗаявление, "ДатаРожденияИзСтрахового")); 
							Иначе
								ОбластьЗаявление.Параметры.ДатаРожденияВСвидетельстве = 
								ПроцедурыПерсонифицированногоУчета.ДатаВОтчет(Дата(ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваДатаРожденияОсобая,"Год"),
								ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваДатаРожденияОсобая,"Месяц"),
								ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваДатаРожденияОсобая,"День"))); 
							КонецЕсли;
							
							//Место рождения, указанное в свидетельстве
							СтрокаДереваМестоРождения = СтрокаДереваЗаявление.Строки.Найти("МестоРожденияИзСтрахового");
							Если СтрокаДереваМестоРождения <> Неопределено Тогда
								ТипМестаРождения = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваМестоРождения, "ТипМестаРождения");
								Если ТипМестаРождения = "ОСОБОЕ" Тогда
									//ОбластьАнкета.Параметры.МестоРожденияТип = "особое";
								КонецЕсли;
								ОбластьЗаявление.Параметры.МестоРожденияГородВСвидетельстве = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваМестоРождения, "ГородРождения");
								ОбластьЗаявление.Параметры.МестоРожденияРайонВСвидетельстве = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваМестоРождения, "РайонРождения");
								ОбластьЗаявление.Параметры.МестоРожденияОбластьВСвидетельстве = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваМестоРождения, "РегионРождения");
								ОбластьЗаявление.Параметры.МестоРожденияСтранаВСвидетельстве = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваМестоРождения, "СтранаРождения");
							КонецЕсли;
							
							
							ОтметкаОПредставленииСведений = ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваЗаявление, "ОтметкаОпредставленииСведений");
							Если ОтметкаОПредставленииСведений <> "ПРЕДСТАВЛЕНЫ РАНЕЕ" Тогда
								ОбластьЗаявление.Области.СведенияПредставлялись.Шрифт 		= ЗачеркнутыйШрифт;
								ОбластьЗаявление.Области.СведенияБудутПредставлены.Шрифт 	= НормальныйШрифт;
							Иначе	
								ОбластьЗаявление.Области.СведенияПредставлялись.Шрифт 		= НормальныйШрифт;
								ОбластьЗаявление.Области.СведенияБудутПредставлены.Шрифт 	= ЗачеркнутыйШрифт;
							КонецЕсли;	 
							ОтветственныеЛица = РегламентированнаяОтчетность.ОтветственныеЛицаОрганизаций(Организация,Дата,Ответственный.ФизЛицо);
							ОбластьЗаявление.Параметры.ДатаЗаполнения = ПроцедурыПерсонифицированногоУчета.ДатаXMLВОтчет(ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваЗаявление, "ДатаЗаполнения"));
							ОбластьЗаявление.Параметры.ДолжностьРуководителя		 		= ОтветственныеЛица.РуководительДолжность;
							ОбластьЗаявление.Параметры.РасшифровкаПодписиРуководителя	= ОтветственныеЛица.Руководитель;
						КонецЕсли;	
						
						ДокументРезультат.Вывести(ОбластьЗаявление);
						ДокументРезультат.ВывестиГоризонтальныйРазделительСтраниц();
						
						Для Сч = 1 По ОбластьЗаявление.Параметры.Количество() Цикл
							ОбластьЗаявление.Параметры.Установить(Сч - 1,"");
						КонецЦикла;
						
					КонецЕсли;
				КонецЦикла;
				
				Если СтрокаДереваЗаявление.Имя = "ЗАЯВЛЕНИЕ_ОБ_ОБМЕНЕ" Тогда
					УниверсальныеМеханизмы.НапечататьДокумент(ДокументРезультат,1,Ложь,"Заявления об обмене страхового свидетельства АДВ-2",,ДокументРезультат);
					ТипДокумента = "ОБМН";
				иначе	
					УниверсальныеМеханизмы.НапечататьДокумент(ДокументРезультат,1,Ложь,"Заявления о выдаче дубликата страхового свидетельства АДВ-3",,ДокументРезультат);
					ТипДокумента = "ДУБЛ";
				КонецЕсли;	 
				
				//Печать описи документов
				СтрокаДереваОпись = СтрокаДереваПачкаВходящихДокументов.Строки.Найти("ВХОДЯЩАЯ_ОПИСЬ");
				Если СтрокаДереваОпись <> Неопределено Тогда
					ДокументОписи = Новый ТабличныйДокумент;
					ДокументОписи.ИмяПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства_АДВ_6";
					ОтветственныеЛица = РегламентированнаяОтчетность.ОтветственныеЛицаОрганизаций(Организация,Дата,Ответственный.ФизЛицо);
					ИнформацияОПачке = Новый Структура;
					ИнформацияОПачке.Вставить("ИнформацияОРаботодателе", Организация);
					ИнформацияОПачке.Вставить("ТипДокумента", ТипДокумента);
					СтрокаДереваСоставДокументов = СтрокаДереваОпись.Строки.Найти("СоставДокументов");
					Если СтрокаДереваСоставДокументов <> Неопределено Тогда
						СтрокаДереваНаличиеДокументов = СтрокаДереваСоставДокументов.Строки.Найти("НаличиеДокументов");
						Если СтрокаДереваНаличиеДокументов <> Неопределено Тогда
							ИнформацияОПачке.Вставить("ДокументовВПачке",ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваНаличиеДокументов, "Количество"));
						КонецЕсли;
					КонецЕсли;
					
					СтрокаДереваНомерПачки = СтрокаДереваОпись.Строки.Найти("НомерПачки");
					Если СтрокаДереваНомерПачки  <> Неопределено Тогда
						СтрокаДереваОсновной = СтрокаДереваНомерПачки.Строки.Найти("Основной");
						Если СтрокаДереваОсновной <> Неопределено Тогда
							ИнформацияОПачке.Вставить("НомерПачкиРаботодателя", ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваНомерПачки, "Основной"));
						Иначе
							ИнформацияОПачке.Вставить("НомерПачкиРаботодателя", ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваНомерПачки, "ПоПодразделению"));
						КонецЕсли;
					КонецЕсли;
					ИнформацияОПачке.Вставить("ДатаСоставленияОписи",ПроцедурыПерсонифицированногоУчета.ДатаXMLВОтчет(ПроцедурыПерсонифицированногоУчета.ИзвлечьДанное(СтрокаДереваОпись, "ДатаСоставления"),Ложь));
					ПроцедурыПерсонифицированногоУчета.ВывестиОписьАДВ6(ДокументОписи,ИнформацияОПачке,ОтветственныеЛица, ЗаменятьБуквуЕ);
					Возврат УниверсальныеМеханизмы.НапечататьДокумент(ДокументОписи,1,Ложь,"Опись документов АДВ-6");
				КонецЕсли;
				
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
КонецФункции // Печать

#КонецЕсли

// Возвращает доступные варианты печати документа
//
// Возвращаемое значение:
//  Структура, каждая строка которой соответствует одному из вариантов печати
//  
Функция ПолучитьСтруктуруПечатныхФорм() Экспорт
	
	Возврат Новый Структура("ПечатьФайла","АДВ-2,3");
	
КонецФункции // ПолучитьСтруктуруПечатныхФорм()

//Процедура выполняет заполнение реквизитов заявлений табличной части документа
Процедура ЗаполнитьДанныеЗаявлений() Экспорт
	
	//Запрос среза данных на даты, указанные в реквизите "ДатаПолученияСвидетельства"
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ВводимыйДокумент" , 		Ссылка);
	Запрос.УстановитьПараметр("ВыбранныйПериод",		Дата);
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.НомерСтроки КАК НомерСтроки,
	|	ВЫБОР
	|		КОГДА ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.ДатаПолученияСвидетельства = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.Ссылка.Дата
	|		ИНАЧЕ ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.ДатаПолученияСвидетельства
	|	КОНЕЦ КАК УточненнаяДатаПолученияСвидетельства,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.ДатаПолученияСвидетельства КАК ДатаПолученияСвидетельства,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.ФизЛицо КАК ФизЛицо,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.Ссылка.Дата КАК ДатаЗаявления,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.Ссылка.ВидАДВ КАК ВидАДВ,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.ФизЛицо.СтраховойНомерПФР,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.ФизЛицо.Пол,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.ФизЛицо.ДатаРождения,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.ФизЛицо.МестоРождения,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.Ссылка.Организация
	|ПОМЕСТИТЬ ВТСписокФизлиц
	|ИЗ
	|	Документ.ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.РаботникиОрганизации КАК ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации
	|ГДЕ
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.Ссылка = &ВводимыйДокумент
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ФизЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДомашниеТелефоны.Поле3,
	|	ДомашниеТелефоны.Объект КАК Объект
	|ПОМЕСТИТЬ ВТДомашниеТелефоны
	|ИЗ
	|	РегистрСведений.КонтактнаяИнформация КАК ДомашниеТелефоны
	|ГДЕ
	|	ДомашниеТелефоны.Объект В
	|			(ВЫБРАТЬ
	|				СписокФизЛиц.ФизЛицо
	|			ИЗ
	|				ВТСписокФизлиц КАК СписокФизЛиц)
	|	И ДомашниеТелефоны.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ТелефонФизЛица)
	|	И ДомашниеТелефоны.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Телефон)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Объект
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	АдресаФактические.Поле1,
	|	АдресаФактические.Поле2,
	|	АдресаФактические.Поле3,
	|	АдресаФактические.Поле4,
	|	АдресаФактические.Поле5,
	|	АдресаФактические.Поле6,
	|	АдресаФактические.Поле7,
	|	АдресаФактические.Поле8,
	|	АдресаФактические.Поле9,
	|	АдресаФактические.ТипДома,
	|	АдресаФактические.ТипКорпуса,
	|	АдресаФактические.ТипКвартиры,
	|	АдресаФактические.Объект КАК Объект
	|ПОМЕСТИТЬ ВТАдресаФактические
	|ИЗ
	|	РегистрСведений.КонтактнаяИнформация КАК АдресаФактические
	|ГДЕ
	|	АдресаФактические.Объект В
	|			(ВЫБРАТЬ
	|				СписокФизЛиц.ФизЛицо
	|			ИЗ
	|				ВТСписокФизлиц КАК СписокФизЛиц)
	|	И АдресаФактические.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ФактАдресФизЛица)
	|	И АдресаФактические.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Адрес)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Объект
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	АдресаРегистрации.Поле1,
	|	АдресаРегистрации.Поле2,
	|	АдресаРегистрации.Поле3,
	|	АдресаРегистрации.Поле4,
	|	АдресаРегистрации.Поле5,
	|	АдресаРегистрации.Поле6,
	|	АдресаРегистрации.Поле7,
	|	АдресаРегистрации.Поле8,
	|	АдресаРегистрации.Поле9,
	|	АдресаРегистрации.ТипДома,
	|	АдресаРегистрации.ТипКорпуса,
	|	АдресаРегистрации.ТипКвартиры,
	|	АдресаРегистрации.Объект КАК Объект
	|ПОМЕСТИТЬ ВТАдресаРегистрации
	|ИЗ
	|	РегистрСведений.КонтактнаяИнформация КАК АдресаРегистрации
	|ГДЕ
	|	АдресаРегистрации.Объект В
	|			(ВЫБРАТЬ
	|				СписокФизЛиц.ФизЛицо
	|			ИЗ
	|				ВТСписокФизлиц КАК СписокФизЛиц)
	|	И АдресаРегистрации.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ЮрАдресФизЛица)
	|	И АдресаРегистрации.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Адрес)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Объект
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.ФизЛицо КАК ФизЛицо,
	|	Анкета.АдресРегистрации,
	|	Анкета.АдресФактический,
	|	Анкета.Телефоны,
	|	Анкета.Фамилия,
	|	Анкета.Имя,
	|	Анкета.Отчество,
	|	Анкета.Пол,
	|	Анкета.ДатаРождения,
	|	Анкета.МестоРождения,
	|	Анкета.Гражданство,
	|	Анкета.Ссылка.Дата КАК ДатаАнкеты
	|ПОМЕСТИТЬ ВТАнкетысотрудников
	|ИЗ
	|	ВТСписокФизлиц КАК ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.АнкетаЗастрахованногоЛица.РаботникиОрганизации КАК Анкета
	|		ПО ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.ФизЛицо = Анкета.ФизЛицо
	|			И ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.Организация = Анкета.Ссылка.Организация
	|			И ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.УточненнаяДатаПолученияСвидетельства >= Анкета.Ссылка.Дата
	|			И (Анкета.Ссылка.Проведен)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ФизЛицо,
	|	ДатаАнкеты
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	МаксимальныеДатыПоСотрудникам.ФизЛицо КАК ФизЛицо,
	|	Анкета.Фамилия КАК Фамилия,
	|	Анкета.Имя КАК Имя,
	|	Анкета.Отчество КАК Отчество,
	|	Анкета.Пол КАК Пол,
	|	Анкета.ДатаРождения КАК ДатаРождения,
	|	Анкета.МестоРождения КАК МестоРождения,
	|	ВЫБОР
	|		КОГДА Анкета.Гражданство = ЗНАЧЕНИЕ(Справочник.КлассификаторСтранМира.ПустаяСсылка)
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.КлассификаторСтранМира.Россия)
	|		ИНАЧЕ Анкета.Гражданство
	|	КОНЕЦ КАК Гражданство,
	|	Анкета.АдресРегистрации КАК АдресРегистрации,
	|	Анкета.АдресФактический КАК АдресФактический,
	|	Анкета.Телефоны КАК Телефоны
	|ПОМЕСТИТЬ ВТДанныеАнкет
	|ИЗ
	|	(ВЫБРАТЬ
	|		МАКСИМУМ(Анкета.ДатаАнкеты) КАК МаксимальнаяДата,
	|		Анкета.ФизЛицо КАК ФизЛицо
	|	ИЗ
	|		ВТАнкетысотрудников КАК Анкета
	|	
	|	СГРУППИРОВАТЬ ПО
	|		Анкета.ФизЛицо) КАК МаксимальныеДатыПоСотрудникам
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТАнкетысотрудников КАК Анкета
	|		ПО МаксимальныеДатыПоСотрудникам.МаксимальнаяДата = Анкета.ДатаАнкеты
	|			И МаксимальныеДатыПоСотрудникам.ФизЛицо = Анкета.ФизЛицо
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ФизЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.ФизЛицо КАК ФизЛицо,
	|	Заявление.Ссылка.Дата КАК ДатаСтарогоДокумента,
	|	Заявление.Гражданство,
	|	Заявление.АдресРегистрации,
	|	Заявление.АдресФактический,
	|	Заявление.Телефоны,
	|	Заявление.Фамилия,
	|	Заявление.Имя,
	|	Заявление.Отчество,
	|	Заявление.ФамилияВСвидетельстве,
	|	Заявление.ИмяВСвидетельстве,
	|	Заявление.ОтчествоВСвидетельстве,
	|	Заявление.Пол,
	|	Заявление.ПолВСвидетельстве,
	|	Заявление.ДатаРождения,
	|	Заявление.ДатаРожденияВСвидетельстве,
	|	Заявление.МестоРождения,
	|	Заявление.МестоРожденияВСвидетельстве
	|ПОМЕСТИТЬ ВТПредыдущиеЗаявления
	|ИЗ
	|	ВТСписокФизлиц КАК ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.РаботникиОрганизации КАК Заявление
	|		ПО ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.ФизЛицо = Заявление.ФизЛицо
	|			И (Заявление.Ссылка.Проведен)
	|			И (Заявление.Ссылка <> &ВводимыйДокумент)
	|			И ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.Организация = Заявление.Ссылка.Организация
	|			И (Заявление.Ссылка.Дата <= ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.УточненнаяДатаПолученияСвидетельства)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ФизЛицо,
	|	ДатаСтарогоДокумента
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	МаксимальныеДатыПоСотрудникам.ФизЛицо КАК ФизЛицо,
	|	ВЫБОР
	|		КОГДА Заявление.Фамилия = """"
	|			ТОГДА Заявление.ФамилияВСвидетельстве
	|		ИНАЧЕ Заявление.Фамилия
	|	КОНЕЦ КАК Фамилия,
	|	ВЫБОР
	|		КОГДА Заявление.Имя = """"
	|			ТОГДА Заявление.ИмяВСвидетельстве
	|		ИНАЧЕ Заявление.Имя
	|	КОНЕЦ КАК Имя,
	|	ВЫБОР
	|		КОГДА Заявление.Отчество = """"
	|			ТОГДА Заявление.ОтчествоВСвидетельстве
	|		ИНАЧЕ Заявление.Отчество
	|	КОНЕЦ КАК Отчество,
	|	ВЫБОР
	|		КОГДА Заявление.Пол = ЗНАЧЕНИЕ(Перечисление.ПолФизическихЛиц.ПустаяСсылка)
	|			ТОГДА Заявление.ПолВСвидетельстве
	|		ИНАЧЕ Заявление.Пол
	|	КОНЕЦ КАК Пол,
	|	ВЫБОР
	|		КОГДА Заявление.ДатаРождения = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА Заявление.ДатаРожденияВСвидетельстве
	|		ИНАЧЕ Заявление.ДатаРождения
	|	КОНЕЦ КАК ДатаРождения,
	|	ВЫБОР
	|		КОГДА Заявление.МестоРождения = """"
	|			ТОГДА Заявление.МестоРожденияВСвидетельстве
	|		ИНАЧЕ Заявление.МестоРождения
	|	КОНЕЦ КАК МестоРождения
	|ПОМЕСТИТЬ ВТСтарыеДанные
	|ИЗ
	|	(ВЫБРАТЬ
	|		МАКСИМУМ(Заявление.ДатаСтарогоДокумента) КАК МаксимальнаяДата,
	|		Заявление.ФизЛицо КАК ФизЛицо
	|	ИЗ
	|		ВТПредыдущиеЗаявления КАК Заявление
	|	
	|	СГРУППИРОВАТЬ ПО
	|		Заявление.ФизЛицо) КАК МаксимальныеДатыПоСотрудникам
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТПредыдущиеЗаявления КАК Заявление
	|		ПО МаксимальныеДатыПоСотрудникам.МаксимальнаяДата = Заявление.ДатаСтарогоДокумента
	|			И МаксимальныеДатыПоСотрудникам.ФизЛицо = Заявление.ФизЛицо
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ФизЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	МаксимальныеДатыПоСотрудникам.ФизЛицо КАК ФизЛицо,
	|	Заявление.Гражданство КАК Гражданство
	|ПОМЕСТИТЬ ВТСтарыеДанныеОГражданстве
	|ИЗ
	|	(ВЫБРАТЬ
	|		МАКСИМУМ(Заявление.ДатаСтарогоДокумента) КАК МаксимальнаяДата,
	|		Заявление.ФизЛицо КАК ФизЛицо
	|	ИЗ
	|		ВТПредыдущиеЗаявления КАК Заявление
	|	ГДЕ
	|		Заявление.Гражданство <> ЗНАЧЕНИЕ(Справочник.КлассификаторСтранМира.ПустаяСсылка)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		Заявление.ФизЛицо) КАК МаксимальныеДатыПоСотрудникам
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТПредыдущиеЗаявления КАК Заявление
	|		ПО МаксимальныеДатыПоСотрудникам.МаксимальнаяДата = Заявление.ДатаСтарогоДокумента
	|			И МаксимальныеДатыПоСотрудникам.ФизЛицо = Заявление.ФизЛицо
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ФизЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	МаксимальныеДатыПоСотрудникам.ФизЛицо КАК ФизЛицо,
	|	Заявление.Телефоны КАК Телефоны
	|ПОМЕСТИТЬ ВТСтарыеДанныеОТелефоне
	|ИЗ
	|	(ВЫБРАТЬ
	|		МАКСИМУМ(Заявление.ДатаСтарогоДокумента) КАК МаксимальнаяДата,
	|		Заявление.ФизЛицо КАК ФизЛицо
	|	ИЗ
	|		ВТПредыдущиеЗаявления КАК Заявление
	|	ГДЕ
	|		Заявление.Телефоны <> """"
	|	
	|	СГРУППИРОВАТЬ ПО
	|		Заявление.ФизЛицо) КАК МаксимальныеДатыПоСотрудникам
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТПредыдущиеЗаявления КАК Заявление
	|		ПО МаксимальныеДатыПоСотрудникам.МаксимальнаяДата = Заявление.ДатаСтарогоДокумента
	|			И МаксимальныеДатыПоСотрудникам.ФизЛицо = Заявление.ФизЛицо
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ФизЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	МаксимальныеДатыПоСотрудникам.ФизЛицо КАК ФизЛицо,
	|	Заявление.АдресФактический КАК АдресФактический
	|ПОМЕСТИТЬ ВТСтарыеДанныеАдресаФактического
	|ИЗ
	|	(ВЫБРАТЬ
	|		МАКСИМУМ(Заявление.ДатаСтарогоДокумента) КАК МаксимальнаяДата,
	|		Заявление.ФизЛицо КАК ФизЛицо
	|	ИЗ
	|		ВТПредыдущиеЗаявления КАК Заявление
	|	ГДЕ
	|		Заявление.АдресФактический <> """"
	|	
	|	СГРУППИРОВАТЬ ПО
	|		Заявление.ФизЛицо) КАК МаксимальныеДатыПоСотрудникам
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТПредыдущиеЗаявления КАК Заявление
	|		ПО МаксимальныеДатыПоСотрудникам.МаксимальнаяДата = Заявление.ДатаСтарогоДокумента
	|			И МаксимальныеДатыПоСотрудникам.ФизЛицо = Заявление.ФизЛицо
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ФизЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	МаксимальныеДатыПоСотрудникам.ФизЛицо КАК ФизЛицо,
	|	Заявление.АдресРегистрации КАК АдресРегистрации
	|ПОМЕСТИТЬ ВТСтарыеДанныеАдресаРегистрации
	|ИЗ
	|	(ВЫБРАТЬ
	|		МАКСИМУМ(Заявление.ДатаСтарогоДокумента) КАК МаксимальнаяДата,
	|		Заявление.ФизЛицо КАК ФизЛицо
	|	ИЗ
	|		ВТПредыдущиеЗаявления КАК Заявление
	|	ГДЕ
	|		Заявление.АдресРегистрации <> """"
	|	
	|	СГРУППИРОВАТЬ ПО
	|		Заявление.ФизЛицо) КАК МаксимальныеДатыПоСотрудникам
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТПредыдущиеЗаявления КАК Заявление
	|		ПО МаксимальныеДатыПоСотрудникам.МаксимальнаяДата = Заявление.ДатаСтарогоДокумента
	|			И МаксимальныеДатыПоСотрудникам.ФизЛицо = Заявление.ФизЛицо
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ФизЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	МАКСИМУМ(СведенияОТрудовомСтажеИЗаработкеСЗВ4РаботникиОрганизации.Ссылка.Дата) КАК Ссылка,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.ФизЛицо КАК ФизЛицо
	|ПОМЕСТИТЬ ВТДанныеОСЗВ4
	|ИЗ
	|	ВТСписокФизлиц КАК ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СведенияОТрудовомСтажеИЗаработкеСЗВ4.РаботникиОрганизации КАК СведенияОТрудовомСтажеИЗаработкеСЗВ4РаботникиОрганизации
	|		ПО ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.ФизЛицо = СведенияОТрудовомСтажеИЗаработкеСЗВ4РаботникиОрганизации.ФизЛицо
	|			И ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.Организация = СведенияОТрудовомСтажеИЗаработкеСЗВ4РаботникиОрганизации.Ссылка.Организация
	|			И (СведенияОТрудовомСтажеИЗаработкеСЗВ4РаботникиОрганизации.Ссылка.Проведен)
	|			И (СведенияОТрудовомСтажеИЗаработкеСЗВ4РаботникиОрганизации.Ссылка.Дата МЕЖДУ НАЧАЛОПЕРИОДА(ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.ДатаЗаявления, ГОД) И ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.ДатаЗаявления)
	|
	|СГРУППИРОВАТЬ ПО
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельстваРаботникиОрганизации.ФизЛицо
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ФизЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ФИОФизЛиц.ФизЛицо КАК ФизЛицо,
	|	ФИОФизЛиц.Фамилия,
	|	ФИОФизЛиц.Имя,
	|	ФИОФизЛиц.Отчество
	|ПОМЕСТИТЬ ВТФИО
	|ИЗ
	|	РегистрСведений.ФИОФизЛиц.СрезПоследних(
	|			&ВыбранныйПериод,
	|			ФизЛицо В
	|				(ВЫБРАТЬ
	|					СписокФизЛиц.ФизЛицо
	|				ИЗ
	|					ВТСписокФизлиц КАК СписокФизЛиц)) КАК ФИОФизЛиц
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ФизЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ГражданствоФизЛиц.ФизЛицо КАК ФизЛицо,
	|	ГражданствоФизЛиц.Страна
	|ПОМЕСТИТЬ ВТГражданство
	|ИЗ
	|	РегистрСведений.ГражданствоФизЛиц.СрезПоследних(
	|			&ВыбранныйПериод,
	|			ФизЛицо В
	|				(ВЫБРАТЬ
	|					СписокФизЛиц.ФизЛицо
	|				ИЗ
	|					ВТСписокФизлиц КАК СписокФизЛиц)) КАК ГражданствоФизЛиц
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ФизЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НомераСтрок.НомерСтроки КАК НомерСтроки,
	|	НомераСтрок.ФизЛицо,
	|	НомераСтрок.ДатаПолученияСвидетельства,
	|	НомераСтрок.ФизЛицоСтраховойНомерПФР КАК СтраховойНомерПФРВСвидетельстве,
	|	ВЫБОР
	|		КОГДА СтарыеДанные.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА СтарыеДанные.Фамилия
	|		КОГДА ДанныеАнкет.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ДанныеАнкет.Фамилия
	|		ИНАЧЕ ФИОСрезПоследних.Фамилия
	|	КОНЕЦ КАК ФамилияВСвидетельстве,
	|	ВЫБОР
	|		КОГДА СтарыеДанные.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА СтарыеДанные.Имя
	|		КОГДА ДанныеАнкет.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ДанныеАнкет.Имя
	|		ИНАЧЕ ФИОСрезПоследних.Имя
	|	КОНЕЦ КАК ИмяВСвидетельстве,
	|	ВЫБОР
	|		КОГДА СтарыеДанные.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА СтарыеДанные.Отчество
	|		КОГДА ДанныеАнкет.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ДанныеАнкет.Отчество
	|		ИНАЧЕ ФИОСрезПоследних.Отчество
	|	КОНЕЦ КАК ОтчествоВСвидетельстве,
	|	ВЫБОР
	|		КОГДА СтарыеДанные.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА СтарыеДанные.Пол
	|		КОГДА ДанныеАнкет.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ДанныеАнкет.Пол
	|		ИНАЧЕ НомераСтрок.ФизЛицоПол
	|	КОНЕЦ КАК ПолВСвидетельстве,
	|	ВЫБОР
	|		КОГДА СтарыеДанные.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА СтарыеДанные.ДатаРождения
	|		КОГДА ДанныеАнкет.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ДанныеАнкет.ДатаРождения
	|		ИНАЧЕ НомераСтрок.ФизЛицоДатаРождения
	|	КОНЕЦ КАК ДатаРожденияВСвидетельстве,
	|	ВЫБОР
	|		КОГДА СтарыеДанные.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА СтарыеДанные.МестоРождения
	|		КОГДА ДанныеАнкет.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ДанныеАнкет.МестоРождения
	|		ИНАЧЕ НомераСтрок.ФизЛицоМестоРождения
	|	КОНЕЦ КАК МестоРожденияВСвидетельстве,
	|	ВЫБОР
	|		КОГДА СтарыеДанные.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА ФИОСрезПоследних.Фамилия <> СтарыеДанные.Фамилия
	|						ТОГДА ФИОСрезПоследних.Фамилия
	|					ИНАЧЕ """"
	|				КОНЕЦ
	|		КОГДА ДанныеАнкет.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА ФИОСрезПоследних.Фамилия <> ДанныеАнкет.Фамилия
	|						ТОГДА ФИОСрезПоследних.Фамилия
	|					ИНАЧЕ """"
	|				КОНЕЦ
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК Фамилия,
	|	ВЫБОР
	|		КОГДА СтарыеДанные.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА ФИОСрезПоследних.Имя <> СтарыеДанные.Имя
	|						ТОГДА ФИОСрезПоследних.Имя
	|					ИНАЧЕ """"
	|				КОНЕЦ
	|		КОГДА ДанныеАнкет.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА ФИОСрезПоследних.Имя <> ДанныеАнкет.Имя
	|						ТОГДА ФИОСрезПоследних.Имя
	|					ИНАЧЕ """"
	|				КОНЕЦ
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК Имя,
	|	ВЫБОР
	|		КОГДА СтарыеДанные.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА ФИОСрезПоследних.Отчество <> СтарыеДанные.Отчество
	|						ТОГДА ФИОСрезПоследних.Отчество
	|					ИНАЧЕ """"
	|				КОНЕЦ
	|		КОГДА ДанныеАнкет.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА ФИОСрезПоследних.Отчество <> ДанныеАнкет.Отчество
	|						ТОГДА ФИОСрезПоследних.Отчество
	|					ИНАЧЕ """"
	|				КОНЕЦ
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК Отчество,
	|	ВЫБОР
	|		КОГДА СтарыеДанные.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА СтарыеДанные.Отчество <> """"
	|							И ФИОСрезПоследних.Отчество = """"
	|						ТОГДА ИСТИНА
	|					ИНАЧЕ ЛОЖЬ
	|				КОНЕЦ
	|		КОГДА ДанныеАнкет.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА ДанныеАнкет.Отчество <> """"
	|							И ФИОСрезПоследних.Отчество = """"
	|						ТОГДА ИСТИНА
	|					ИНАЧЕ ЛОЖЬ
	|				КОНЕЦ
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ПризнакОтменыОтчества,
	|	ВЫБОР
	|		КОГДА СтарыеДанные.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА НомераСтрок.ФизЛицоПол = СтарыеДанные.Пол
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.ПолФизическихЛиц.ПустаяСсылка)
	|					ИНАЧЕ НомераСтрок.ФизЛицоПол
	|				КОНЕЦ
	|		КОГДА ДанныеАнкет.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА НомераСтрок.ФизЛицоПол = ДанныеАнкет.Пол
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.ПолФизическихЛиц.ПустаяСсылка)
	|					ИНАЧЕ НомераСтрок.ФизЛицоПол
	|				КОНЕЦ
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ПолФизическихЛиц.ПустаяСсылка)
	|	КОНЕЦ КАК Пол,
	|	ВЫБОР
	|		КОГДА СтарыеДанные.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА НомераСтрок.ФизЛицоДатаРождения = СтарыеДанные.ДатаРождения
	|						ТОГДА ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|					ИНАЧЕ НомераСтрок.ФизЛицоДатаРождения
	|				КОНЕЦ
	|		КОГДА ДанныеАнкет.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА НомераСтрок.ФизЛицоДатаРождения = ДанныеАнкет.ДатаРождения
	|						ТОГДА ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|					ИНАЧЕ НомераСтрок.ФизЛицоДатаРождения
	|				КОНЕЦ
	|		ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|	КОНЕЦ КАК ДатаРождения,
	|	ВЫБОР
	|		КОГДА СтарыеДанные.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА НомераСтрок.ФизЛицоМестоРождения = СтарыеДанные.МестоРождения
	|						ТОГДА """"
	|					ИНАЧЕ НомераСтрок.ФизЛицоМестоРождения
	|				КОНЕЦ
	|		КОГДА ДанныеАнкет.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА НомераСтрок.ФизЛицоМестоРождения = ДанныеАнкет.МестоРождения
	|						ТОГДА """"
	|					ИНАЧЕ НомераСтрок.ФизЛицоМестоРождения
	|				КОНЕЦ
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК МестоРождения,
	|	ВЫБОР
	|		КОГДА СтарыеДанныеОГражданстве.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА ЕСТЬNULL(ГражданствоФизЛицСрезПоследних.Страна, ЗНАЧЕНИЕ(Справочник.КлассификаторСтранМира.Россия)) = СтарыеДанныеОГражданстве.Гражданство
	|						ТОГДА ЗНАЧЕНИЕ(Справочник.КлассификаторСтранМира.ПустаяСсылка)
	|					ИНАЧЕ ЕСТЬNULL(ГражданствоФизЛицСрезПоследних.Страна, ЗНАЧЕНИЕ(Справочник.КлассификаторСтранМира.Россия))
	|				КОНЕЦ
	|		КОГДА ДанныеАнкет.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА ЕСТЬNULL(ГражданствоФизЛицСрезПоследних.Страна, ЗНАЧЕНИЕ(Справочник.КлассификаторСтранМира.Россия)) = ДанныеАнкет.Гражданство
	|						ТОГДА ЗНАЧЕНИЕ(Справочник.КлассификаторСтранМира.ПустаяСсылка)
	|					ИНАЧЕ ЕСТЬNULL(ГражданствоФизЛицСрезПоследних.Страна, ЗНАЧЕНИЕ(Справочник.КлассификаторСтранМира.Россия))
	|				КОНЕЦ
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.КлассификаторСтранМира.ПустаяСсылка)
	|	КОНЕЦ КАК Гражданство,
	|	ВЫБОР
	|		КОГДА СтарыеДанныеАдресаРегистрации.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА (ВЫРАЗИТЬ("","" + АдресаРегистрации.Поле1 + "","" + АдресаРегистрации.Поле2 + "","" + АдресаРегистрации.Поле3 + "","" + АдресаРегистрации.Поле4 + "","" + АдресаРегистрации.Поле5 + "","" + АдресаРегистрации.Поле6 + "","" + АдресаРегистрации.Поле7 + "","" + АдресаРегистрации.Поле8 + "","" + АдресаРегистрации.Поле9 + "","" + ВЫБОР
	|								КОГДА АдресаРегистрации.ТипДома В (ЗНАЧЕНИЕ(Перечисление.ТипыДомов.Дом), ЗНАЧЕНИЕ(Перечисление.ТипыДомов.ПустаяСсылка))
	|									ТОГДА ""дом""
	|								ИНАЧЕ ""владение""
	|							КОНЕЦ + "","" + ВЫБОР
	|								КОГДА АдресаРегистрации.ТипКорпуса В (ЗНАЧЕНИЕ(Перечисление.ТипыКорпусов.Корпус), ЗНАЧЕНИЕ(Перечисление.ТипыКорпусов.ПустаяСсылка))
	|									ТОГДА ""корпус""
	|								ИНАЧЕ ""строение""
	|							КОНЕЦ + "","" + ВЫБОР
	|								КОГДА АдресаРегистрации.ТипКвартиры В (ЗНАЧЕНИЕ(Перечисление.ТипыКвартир.Квартира), ЗНАЧЕНИЕ(Перечисление.ТипыКвартир.ПустаяСсылка))
	|									ТОГДА ""кв.""
	|								ИНАЧЕ ""оф.""
	|							КОНЕЦ КАК СТРОКА(240))) = СтарыеДанныеАдресаРегистрации.АдресРегистрации
	|						ТОГДА """"
	|					ИНАЧЕ "","" + АдресаРегистрации.Поле1 + "","" + АдресаРегистрации.Поле2 + "","" + АдресаРегистрации.Поле3 + "","" + АдресаРегистрации.Поле4 + "","" + АдресаРегистрации.Поле5 + "","" + АдресаРегистрации.Поле6 + "","" + АдресаРегистрации.Поле7 + "","" + АдресаРегистрации.Поле8 + "","" + АдресаРегистрации.Поле9 + "","" + ВЫБОР
	|							КОГДА АдресаРегистрации.ТипДома В (ЗНАЧЕНИЕ(Перечисление.ТипыДомов.Дом), ЗНАЧЕНИЕ(Перечисление.ТипыДомов.ПустаяСсылка))
	|								ТОГДА ""дом""
	|							ИНАЧЕ ""владение""
	|						КОНЕЦ + "","" + ВЫБОР
	|							КОГДА АдресаРегистрации.ТипКорпуса В (ЗНАЧЕНИЕ(Перечисление.ТипыКорпусов.Корпус), ЗНАЧЕНИЕ(Перечисление.ТипыКорпусов.ПустаяСсылка))
	|								ТОГДА ""корпус""
	|							ИНАЧЕ ""строение""
	|						КОНЕЦ + "","" + ВЫБОР
	|							КОГДА АдресаРегистрации.ТипКвартиры В (ЗНАЧЕНИЕ(Перечисление.ТипыКвартир.Квартира), ЗНАЧЕНИЕ(Перечисление.ТипыКвартир.ПустаяСсылка))
	|								ТОГДА ""кв.""
	|							ИНАЧЕ ""оф.""
	|						КОНЕЦ
	|				КОНЕЦ
	|		КОГДА ДанныеАнкет.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА (ВЫРАЗИТЬ("","" + АдресаРегистрации.Поле1 + "","" + АдресаРегистрации.Поле2 + "","" + АдресаРегистрации.Поле3 + "","" + АдресаРегистрации.Поле4 + "","" + АдресаРегистрации.Поле5 + "","" + АдресаРегистрации.Поле6 + "","" + АдресаРегистрации.Поле7 + "","" + АдресаРегистрации.Поле8 + "","" + АдресаРегистрации.Поле9 + "","" + ВЫБОР
	|								КОГДА АдресаРегистрации.ТипДома В (ЗНАЧЕНИЕ(Перечисление.ТипыДомов.Дом), ЗНАЧЕНИЕ(Перечисление.ТипыДомов.ПустаяСсылка))
	|									ТОГДА ""дом""
	|								ИНАЧЕ ""владение""
	|							КОНЕЦ + "","" + ВЫБОР
	|								КОГДА АдресаРегистрации.ТипКорпуса В (ЗНАЧЕНИЕ(Перечисление.ТипыКорпусов.Корпус), ЗНАЧЕНИЕ(Перечисление.ТипыКорпусов.ПустаяСсылка))
	|									ТОГДА ""корпус""
	|								ИНАЧЕ ""строение""
	|							КОНЕЦ + "","" + ВЫБОР
	|								КОГДА АдресаРегистрации.ТипКвартиры В (ЗНАЧЕНИЕ(Перечисление.ТипыКвартир.Квартира), ЗНАЧЕНИЕ(Перечисление.ТипыКвартир.ПустаяСсылка))
	|									ТОГДА ""кв.""
	|								ИНАЧЕ ""оф.""
	|							КОНЕЦ КАК СТРОКА(240))) = ДанныеАнкет.АдресРегистрации
	|						ТОГДА """"
	|					ИНАЧЕ "","" + АдресаРегистрации.Поле1 + "","" + АдресаРегистрации.Поле2 + "","" + АдресаРегистрации.Поле3 + "","" + АдресаРегистрации.Поле4 + "","" + АдресаРегистрации.Поле5 + "","" + АдресаРегистрации.Поле6 + "","" + АдресаРегистрации.Поле7 + "","" + АдресаРегистрации.Поле8 + "","" + АдресаРегистрации.Поле9 + "","" + ВЫБОР
	|							КОГДА АдресаРегистрации.ТипДома В (ЗНАЧЕНИЕ(Перечисление.ТипыДомов.Дом), ЗНАЧЕНИЕ(Перечисление.ТипыДомов.ПустаяСсылка))
	|								ТОГДА ""дом""
	|							ИНАЧЕ ""владение""
	|						КОНЕЦ + "","" + ВЫБОР
	|							КОГДА АдресаРегистрации.ТипКорпуса В (ЗНАЧЕНИЕ(Перечисление.ТипыКорпусов.Корпус), ЗНАЧЕНИЕ(Перечисление.ТипыКорпусов.ПустаяСсылка))
	|								ТОГДА ""корпус""
	|							ИНАЧЕ ""строение""
	|						КОНЕЦ + "","" + ВЫБОР
	|							КОГДА АдресаРегистрации.ТипКвартиры В (ЗНАЧЕНИЕ(Перечисление.ТипыКвартир.Квартира), ЗНАЧЕНИЕ(Перечисление.ТипыКвартир.ПустаяСсылка))
	|								ТОГДА ""кв.""
	|							ИНАЧЕ ""оф.""
	|						КОНЕЦ
	|				КОНЕЦ
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК АдресРегистрации,
	|	ВЫБОР
	|		КОГДА СтарыеДанныеАдресаФактического.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА (ВЫРАЗИТЬ("","" + АдресаФактические.Поле1 + "","" + АдресаФактические.Поле2 + "","" + АдресаФактические.Поле3 + "","" + АдресаФактические.Поле4 + "","" + АдресаФактические.Поле5 + "","" + АдресаФактические.Поле6 + "","" + АдресаФактические.Поле7 + "","" + АдресаФактические.Поле8 + "","" + АдресаФактические.Поле9 + "","" + ВЫБОР
	|								КОГДА АдресаФактические.ТипДома В (ЗНАЧЕНИЕ(Перечисление.ТипыДомов.Дом), ЗНАЧЕНИЕ(Перечисление.ТипыДомов.ПустаяСсылка))
	|									ТОГДА ""дом""
	|								ИНАЧЕ ""владение""
	|							КОНЕЦ + "","" + ВЫБОР
	|								КОГДА АдресаФактические.ТипКорпуса В (ЗНАЧЕНИЕ(Перечисление.ТипыКорпусов.Корпус), ЗНАЧЕНИЕ(Перечисление.ТипыКорпусов.ПустаяСсылка))
	|									ТОГДА ""корпус""
	|								ИНАЧЕ ""строение""
	|							КОНЕЦ + "","" + ВЫБОР
	|								КОГДА АдресаФактические.ТипКвартиры В (ЗНАЧЕНИЕ(Перечисление.ТипыКвартир.Квартира), ЗНАЧЕНИЕ(Перечисление.ТипыКвартир.ПустаяСсылка))
	|									ТОГДА ""кв.""
	|								ИНАЧЕ ""оф.""
	|							КОНЕЦ КАК СТРОКА(240))) = СтарыеДанныеАдресаФактического.АдресФактический
	|						ТОГДА """"
	|					ИНАЧЕ "","" + АдресаФактические.Поле1 + "","" + АдресаФактические.Поле2 + "","" + АдресаФактические.Поле3 + "","" + АдресаФактические.Поле4 + "","" + АдресаФактические.Поле5 + "","" + АдресаФактические.Поле6 + "","" + АдресаФактические.Поле7 + "","" + АдресаФактические.Поле8 + "","" + АдресаФактические.Поле9 + "","" + ВЫБОР
	|							КОГДА АдресаФактические.ТипДома В (ЗНАЧЕНИЕ(Перечисление.ТипыДомов.Дом), ЗНАЧЕНИЕ(Перечисление.ТипыДомов.ПустаяСсылка))
	|								ТОГДА ""дом""
	|							ИНАЧЕ ""владение""
	|						КОНЕЦ + "","" + ВЫБОР
	|							КОГДА АдресаФактические.ТипКорпуса В (ЗНАЧЕНИЕ(Перечисление.ТипыКорпусов.Корпус), ЗНАЧЕНИЕ(Перечисление.ТипыКорпусов.ПустаяСсылка))
	|								ТОГДА ""корпус""
	|							ИНАЧЕ ""строение""
	|						КОНЕЦ + "","" + ВЫБОР
	|							КОГДА АдресаФактические.ТипКвартиры В (ЗНАЧЕНИЕ(Перечисление.ТипыКвартир.Квартира), ЗНАЧЕНИЕ(Перечисление.ТипыКвартир.ПустаяСсылка))
	|								ТОГДА ""кв.""
	|							ИНАЧЕ ""оф.""
	|						КОНЕЦ
	|				КОНЕЦ
	|		КОГДА ДанныеАнкет.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА (ВЫРАЗИТЬ("","" + АдресаФактические.Поле1 + "","" + АдресаФактические.Поле2 + "","" + АдресаФактические.Поле3 + "","" + АдресаФактические.Поле4 + "","" + АдресаФактические.Поле5 + "","" + АдресаФактические.Поле6 + "","" + АдресаФактические.Поле7 + "","" + АдресаФактические.Поле8 + "","" + АдресаФактические.Поле9 + "","" + ВЫБОР
	|								КОГДА АдресаФактические.ТипДома В (ЗНАЧЕНИЕ(Перечисление.ТипыДомов.Дом), ЗНАЧЕНИЕ(Перечисление.ТипыДомов.ПустаяСсылка))
	|									ТОГДА ""дом""
	|								ИНАЧЕ ""владение""
	|							КОНЕЦ + "","" + ВЫБОР
	|								КОГДА АдресаФактические.ТипКорпуса В (ЗНАЧЕНИЕ(Перечисление.ТипыКорпусов.Корпус), ЗНАЧЕНИЕ(Перечисление.ТипыКорпусов.ПустаяСсылка))
	|									ТОГДА ""корпус""
	|								ИНАЧЕ ""строение""
	|							КОНЕЦ + "","" + ВЫБОР
	|								КОГДА АдресаФактические.ТипКвартиры В (ЗНАЧЕНИЕ(Перечисление.ТипыКвартир.Квартира), ЗНАЧЕНИЕ(Перечисление.ТипыКвартир.ПустаяСсылка))
	|									ТОГДА ""кв.""
	|								ИНАЧЕ ""оф.""
	|							КОНЕЦ КАК СТРОКА(240))) = ДанныеАнкет.АдресФактический
	|						ТОГДА """"
	|					ИНАЧЕ "","" + АдресаФактические.Поле1 + "","" + АдресаФактические.Поле2 + "","" + АдресаФактические.Поле3 + "","" + АдресаФактические.Поле4 + "","" + АдресаФактические.Поле5 + "","" + АдресаФактические.Поле6 + "","" + АдресаФактические.Поле7 + "","" + АдресаФактические.Поле8 + "","" + АдресаФактические.Поле9 + "","" + ВЫБОР
	|							КОГДА АдресаФактические.ТипДома В (ЗНАЧЕНИЕ(Перечисление.ТипыДомов.Дом), ЗНАЧЕНИЕ(Перечисление.ТипыДомов.ПустаяСсылка))
	|								ТОГДА ""дом""
	|							ИНАЧЕ ""владение""
	|						КОНЕЦ + "","" + ВЫБОР
	|							КОГДА АдресаФактические.ТипКорпуса В (ЗНАЧЕНИЕ(Перечисление.ТипыКорпусов.Корпус), ЗНАЧЕНИЕ(Перечисление.ТипыКорпусов.ПустаяСсылка))
	|								ТОГДА ""корпус""
	|							ИНАЧЕ ""строение""
	|						КОНЕЦ + "","" + ВЫБОР
	|							КОГДА АдресаФактические.ТипКвартиры В (ЗНАЧЕНИЕ(Перечисление.ТипыКвартир.Квартира), ЗНАЧЕНИЕ(Перечисление.ТипыКвартир.ПустаяСсылка))
	|								ТОГДА ""кв.""
	|							ИНАЧЕ ""оф.""
	|						КОНЕЦ
	|				КОНЕЦ
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК АдресФактический,
	|	ВЫБОР
	|		КОГДА СтарыеДанныеОТелефоне.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА ДомашниеТелефоны.Поле3 = СтарыеДанныеОТелефоне.Телефоны
	|						ТОГДА """"
	|					ИНАЧЕ ДомашниеТелефоны.Поле3
	|				КОНЕЦ
	|		КОГДА ДанныеАнкет.ФизЛицо ЕСТЬ НЕ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА ДомашниеТелефоны.Поле3 = ДанныеАнкет.Телефоны
	|						ТОГДА """"
	|					ИНАЧЕ ДомашниеТелефоны.Поле3
	|				КОНЕЦ
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК Телефоны,
	|	ВЫБОР
	|		КОГДА НомераСтрок.ВидАДВ = ЗНАЧЕНИЕ(Перечисление.ВидыАДВ.АДВ3)
	|			ТОГДА ВЫБОР
	|					КОГДА ДанныеОСЗВ4.Ссылка ЕСТЬ НЕ NULL 
	|						ТОГДА ""Представлялись""
	|					ИНАЧЕ ""Будут представлены""
	|				КОНЕЦ
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК ОтметкаОПредставленииСведений
	|ИЗ
	|	ВТСписокФизлиц КАК НомераСтрок
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФИО КАК ФИОСрезПоследних
	|		ПО НомераСтрок.ФизЛицо = ФИОСрезПоследних.ФизЛицо
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТГражданство КАК ГражданствоФизЛицСрезПоследних
	|		ПО НомераСтрок.ФизЛицо = ГражданствоФизЛицСрезПоследних.ФизЛицо
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДанныеАнкет КАК ДанныеАнкет
	|		ПО НомераСтрок.ФизЛицо = ДанныеАнкет.ФизЛицо
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтарыеДанные КАК СтарыеДанные
	|		ПО НомераСтрок.ФизЛицо = СтарыеДанные.ФизЛицо
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДанныеОСЗВ4 КАК ДанныеОСЗВ4
	|		ПО НомераСтрок.ФизЛицо = ДанныеОСЗВ4.ФизЛицо
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтарыеДанныеОГражданстве КАК СтарыеДанныеОГражданстве
	|		ПО НомераСтрок.ФизЛицо = СтарыеДанныеОГражданстве.ФизЛицо
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтарыеДанныеОТелефоне КАК СтарыеДанныеОТелефоне
	|		ПО НомераСтрок.ФизЛицо = СтарыеДанныеОТелефоне.ФизЛицо
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтарыеДанныеАдресаФактического КАК СтарыеДанныеАдресаФактического
	|		ПО НомераСтрок.ФизЛицо = СтарыеДанныеАдресаФактического.ФизЛицо
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтарыеДанныеАдресаРегистрации КАК СтарыеДанныеАдресаРегистрации
	|		ПО НомераСтрок.ФизЛицо = СтарыеДанныеАдресаРегистрации.ФизЛицо
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДомашниеТелефоны КАК ДомашниеТелефоны
	|		ПО НомераСтрок.ФизЛицо = ДомашниеТелефоны.Объект
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТАдресаФактические КАК АдресаФактические
	|		ПО НомераСтрок.ФизЛицо = АдресаФактические.Объект
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТАдресаРегистрации КАК АдресаРегистрации
	|		ПО НомераСтрок.ФизЛицо = АдресаРегистрации.Объект
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерСтроки";
	
	РаботникиОрганизации.Загрузить(Запрос.Выполнить().Выгрузить());
	
КонецПроцедуры 

// Формирует файл, который можно будет записать на дискетку
//
// Параметры: 
//  Нет
//
// Возвращаемое значение:
//  Строка - содержимое файла
//
Функция СформироватьВыходнойФайл(Отказ) Экспорт
	
	// Заголовок для сообщений об ошибках проведения.
	Заголовок = ОбщегоНазначения.ПредставлениеДокументаПриПроведении(Ссылка);
	
	ВыборкаПоШапкеДокумента = СформироватьЗапросПоШапке().Выбрать();
	Если Не ВыборкаПоШапкеДокумента.Следующий() тогда
		Отказ = Истина;
		Возврат "";
	КонецЕсли;
	
	ПроверитьЗаполнениеШапки(ВыборкаПоШапкеДокумента, Отказ, Заголовок);
	Если Отказ тогда
		Возврат "";
	КонецЕсли;
	
	ВыборкаПоРаботникиОрганизации = СформироватьЗапросПоРаботникиОрганизации(ВыборкаПоШапкеДокумента).Выбрать(ОбходРезультатаЗапроса.Прямой);
	
	Если ВыборкаПоРаботникиОрганизации.Количество() > 200 тогда
		ОбщегоНазначения.ВывестиИнформациюОбОшибке("В документе должно быть не более 200 заявлений (сотрудников)!", Отказ, Заголовок);
	КонецЕсли;
	
	СписокОбработанныхЗаявлений = Новый Соответствие;
	
	ТекстФайла	= "";
	НомерДокументаВПачке = 0;
	
	ДатаЗаполнения			= ВыборкаПоШапкеДокумента.Дата;
	КоличествоДокументов 	= ВыборкаПоРаботникиОрганизации.Количество();
	
	// Формирование файла версии 04.00
	Если ВыборкаПоШапкеДокумента.ФорматФайла = Перечисления.ФорматФайлаПФР.Версия04 Тогда
		//Формируем заголовок выходного файла
		ТекстФайла	= ТекстФайла + ПроцедурыПерсонифицированногоУчета.ПолучитьЗаписьЗаголовок();
		ТекстФайла	= ТекстФайла + ПроцедурыПерсонифицированногоУчета.ПолучитьЗаписьОРаботодателе(ВыборкаПоШапкеДокумента.Организация, ВыборкаПоШапкеДокумента.Дата, Отказ);
		ТекстФайла	= ТекстФайла + ПроцедурыПерсонифицированногоУчета.ПолучитьЗаписьОПачке(НомерПачки,ДатаЗаполнения,"","");
		Если Отказ Тогда
			Возврат "";
		КонецЕсли;
		
		Если ВыборкаПоШапкеДокумента.ВидАДВ =  Перечисления.ВидыАДВ.АДВ2 тогда
			ТипДокумента = "ОБМН";
		Иначе	
			ТипДокумента = "ДУБЛ";
		КонецЕсли;
		ТекстФайла	= ТекстФайла + ПроцедурыПерсонифицированногоУчета.ПолучитьЗаписьОТипеДокумента(ТипДокумента,КоличествоДокументов);
		
		//Получаем таблицу формата записи
		ДокументФорматЗаписей = ПолучитьМакет("ФорматЗаписей");
		ТаблицаФорматаЗаписи = ПроцедурыПерсонифицированногоУчета.ПолучитьФорматЗаписи(ТипДокумента,ДокументФорматЗаписей);
		
		Пока ВыборкаПоРаботникиОрганизации.Следующий() Цикл
			
			//Контроль дубля строк
			Если СписокОбработанныхЗаявлений.Получить(ВыборкаПоРаботникиОрганизации.ФизЛицо) = Неопределено Тогда
				СписокОбработанныхЗаявлений.Вставить(ВыборкаПоРаботникиОрганизации.ФизЛицо, Истина);
			Иначе	
				ОбщегоНазначения.ВывестиИнформациюОбОшибке("Строка №" + ВыборкаПоРаботникиОрганизации.НомерСтроки + ": Сотрудник " + ВыборкаПоРаботникиОрганизации.ФизЛицоНаименование + " указан(а) в документе дважды!", Отказ, Заголовок);
			КонецЕсли;
			
			ПроверитьЗаполнениеСтрокиРаботникаОрганизации(ВыборкаПоШапкеДокумента, ВыборкаПоРаботникиОрганизации, Отказ, Заголовок);
			
			Если Отказ Тогда
				Продолжить;
			КонецЕсли;
			
			НомерДокументаВПачке = 	НомерДокументаВПачке + 1;
			
			//Берем запись с пустыми полями
			Запись = ПроцедурыПерсонифицированногоУчета.ПолучитьСтруктуруЗаписи(ТаблицаФорматаЗаписи);
			
			Запись.ТипЗаписи = ТипДокумента;
			Запись.НомерДокументаВПачке = НомерДокументаВПачке;
			Запись.ДатаЗаполнения = ДатаЗаполнения;
			
			//Данные, указанные в свидетельстве
			Запись.СтраховойНомер = ВыборкаПоРаботникиОрганизации.СтраховойНомерПФРВСвидетельстве;
			Запись.ФамилияВСвидетельстве = ВыборкаПоРаботникиОрганизации.ФамилияВСвидетельстве;
			Запись.ИмяВСвидетельстве = ВыборкаПоРаботникиОрганизации.ИмяВСвидетельстве;
			Запись.ОтчествоВСвидетельстве = ВыборкаПоРаботникиОрганизации.ОтчествоВСвидетельстве;
			
			//Изменившиеся данные
			Запись.Фамилия	= ВыборкаПоРаботникиОрганизации.Фамилия;
			Запись.Имя		= ВыборкаПоРаботникиОрганизации.Имя;
			
			//Отчетство может быть отменено
			Если ВыборкаПоРаботникиОрганизации.ПризнакОтменыОтчества  тогда
				Запись.ПризнакОтменыОтчества = "ОТМН";
				
			Иначе
				Запись.Отчество = ВыборкаПоРаботникиОрганизации.Отчество;
				
			КонецЕсли;
			
			//Пол
			Если ЗначениеЗаполнено(ВыборкаПоРаботникиОрганизации.Пол) тогда
				Запись.Пол = ?(ВыборкаПоРаботникиОрганизации.Пол = Перечисления.ПолФизическихЛиц.Мужской, "М", "Ж");
			КонецЕсли;
			
			//Дата рождения
			Если ЗначениеЗаполнено(ВыборкаПоРаботникиОрганизации.ДатаРождения) тогда
				Запись.ТипДатыРождения = "СТАНДАРТ";
				Запись.СтандартнаяДатаРождения = ВыборкаПоРаботникиОрганизации.ДатаРождения;
				Запись.ОсобаяДатаРожденияДень = 0;
				Запись.ОсобаяДатаРожденияМесяц = 0;
				Запись.ОсобаяДатаРожденияГод = 0;
			КонецЕсли;
			
			//Место рождения может быть отменено
			Если ВыборкаПоРаботникиОрганизации.ПризнакОтменыМестаРождения  тогда
				Запись.ПризнакОтменыМестаРождения = "ОТМН";
				
			ИначеЕсли ЗначениеЗаполнено(ВыборкаПоРаботникиОрганизации.МестоРождения) тогда
				ПроцедурыПерсонифицированногоУчета.ВписатьВЗаписьМестоРождения(Запись, ВыборкаПоРаботникиОрганизации.МестоРождения);
				
			КонецЕсли;
			
			Запись.Гражданство = СокрЛП(ВыборкаПоРаботникиОрганизации.Гражданство);
			
			//Паспортные данные
			Если ЗначениеЗаполнено(ВыборкаПоРаботникиОрганизации.ДокументВид) тогда
				ПроцедурыПерсонифицированногоУчета.ВписатьВЗаписьДокумент(Запись,ВыборкаПоРаботникиОрганизации);
			КонецЕсли;
			
			Запись.АдресРегистрации = ВыборкаПоРаботникиОрганизации.АдресРегистрации;
			Запись.АдресФактический = ВыборкаПоРаботникиОрганизации.АдресФактический;
			Запись.Телефоны = ВыборкаПоРаботникиОрганизации.Телефоны;
			
			//Поля, присутствующие только в записи типа "ДУБЛ"
			Если ТипДокумента = "ДУБЛ" тогда
				Запись.ПолВСвидетельстве = ?(ВыборкаПоРаботникиОрганизации.ПолВСвидетельстве = Перечисления.ПолФизическихЛиц.Мужской, "М", "Ж");
				
				//Даты рождения указанная в свидетельстве 
				Запись.ТипДатыРожденияВСвидетельстве			= "СТАНДАРТ";
				Запись.СтандартнаяДатаРожденияВСвидетельстве	= ВыборкаПоРаботникиОрганизации.ДатаРожденияВСвидетельстве;
				Запись.ОсобаяДатаРожденияДеньВСвидетельстве		= 0;
				Запись.ОсобаяДатаРожденияМесяцВСвидетельстве	= 0;
				Запись.ОсобаяДатаРожденияГодВСвидетельстве		= 0;
				
				//Место рождения указанное в свидетельстве (может не указываться)
				МестоРождения = РегламентированнаяОтчетность.РазложитьМестоРождения(ВыборкаПоРаботникиОрганизации.МестоРожденияВСвидетельстве);
				Запись.ТипМестаРожденияВСвидетельстве				= ?(МестоРождения.Особое = 1, "ОСОБОЕ", "СТАНДАРТ");
				Запись.МестоРожденияНаселенныйПунктВСвидетельстве	= МестоРождения.НаселенныйПункт;
				Запись.МестоРожденияРайонВСвидетельстве				= МестоРождения.Район;
				Запись.МестоРожденияОбластьВСвидетельстве			= МестоРождения.Область;
				Запись.МестоРожденияСтранаВСвидетельстве			= МестоРождения.Страна;
				
				//Отметка о предоставлении сведений
				Если СокрЛП(ВыборкаПоРаботникиОрганизации.ОтметкаОПредставленииСведений)= "Представлялись" тогда
					Запись.ОтметкаОПредставленииСведений = "ПРЕДСТАВЛ";
					
				ИначеЕсли СокрЛП(ВыборкаПоРаботникиОрганизации.ОтметкаОПредставленииСведений)= "Будут представлены" тогда	
					Запись.ОтметкаОПредставленииСведений = "БУДУТ";
					
				КонецЕсли;
			КонецЕсли;
			
			//Добавляем запись в файл
			СтрокавФайл	= ПроцедурыПерсонифицированногоУчета.ПолучитьСтрокуПоДаннымЗаписи(Запись,ТаблицаФорматаЗаписи);
			ТекстФайла	= ТекстФайла + ВРег(СтрокавФайл) + Символы.ПС;
		КонецЦикла;
		
	ИначеЕсли ВыборкаПоШапкеДокумента.ФорматФайла = Перечисления.ФорматФайлаПФР.Версия07 Тогда
		// Формируем файл версии 07.00
		
		// Список стран
		СписокСтран = Новый Соответствие;
		Запрос = Новый Запрос;
		Запрос.Текст =
		"ВЫБРАТЬ
		|	КлассификаторСтранМира.Наименование,
		|	КлассификаторСтранМира.Код
		|ИЗ
		|	Справочник.КлассификаторСтранМира КАК КлассификаторСтранМира";
		Выборка = Запрос.Выполнить().Выбрать();
		Пока Выборка.Следующий() Цикл
			СписокСтран.Вставить(СокрЛП(Выборка.Наименование), Строка(Выборка.Код));
		КонецЦикла;
		
		НомерДокументаВПачке = 1;
		
		// Загружаем формат файла сведений
		МакетФормата = ПолучитьОбщийМакет("ФорматПФР70");
		
		// Создаем начальное дерево
		ДеревоВыгрузки = ПроцедурыПерсонифицированногоУчета.СоздатьДеревоXML();
		
		УзелПФР = ПроцедурыПерсонифицированногоУчета.ДобавитьУзелВДеревоXML(ДеревоВыгрузки, "ФайлПФР", "", );
		
		ПроцедурыПерсонифицированногоУчета.ЗаполнитьИмяИЗаголовокФайла(УзелПФР, МакетФормата, ПроцедурыПерсонифицированногоУчета.ПолучитьИмяФайлаПФ(Ссылка, Год(ДатаЗаполнения), ВыборкаПоШапкеДокумента));
		
		Если ВыборкаПоШапкеДокумента.ВидАДВ =  Перечисления.ВидыАДВ.АДВ2 тогда
			ТипДокумента = "ЗАЯВЛЕНИЕ_ОБ_ОБМЕНЕ";
		Иначе	
			ТипДокумента = "ЗАЯВЛЕНИЕ_О_ДУБЛИКАТЕ";
		КонецЕсли;
		
		// Добавляем реквизит ПачкаВходящихДокументов
		УзелПачкаВходящихДокументов = ПроцедурыПерсонифицированногоУчета.ЗаполнитьНаборЗаписейВходящаяОпись(УзелПФР, МакетФормата, ТипДокумента, ВыборкаПоШапкеДокумента, КоличествоДокументов, НомерПачки, НомерДокументаВПачке,,,,ЗаменятьБуквуЕ);
		
		Сокращение = "";
		ФорматАДВ23 = ПроцедурыПерсонифицированногоУчета.ЗагрузитьФорматНабораЗаписейдляПФР(МакетФормата, ТипДокумента);
		ФорматИностранныйАдрес = ПроцедурыПерсонифицированногоУчета.ЗагрузитьФорматНабораЗаписейдляПФР(МакетФормата, "АдресОбщий", 3);
		ФорматНеструктурированныйАдрес = ПроцедурыПерсонифицированногоУчета.ЗагрузитьФорматНабораЗаписейдляПФР(МакетФормата, "АдресОбщий", 2);
		
		Пока ВыборкаПоРаботникиОрганизации.Следующий()	Цикл
			
			//Контроль дубля строк
			Если СписокОбработанныхЗаявлений.Получить(ВыборкаПоРаботникиОрганизации.ФизЛицо) = Неопределено Тогда
				СписокОбработанныхЗаявлений.Вставить(ВыборкаПоРаботникиОрганизации.ФизЛицо, Истина);
			Иначе	
				ОбщегоНазначения.ВывестиИнформациюОбОшибке("Строка №" + ВыборкаПоРаботникиОрганизации.НомерСтроки + ": Сотрудник " + ВыборкаПоРаботникиОрганизации.ФизЛицоНаименование + " указан(а) в документе дважды!", Отказ, Заголовок);
			КонецЕсли;
			
			ПроверитьЗаполнениеСтрокиРаботникаОрганизации(ВыборкаПоШапкеДокумента, ВыборкаПоРаботникиОрганизации, Отказ, Заголовок);
			
			Если Отказ Тогда
				Продолжить;
			КонецЕсли;
			
			НомерДокументаВПачке = 	НомерДокументаВПачке + 1;
			
			НаборЗаписейАДВ23 = ПроцедурыПерсонифицированногоУчета.СкопироватьСтруктуруДанных(ФорматАДВ23);
			
			НаборЗаписейАДВ23.НомерВпачке.Значение = НомерДокументаВПачке;
			НаборЗаписейАДВ23.СтраховойНомер.Значение = ВыборкаПоРаботникиОрганизации.СтраховойНомерПФРВСвидетельстве;
			
			// ФИОИзСтрахового
			НаборЗаписейФИОИзСтрахового = НаборЗаписейАДВ23.ФИОИзСтрахового.Значение;
			НаборЗаписейФИОИзСтрахового.Фамилия = ВРег(СокрЛП(ВыборкаПоРаботникиОрганизации.ФамилияВСвидетельстве));
			НаборЗаписейФИОИзСтрахового.Имя = ВРег(СокрЛП(ВыборкаПоРаботникиОрганизации.ИмяВСвидетельстве));
			НаборЗаписейФИОИзСтрахового.Отчество = ВРег(СокрЛП(ВыборкаПоРаботникиОрганизации.ОтчествоВСвидетельстве));
			
			Если ЗаменятьБуквуЕ И ТипДокумента = "ЗАЯВЛЕНИЕ_О_ДУБЛИКАТЕ" Тогда
				ПроцедурыПерсонифицированногоУчета.ЗаменитьБуквуЁ(НаборЗаписейФИОИзСтрахового.Фамилия, "Фамилия в свидетельстве");
				ПроцедурыПерсонифицированногоУчета.ЗаменитьБуквуЁ(НаборЗаписейФИОИзСтрахового.Имя, "Имя в с видетельстве");
				ПроцедурыПерсонифицированногоУчета.ЗаменитьБуквуЁ(НаборЗаписейФИОИзСтрахового.Отчество, "Отчество в свидетельстве");
			КонецЕсли;
			
			//Поля, присутствующие только в записи типа "ЗАЯВЛЕНИЕ_О_ДУБЛИКАТЕ"
			Если ТипДокумента = "ЗАЯВЛЕНИЕ_О_ДУБЛИКАТЕ" Тогда
				
				
				//Отметка о предоставлении сведений
				Если СокрЛП(ВыборкаПоРаботникиОрганизации.ОтметкаОПредставленииСведений)= "Представлялись" тогда
					НаборЗаписейАДВ23.ОтметкаОПредставленииСведений.Значение = "ПРЕДСТАВЛЕНЫ РАНЕЕ";
				ИначеЕсли СокрЛП(ВыборкаПоРаботникиОрганизации.ОтметкаОПредставленииСведений)= "Будут представлены" тогда	
					НаборЗаписейАДВ23.ОтметкаОПредставленииСведений.Значение = "БУДУТ ПРЕДСТАВЛЕНЫ";
				КонецЕсли;
				// ПолИзСтрахового
				НаборЗаписейАДВ23.ПолИзСтрахового.Значение = ?(ВыборкаПоРаботникиОрганизации.ПолВСвидетельстве = Перечисления.ПолФизическихЛиц.Мужской, "МУЖСКОЙ", "ЖЕНСКИЙ");
				// ДатаРожденияИзСтрахового
				НаборЗаписейАДВ23.ДатаРожденияИзСтрахового.Значение = ВыборкаПоРаботникиОрганизации.ДатаРожденияВСвидетельстве;
				// МестоРожденияИзСтрахового
				НаборЗаписейМестоРожденияИзСтрахового = НаборЗаписейАДВ23.МестоРожденияИзСтрахового.Значение;
				МестоРожденияИзСтрахового = РегламентированнаяОтчетность.РазложитьМестоРождения(ВыборкаПоРаботникиОрганизации.МестоРожденияВСвидетельстве);
				Если НЕ (ЗначениеЗаполнено(МестоРожденияИзСтрахового.НаселенныйПункт) ИЛИ ЗначениеЗаполнено(МестоРожденияИзСтрахового.Район) 
					ИЛИ ЗначениеЗаполнено(МестоРожденияИзСтрахового.Область) ИЛИ ЗначениеЗаполнено(МестоРожденияИзСтрахового.Страна)) Тогда
					НаборЗаписейАДВ23.Удалить("МестоРожденияИзСтрахового");
				Иначе
					НаборЗаписейМестоРожденияИзСтрахового.ТипМестаРождения = ?(МестоРожденияИзСтрахового.Особое = 1, "ОСОБОЕ", "СТАНДАРТНОЕ");
					
					НаборЗаписейМестоРожденияИзСтрахового.ГородРождения = УправлениеКонтактнойИнформацией.ПолучитьИмяИАдресноеСокращение(МестоРожденияИзСтрахового.НаселенныйПункт,Сокращение);
					НаборЗаписейМестоРожденияИзСтрахового.РайонРождения = УправлениеКонтактнойИнформацией.ПолучитьИмяИАдресноеСокращение(МестоРожденияИзСтрахового.Район,Сокращение);
					НаборЗаписейМестоРожденияИзСтрахового.РегионРождения = МестоРожденияИзСтрахового.Область;
					НаборЗаписейМестоРожденияИзСтрахового.СтранаРождения = МестоРожденияИзСтрахового.Страна;
					
					Если ЗаменятьБуквуЕ Тогда
						ПроцедурыПерсонифицированногоУчета.ЗаменитьБуквуЁ(НаборЗаписейМестоРожденияИзСтрахового.ГородРождения, "Город рождения");
						ПроцедурыПерсонифицированногоУчета.ЗаменитьБуквуЁ(НаборЗаписейМестоРожденияИзСтрахового.РайонРождения, "Район рождения");
                        ПроцедурыПерсонифицированногоУчета.ЗаменитьБуквуЁ(НаборЗаписейМестоРожденияИзСтрахового.РегионРождения, "Регион рождения");
						ПроцедурыПерсонифицированногоУчета.ЗаменитьБуквуЁ(НаборЗаписейМестоРожденияИзСтрахового.СтранаРождения, "Страна рождения");
					КонецЕсли;	
				КонецЕсли;	
			КонецЕсли;
			
			// ИзменившиесяДанные
			НаборЗаписейИзменившиесяДанные = НаборЗаписейАДВ23.ИзменившиесяДанные.Значение;
			// ФИО
			НаборЗаписейИзмФИО = НаборЗаписейИзменившиесяДанные.ФИО.Значение;
			НаборЗаписейИзмФИО.Фамилия = СокрЛП(ВРег(ВыборкаПоРаботникиОрганизации.Фамилия));
			НаборЗаписейИзмФИО.Имя = СокрЛП(ВРег(ВыборкаПоРаботникиОрганизации.Имя));
						
			Если ЗаменятьБуквуЕ И ТипДокумента = "ЗАЯВЛЕНИЕ_ОБ_ОБМЕНЕ" Тогда
				ПроцедурыПерсонифицированногоУчета.ЗаменитьБуквуЁ(НаборЗаписейИзмФИО.Фамилия, "Фамилия");
				ПроцедурыПерсонифицированногоУчета.ЗаменитьБуквуЁ(НаборЗаписейИзмФИО.Имя, "Имя");
			КонецЕсли;
				
			//Отчетство может быть отменено
			Если ВыборкаПоРаботникиОрганизации.ПризнакОтменыОтчества  тогда
				НаборЗаписейАДВ23.ПризнакОтменыОтчества.Значение = "ОТМН";
			Иначе
				НаборЗаписейИзмФИО.Отчество = СокрЛП(ВРег(ВыборкаПоРаботникиОрганизации.Отчество));
				Если ЗаменятьБуквуЕ И ТипДокумента = "ЗАЯВЛЕНИЕ_ОБ_ОБМЕНЕ" Тогда
					ПроцедурыПерсонифицированногоУчета.ЗаменитьБуквуЁ(НаборЗаписейИзмФИО.Отчество, "Отчество");
				КонецЕсли;	
			КонецЕсли;
			
			//Пол
			Если ЗначениеЗаполнено(ВыборкаПоРаботникиОрганизации.Пол) тогда
				НаборЗаписейИзменившиесяДанные.Пол.Значение = ?(ВыборкаПоРаботникиОрганизации.Пол = Перечисления.ПолФизическихЛиц.Мужской, "МУЖСКОЙ", "ЖЕНСКИЙ");
			КонецЕсли;
			//Дата рождения
			Если ЗначениеЗаполнено(ВыборкаПоРаботникиОрганизации.ДатаРождения) тогда
				НаборЗаписейИзменившиесяДанные.ДатаРождения.Значение = ВыборкаПоРаботникиОрганизации.ДатаРождения;
			КонецЕсли;
			
			//Место рождения
			НаборЗаписейМестоРождения = НаборЗаписейИзменившиесяДанные.МестоРождения.Значение;
			МестоРождения = РегламентированнаяОтчетность.РазложитьМестоРождения(ВыборкаПоРаботникиОрганизации.МестоРождения);
			Если НЕ (ЗначениеЗаполнено(МестоРождения.НаселенныйПункт) ИЛИ ЗначениеЗаполнено(МестоРождения.Район) ИЛИ ЗначениеЗаполнено(МестоРождения.Область)
					ИЛИ ЗначениеЗаполнено(МестоРождения.Страна)) Тогда
				НаборЗаписейИзменившиесяДанные.Удалить("МестоРождения");
			Иначе
				НаборЗаписейМестоРождения.ТипМестаРождения = ?(МестоРождения.Особое = 1, "ОСОБОЕ", "СТАНДАРТНОЕ");
				
				НаборЗаписейМестоРождения.ГородРождения = УправлениеКонтактнойИнформацией.ПолучитьИмяИАдресноеСокращение(МестоРождения.НаселенныйПункт,Сокращение);
				НаборЗаписейМестоРождения.РайонРождения = УправлениеКонтактнойИнформацией.ПолучитьИмяИАдресноеСокращение(МестоРождения.Район, Сокращение);
				НаборЗаписейМестоРождения.РегионРождения = МестоРождения.Область;
				НаборЗаписейМестоРождения.СтранаРождения = МестоРождения.Страна;
				
				Если ЗаменятьБуквуЕ Тогда
					ПроцедурыПерсонифицированногоУчета.ЗаменитьБуквуЁ(НаборЗаписейМестоРождения.ГородРождения, "Город рождения");
					ПроцедурыПерсонифицированногоУчета.ЗаменитьБуквуЁ(НаборЗаписейМестоРождения.РайонРождения, "Район рождения");
					ПроцедурыПерсонифицированногоУчета.ЗаменитьБуквуЁ(НаборЗаписейМестоРождения.РегионРождения, "Регион рождения");
	                ПроцедурыПерсонифицированногоУчета.ЗаменитьБуквуЁ(НаборЗаписейМестоРождения.СтранаРождения, "Страна рождения");
				КонецЕсли;	
			КонецЕсли;
			
			
			// Гражданство
			НаборЗаписейИзменившиесяДанные.Гражданство.Значение = СокрЛП(ВыборкаПоРаботникиОрганизации.Гражданство);
			Если ЗаменятьБуквуЕ Тогда
				ПроцедурыПерсонифицированногоУчета.ЗаменитьБуквуЁ(НаборЗаписейИзменившиесяДанные.Гражданство.Значение, "Гражданство");
			КонецЕсли;	
			
			// АдресРегистрации
			Если РегламентированнаяОтчетность.ПустоеЗначение(ВыборкаПоРаботникиОрганизации.АдресРегистрации) ТОгда
				НаборЗаписейИзменившиесяДанные.Удалить("АдресРегистрации");
			Иначе
				ТекстОшибки  ="";
				НаборЗаписейАдресРегистрации = НаборЗаписейИзменившиесяДанные.АдресРегистрации.Значение;
				ПроцедурыПерсонифицированногоУчета.ЗаполнитьАдрес(НаборЗаписейАдресРегистрации, ВыборкаПоРаботникиОрганизации.АдресРегистрации, 
				СписокСтран, ФорматНеструктурированныйАдрес, ФорматИностранныйАдрес, ТекстОшибки);
				НаборЗаписейИзменившиесяДанные.АдресРегистрации.Значение = НаборЗаписейАдресРегистрации;
				Если НЕ ПустаяСтрока(ТекстОшибки) Тогда
					ОбщегоНазначения.ВывестиИнформациюОбОшибке("Предупреждение: Строка №"+ВыборкаПоРаботникиОрганизации.НомерСтроки+": Сотрудник "+ВыборкаПоРаботникиОрганизации.ФизЛицо+ " Адрес регистрации" + ТекстОшибки, Ложь);
				КонецЕсли;
			КонецЕсли;
			
			// АдресФактический
			Если ПустаяСтрока(ВыборкаПоРаботникиОрганизации.АдресФактический) Тогда
				НаборЗаписейИзменившиесяДанные.Удалить("АдресФактический");
			Иначе
				ТекстОшибки = "";
				НаборЗаписейАдресФактический = НаборЗаписейИзменившиесяДанные.АдресФактический.Значение;
				ПроцедурыПерсонифицированногоУчета.ЗаполнитьАдрес(НаборЗаписейАдресФактический, ВыборкаПоРаботникиОрганизации.АдресФактический, 
				СписокСтран, ФорматНеструктурированныйАдрес, ФорматИностранныйАдрес, ТекстОшибки);
				НаборЗаписейИзменившиесяДанные.АдресФактический.Значение = НаборЗаписейАдресФактический;
				Если НЕ ПустаяСтрока(ТекстОшибки) Тогда
					ОбщегоНазначения.ВывестиИнформациюОбОшибке("Предупреждение: Строка №"+ВыборкаПоРаботникиОрганизации.НомерСтроки+": Сотрудник "+ВыборкаПоРаботникиОрганизации.ФизЛицо+ " Адрес фактический" + ТекстОшибки, Ложь);
				КонецЕсли;
			КонецЕсли;
			
			// Телефон
			НаборЗаписейИзменившиесяДанные.Телефон.Значение = ВыборкаПоРаботникиОрганизации.Телефоны;
			
			// ПризнакОтменыОтчества, Отчетство может быть отменено
			Если ВыборкаПоРаботникиОрганизации.ПризнакОтменыОтчества  Тогда
				НаборЗаписейАДВ23.ПризнакОтменыОтчества.Значение = "ОТМЕНЕНО";
			Иначе
				НаборЗаписейАДВ23.Удалить("ПризнакОтменыОтчества");
			КонецЕсли;
			
			//Место рождения может быть отменено
			Если ВыборкаПоРаботникиОрганизации.ПризнакОтменыМестаРождения  Тогда
				НаборЗаписейАДВ23.ПризнакОтменыМестаРождения.Значение = "ОТМЕНЕНО";
			Иначе
				НаборЗаписейАДВ23.Удалить("ПризнакОтменыМестаРождения");
			КонецЕсли;	
			
			// УдостоверяющийДокумент
			НаборЗаписейУдостоверяющийДокумент = НаборЗаписейАДВ23.УдостоверяющийДокумент.Значение;
			НаборЗаписейДокумент = НаборЗаписейУдостоверяющийДокумент.Документ.Значение;
			
			Если ВыборкаПоРаботникиОрганизации.ДокументВид = Справочники.ДокументыУдостоверяющиеЛичность.ИМНС23 
				ИЛИ ВыборкаПоРаботникиОрганизации.ДокументВид = Справочники.ДокументыУдостоверяющиеЛичность.ИМНС15
				ИЛИ  ВыборкаПоРаботникиОрганизации.ДокументВид = Справочники.ДокументыУдостоверяющиеЛичность.ИМНС91 Тогда
				ЭлементИМНС91 = Справочники.ДокументыУдостоверяющиеЛичность.ИМНС91;
				НаборЗаписейУдостоверяющийДокумент.ТипУдостоверяющего.Значение = ЭлементИМНС91.КодПФР;
				НаборЗаписейДокумент.НаименованиеУдостоверяющего = ВРег(СокрЛП(ЭлементИМНС91.Наименование)); 	
			Иначе
				НаборЗаписейУдостоверяющийДокумент.ТипУдостоверяющего.Значение = ВыборкаПоРаботникиОрганизации.ДокументВидКодПФР;
				НаборЗаписейДокумент.НаименованиеУдостоверяющего = ВыборкаПоРаботникиОрганизации.ДокументВидКодПФР;
			КонецЕсли;
			
			СерииДокумента = РегламентированнаяОтчетность.РазложитьСериюДокумента(ВыборкаПоРаботникиОрганизации.ДокументВид,ВыборкаПоРаботникиОрганизации.ДокументСерия);
			НаборЗаписейДокумент.СерияРимскиеЦифры = СерииДокумента.Часть1;
			НаборЗаписейДокумент.СерияРусскиеБуквы = СерииДокумента.Часть2;
			НаборЗаписейДокумент.НомерУдостоверяющего = ВыборкаПоРаботникиОрганизации.ДокументНомер;
			НаборЗаписейДокумент.ДатаВыдачи = ВыборкаПоРаботникиОрганизации.ДокументДатаВыдачи;
			НаборЗаписейДокумент.КемВыдан = СокрЛП(ВРег(ВыборкаПоРаботникиОрганизации.ДокументКемВыдан));
			Если ЗаменятьБуквуЕ Тогда
				ПроцедурыПерсонифицированногоУчета.ЗаменитьБуквуЁ(НаборЗаписейДокумент.КемВыдан, "Кем выдан");
			КонецЕсли;	
			
			// ДатаЗаполнения
			НаборЗаписейАДВ23.ДатаЗаполнения.Значение = ДатаЗаполнения;
			ПроцедурыПерсонифицированногоУчета.ДобавитьИнформациюВДерево(ПроцедурыПерсонифицированногоУчета.ДобавитьУзелВДеревоXML(УзелПачкаВходящихДокументов, ТипДокумента,""), НаборЗаписейАДВ23);
		КонецЦикла;
		
		// Преобразуем дерево в строковое описание XML
		ТекстФайла = ПроцедурыПерсонифицированногоУчета.ПолучитьТекстФайлаИзДереваЗначений(ДеревоВыгрузки);
		
	КонецЕсли;
	
	Возврат ТекстФайла;
	
КонецФункции // СформироватьВыходнойФайл()

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ДЛЯ ОБЕСПЕЧЕНИЯ ПРОВЕДЕНИЯ ДОКУМЕНТА

// Формирует запрос по шапке документа
//
// Параметры: 
//  Режим - режим проведения
//
// Возвращаемое значение:
//  Результат запроса
//
Функция СформироватьЗапросПоШапке()
	
	Запрос = Новый Запрос;
	
	// Установим параметры запроса
	Запрос.УстановитьПараметр("ДокументСсылка" , Ссылка);
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.Дата,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.Номер,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.Организация,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.Организация.Код,
	|	ВЫБОР
	|		КОГДА ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.Организация.ГоловнаяОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|			ТОГДА ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.Организация
	|		ИНАЧЕ ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.Организация.ГоловнаяОрганизация
	|	КОНЕЦ КАК ГоловнаяОрганизация,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.Организация.НаименованиеПолное КАК ОрганизацияНаименованиеПолное,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.Организация.НаименованиеСокращенное КАК ОрганизацияНаименованиеСокращенное,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.Организация.РегистрационныйНомерПФР,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.Организация.ИНН,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.Организация.КПП,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.Организация.ЮрФизЛицо,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.Организация.ОГРН,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.Организация.НаименованиеОКОПФ,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.Организация.Наименование,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.Ответственный,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.ВидАДВ,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.ФорматФайла,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.Ссылка,
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.НомерПачки
	|ИЗ
	|	Документ.ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства КАК ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства
	|ГДЕ
	|	ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.Ссылка = &ДокументСсылка";
	
	Возврат Запрос.Выполнить();
	
КонецФункции // СформироватьЗапросПоШапке()

// Выбирает данные, необходимые для заполнения утвержденных форм как из спр-ка
//  физлиц, так и из соотв. регистров сведений
//
// Параметры: 
//  Нет
//
// Возвращаемое значение:
//  Результат запроса к данным работников документа.
//
Функция СформироватьЗапросПоРаботникиОрганизации(ВыборкаПоШапкеДокумента)
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	// Установим параметры запроса
	Запрос.УстановитьПараметр("ДокументСсылка",				Ссылка);
	Запрос.УстановитьПараметр("ДатаАктуальности",			Дата);
	Запрос.УстановитьПараметр("Организация",				Организация);
	Запрос.УстановитьПараметр("ГоловнаяОрганизация",		ВыборкаПоШапкеДокумента.ГоловнаяОрганизация);
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ЗаявлениеРаботникиОрганизации.Ссылка,
	|	ЗаявлениеРаботникиОрганизации.НомерСтроки,
	|	ЗаявлениеРаботникиОрганизации.ФизЛицо,
	|	ЗаявлениеРаботникиОрганизации.ДатаПолученияСвидетельства,
	|	ЗаявлениеРаботникиОрганизации.ФизЛицо.Наименование КАК ФизЛицоНаименование,
	|	ЗаявлениеРаботникиОрганизации.СтраховойНомерПФРВСвидетельстве,
	|	ЗаявлениеРаботникиОрганизации.ФамилияВСвидетельстве,
	|	ЗаявлениеРаботникиОрганизации.ИмяВСвидетельстве,
	|	ЗаявлениеРаботникиОрганизации.ОтчествоВСвидетельстве,
	|	ЗаявлениеРаботникиОрганизации.ПолВСвидетельстве,
	|	ЗаявлениеРаботникиОрганизации.ДатаРожденияВСвидетельстве,
	|	ЗаявлениеРаботникиОрганизации.МестоРожденияВСвидетельстве,
	|	ЗаявлениеРаботникиОрганизации.Фамилия,
	|	ЗаявлениеРаботникиОрганизации.Имя,
	|	ЗаявлениеРаботникиОрганизации.Отчество,
	|	ЗаявлениеРаботникиОрганизации.Пол,
	|	ЗаявлениеРаботникиОрганизации.ДатаРождения,
	|	ЗаявлениеРаботникиОрганизации.МестоРождения,
	|	ЗаявлениеРаботникиОрганизации.Гражданство,
	|	ЗаявлениеРаботникиОрганизации.АдресРегистрации,
	|	ЕСТЬNULL(ЗаявлениеРаботникиОрганизации.Гражданство.Наименование, """") КАК ГражданствоНаименование,
	|	ЗаявлениеРаботникиОрганизации.АдресФактический,
	|	ЗаявлениеРаботникиОрганизации.Телефоны,
	|	ЗаявлениеРаботникиОрганизации.ОтметкаОПредставленииСведений,
	|	ЗаявлениеРаботникиОрганизации.ПризнакОтменыОтчества,
	|	ЗаявлениеРаботникиОрганизации.ПризнакОтменыМестаРождения
	|ПОМЕСТИТЬ ВТСписокФизлиц
	|ИЗ
	|	Документ.ЗаявлениеОбОбменеДубликатеСтраховогоСвидетельства.РаботникиОрганизации КАК ЗаявлениеРаботникиОрганизации
	|ГДЕ
	|	ЗаявлениеРаботникиОрганизации.Ссылка = &ДокументСсылка";
	
	Запрос.Выполнить();
	СписокФизЛицТекст = "ВТСписокФизлиц";	
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	РаботникиЗаявления.СтраховойНомерПФРВСвидетельстве,
	|	РаботникиЗаявления.ФамилияВСвидетельстве,
	|	РаботникиЗаявления.ИмяВСвидетельстве,
	|	РаботникиЗаявления.ОтчествоВСвидетельстве,
	|	РаботникиЗаявления.ПолВСвидетельстве,
	|	РаботникиЗаявления.ДатаРожденияВСвидетельстве,
	|	РаботникиЗаявления.МестоРожденияВСвидетельстве,
	|	РаботникиЗаявления.Фамилия,
	|	РаботникиЗаявления.Имя,
	|	РаботникиЗаявления.Отчество,
	|	РаботникиЗаявления.Пол,
	|	РаботникиЗаявления.ДатаРождения,
	|	РаботникиЗаявления.МестоРождения,
	|	РаботникиЗаявления.Телефоны,
	|	РаботникиЗаявления.ОтметкаОПредставленииСведений,
	|	РаботникиЗаявления.ПризнакОтменыОтчества,
	|	РаботникиЗаявления.ПризнакОтменыМестаРождения,
	|	ЕСТЬNULL(ВЫБОР
	|			КОГДА РаботникиЗаявления.Гражданство = ЗНАЧЕНИЕ(Справочник.КлассификаторСтранМира.Россия)
	|				ТОГДА """"
	|			ИНАЧЕ РаботникиЗаявления.ГражданствоНаименование
	|		КОНЕЦ, """") КАК Гражданство,
	|	РаботникиЗаявления.АдресРегистрации,
	|	РаботникиЗаявления.АдресФактический,
	|	РаботникиЗаявления.НомерСтроки КАК НомерСтроки,
	|	РаботникиЗаявления.ФизЛицо,
	|	РаботникиЗаявления.ФизЛицоНаименование,
	|	РаботникиЗаявления.ДатаПолученияСвидетельства,
	|	ПаспортныеДанныеФизЛицСрезПоследних.ДокументВид,
	|	ПаспортныеДанныеФизЛицСрезПоследних.ДокументВид.КодИМНС КАК КодИМНС,
	|	ПаспортныеДанныеФизЛицСрезПоследних.ДокументСерия,
	|	ПаспортныеДанныеФизЛицСрезПоследних.ДокументНомер,
	|	ПаспортныеДанныеФизЛицСрезПоследних.ДокументДатаВыдачи,
	|	ВЫРАЗИТЬ(ПаспортныеДанныеФизЛицСрезПоследних.ДокументКемВыдан КАК СТРОКА(300)) КАК ДокументКемВыдан,
	|	ПаспортныеДанныеФизЛицСрезПоследних.ДокументВид.КодПФР,
	|	ПаспортныеДанныеФизЛицСрезПоследних.ДокументВид.Наименование,
	|	ВЫБОР
	|		КОГДА РаботникиОрганизации.ФизЛицо ЕСТЬ НЕ NULL
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ФизЛицоРаботаетВОрганизации
	|ИЗ
	|	" + СписокФизЛицТекст + " КАК РаботникиЗаявления
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПаспортныеДанныеФизЛиц.СрезПоследних(&ДатаАктуальности, ФизЛицо В (ВЫБРАТЬ ФизЛицо ИЗ " + СписокФизЛицТекст + " КАК СписокФизЛиц)) КАК ПаспортныеДанныеФизЛицСрезПоследних
	|		ПО РаботникиЗаявления.ФизЛицо = ПаспортныеДанныеФизЛицСрезПоследних.ФизЛицо
	|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
	|			РаботникиОрганизации.Сотрудник.Физлицо КАК ФизЛицо
	|		ИЗ
	|			РегистрСведений.РаботникиОрганизаций.СрезПоследних(
	|				&ДатаАктуальности,
	|				Организация = &ГоловнаяОрганизация
	|					И Сотрудник.Физлицо В (ВЫБРАТЬ ФизЛицо ИЗ " + СписокФизЛицТекст + " КАК СписокФизЛиц)
	|					И Сотрудник.ВидЗанятости <> ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ВнутреннееСовместительство)) КАК РаботникиОрганизации
	|		ГДЕ
	|			ВЫБОР
	|					КОГДА РаботникиОрганизации.ПериодЗавершения <= &ДатаАктуальности
	|							И РаботникиОрганизации.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|						ТОГДА РаботникиОрганизации.ПричинаИзмененияСостоянияЗавершения
	|					ИНАЧЕ РаботникиОрганизации.ПричинаИзмененияСостояния
	|				КОНЕЦ <> ЗНАЧЕНИЕ(Перечисление.ПричиныИзмененияСостояния.Увольнение)
	|			И ВЫБОР
	|					КОГДА РаботникиОрганизации.ПериодЗавершения <= &ДатаАктуальности
	|							И РаботникиОрганизации.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|						ТОГДА РаботникиОрганизации.ОбособленноеПодразделениеЗавершения
	|					ИНАЧЕ РаботникиОрганизации.ОбособленноеПодразделение
	|				КОНЕЦ = &Организация
	|		
	|		ОБЪЕДИНИТЬ
	|		
	|		ВЫБРАТЬ РАЗЛИЧНЫЕ
	|			ДоговорНаВыполнениеРаботСФизЛицом.Сотрудник.Физлицо
	|		ИЗ
	|			Документ.ДоговорНаВыполнениеРаботСФизЛицом КАК ДоговорНаВыполнениеРаботСФизЛицом
	|		ГДЕ
	|			ДоговорНаВыполнениеРаботСФизЛицом.ДатаНачала <= &ДатаАктуальности
	|			И ДоговорНаВыполнениеРаботСФизЛицом.ДатаОкончания >= &ДатаАктуальности
	|			И ДоговорНаВыполнениеРаботСФизЛицом.Проведен
	|			И ДоговорНаВыполнениеРаботСФизЛицом.Сотрудник.Физлицо В (ВЫБРАТЬ ФизЛицо ИЗ " + СписокФизЛицТекст + " КАК СписокФизЛиц)
	|			И ДоговорНаВыполнениеРаботСФизЛицом.Организация = &Организация) КАК РаботникиОрганизации
	|		ПО РаботникиЗаявления.ФизЛицо = РаботникиОрганизации.ФизЛицо
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерСтроки";
	
	Возврат Запрос.Выполнить();
	
КонецФункции

// Проверяет правильность заполнения шапки документа.
// Если какой-то из реквизитов шапки, влияющий на проведение не заполнен или
// заполнен не корректно, то выставляется флаг отказа в проведении.
// Проверка выполняется по выборке из результата запроса по шапке,
// все проверяемые реквизиты должны быть включены в выборку по шапке.
//
// Параметры: 
//  ВыборкаПоШапкеДокумента	- выборка из результата запроса по шапке документа,
//  Отказ 					- флаг отказа в проведении.
//	Заголовок				- Заголовок для сообщений об ошибках проведения
//
Процедура ПроверитьЗаполнениеШапки(ВыборкаПоШапкеДокумента, Отказ, Заголовок)
	
	Если НЕ ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.Организация) Тогда
		ОбщегоНазначения.ВывестиИнформациюОбОшибке(ОбщегоНазначения.ПреобразоватьСтрокуИнтерфейса("Не указана организация, которая подает сведения!"), Отказ, Заголовок);
	КонецЕсли;
	
	Если НЕ ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.Ответственный) Тогда
		ОбщегоНазначения.ВывестиИнформациюОбОшибке("Не указано ответственное лицо!", Отказ, Заголовок);
	КонецЕсли;
	
	Если НЕ ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.ФорматФайла) Тогда
		ОбщегоНазначения.ВывестиИнформациюОбОшибке("Не указан формат файла!", Отказ, Заголовок);
		
	ИначеЕсли ВыборкаПоШапкеДокумента.ФорматФайла = Перечисления.ФорматФайлаПФР.Версия07 Тогда	
		Если НЕ ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.ОрганизацияНаименованиеОКОПФ) Тогда
			ОбщегоНазначения.ВывестиИнформациюОбОшибке(ОбщегоНазначения.ПреобразоватьСтрокуИнтерфейса("Предупреждение: Не указано наименование ОКОПФ организации"),,Заголовок);
			
		ИначеЕсли СтрДлина(ВыборкаПоШапкеДокумента.ОрганизацияНаименованиеОКОПФ) > 40 Тогда
			ОбщегоНазначения.ВывестиИнформациюОбОшибке(ОбщегоНазначения.ПреобразоватьСтрокуИнтерфейса("Предупреждение: Наименование ОКОПФ организации обрезано до 40 символов."),,Заголовок);
			
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры // ПроверитьЗаполнениеШапки()

// Проверяет правильность заполнения реквизитов в строке ТЧ "РаботникиОрганизации" документа.
// Если какой-то из реквизитов, влияющий на проведение не заполнен или
// заполнен не корректно, то выставляется флаг отказа в проведении.
// Проверка выполняется по выборке из результата запроса по строке ТЧ документа,
// все проверяемые реквизиты должны быть включены в выборку.
//
// Параметры: 
//  ВыборкаПоШапкеДокумента		- выборка из результата запроса по шапке документа,
//  ВыборкаПоСтрокамДокумента	- спозиционированная на определеной строке выборка 
//  							  из результата запроса по работникам, 
//  Отказ 						- флаг отказа в проведении.
//	Заголовок					- Заголовок для сообщений об ошибках проведения
//
Процедура ПроверитьЗаполнениеСтрокиРаботникаОрганизации(ВыборкаПоШапкеДокумента, ВыборкаПоСтрокамДокумента, Отказ, Заголовок)
	
	// ФизЛицо
	Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ФизЛицо) Тогда
		СтрокаНачалоСообщения = "В табличной части ""Сотрудники"" в строке № "+ СокрЛП(ВыборкаПоСтрокамДокумента.НомерСтроки)+":"+ Символы.ПС + Символы.Таб;
		ОбщегоНазначения.ВывестиИнформациюОбОшибке(СтрокаНачалоСообщения + "- не выбран сотрудник!", Отказ, Заголовок);
	Иначе
		
		//Проверка реквизитов страницы "РаботникиОрганизации"
		СтрокаСообщения = "";
		
		Если ВидАДВ = Перечисления.ВидыАДВ.АДВ2 тогда
			
		Иначе
			Если (НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ОтметкаОПредставленииСведений)) Тогда
				СтрокаСообщения = СтрокаСообщения + Символы.ПС+Символы.Таб + "- не указана отметка о предоставлении сведений!";
			КонецЕсли;
			
		КонецЕсли;
		
		//Паспортные данные
		Если ВыборкаПоСтрокамДокумента.ДокументВид = NULL Тогда
			
			СтрокаСообщения = СтрокаСообщения + Символы.ПС+Символы.Таб +  "- не указаны паспортные данные!";
			
		Иначе
			
			Если НЕ ВыборкаПоСтрокамДокумента.ФизЛицоРаботаетВОрганизации тогда
				СтрокаСообщения = СтрокаСообщения  + Символы.ПС+Символы.Таб +  "- сотрудник не работает в организации " + ВыборкаПоШапкеДокумента.ОрганизацияНаименование + "!";
			КонецЕсли;
			
			УказанВидДокумента = ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ДокументВид);
			СообщениеОбОшибке =  "";
			
			//Проверка реквизитов паспортных данных
			Если Не УказанВидДокумента Тогда
				СтрокаСообщения = СтрокаСообщения + Символы.ПС+Символы.Таб + "- не задан документ, удостоверяющий личность!";
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ДокументДатаВыдачи) Тогда
				СтрокаСообщения = СтрокаСообщения + Символы.ПС+Символы.Таб + "- не задана дата выдачи документа, удостоверяющего личность!";
			Иначе
				Если (ВыборкаПоСтрокамДокумента.ДатаРождения > ВыборкаПоСтрокамДокумента.ДокументДатаВыдачи) Тогда
					СтрокаСообщения = СтрокаСообщения + Символы.ПС+Символы.Таб + "- дата рождения не должна превышать дату выдачи документа, удостоверяющего личность!";
				КонецЕсли;
			КонецЕсли;
			Если ВыборкаПоСтрокамДокумента.ДокументВид <> Справочники.ДокументыУдостоверяющиеЛичность.ИМНС05
				И ВыборкаПоСтрокамДокумента.ДокументВид <> Справочники.ДокументыУдостоверяющиеЛичность.ИМНС10
				И ВыборкаПоСтрокамДокумента.ДокументВид <> Справочники.ДокументыУдостоверяющиеЛичность.ИМНС11
				И ВыборкаПоСтрокамДокумента.ДокументВид <> Справочники.ДокументыУдостоверяющиеЛичность.ИМНС12
				И ВыборкаПоСтрокамДокумента.ДокументВид <> Справочники.ДокументыУдостоверяющиеЛичность.ИМНС13
				И ВыборкаПоСтрокамДокумента.ДокументВид <> Справочники.ДокументыУдостоверяющиеЛичность.ИМНС14
				И ВыборкаПоСтрокамДокумента.ДокументВид <> Справочники.ДокументыУдостоверяющиеЛичность.ИМНС15 // Документы, серию и номер которых не нужно проверять
				И ВыборкаПоСтрокамДокумента.ДокументВид <> Справочники.ДокументыУдостоверяющиеЛичность.ИМНС91  Тогда
				
				Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ДокументСерия) Тогда
					СтрокаСообщения = СтрокаСообщения + Символы.ПС+Символы.Таб +  "- не задана серия документа, удостоверяющего личность!";
				ИначеЕсли УказанВидДокумента 
					И НЕ ПроцедурыПерсонифицированногоУчета.ПроверитьСериюУдостоверенияЛичности(ВыборкаПоСтрокамДокумента.ДокументВид,ВыборкаПоСтрокамДокумента.ДокументСерия, СообщениеОбОшибке) Тогда 
					СтрокаСообщения = СтрокаСообщения + Символы.ПС+Символы.Таб +  "- ошибка в серии удостоверения личности "+ СообщениеОбОшибке;
				КонецЕсли;
				Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ДокументНомер) Тогда
					СтрокаСообщения = СтрокаСообщения + Символы.ПС+Символы.Таб +  "- не задан номер документа, удостоверяющего личность!";
				ИначеЕсли УказанВидДокумента 
					И НЕ ПроцедурыПерсонифицированногоУчета.ПроверитьНомерУдостоверенияЛичности(ВыборкаПоСтрокамДокумента.ДокументВид,ВыборкаПоСтрокамДокумента.ДокументНомер, СообщениеОбОшибке) Тогда 
					СтрокаСообщения = СтрокаСообщения + Символы.ПС+Символы.Таб +  "- ошибка в номере удостоверения личности. "+ СообщениеОбОшибке;
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
		
		Если СтрокаСообщения <> "" тогда
			СтрокаСообщения = "Для сотрудника, указанного в строке № "+ СокрЛП(ВыборкаПоСтрокамДокумента.НомерСтроки)+" табличной части ""Сотрудники"""+ СтрокаСообщения;
			ОбщегоНазначения.ВывестиИнформациюОбОшибке(СтрокаСообщения, Отказ, Заголовок);
		КонецЕсли;
		
		//Проверка реквизитов страницы "Данные, указанные в свидетельстве"
		СтрокаСообщения = "";
		
		Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ФамилияВСвидетельстве) Тогда
			СтрокаСообщения = СтрокаСообщения + Символы.ПС+Символы.Таб + "- не указана фамилия!";
		КонецЕсли;
		
		Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ИмяВСвидетельстве) Тогда
			СтрокаСообщения = СтрокаСообщения + Символы.ПС+Символы.Таб + "- не указано имя!";
		КонецЕсли;
		
		Если ВидАДВ = Перечисления.ВидыАДВ.АДВ2 тогда
			
		Иначе//Вид АДВ-3
			Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ПолВСвидетельстве) Тогда
				СтрокаСообщения = СтрокаСообщения + Символы.ПС+Символы.Таб + "- не указан пол!";
			КонецЕсли;
			Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ДатаРожденияВСвидетельстве) Тогда
				СтрокаСообщения = СтрокаСообщения + Символы.ПС+Символы.Таб + "- не указана дата рождения!";
			КонецЕсли;
			
		КонецЕсли;
		
		//Проверка на указание пустого или неверного страхового номера ("   -   -      ")
		Если НЕ ЗначениеЗаполнено(СтрЗаменить(ВыборкаПоСтрокамДокумента.СтраховойНомерПФРВСвидетельстве,"-","")) Тогда
			СтрокаСообщения = СтрокаСообщения + Символы.ПС+Символы.Таб + "- не указан номер страхового свидетельства!";
			
		ИначеЕсли Не РегламентированнаяОтчетность.СтраховойНомерПФРСоответствуетТребованиям(ВыборкаПоСтрокамДокумента.СтраховойНомерПФРВСвидетельстве) тогда
			СтрокаСообщения = СтрокаСообщения + Символы.ПС+Символы.Таб + "- задан неверный номер страхового свидетельства!";
			
		КонецЕсли;
		
		Если СтрокаСообщения <> "" тогда
			СтрокаСообщения = "На закладке ""Данные, указанные в свидетельстве"" в строке № "+ СокрЛП(ВыборкаПоСтрокамДокумента.НомерСтроки)+":"+ СтрокаСообщения;
			ОбщегоНазначения.ВывестиИнформациюОбОшибке(СтрокаСообщения, Отказ, Заголовок);
		КонецЕсли;
		
		//Проверка реквизитов страницы "Изменившиеся данные"
		СтрокаСообщения = "";
		
		Если ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.АдресРегистрации) Тогда 
			
			АдресРегистрацииСписком = УправлениеКонтактнойИнформацией.ПолучитьСтруктуруАдресаИзСтроки(ВыборкаПоСтрокамДокумента.АдресРегистрации);
			ЗаПределамиРФ = Ложь;
			АдресРегистрацииСписком.Свойство("ЗаПределамиРФ", ЗаПределамиРФ);
			// значение переменной ЗаПределамиРФ может быть Неопределено
			Если ЗаПределамиРФ <> Истина Тогда
				Если  РегламентированнаяОтчетность.АдресСоответствуетТребованиям(АдресРегистрацииСписком) Тогда
					ТекстОшибки = ПроцедурыПерсонифицированногоУчета.ПроверитьАдресПоКЛАДР(АдресРегистрацииСписком);
					
					Если НЕ ПустаяСтрока(ТекстОшибки) Тогда
						ОбщегоНазначения.ВывестиИнформациюОбОшибке("На закладке ""Изменившиеся данные"" в строке № "+ СокрЛП(ВыборкаПоСтрокамДокумента.НомерСтроки)+": Адрес регистрации не соответствует адресному классификатору: в классификаторе не найден" + ТекстОшибки + "!", , Заголовок);
					КонецЕсли;
				Иначе
					СтрокаСообщения = СтрокаСообщения + Символы.ПС+Символы.Таб + "- адрес регистрации заполнен не полностью или неверно или присутствуют латинские или недопустимые символы!";
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
		
		Если ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.АдресФактический) Тогда
			
			АдресФактическийСписком = УправлениеКонтактнойИнформацией.ПолучитьСтруктуруАдресаИзСтроки(ВыборкаПоСтрокамДокумента.АдресФактический);
			ЗаПределамиРФ = Ложь;
			АдресФактическийСписком.Свойство("ЗаПределамиРФ", ЗаПределамиРФ);
			Если ЗаПределамиРФ <> Истина Тогда
				Если РегламентированнаяОтчетность.АдресСоответствуетТребованиям(АдресФактическийСписком) Тогда
					ТекстОшибки = ПроцедурыПерсонифицированногоУчета.ПроверитьАдресПоКЛАДР(АдресФактическийСписком);
					Если НЕ ПустаяСтрока(ТекстОшибки) Тогда
						ОбщегоНазначения.ВывестиИнформациюОбОшибке("На закладке ""Изменившиеся данные"" в строке № "+ СокрЛП(ВыборкаПоСтрокамДокумента.НомерСтроки)+": Фактический адрес проживания не соответствует адресному классификатору: в классификаторе не найден" + ТекстОшибки + "!", , Заголовок);
					КонецЕсли;
				Иначе
					СтрокаСообщения = СтрокаСообщения + Символы.ПС+Символы.Таб + "- фактический адрес проживания заполнен не полностью или неверно или присутствуют латинские или недопустимые символы!";
				КонецЕсли;
			КонецЕсли;
			
		КонецЕсли;
		
		Если ВидАДВ = Перечисления.ВидыАДВ.АДВ2 Тогда 
			Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.Фамилия) И НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.Имя) И НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.Отчество)
				И НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.Пол)  И НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ДатаРождения) И НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.МестоРождения)
				И НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.АдресРегистрации) И НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.АдресФактический) 
				И НЕ(ВыборкаПоСтрокамДокумента.ПризнакОтменыОтчества) И НЕ(ВыборкаПоСтрокамДокумента.ПризнакОтменыМестаРождения) Тогда 
				СтрокаСообщения = СтрокаСообщения + Символы.ПС+Символы.Таб + "- не указаны изменившиеся данные!";
			КонецЕсли;
		КонецЕсли;
		
		Если ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ДатаРождения) Тогда 
			Если (ВыборкаПоСтрокамДокумента.ДатаРождения > Дата) Тогда
				СтрокаСообщения = СтрокаСообщения + Символы.ПС+Символы.Таб + "- дата рождения не должна превышать дату документа!";
			КонецЕсли;
		КонецЕсли;
		
		Если СтрокаСообщения <> "" Тогда 
			СтрокаСообщения = "На закладке ""Изменившиеся данные"" в строке № "+ СокрЛП(ВыборкаПоСтрокамДокумента.НомерСтроки)+":"+ СтрокаСообщения;
			ОбщегоНазначения.ВывестиИнформациюОбОшибке(СтрокаСообщения, Отказ, Заголовок);
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры // ПроверитьЗаполнениеСтрокиРаботникаОрганизации()

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ

Процедура ОбработкаПроведения(Отказ, Режим)
	
	ОбработкаКомментариев = глЗначениеПеременной("глОбработкаСообщений");
	ОбработкаКомментариев.УдалитьСообщения();
	
	// Заголовок для сообщений об ошибках проведения.
	Заголовок = ОбщегоНазначения.ПредставлениеДокументаПриПроведении(Ссылка);
	
	// Получим реквизиты шапки из запроса
	ВыборкаПоШапкеДокумента = СформироватьЗапросПоШапке().Выбрать();
	
	Если ВыборкаПоШапкеДокумента.Следующий() Тогда
		
		//Надо позвать проверку заполнения реквизитов шапки
		ПроверитьЗаполнениеШапки(ВыборкаПоШапкеДокумента, Отказ, Заголовок);
		
	КонецЕсли;
	
	//При проведении файл формируем заново 
	Если Не Отказ Тогда
		ТекстФайла = СформироватьВыходнойФайл(Отказ);
	КонецЕсли;
	
	ОбработкаКомментариев.ПоказатьСообщения();
	
	Если Отказ тогда
		Возврат;
	КонецЕсли;
	
	//Сохраним сформированный файл сведений в регистре сведений
	Запись = Движения.АрхивДанныхРегламентированнойОтчетности.Добавить();
	Запись.Объект = Ссылка;
	Запись.ОписаниеДанных = "Файл-пачка форм "+ВидАДВ;
	Запись.Данные = ТекстФайла;
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	ПроцедурыПерсонифицированногоУчета.ПроставитьНомерПачки(ЭтотОбъект);
	
	МассивТЧ = Новый Массив();
	МассивТЧ.Добавить(РаботникиОрганизации);
	
	КраткийСоставДокумента = ПроцедурыУправленияПерсоналом.ЗаполнитьКраткийСоставДокумента(МассивТЧ, "Физлицо");
	
КонецПроцедуры